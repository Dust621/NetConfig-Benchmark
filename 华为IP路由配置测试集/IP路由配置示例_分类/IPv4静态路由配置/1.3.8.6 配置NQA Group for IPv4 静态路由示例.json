{
  "topology": "网络拓扑采用BGP冗余备份设计，共包含6台网络设备。DeviceA作为核心设备，通过LoopBack0接口(1.1.1.1/32)建立BGP邻居关系，AS号为100。DeviceA的GE1/0/0接口(172.16.3.1/24)连接DeviceB的GE1/0/0接口(172.16.3.2/24)，GE1/0/1接口(172.16.4.1/24)连接DeviceC的GE1/0/1接口(172.16.4.2/24)。\n\nDeviceB作为主用设备，LoopBack0接口为2.2.2.2/32，配置BGP preferred-value为200。DeviceB通过两条冗余链路连接DeviceD：GE1/0/1接口(172.16.1.1/24)经DeviceB1连接到DeviceD的GE1/0/1接口(172.16.1.2/24)，GE1/0/2接口(172.16.2.1/24)经DeviceB2连接到DeviceD的GE1/0/2接口(172.16.2.2/24)。\n\nDeviceC作为备用设备，LoopBack0接口为3.3.3.3/32，配置BGP preferred-value为100。DeviceC的GE1/0/0接口(172.16.6.1/24)直连DeviceD的GE1/0/3接口(172.16.6.2/24)。\n\nDeviceB1和DeviceB2作为中继设备，分别提供DeviceB到DeviceD的备用路径。DeviceB1的接口配置为interface1(172.16.1.2/24)和interface2(172.16.7.1/24)，DeviceB2的接口配置为interface1(172.16.2.2/24)、interface2(172.16.5.1/24)和interface3(172.16.7.2/24)。\n\nDeviceD作为目标设备，具有多个接口：interface1(172.16.1.2/24)、interface2(172.16.5.2/24)、interface3(172.16.6.2/24)，分别与不同路径的设备相连。\n\n网络通过NQA Group配置实现链路检测，DeviceB配置两个NQA测试实例分别检测到172.16.1.2和172.16.2.2的连通性，采用OR逻辑关联，确保主备路径的自动切换功能。",
  "requirement": "配置NQA Group for IPv4静态路由可以利用NQA Group关联多个NQA测试例，实现对多条链路的检测，快速检测到网络的故障，控制IPv4静态路由的发布，实现业务切换。正常情况下，要求业务流量走主用链路DeviceB→DeviceD。当主用链路出现故障后，即DeviceB的默认IPv4静态路由绑定的NQA Group通过检测DeviceB到DeviceD的两条链路判断IPv4静态路由不活跃，则业务流量切换到备用链路DeviceC→DeviceD。",
  "steps": [
    "创建ICMP类型的NQA测试例。",
    "创建NQA Group。",
    "配置静态路由。",
    "配置BGP路由协议。",
    "BGP协议引入IPv4静态路由。"
  ],
  "configs": {
    "DeviceA": "#\nsysname DeviceA\n#\nrouter id 1.1.1.1\n#\ninterface LoopBack0\n ip address 1.1.1.1 255.255.255.255\n#\ninterface GigabitEthernet 1/0/0\n ip address 172.16.3.1 255.255.255.0\n#\ninterface GigabitEthernet 1/0/1\n ip address 172.16.4.1 255.255.255.0\n#\nbgp 100\n peer 2.2.2.2 as-number 100\n peer 2.2.2.2 connect-interface LoopBack0\n peer 3.3.3.3 as-number 100\n peer 3.3.3.3 connect-interface LoopBack0\n #\n ipv4-family unicast\n  undo synchronization\n  peer 2.2.2.2 enable\n  peer 3.3.3.3 enable\n#\nip route-static 2.2.2.2 255.255.255.255 GigabitEthernet 1/0/0 172.16.3.2\nip route-static 3.3.3.3 255.255.255.255 GigabitEthernet 1/0/1 172.16.4.2\n#\nreturn",
    "DeviceB": "#\nsysname DeviceB\n#\nrouter id 2.2.2.2\n#\ninterface LoopBack0\n ip address 2.2.2.2 255.255.255.255\n#\ninterface GigabitEthernet 1/0/0\n ip address 172.16.3.2 255.255.255.0\n#\ninterface GigabitEthernet 1/0/1\n ip address 172.16.1.1 255.255.255.0\n#\ninterface GigabitEthernet 1/0/2\n ip address 172.16.2.1 255.255.255.0\n#\nbgp 100\n peer 1.1.1.1 as-number 100\n peer 1.1.1.1 connect-interface LoopBack0\n #\n ipv4-family unicast\n  import-route static\n  peer 1.1.1.1 preferred-value 200\n#\nip route-static 0.0.0.0 32 NULL0 track nqa-group group1\nip route-static 1.1.1.1 255.255.255.255 GigabitEthernet 1/0/0 172.16.3.1\n#\nnqa test-instance user1 test1\n test-type icmp\n destination-address ipv4 172.16.1.2\n interval seconds 5\n timeout 4\n probe-count 3\n frequency 10\n start now\n#\nnqa test-instance user2 test2\n test-type icmp\n destination-address ipv4 172.16.2.2\n interval seconds 5\n timeout 4\n probe-count 3\n frequency 10\n start now\n#\nnqa group group1\n nqa test-instance user1 test1\n nqa test-instance user2 test2\n operator or\n#\nreturn",
    "DeviceC": "#\nsysname DeviceC\n#\nrouter id 3.3.3.3\n#\ninterface LoopBack0\n ip address 3.3.3.3 255.255.255.255\n#\ninterface GigabitEthernet1/0/0\n ip address 172.16.6.1 255.255.255.0\n#\ninterface GigabitEthernet1/0/1\n ip address 172.16.4.2 255.255.255.0\n#\nbgp 100\n peer 1.1.1.1 as-number 100\n peer 1.1.1.1 connect-interface LoopBack0\n #\n ipv4-family unicast\n  import-route static\n  peer 1.1.1.1 preferred-value 100\n#\nip route-static 0.0.0.0 32 NULL0\nip route-static 1.1.1.1 255.255.255.255 GigabitEthernet1/0/1 172.16.4.1\n#\nreturn"
  },
  "related_images": [
    "图1-24 NQA Group for IPv4 静态路由实现组网图.png"
  ]
}