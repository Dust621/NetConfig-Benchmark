{
  "topology": "该网络拓扑由一台二层交换机Switch和三台三层设备Device1、Device2、Device3组成。Switch通过GigabitEthernet1/0/0和GigabitEthernet1/0/1接口分别连接Device1和Device2的GigabitEthernet1/0/0接口，所有接口均划分在VLAN 10中，形成用户侧接入网段10.1.1.0/24。\n\nDevice1作为VRRP主用设备（优先级120），Device2作为备用设备（默认优先级100），两设备通过VRRP协议在10.1.1.0/24网段提供虚拟网关服务，虚拟IP地址为10.1.1.111。Device1的GigabitEthernet1/0/1接口（10.1.3.1/24）与Device3的GigabitEthernet1/0/0接口（10.1.3.2/24）直连，形成传输网段10.1.3.0/24。Device2的GigabitEthernet1/0/1接口（10.1.2.1/24）与Device3的GigabitEthernet1/0/1接口（10.1.2.2/24）直连，形成传输网段10.1.2.0/24。\n\n三台设备均运行OSPF协议，Device1和Device2通过import-route direct命令将用户网段10.1.1.0/24路由引入OSPF，Device3通过OSPF学习到两条等价路由。配置了direct-route track vrrp功能，当VRRP状态发生变化时，会调整直连路由的开销值（增加300），影响OSPF路由选择，从而实现流量路径的动态调整。\n\n用户上行流量通过VRRP虚拟IP发往主用设备Device1，下行流量因Device3存在两条等价OSPF路由而产生负载分担，导致上下行流量路径不对称的问题。",
  "requirement": "将 Device1 与 Device2 构成的 VRRP 备份组作为用户侧网关，用户访问网络的上行流量将发往 VRRP 主用设备 Device1。同时，Device1、Device2 和 Device3 之间运行 OSPF 协议以实现 IP 层互通。由网络返回到用户的下行流量路径将由 OSPF 选路决定。在本例中，Device3 上存在去往用户网段 10.1.1.0/24 的两条等价 OSPF 路由，因此下行流量将出现负载分担的情况。这样就导致了上下行流量路径不一致。",
  "steps": [
    "在 Device1 和 Device2 上配置 VRRP 备份组。",
    "在 Device1、Device2 和 Device3 上配置 OSPF，实现 IP 路由互通。",
    "在 Device1 和 Device2 上配置直连路由与 VRRP 联动。",
    "在 Device1 和 Device2 上配置 OSPF 引入直连路由，并配置继承 cost。"
  ],
  "configs": {
    "Switch": "#\nsysname Switch\n#\nvlan batch 10\n#\ninterface GigabitEthernet1/0/0\n portswitch\n undo shutdown\n port default vlan 10\n#\ninterface GigabitEthernet1/0/1\n portswitch\n undo shutdown\n port default vlan 10",
    "Device1": "#\nsysname Device1\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.1.1.1 255.255.255.0\n vrrp vrid 1 virtual-ip 10.1.1.111\n vrrp vrid 1 priority 120\n direct-route track vrrp vrid 1 degrade-cost 300\n#\ninterface GigabitEthernet1/0/1\n undo shutdown\n ip address 10.1.3.1 255.255.255.0\n#\nospf 1\n default cost inherit-metric\n import-route direct\n area 0.0.0.0\n  network 10.1.3.0 0.0.0.255",
    "Device2": "#\nsysname Device2\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.1.1.2 255.255.255.0\n vrrp vrid 1 virtual-ip 10.1.1.111\n direct-route track vrrp vrid 1 degrade-cost 300\n#\ninterface GigabitEthernet1/0/1\n undo shutdown\n ip address 10.1.2.1 255.255.255.0\n#\nospf 1\n default cost inherit-metric\n import-route direct\n area 0.0.0.0\n  network 10.1.2.0 0.0.0.255",
    "Device3": "#\nsysname Device3\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.1.3.2 255.255.255.0\n#\ninterface GigabitEthernet1/0/1\n undo shutdown\n ip address 10.1.2.2 255.255.255.0\n#\nospf 1\n area 0.0.0.0\n  network 10.1.2.0 0.0.0.255\n  network 10.1.3.0 0.0.0.255"
  },
  "related_images": [
    "图1-15直连路由联动VRRP状态组网图.png"
  ]
}