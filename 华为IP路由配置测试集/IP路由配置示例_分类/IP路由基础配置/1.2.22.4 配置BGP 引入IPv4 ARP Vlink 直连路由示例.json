{
  "topology": "网络拓扑由5台设备组成：DeviceA、DeviceB、DeviceC、DeviceD和SwitchA，采用混合组网架构。\n\n物理连接关系：\n- DeviceA通过Interface1（10.1.1.3/24）连接至SwitchA的Interface1端口\n- DeviceB通过Interface1（10.1.1.4/24）连接至SwitchA的Interface3端口  \n- SwitchA通过Interface2连接至DeviceC的GE1/0/0端口\n- DeviceC通过GE2/0/0接口（10.2.1.1/24）与DeviceD的GE1/0/0接口（10.2.1.2/24）直连\n\nVLAN配置：\n- SwitchA配置VLAN 10，所有access端口归属该VLAN，VLANIF10接口地址为10.1.1.2/24\n- DeviceC的GE1/0/0配置为access模式，归属VLAN 10，VLANIF10接口地址为10.1.1.1/24\n\n网络分段：\n- VLAN 10网段：10.1.1.0/24，包含DeviceA、DeviceB、SwitchA和DeviceC的VLANIF接口\n- 互联网段：10.2.1.0/24，用于DeviceC与DeviceD的BGP邻居连接\n\n协议配置：\n- DeviceC和DeviceD运行BGP协议，AS号为100\n- DeviceC（Router-ID 3.3.3.3）与DeviceD（Router-ID 4.4.4.4）建立IBGP邻居关系\n- DeviceC发布直连路由，配置ARP Vlink直连路由通告功能，仅允许DeviceB（10.1.1.4/32）的ARP路由通告\n- DeviceC出方向路由策略过滤10.1.1.0/24网段路由，实现对DeviceA的路由隔离\n\n该拓扑实现了VLAN内用户的选择性路由发布和流量控制，确保DeviceD只能与DeviceB互访，而无法访问DeviceA。",
  "requirement": "VLAN外部用户需要知道VLAN内的IPv4 ARP Vlink直连路由，并且针对不同的VLAN用户采取不同的流量控制策略。在DeviceC上配置发布IPv4 ARP Vlink直连路由，并且利用路由策略过滤掉网段路由和到DeviceA的路由。",
  "steps": [
    "在SwitchA和DeviceC上创建VLANIF，并且配置IP地址，保证DeviceA、DeviceB、SwitchA和DeviceC之间的互通。",
    "在DeviceC和DeviceD之间配置BGP协议，保证DeviceC和DeviceD之间可以相互传递路由。",
    "在DeviceC上配置发布IPv4 ARP Vlink直连路由，使IPv4 ARP Vlink直连路由可发布。",
    "在DeviceC上配置路由策略，只允许来源于DeviceB的路由通过。",
    "在DeviceC上配置BGP引入直连路由，并且应用路由策略只引入来源于DeviceB的路由。",
    "在DeviceC上配置BGP使用路由出口过滤策略，过滤掉VLAN所在网段路由，使DeviceD无法看到网段路由，只能使用ARP Vlink直连路由与VLAN内的用户通信。"
  ],
  "configs": {
    "DeviceA": "#\nsysname DeviceA\n#\ninterface GigabitEthernet 1/0/0\n undo shutdown\n ip address 10.1.1.3 255.255.255.0\n#\ncommit",
    "DeviceB": "#\nsysname DeviceB\n#\ninterface GigabitEthernet 1/0/0\n undo shutdown\n ip address 10.1.1.4 255.255.255.0\n#\ncommit",
    "DeviceC": "#\nsysname DeviceC\n#\ninterface GigabitEthernet 2/0/0\n undo shutdown\n ip address 10.2.1.1 255.255.255.0\n#\nvlan 10\n#\ninterface GigabitEthernet 1/0/0\n portswitch\n undo shutdown\n port link-type access\n port default vlan 10\n#\ninterface Vlanif 10\n ip address 10.1.1.1 255.255.255.0\n#\nbgp 100\n router-id 3.3.3.3\n peer 10.2.1.2 as-number 100\n import-route direct\n#\nip ip-prefix prefix1 permit 10.1.1.4 32\nroute-policy policy1 permit node 10\n if-match ip-prefix prefix1\n#\narp vlink-direct-route advertise route-policy policy1\n#\nip ip-prefix prefix2 index 10 deny 10.1.1.0 24\nip ip-prefix prefix2 index 20 permit 0.0.0.0 0 less-equal 32\nroute-policy policy2 permit node 10\n if-match ip-prefix prefix2\n#\nbgp 100\n peer 10.2.1.2 route-policy policy2 export\n#\ncommit",
    "DeviceD": "#\nsysname DeviceD\n#\ninterface GigabitEthernet 1/0/0\n undo shutdown\n ip address 10.2.1.2 255.255.255.0\n#\nbgp 100\n router-id 4.4.4.4\n peer 10.2.1.1 as-number 100\n#\ncommit",
    "SwitchA": "#\nsysname SwitchA\n#\nvlan batch 10\n#\ninterface GigabitEthernet1/0/0\n portswitch\n undo shutdown\n port link-type access\n port default vlan 10\n#\ninterface GigabitEthernet2/0/0\n portswitch\n undo shutdown\n port link-type access\n port default vlan 10\n#\ninterface GigabitEthernet3/0/0\n portswitch\n undo shutdown\n port link-type access\n port default vlan 10\n#\ninterface Vlanif 10\n ip address 10.1.1.2 255.255.255.0\n#\ncommit"
  },
  "related_images": [
    "图1-16 配置BGP引入IPv4 ARP Vlink直连路由组网图.png"
  ]
}