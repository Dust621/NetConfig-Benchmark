{
  "topology": "基于网络拓扑图分析，增强的网络拓扑描述如下：\n\n**物理连接拓扑：**\n四台路由器设备通过以太网接口互连。DeviceA（AS 100）通过interface1连接DeviceB的interface1（10.12.1.1/24-10.12.1.2/24）。DeviceB作为核心节点，通过interface2连接DeviceC的interface1（10.23.1.2/24-10.23.1.3/24），通过interface3连接DeviceD的interface1（10.24.1.2/24-10.24.1.4/24）。DeviceC和DeviceD之间通过interface2和interface1直连（10.34.1.3/24-10.34.1.4/24）。\n\n**协议配置：**\n- **BGP配置**：四台设备均属于AS 100，配置IBGP邻居关系。DeviceB配置为路由反射器（Route Reflector），DeviceC为其反射客户端。各设备Router-ID分别为1.1.1.1（DeviceA）、2.2.2.2（DeviceB）、3.3.3.3（DeviceC）、4.4.4.4（DeviceD）。\n\n- **OSPF配置**：DeviceC和DeviceD运行OSPF进程1，同属区域0.0.0.0，网段10.34.1.0/24参与OSPF路由计算。\n\n**路由重分布与环路检测：**\nDeviceC配置OSPF引入BGP路由（import-route bgp permit-ibgp），DeviceD配置BGP引入OSPF路由（import-route ospf）。DeviceA启用OSPF和BGP环路检测功能，通过route loop-detect机制防止路由环路。DeviceA配置静态路由10.0.0.0/32指向NULL0接口。\n\n该拓扑实现BGP与OSPF的双向路由重分布，通过路由反射器简化IBGP配置，并采用环路检测机制确保网络稳定性。",
  "requirement": "在现网应用中，OSPF路由可以通过路由引入的方式在BGP进程进行重发布。此类场景通常通过多台设备协同配置路由策略防环。如果引入路由的设备路由策略配置不当，可能导致路由环路。为了避免该问题，可以在OSPF引入路由时，配置环路检测功能。",
  "steps": [
    "配置各设备接口的IP地址。",
    "在设备上使能OSPF和BGP，配置OSPF和BGP基本功能。",
    "配置路由引入，构造环路。",
    "验证是否存在路由环路。",
    "使能路由环路检测功能，验证环路是否解除。"
  ],
  "configs": {
    "DeviceA": "#\nsysname DeviceA\n#\ninterface GigabitEthernet1/0/0\n ip address 10.12.1.1 255.255.255.0\n quit\n#\nip route-static 10.0.0.0 255.255.255.255 NULL0\n#\nbgp 100\n router-id 1.1.1.1\n peer 10.12.1.2 as-number 100\n ipv4-family unicast\n  peer 10.12.1.2 enable\n quit\n#\nroute loop-detect ospf enable\nroute loop-detect bgp enable\n#\ncommit",
    "DeviceB": "#\nsysname DeviceB\n#\nbgp 100\n router-id 2.2.2.2\n peer 10.12.1.1 as-number 100\n peer 10.23.1.3 as-number 100\n peer 10.24.1.4 as-number 100\n ipv4-family unicast\n  peer 10.12.1.1 enable\n  peer 10.23.1.3 enable\n  peer 10.24.1.4 enable\n  peer 10.23.1.3 reflect-client\n quit\n#\ncommit",
    "DeviceC": "#\nsysname DeviceC\n#\nbgp 100\n router-id 3.3.3.3\n peer 10.23.1.2 as-number 100\n ipv4-family unicast\n  peer 10.23.1.2 enable\n quit\n#\nospf 1 router-id 3.3.3.3\n area 0.0.0.0\n  network 10.34.1.0 0.0.0.255\n quit\n import-route bgp permit-ibgp\n quit\n#\ncommit",
    "DeviceD": "#\nsysname DeviceD\n#\nbgp 100\n router-id 4.4.4.4\n peer 10.24.1.2 as-number 100\n ipv4-family unicast\n  peer 10.24.1.2 enable\n import-route ospf\n quit\n#\ncommit"
  },
  "related_images": [
    "图1-53 OSPF 引入BGP 路由环路检测.png"
  ]
}