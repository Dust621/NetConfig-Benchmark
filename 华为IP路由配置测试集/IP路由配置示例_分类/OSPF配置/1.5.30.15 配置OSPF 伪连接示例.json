{
  "topology": "根据网络拓扑图和配置文件分析，这是一个基于MPLS VPN的网络架构，具体拓扑描述如下：\n\n**物理拓扑结构：**\n- CE1（客户边缘路由器）通过接口GE1/0/0（172.16.1.1/24）连接PE1的GE1/0/0（172.16.1.2/24）\n- PE1（提供商边缘路由器）通过接口GE2/0/0（10.10.1.1/24）连接P路由器的GE1/0/0（10.10.1.2/24）\n- P（骨干网路由器）通过接口GE2/0/0（10.20.1.1/24）连接PE2的GE2/0/0（10.20.1.2/24）\n- PE2（提供商边缘路由器）通过接口GE1/0/0（172.16.2.2/24）连接CE2的GE1/0/0（172.16.2.1/24）\n- CE1通过接口GE2/0/0（10.1.1.1/24）连接RT0的GE1/0/0（10.1.1.2/24）\n- RT0通过接口GE2/0/0（10.2.1.1/24）连接CE2的GE2/0/0（10.2.1.2/24）\n\n**MPLS VPN配置：**\n- PE1和PE2配置相同的VPN实例vpn1，RD为100:1，RT为1:1\n- PE1-PE2之间建立MP-BGP邻居关系，用于VPNv4路由交换\n- MPLS骨干网（PE1-P-PE2）启用LDP协议进行标签分发\n\n**OSPF配置：**\n- 骨干网OSPF进程1：PE1、P、PE2的环回接口和骨干网链路属于区域0\n- VPN内OSPF进程100：CE1-PE1和CE2-PE2分别运行独立的OSPF实例\n- PE1和PE2之间配置OSPF Sham-link（5.5.5.5 ↔ 6.6.6.6），cost值为1\n- CE1-RT0-CE2形成区域内OSPF连接，RT0-CE1和RT0-CE2链路cost设置为10\n\n**关键网络特性：**\n- VPN流量通过MPLS骨干网转发，不依赖区域内OSPF路由\n- Sham-link确保VPN站点间流量优先走MPLS路径而非区域内路径\n- CE2配置环回接口8.8.8.8/32作为测试节点",
  "requirement": "CE与PE之间运行OSPF，CE1与CE2之间的VPN流量通过MPLS骨干网转发，不使用OSPF的区域内路由。",
  "steps": [
    "建立MP-IBGP对等体关系：PE之间建立MP-IBGP对等体关系，PE与CE运行OSPF协议来建立连接。",
    "创建VPN实例：在PE上创建VPN实例，并绑定与CE相连的接口。",
    "创建OSPF伪连接：在PE上创建OSPF伪连接。",
    "调整接口cost值：调整用户网络转发接口的cost值，使其比sham link的cost值大。"
  ],
  "configs": {
    "PE1": "#\nsysname PE1\n#\nip vpn-instance vpn1\n ipv4-family\n  route-distinguisher 100:1\n  apply-label per-instance\n  vpn-target 1:1 export-extcommunity\n  vpn-target 1:1 import-extcommunity\n#\nmpls lsr-id 1.1.1.9\n#\nmpls\n#\nmpls ldp\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip binding vpn-instance vpn1\n ip address 172.16.1.2 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.10.1.1 255.255.255.0\n mpls\n mpls ldp\n#\ninterface LoopBack1\n ip address 1.1.1.9 255.255.255.255\n#\ninterface LoopBack10\n ip binding vpn-instance vpn1\n ip address 5.5.5.5 255.255.255.255\n#\nbgp 100\n peer 3.3.3.9 as-number 100\n peer 3.3.3.9 connect-interface LoopBack1\n #\n ipv4-family unicast\n  undo synchronization\n  peer 3.3.3.9 enable\n #\n ipv4-family vpnv4\n  policy vpn-target\n  peer 3.3.3.9 enable\n #\n ipv4-family vpn-instance vpn1\n  import-route direct\n  import-route ospf 100\n#\nospf 1\n area 0.0.0.0\n  network 1.1.1.9 0.0.0.0\n  network 10.10.1.0 0.0.0.255\n#\nospf 100 router-id 11.11.11.11 vpn-instance vpn1\n import-route bgp\n domain-id 0.0.0.0\n area 0.0.0.0\n  network 172.16.1.0 0.0.0.255\n  sham-link 5.5.5.5 6.6.6.6 cost 1\n#\nreturn",
    "P": "#\nsysname P\n#\nmpls lsr-id 2.2.2.9\n#\nmpls\n#\nmpls ldp\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.10.1.2 255.255.255.0\n mpls\n mpls ldp\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.20.1.1 255.255.255.0\n mpls\n mpls ldp\n#\ninterface LoopBack1\n ip address 2.2.2.9 255.255.255.255\n#\nospf 1\n area 0.0.0.0\n  network 2.2.2.9 0.0.0.0\n  network 10.10.1.0 0.0.0.255\n  network 10.20.1.0 0.0.0.255\n#\nreturn",
    "PE2": "#\nsysname PE2\n#\nip vpn-instance vpn1\n ipv4-family\n  route-distinguisher 100:1\n  apply-label per-instance\n  vpn-target 1:1 export-extcommunity\n  vpn-target 1:1 import-extcommunity\n#\nmpls lsr-id 3.3.3.9\n#\nmpls\n#\nmpls ldp\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip binding vpn-instance vpn1\n ip address 172.16.2.2 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.20.1.2 255.255.255.0\n mpls\n mpls ldp\n#\ninterface LoopBack1\n ip address 3.3.3.9 255.255.255.255\n#\ninterface LoopBack10\n ip binding vpn-instance vpn1\n ip address 6.6.6.6 255.255.255.255\n#\nbgp 100\n peer 1.1.1.9 as-number 100\n peer 1.1.1.9 connect-interface LoopBack1\n #\n ipv4-family unicast\n  undo synchronization\n  peer 1.1.1.9 enable\n #\n ipv4-family vpnv4\n  policy vpn-target\n  peer 1.1.1.9 enable\n #\n ipv4-family vpn-instance vpn1\n  import-route direct\n  import-route ospf 100\n#\nospf 1\n area 0.0.0.0\n  network 3.3.3.9 0.0.0.0\n  network 10.20.1.0 0.0.0.255\n#\nospf 100 router-id 22.22.22.22 vpn-instance vpn1\n import-route bgp\n domain-id 0.0.0.0\n area 0.0.0.0\n  network 172.16.2.0 0.0.0.255\n  sham-link 6.6.6.6 5.5.5.5 cost 1\n#\nreturn",
    "CE1": "#\nsysname CE1\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 172.16.1.1 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.1.1.1 255.255.255.0\n ospf cost 10\n#\nospf 1\n area 0.0.0.0\n  network 172.16.1.0 0.0.0.255\n  network 10.1.1.0 0.0.0.255\n#\nreturn",
    "CE2": "#\nsysname CE2\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 172.16.2.1 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.2.1.2 255.255.255.0\n ospf cost 10\n#\ninterface LoopBack1\n ip address 8.8.8.8 255.255.255.255\n ospf enable 1 area 0.0.0.0\n#\nospf 1\n area 0.0.0.0\n  network 10.2.1.0 0.0.0.255\n  network 172.16.2.0 0.0.0.255\n#\nreturn",
    "RT0": "#\nsysname RT0\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.1.1.2 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.2.1.1 255.255.255.0\n#\nospf 1\n area 0.0.0.0\n  network 10.1.1.0 0.0.0.255\n  network 10.2.1.0 0.0.0.255\n#\nreturn"
  },
  "related_images": [
    "图1-56 OSPF 伪连接配置组网图.png"
  ]
}