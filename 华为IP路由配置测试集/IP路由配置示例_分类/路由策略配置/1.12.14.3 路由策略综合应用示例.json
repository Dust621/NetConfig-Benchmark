{
  "topology": "该网络采用双平面核心架构，包含以下组件：\n\n**设备构成：**\n- PE设备4台：PE1、PE2、PE3、PE4，分别部署在VPN site 1（10.21.1.0/24）和VPN site 2（10.22.1.0/24）两个站点\n- P设备6台：P1、P2、P3、P4、P5、P6，构成核心传输网络\n- RR设备1台：作为路由反射器，Router ID为10.11.11.9\n\n**网络平面架构：**\n- Plane A（上层平面）：包含P1、P3、P5节点，节点间全互联\n- Plane B（下层平面）：包含P2、P4、P6节点，节点间全互联\n- 跨平面连接：P1-P2、P3-P4、P5-P6提供平面间冗余路径\n\n**PE接入方式：**\n- VPN site 1：PE1和PE2双归接入，PE1连接P1和P2，PE2连接P2和P6\n- VPN site 2：PE3和PE4双归接入，PE3连接P3和P5，PE4连接P4和P6\n\n**BGP配置：**\n- 自治系统号：AS 65000\n- PE1（Router ID 10.7.7.9）与RR建立MP-IBGP对等体，配置community 65000:100\n- PE2（Router ID 10.8.8.9）与RR建立MP-IBGP对等体，配置community 65000:200\n- RR配置路由反射器功能，为PE1、PE2、PE3、PE4提供VPNv4路由反射服务\n- 部署路由策略实现流量工程，通过community属性和local-preference控制路径选择\n\n**业务承载：**\n- 支持多种L3VPN业务类型（多媒体、信令、计费等）\n- 使用MP-BGP协议在PE间发布内层标签和VPNv4路由信息\n- 实现站点间VPN互联互通和流量负载分担",
  "requirement": "通过部署路由策略，可灵活控制复杂网络中的流量。所有的路由器都运行BGP，并将整个自治系统划分为多个区域。其中，PE和RR作为核心节点来转发区域之间的路由。配置完成后，每台路由器都应学到自治系统内的所有网段的路由。",
  "steps": [
    "为位于同一站点的两个PE分配不同的RD，保证每个PE都能从远端站点的不同BGP下一跳收到两条路由。",
    "为平面A的PE发布的路由和平面B的PE发布的路由分配不同的团体属性。",
    "基于不同的团体属性设置不同的本地优先级。使平面A的PE总是选择从平面A的远端PE发布的路由，使平面B的PE总是选择从平面B的远端PE发布的路由。"
  ],
  "configs": {
    "PE1": "#\nsysname PE1\n#\nrouter id 0.7.7.9\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 0.1.16.1 255.255.255.0\n#\nbgp 65000\n peer 10.11.11.9 as-number 65000\n peer 10.11.11.9 connect-interface LoopBack0\n ipv4-family unicast\n  undo peer 10.11.11.9 enable\n ipv4-family vpnv4\n  peer 10.11.11.9 enable\n  peer 10.11.11.9 route-policy comm export\n  peer 10.11.11.9 advertise-community\n  peer 10.11.11.9 route-policy local_pre import\n#\nroute-policy comm permit node 10\n apply community 65000:100\n#\nroute-policy local_pre permit node 10\n if-match community-filter 1\n apply local-preference 200\n#\nip community-filter 1 permit 65000:100\n#\nreturn",
    "PE2": "#\nsysname PE2\n#\nrouter id 0.8.8.9\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 0.1.17.1 255.255.255.0\n#\nbgp 65000\n peer 10.11.11.9 as-number 65000\n peer 10.11.11.9 connect-interface LoopBack0\n ipv4-family unicast\n  undo peer 10.11.11.9 enable\n ipv4-family vpnv4\n  peer 10.11.11.9 enable\n  peer 10.11.11.9 route-policy comm export\n  peer 10.11.11.9 advertise-community\n  peer 10.11.11.9 route-policy local_pre import\n#\nroute-policy comm permit node 10\n apply community 65000:200\n#\nroute-policy local_pre permit node 10\n if-match community-filter 1\n apply local-preference 200\n#\nip community-filter 1 permit 65000:200\n#\nreturn",
    "RR": "#\nsysname RR\n#\nrouter id 0.11.11.9\n#\nbgp 65000\n group client internal\n peer client connect-interface LoopBack0\n ipv4-family unicast\n  undo peer client enable\n ipv4-family vpnv4\n  undo policy vpn-target\n  peer client enable\n  peer 10.7.7.9 group client\n  peer 10.8.8.9 group client\n  peer 10.9.9.9 group client\n  peer 10.10.10.9 group client\n  peer client reflect-client\n  peer client advertise-community\n#\nreturn"
  },
  "related_images": [
    "图1-187配置路由策略综合应用组网示例图.png"
  ]
}