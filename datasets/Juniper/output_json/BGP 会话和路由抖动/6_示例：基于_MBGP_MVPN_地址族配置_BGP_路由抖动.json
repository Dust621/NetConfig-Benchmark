{
  "title": "示例：基于 MBGP MVPN 地址族配置 BGP 路由抖动阻尼",
  "sections": [
    {
      "title": "要求",
      "level": 3,
      "content": "此示例使用 Junos OS 12.2 版。Junos OS 12.2 版中引入了对 MBGP MVPN 的 BGP 路由抖动阻尼支持，特别是在地址族的基础上。"
    },
    {
      "title": "概述",
      "level": 3,
      "content": "BGP 路由抖动阻尼有助于减少在链路间歇性故障时反复撤销和重新播发路由而导致的路由不稳定。 此示例使用默认阻尼参数，并演示了具有三个提供商边缘 （PE） 路由设备、三个客户边缘 （CE） 路由设备和一个提供商 （P） 路由设备的 MBGP MVPN 方案。 拓扑学 图 4 显示了此示例中使用的拓扑。 图 4： 具有 BGP 路由抖动阻尼功能的 MBGP MVPN 在 PE 设备 R4 上，为地址族 inet-mvpn 配置了 BGP 路由抖动抑制。名为 dampPolicy 的路由策略使用 nlri-route-type 匹配条件来仅抑制 MVPN 路由类型 3、4 和 5。所有其他 MVPN 路由类型均不会受到抑制。 此示例显示了本节 CLI 快速配置 中所有设备上的完整配置。本节 配置设备 R4 介绍 PE 设备 R4 的分步配置。 BGP 路由抖动阻尼有助于减少在链路间歇性故障时反复撤销和重新播发路由而导致的路由不稳定。 此示例使用默认阻尼参数，并演示了具有三个提供商边缘 （PE） 路由设备、三个客户边缘 （CE） 路由设备和一个提供商 （P） 路由设备的 MBGP MVPN 方案。 拓扑学 图 4 显示了此示例中使用的拓扑。 图 4： 具有 BGP 路由抖动阻尼功能的 MBGP MVPN 在 PE 设备 R4 上，为地址族 inet-mvpn 配置了 BGP 路由抖动抑制。名为 dampPolicy 的路由策略使用 nlri-route-type 匹配条件来仅抑制 MVPN 路由类型 3、4 和 5。所有其他 MVPN 路由类型均不会受到抑制。 此示例显示了本节 CLI 快速配置 中所有设备上的完整配置。本节 配置设备 R4 介绍 PE 设备 R4 的分步配置。 图 4 显示了此示例中使用的拓扑。 图 4： 具有 BGP 路由抖动阻尼功能的 MBGP MVPN 在 PE 设备 R4 上，为地址族 inet-mvpn 配置了 BGP 路由抖动抑制。名为 dampPolicy 的路由策略使用 nlri-route-type 匹配条件来仅抑制 MVPN 路由类型 3、4 和 5。所有其他 MVPN 路由类型均不会受到抑制。 此示例显示了本节 CLI 快速配置 中所有设备上的完整配置。本节 配置设备 R4 介绍 PE 设备 R4 的分步配置。",
      "sections": [
        {
          "title": "拓扑学",
          "level": 4,
          "content": "图 4 显示了此示例中使用的拓扑。 图 4： 具有 BGP 路由抖动阻尼功能的 MBGP MVPN 在 PE 设备 R4 上，为地址族 inet-mvpn 配置了 BGP 路由抖动抑制。名为 dampPolicy 的路由策略使用 nlri-route-type 匹配条件来仅抑制 MVPN 路由类型 3、4 和 5。所有其他 MVPN 路由类型均不会受到抑制。 此示例显示了本节 CLI 快速配置 中所有设备上的完整配置。本节 配置设备 R4 介绍 PE 设备 R4 的分步配置。",
          "images": [
            "BGP 会话和路由抖动\\images\\6_示例：基于_MBGP_MVPN_地址族配_1.gif"
          ]
        }
      ]
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 R1 set interfaces ge-1/2/0 unit 1 family inet address 10.1.1.1/30 set interfaces ge-1/2/0 unit 1 family mpls set interfaces lo0 unit 1 family inet address 172.16.1.1/32 set protocols ospf area 0.0.0.0 interface lo0.1 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.1 set protocols pim rp static address 172.16.100.1 set protocols pim interface all set routing-options router-id 172.16.1.1 设备 R2 set interfaces ge-1/2/0 unit 2 family inet address 10.1.1.2/30 set interfaces ge-1/2/0 unit 2 family mpls set interfaces ge-1/2/1 unit 5 family inet address 10.1.1.5/30 set interfaces ge-1/2/1 unit 5 family mpls set interfaces vt-1/2/0 unit 2 family inet set interfaces lo0 unit 2 family inet address 172.16.1.2/32 set interfaces lo0 unit 102 family inet address 172.16.100.1/32 set protocols mpls interface ge-1/2/1.5 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 172.16.1.2 set protocols bgp group ibgp family inet-vpn any set protocols bgp group ibgp family inet-mvpn signaling set protocols bgp group ibgp neighbor 172.16.1.4 set protocols bgp group ibgp neighbor 172.16.1.5 set protocols ospf area 0.0.0.0 interface lo0.2 passive set protocols ospf area 0.0.0.0 interface ge-1/2/1.5 set protocols ldp interface ge-1/2/1.5 set protocols ldp p2mp set policy-options policy-statement parent_vpn_routes from protocol bgp set policy-options policy-statement parent_vpn_routes then accept set routing-instances vpn-1 instance-type vrf set routing-instances vpn-1 interface ge-1/2/0.2 set routing-instances vpn-1 interface vt-1/2/0.2 set routing-instances vpn-1 interface lo0.102 set routing-instances vpn-1 route-distinguisher 100:100 set routing-instances vpn-1 provider-tunnel ldp-p2mp set routing-instances vpn-1 vrf-target target:1:1 set routing-instances vpn-1 protocols ospf export parent_vpn_routes set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface lo0.102 passive set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface ge-1/2/0.2 set routing-instances vpn-1 protocols pim rp static address 172.16.1.2 with 172.16.4.1100.1 set routing-instances vpn-1 protocols pim interface ge-1/2/0.2 mode sparse set routing-instances vpn-1 protocols mvpn set routing-options router-id 172.16.1.2 set routing-options autonomous-system 1001 设备 R3 set interfaces ge-1/2/0 unit 6 family inet address 10.1.1.6/30 set interfaces ge-1/2/0 unit 6 family mpls set interfaces ge-1/2/1 unit 9 family inet address 10.1.1.9/30 set interfaces ge-1/2/1 unit 9 family mpls set interfaces ge-1/2/2 unit 13 family inet address 10.1.1.13/30 set interfaces ge-1/2/2 unit 13 family mpls set interfaces lo0 unit 3 family inet address 172.16.1.3/32 set protocols mpls interface ge-1/2/0.6 set protocols mpls interface ge-1/2/1.9 set protocols mpls interface ge-1/2/2.13 set protocols ospf area 0.0.0.0 interface lo0.3 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.6 set protocols ospf area 0.0.0.0 interface ge-1/2/1.9 set protocols ospf area 0.0.0.0 interface ge-1/2/2.13 set protocols ldp interface ge-1/2/0.6 set protocols ldp interface ge-1/2/1.9 set protocols ldp interface ge-1/2/2.13 set protocols ldp p2mp set routing-options router-id 172.16.1.3 设备 R4 set interfaces ge-1/2/0 unit 10 family inet address 10.1.1.10/30 set interfaces ge-1/2/0 unit 10 family mpls set interfaces ge-1/2/1 unit 17 family inet address 10.1.1.17/30 set interfaces ge-1/2/1 unit 17 family mpls set interfaces vt-1/2/0 unit 4 family inet set interfaces lo0 unit 4 family inet address 172.16.1.4/32 set interfaces lo0 unit 104 family inet address 172.16.100.1/32 set protocols rsvp interface all aggregate set protocols mpls interface all set protocols mpls interface ge-1/2/0.10 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 172.16.1.4 set protocols bgp group ibgp family inet-vpn unicast set protocols bgp group ibgp family inet-vpn any set protocols bgp group ibgp family inet-mvpn signaling damping set protocols bgp group ibgp neighbor 172.16.1.2 import dampPolicy set protocols bgp group ibgp neighbor 172.16.1.5 set protocols ospf traffic-engineering set protocols ospf area 0.0.0.0 interface all set protocols ospf area 0.0.0.0 interface lo0.4 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.10 set protocols ldp interface ge-1/2/0.10 set protocols ldp p2mp set policy-options policy-statement dampPolicy term term1 from family inet-mvpn set policy-options policy-statement dampPolicy term term1 from nlri-route-type 3 set policy-options policy-statement dampPolicy term term1 from nlri-route-type 4 set policy-options policy-statement dampPolicy term term1 from nlri-route-type 5 set policy-options policy-statement dampPolicy term term1 then accept set policy-options policy-statement dampPolicy then damping no-damp set policy-options policy-statement dampPolicy then accept set policy-options policy-statement parent_vpn_routes from protocol bgp set policy-options policy-statement parent_vpn_routes then accept set policy-options damping no-damp disable set routing-instances vpn-1 instance-type vrf set routing-instances vpn-1 interface vt-1/2/0.4 set routing-instances vpn-1 interface ge-1/2/1.17 set routing-instances vpn-1 interface lo0.104 set routing-instances vpn-1 route-distinguisher 100:100 set routing-instances vpn-1 vrf-target target:1:1 set routing-instances vpn-1 protocols ospf export parent_vpn_routes set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface lo0.104 passive set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface ge-1/2/1.17 set routing-instances vpn-1 protocols pim rp static address 172.16.100.1 set routing-instances vpn-1 protocols pim interface ge-1/2/1.17 mode sparse set routing-instances vpn-1 protocols mvpn set routing-options router-id 172.16.1.4 set routing-options autonomous-system 64501 设备 R5 set interfaces ge-1/2/0 unit 14 family inet address 10.1.1.14/30 set interfaces ge-1/2/0 unit 14 family mpls set interfaces ge-1/2/1 unit 21 family inet address 10.1.1.21/30 set interfaces ge-1/2/1 unit 21 family mpls set interfaces vt-1/2/0 unit 5 family inet set interfaces lo0 unit 5 family inet address 172.16.1.5/32 set interfaces lo0 unit 105 family inet address 172.16.100.5/32 set protocols mpls interface ge-1/2/0.14 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 172.16.1.5 set protocols bgp group ibgp family inet-vpn any set protocols bgp group ibgp family inet-mvpn signaling set protocols bgp group ibgp neighbor 172.16.1.2 set protocols bgp group ibgp neighbor 172.16.1.4 set protocols ospf area 0.0.0.0 interface lo0.5 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.14 set protocols ldp interface ge-1/2/0.14 set protocols ldp p2mp set policy-options policy-statement parent_vpn_routes from protocol bgp set policy-options policy-statement parent_vpn_routes then accept set routing-instances vpn-1 instance-type vrf set routing-instances vpn-1 interface vt-1/2/0.5 set routing-instances vpn-1 interface ge-1/2/1.21 set routing-instances vpn-1 interface lo0.105 set routing-instances vpn-1 route-distinguisher 100:100 set routing-instances vpn-1 vrf-target target:1:1 set routing-instances vpn-1 protocols ospf export parent_vpn_routes set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface lo0.105 passive set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface ge-1/2/1.21 set routing-instances vpn-1 protocols pim rp static address 172.16.100.2 set routing-instances vpn-1 protocols pim interface ge-1/2/1.21 mode sparse set routing-instances vpn-1 protocols mvpn set routing-options router-id 172.16.1.5 set routing-options autonomous-system 1001 设备 R6 set interfaces ge-1/2/0 unit 18 family inet address 10.1.1.18/30 set interfaces ge-1/2/0 unit 18 family mpls set interfaces lo0 unit 6 family inet address 172.16.1.6/32 set protocols sap listen 233.1.1.1 set protocols ospf area 0.0.0.0 interface lo0.6 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.18 set protocols pim rp static address 172.16.100.2 set protocols pim interface all set routing-options router-id 172.16.1.6 设备 R7 set interfaces ge-1/2/0 unit 22 family inet address 10.1.1.22/30 set interfaces ge-1/2/0 unit 22 family mpls set interfaces lo0 unit 7 family inet address 172.16.1.7/32 set protocols ospf area 0.0.0.0 interface lo0.7 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.22 set protocols pim rp static address 172.16.100.2 set protocols pim interface all set routing-options router-id 172.16.1.7 下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R4： 配置接口。 [edit interfaces] user@R4# set ge-1/2/0 unit 10 family inet address 10.1.1.10/30 user@R4# set ge-1/2/0 unit 10 family mpls user@R4# set ge-1/2/1 unit 17 family inet address 10.1.1.17/30 user@R4# set ge-1/2/1 unit 17 family mpls user@R4# set vt-1/2/0 unit 4 family inet user@R4# set lo0 unit 4 family inet address 172.16.1.4/32 user@R4# set lo0 unit 104 family inet address 172.16.100.4/32 在接口上配置 MPLS 和信令协议。 [edit protocols] user@R4# set mpls interface all user@R4# set mpls interface ge-1/2/0.10 user@R4# set rsvp interface all aggregate user@R4# set ldp interface ge-1/2/0.10 user@R4# set ldp p2mp 配置 BGP。 BGP 配置可为地址族启用 inet-mvpn BGP 路由抖动阻尼。BGP 配置还会将名为 的 dampPolicy 路由策略导入到路由表中。此策略应用于邻接方 PE 设备 R2。 [edit protocols bgp group ibgp] user@R4# set type internal user@R4# set local-address 172.16.1.4 user@R4# set family inet-vpn unicast user@R4# set family inet-vpn any user@R4# set family inet-mvpn signaling damping user@R4# set neighbor 172.16.1.2 import dampPolicy user@R4# set neighbor 172.16.1.5 配置内部网关协议。 [edit protocols ospf] user@R4# set traffic-engineering [edit protocols ospf area 0.0.0.0] user@R4# set interface all user@R4# set interface lo0.4 passive user@R4# set interface ge-1/2/0.10 配置使用 nlri-route-type 匹配条件的阻尼策略，以仅抑制 MVPN 路由类型 3、4 和 5。 [edit policy-options policy-statement dampPolicy term term1] user@R4# set from family inet-mvpn user@R4# set from nlri-route-type 3 user@R4# set from nlri-route-type 4 user@R4# set from nlri-route-type 5 user@R4# set then accept 配置策略以 damping 禁用 BGP 路由抖动抑制。 no-damp 策略 （ damping no-damp disable ） 会导致删除路由表中存在的任何阻尼状态。该 then damping no-damp 语句将 no-damp 策略作为操作应用，并且没有 from 匹配条件。因此，所有不匹配 term1 的路由都将与此术语匹配，结果所有其他 MVPN 路由类型都不会被阻尼。 [edit policy-options policy-statement dampPolicy] user@R4# set then damping no-damp user@R4# set then accept [edit policy-options] user@R4# set damping no-damp disable 将 配置为 parent_vpn_routes 接受不属于地址族的 inet-mvpn 所有其他 BGP 路由。 此策略作为路由实例中的 OSPF 导出策略应用。 [edit policy-options policy-statement parent_vpn_routes] user@R4# set from protocol bgp user@R4# set then accept 配置 VPN 路由和转发 （VRF） 实例。 [edit routing-instances vpn-1] user@R4# set instance-type vrf user@R4# set interface vt-1/2/0.4 user@R4# set interface ge-1/2/1.17 user@R4# set interface lo0.104 user@R4# set route-distinguisher 100:100 user@R4# set vrf-target target:1:1 user@R4# set protocols ospf export parent_vpn_routes user@R4# set protocols ospf area 0.0.0.0 interface lo0.104 passive user@R4# set protocols ospf area 0.0.0.0 interface ge-1/2/1.17 user@R4# set protocols pim rp static address 172.16.100.2 user@R4# set protocols pim interface ge-1/2/1.17 mode sparse user@R4# set protocols mvpn 配置路由器 ID 和自治系统 （AS） 编号。 [edit routing-options] user@R4# set router-id 172.16.1.4 user@R4# set autonomous-system 1001 如果完成设备配置，请提交配置。 user@R4# commit 在配置模式下，输入 show interfaces 、 show protocols 、 show routing-instances show policy-options 和 show routing-options 命令来确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R4# show interfaces ge-1/2/0 { unit 10 { family inet { address 10.1.1.10/30; } family mpls; } } ge-1/2/1 { unit 17 { family inet { address 10.1.1.17/30; } family mpls; } } vt-1/2/0 { unit 4 { family inet; } } lo0 { unit 4 { family inet { address 172.16.1.4/32; } } unit 104 { family inet { address 172.16.100.4/32; } } } user@R4# show protocols rsvp { interface all { aggregate; } } mpls { interface all; interface ge-1/2/0.10; } bgp { group ibgp { type internal; local-address 172.16.1.4; family inet-vpn { unicast; any; } family inet-mvpn { signaling { damping; } } neighbor 172.16.1.2 { import dampPolicy; } neighbor 172.16.1.5; } } ospf { traffic-engineering; area 0.0.0.0 { interface all; interface lo0.4 { passive; } interface ge-1/2/0.10; } } ldp { interface ge-1/2/0.10; p2mp; } user@R4# show policy-options policy-statement dampPolicy { term term1 { from { family inet-mvpn; nlri-route-type [ 3 4 5 ]; } then accept; } then { damping no-damp; accept; } } policy-statement parent_vpn_routes { from protocol bgp; then accept; } damping no-damp { disable; } user@R4# show routing-instances vpn-1 { instance-type vrf; interface vt-1/2/0.4; interface ge-1/2/1.17; interface lo0.104; route-distinguisher 100:100; vrf-target target:1:1; protocols { ospf { export parent_vpn_routes; area 0.0.0.0 { interface lo0.104 { passive; } interface ge-1/2/1.17; } } pim { rp { static { address 172.16.100.2; } } interface ge-1/2/1.17 { mode sparse; } } mvpn; } } user@R4# show routing-optons router-id 172.16.1.4; autonomous-system 1001;",
      "sections": [
        {
          "title": "CLI 快速配置",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 R1 set interfaces ge-1/2/0 unit 1 family inet address 10.1.1.1/30 set interfaces ge-1/2/0 unit 1 family mpls set interfaces lo0 unit 1 family inet address 172.16.1.1/32 set protocols ospf area 0.0.0.0 interface lo0.1 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.1 set protocols pim rp static address 172.16.100.1 set protocols pim interface all set routing-options router-id 172.16.1.1 设备 R2 set interfaces ge-1/2/0 unit 2 family inet address 10.1.1.2/30 set interfaces ge-1/2/0 unit 2 family mpls set interfaces ge-1/2/1 unit 5 family inet address 10.1.1.5/30 set interfaces ge-1/2/1 unit 5 family mpls set interfaces vt-1/2/0 unit 2 family inet set interfaces lo0 unit 2 family inet address 172.16.1.2/32 set interfaces lo0 unit 102 family inet address 172.16.100.1/32 set protocols mpls interface ge-1/2/1.5 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 172.16.1.2 set protocols bgp group ibgp family inet-vpn any set protocols bgp group ibgp family inet-mvpn signaling set protocols bgp group ibgp neighbor 172.16.1.4 set protocols bgp group ibgp neighbor 172.16.1.5 set protocols ospf area 0.0.0.0 interface lo0.2 passive set protocols ospf area 0.0.0.0 interface ge-1/2/1.5 set protocols ldp interface ge-1/2/1.5 set protocols ldp p2mp set policy-options policy-statement parent_vpn_routes from protocol bgp set policy-options policy-statement parent_vpn_routes then accept set routing-instances vpn-1 instance-type vrf set routing-instances vpn-1 interface ge-1/2/0.2 set routing-instances vpn-1 interface vt-1/2/0.2 set routing-instances vpn-1 interface lo0.102 set routing-instances vpn-1 route-distinguisher 100:100 set routing-instances vpn-1 provider-tunnel ldp-p2mp set routing-instances vpn-1 vrf-target target:1:1 set routing-instances vpn-1 protocols ospf export parent_vpn_routes set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface lo0.102 passive set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface ge-1/2/0.2 set routing-instances vpn-1 protocols pim rp static address 172.16.1.2 with 172.16.4.1100.1 set routing-instances vpn-1 protocols pim interface ge-1/2/0.2 mode sparse set routing-instances vpn-1 protocols mvpn set routing-options router-id 172.16.1.2 set routing-options autonomous-system 1001 设备 R3 set interfaces ge-1/2/0 unit 6 family inet address 10.1.1.6/30 set interfaces ge-1/2/0 unit 6 family mpls set interfaces ge-1/2/1 unit 9 family inet address 10.1.1.9/30 set interfaces ge-1/2/1 unit 9 family mpls set interfaces ge-1/2/2 unit 13 family inet address 10.1.1.13/30 set interfaces ge-1/2/2 unit 13 family mpls set interfaces lo0 unit 3 family inet address 172.16.1.3/32 set protocols mpls interface ge-1/2/0.6 set protocols mpls interface ge-1/2/1.9 set protocols mpls interface ge-1/2/2.13 set protocols ospf area 0.0.0.0 interface lo0.3 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.6 set protocols ospf area 0.0.0.0 interface ge-1/2/1.9 set protocols ospf area 0.0.0.0 interface ge-1/2/2.13 set protocols ldp interface ge-1/2/0.6 set protocols ldp interface ge-1/2/1.9 set protocols ldp interface ge-1/2/2.13 set protocols ldp p2mp set routing-options router-id 172.16.1.3 设备 R4 set interfaces ge-1/2/0 unit 10 family inet address 10.1.1.10/30 set interfaces ge-1/2/0 unit 10 family mpls set interfaces ge-1/2/1 unit 17 family inet address 10.1.1.17/30 set interfaces ge-1/2/1 unit 17 family mpls set interfaces vt-1/2/0 unit 4 family inet set interfaces lo0 unit 4 family inet address 172.16.1.4/32 set interfaces lo0 unit 104 family inet address 172.16.100.1/32 set protocols rsvp interface all aggregate set protocols mpls interface all set protocols mpls interface ge-1/2/0.10 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 172.16.1.4 set protocols bgp group ibgp family inet-vpn unicast set protocols bgp group ibgp family inet-vpn any set protocols bgp group ibgp family inet-mvpn signaling damping set protocols bgp group ibgp neighbor 172.16.1.2 import dampPolicy set protocols bgp group ibgp neighbor 172.16.1.5 set protocols ospf traffic-engineering set protocols ospf area 0.0.0.0 interface all set protocols ospf area 0.0.0.0 interface lo0.4 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.10 set protocols ldp interface ge-1/2/0.10 set protocols ldp p2mp set policy-options policy-statement dampPolicy term term1 from family inet-mvpn set policy-options policy-statement dampPolicy term term1 from nlri-route-type 3 set policy-options policy-statement dampPolicy term term1 from nlri-route-type 4 set policy-options policy-statement dampPolicy term term1 from nlri-route-type 5 set policy-options policy-statement dampPolicy term term1 then accept set policy-options policy-statement dampPolicy then damping no-damp set policy-options policy-statement dampPolicy then accept set policy-options policy-statement parent_vpn_routes from protocol bgp set policy-options policy-statement parent_vpn_routes then accept set policy-options damping no-damp disable set routing-instances vpn-1 instance-type vrf set routing-instances vpn-1 interface vt-1/2/0.4 set routing-instances vpn-1 interface ge-1/2/1.17 set routing-instances vpn-1 interface lo0.104 set routing-instances vpn-1 route-distinguisher 100:100 set routing-instances vpn-1 vrf-target target:1:1 set routing-instances vpn-1 protocols ospf export parent_vpn_routes set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface lo0.104 passive set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface ge-1/2/1.17 set routing-instances vpn-1 protocols pim rp static address 172.16.100.1 set routing-instances vpn-1 protocols pim interface ge-1/2/1.17 mode sparse set routing-instances vpn-1 protocols mvpn set routing-options router-id 172.16.1.4 set routing-options autonomous-system 64501 设备 R5 set interfaces ge-1/2/0 unit 14 family inet address 10.1.1.14/30 set interfaces ge-1/2/0 unit 14 family mpls set interfaces ge-1/2/1 unit 21 family inet address 10.1.1.21/30 set interfaces ge-1/2/1 unit 21 family mpls set interfaces vt-1/2/0 unit 5 family inet set interfaces lo0 unit 5 family inet address 172.16.1.5/32 set interfaces lo0 unit 105 family inet address 172.16.100.5/32 set protocols mpls interface ge-1/2/0.14 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 172.16.1.5 set protocols bgp group ibgp family inet-vpn any set protocols bgp group ibgp family inet-mvpn signaling set protocols bgp group ibgp neighbor 172.16.1.2 set protocols bgp group ibgp neighbor 172.16.1.4 set protocols ospf area 0.0.0.0 interface lo0.5 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.14 set protocols ldp interface ge-1/2/0.14 set protocols ldp p2mp set policy-options policy-statement parent_vpn_routes from protocol bgp set policy-options policy-statement parent_vpn_routes then accept set routing-instances vpn-1 instance-type vrf set routing-instances vpn-1 interface vt-1/2/0.5 set routing-instances vpn-1 interface ge-1/2/1.21 set routing-instances vpn-1 interface lo0.105 set routing-instances vpn-1 route-distinguisher 100:100 set routing-instances vpn-1 vrf-target target:1:1 set routing-instances vpn-1 protocols ospf export parent_vpn_routes set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface lo0.105 passive set routing-instances vpn-1 protocols ospf area 0.0.0.0 interface ge-1/2/1.21 set routing-instances vpn-1 protocols pim rp static address 172.16.100.2 set routing-instances vpn-1 protocols pim interface ge-1/2/1.21 mode sparse set routing-instances vpn-1 protocols mvpn set routing-options router-id 172.16.1.5 set routing-options autonomous-system 1001 设备 R6 set interfaces ge-1/2/0 unit 18 family inet address 10.1.1.18/30 set interfaces ge-1/2/0 unit 18 family mpls set interfaces lo0 unit 6 family inet address 172.16.1.6/32 set protocols sap listen 233.1.1.1 set protocols ospf area 0.0.0.0 interface lo0.6 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.18 set protocols pim rp static address 172.16.100.2 set protocols pim interface all set routing-options router-id 172.16.1.6 设备 R7 set interfaces ge-1/2/0 unit 22 family inet address 10.1.1.22/30 set interfaces ge-1/2/0 unit 22 family mpls set interfaces lo0 unit 7 family inet address 172.16.1.7/32 set protocols ospf area 0.0.0.0 interface lo0.7 passive set protocols ospf area 0.0.0.0 interface ge-1/2/0.22 set protocols pim rp static address 172.16.100.2 set protocols pim interface all set routing-options router-id 172.16.1.7",
          "commands_by_device": {
            "设备 R1": "set interfaces ge-1/2/0 unit 1 family inet address 10.1.1.1/30\nset interfaces ge-1/2/0 unit 1 family mpls\nset interfaces lo0 unit 1 family inet address 172.16.1.1/32\nset protocols ospf area 0.0.0.0 interface lo0.1 passive\nset protocols ospf area 0.0.0.0 interface ge-1/2/0.1\nset protocols pim rp static address 172.16.100.1\nset protocols pim interface all\nset routing-options router-id 172.16.1.1",
            "设备 R2": "set interfaces ge-1/2/0 unit 2 family inet address 10.1.1.2/30\nset interfaces ge-1/2/0 unit 2 family mpls\nset interfaces ge-1/2/1 unit 5 family inet address 10.1.1.5/30\nset interfaces ge-1/2/1 unit 5 family mpls\nset interfaces vt-1/2/0 unit 2 family inet\nset interfaces lo0 unit 2 family inet address 172.16.1.2/32\nset interfaces lo0 unit 102 family inet address 172.16.100.1/32\nset protocols mpls interface ge-1/2/1.5\nset protocols bgp group ibgp type internal\nset protocols bgp group ibgp local-address 172.16.1.2\nset protocols bgp group ibgp family inet-vpn any\nset protocols bgp group ibgp family inet-mvpn signaling\nset protocols bgp group ibgp neighbor 172.16.1.4\nset protocols bgp group ibgp neighbor 172.16.1.5\nset protocols ospf area 0.0.0.0 interface lo0.2 passive\nset protocols ospf area 0.0.0.0 interface ge-1/2/1.5\nset protocols ldp interface ge-1/2/1.5\nset protocols ldp p2mp\nset policy-options policy-statement parent_vpn_routes from protocol bgp\nset policy-options policy-statement parent_vpn_routes then accept\nset routing-instances vpn-1 instance-type vrf\nset routing-instances vpn-1 interface ge-1/2/0.2\nset routing-instances vpn-1 interface vt-1/2/0.2\nset routing-instances vpn-1 interface lo0.102\nset routing-instances vpn-1 route-distinguisher 100:100\nset routing-instances vpn-1 provider-tunnel ldp-p2mp\nset routing-instances vpn-1 vrf-target target:1:1\nset routing-instances vpn-1 protocols ospf export parent_vpn_routes\nset routing-instances vpn-1 protocols ospf area 0.0.0.0 interface lo0.102 passive\nset routing-instances vpn-1 protocols ospf area 0.0.0.0 interface ge-1/2/0.2\nset routing-instances vpn-1 protocols pim rp static address 172.16.1.2 with 172.16.4.1100.1\nset routing-instances vpn-1 protocols pim interface ge-1/2/0.2 mode sparse\nset routing-instances vpn-1 protocols mvpn\nset routing-options router-id 172.16.1.2\nset routing-options autonomous-system 1001",
            "设备 R3": "set interfaces ge-1/2/0 unit 6 family inet address 10.1.1.6/30\nset interfaces ge-1/2/0 unit 6 family mpls\nset interfaces ge-1/2/1 unit 9 family inet address 10.1.1.9/30\nset interfaces ge-1/2/1 unit 9 family mpls\nset interfaces ge-1/2/2 unit 13 family inet address 10.1.1.13/30\nset interfaces ge-1/2/2 unit 13 family mpls\nset interfaces lo0 unit 3 family inet address 172.16.1.3/32\nset protocols mpls interface ge-1/2/0.6\nset protocols mpls interface ge-1/2/1.9\nset protocols mpls interface ge-1/2/2.13\nset protocols ospf area 0.0.0.0 interface lo0.3 passive\nset protocols ospf area 0.0.0.0 interface ge-1/2/0.6\nset protocols ospf area 0.0.0.0 interface ge-1/2/1.9\nset protocols ospf area 0.0.0.0 interface ge-1/2/2.13\nset protocols ldp interface ge-1/2/0.6\nset protocols ldp interface ge-1/2/1.9\nset protocols ldp interface ge-1/2/2.13\nset protocols ldp p2mp\nset routing-options router-id 172.16.1.3",
            "设备 R4": "set interfaces ge-1/2/0 unit 10 family inet address 10.1.1.10/30\nset interfaces ge-1/2/0 unit 10 family mpls\nset interfaces ge-1/2/1 unit 17 family inet address 10.1.1.17/30\nset interfaces ge-1/2/1 unit 17 family mpls\nset interfaces vt-1/2/0 unit 4 family inet\nset interfaces lo0 unit 4 family inet address 172.16.1.4/32\nset interfaces lo0 unit 104 family inet address 172.16.100.1/32\nset protocols rsvp interface all aggregate\nset protocols mpls interface all\nset protocols mpls interface ge-1/2/0.10\nset protocols bgp group ibgp type internal\nset protocols bgp group ibgp local-address 172.16.1.4\nset protocols bgp group ibgp family inet-vpn unicast\nset protocols bgp group ibgp family inet-vpn any\nset protocols bgp group ibgp family inet-mvpn signaling damping\nset protocols bgp group ibgp neighbor 172.16.1.2 import dampPolicy\nset protocols bgp group ibgp neighbor 172.16.1.5\nset protocols ospf traffic-engineering\nset protocols ospf area 0.0.0.0 interface all\nset protocols ospf area 0.0.0.0 interface lo0.4 passive\nset protocols ospf area 0.0.0.0 interface ge-1/2/0.10\nset protocols ldp interface ge-1/2/0.10\nset protocols ldp p2mp\nset policy-options policy-statement dampPolicy term term1 from family inet-mvpn\nset policy-options policy-statement dampPolicy term term1 from nlri-route-type 3\nset policy-options policy-statement dampPolicy term term1 from nlri-route-type 4\nset policy-options policy-statement dampPolicy term term1 from nlri-route-type 5\nset policy-options policy-statement dampPolicy term term1 then accept\nset policy-options policy-statement dampPolicy then damping no-damp\nset policy-options policy-statement dampPolicy then accept\nset policy-options policy-statement parent_vpn_routes from protocol bgp\nset policy-options policy-statement parent_vpn_routes then accept\nset policy-options damping no-damp disable\nset routing-instances vpn-1 instance-type vrf\nset routing-instances vpn-1 interface vt-1/2/0.4\nset routing-instances vpn-1 interface ge-1/2/1.17\nset routing-instances vpn-1 interface lo0.104\nset routing-instances vpn-1 route-distinguisher 100:100\nset routing-instances vpn-1 vrf-target target:1:1\nset routing-instances vpn-1 protocols ospf export parent_vpn_routes\nset routing-instances vpn-1 protocols ospf area 0.0.0.0 interface lo0.104 passive\nset routing-instances vpn-1 protocols ospf area 0.0.0.0 interface ge-1/2/1.17\nset routing-instances vpn-1 protocols pim rp static address 172.16.100.1\nset routing-instances vpn-1 protocols pim interface ge-1/2/1.17 mode sparse\nset routing-instances vpn-1 protocols mvpn\nset routing-options router-id 172.16.1.4\nset routing-options autonomous-system 64501",
            "设备 R5": "set interfaces ge-1/2/0 unit 14 family inet address 10.1.1.14/30\nset interfaces ge-1/2/0 unit 14 family mpls\nset interfaces ge-1/2/1 unit 21 family inet address 10.1.1.21/30\nset interfaces ge-1/2/1 unit 21 family mpls\nset interfaces vt-1/2/0 unit 5 family inet\nset interfaces lo0 unit 5 family inet address 172.16.1.5/32\nset interfaces lo0 unit 105 family inet address 172.16.100.5/32\nset protocols mpls interface ge-1/2/0.14\nset protocols bgp group ibgp type internal\nset protocols bgp group ibgp local-address 172.16.1.5\nset protocols bgp group ibgp family inet-vpn any\nset protocols bgp group ibgp family inet-mvpn signaling\nset protocols bgp group ibgp neighbor 172.16.1.2\nset protocols bgp group ibgp neighbor 172.16.1.4\nset protocols ospf area 0.0.0.0 interface lo0.5 passive\nset protocols ospf area 0.0.0.0 interface ge-1/2/0.14\nset protocols ldp interface ge-1/2/0.14\nset protocols ldp p2mp\nset policy-options policy-statement parent_vpn_routes from protocol bgp\nset policy-options policy-statement parent_vpn_routes then accept\nset routing-instances vpn-1 instance-type vrf\nset routing-instances vpn-1 interface vt-1/2/0.5\nset routing-instances vpn-1 interface ge-1/2/1.21\nset routing-instances vpn-1 interface lo0.105\nset routing-instances vpn-1 route-distinguisher 100:100\nset routing-instances vpn-1 vrf-target target:1:1\nset routing-instances vpn-1 protocols ospf export parent_vpn_routes\nset routing-instances vpn-1 protocols ospf area 0.0.0.0 interface lo0.105 passive\nset routing-instances vpn-1 protocols ospf area 0.0.0.0 interface ge-1/2/1.21\nset routing-instances vpn-1 protocols pim rp static address 172.16.100.2\nset routing-instances vpn-1 protocols pim interface ge-1/2/1.21 mode sparse\nset routing-instances vpn-1 protocols mvpn\nset routing-options router-id 172.16.1.5\nset routing-options autonomous-system 1001",
            "设备 R6": "set interfaces ge-1/2/0 unit 18 family inet address 10.1.1.18/30\nset interfaces ge-1/2/0 unit 18 family mpls\nset interfaces lo0 unit 6 family inet address 172.16.1.6/32\nset protocols sap listen 233.1.1.1\nset protocols ospf area 0.0.0.0 interface lo0.6 passive\nset protocols ospf area 0.0.0.0 interface ge-1/2/0.18\nset protocols pim rp static address 172.16.100.2\nset protocols pim interface all\nset routing-options router-id 172.16.1.6",
            "设备 R7": "set interfaces ge-1/2/0 unit 22 family inet address 10.1.1.22/30\nset interfaces ge-1/2/0 unit 22 family mpls\nset interfaces lo0 unit 7 family inet address 172.16.1.7/32\nset protocols ospf area 0.0.0.0 interface lo0.7 passive\nset protocols ospf area 0.0.0.0 interface ge-1/2/0.22\nset protocols pim rp static address 172.16.100.2\nset protocols pim interface all\nset routing-options router-id 172.16.1.7"
          }
        },
        {
          "title": "配置设备 R4",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R4： 配置接口。 [edit interfaces] user@R4# set ge-1/2/0 unit 10 family inet address 10.1.1.10/30 user@R4# set ge-1/2/0 unit 10 family mpls user@R4# set ge-1/2/1 unit 17 family inet address 10.1.1.17/30 user@R4# set ge-1/2/1 unit 17 family mpls user@R4# set vt-1/2/0 unit 4 family inet user@R4# set lo0 unit 4 family inet address 172.16.1.4/32 user@R4# set lo0 unit 104 family inet address 172.16.100.4/32 在接口上配置 MPLS 和信令协议。 [edit protocols] user@R4# set mpls interface all user@R4# set mpls interface ge-1/2/0.10 user@R4# set rsvp interface all aggregate user@R4# set ldp interface ge-1/2/0.10 user@R4# set ldp p2mp 配置 BGP。 BGP 配置可为地址族启用 inet-mvpn BGP 路由抖动阻尼。BGP 配置还会将名为 的 dampPolicy 路由策略导入到路由表中。此策略应用于邻接方 PE 设备 R2。 [edit protocols bgp group ibgp] user@R4# set type internal user@R4# set local-address 172.16.1.4 user@R4# set family inet-vpn unicast user@R4# set family inet-vpn any user@R4# set family inet-mvpn signaling damping user@R4# set neighbor 172.16.1.2 import dampPolicy user@R4# set neighbor 172.16.1.5 配置内部网关协议。 [edit protocols ospf] user@R4# set traffic-engineering [edit protocols ospf area 0.0.0.0] user@R4# set interface all user@R4# set interface lo0.4 passive user@R4# set interface ge-1/2/0.10 配置使用 nlri-route-type 匹配条件的阻尼策略，以仅抑制 MVPN 路由类型 3、4 和 5。 [edit policy-options policy-statement dampPolicy term term1] user@R4# set from family inet-mvpn user@R4# set from nlri-route-type 3 user@R4# set from nlri-route-type 4 user@R4# set from nlri-route-type 5 user@R4# set then accept 配置策略以 damping 禁用 BGP 路由抖动抑制。 no-damp 策略 （ damping no-damp disable ） 会导致删除路由表中存在的任何阻尼状态。该 then damping no-damp 语句将 no-damp 策略作为操作应用，并且没有 from 匹配条件。因此，所有不匹配 term1 的路由都将与此术语匹配，结果所有其他 MVPN 路由类型都不会被阻尼。 [edit policy-options policy-statement dampPolicy] user@R4# set then damping no-damp user@R4# set then accept [edit policy-options] user@R4# set damping no-damp disable 将 配置为 parent_vpn_routes 接受不属于地址族的 inet-mvpn 所有其他 BGP 路由。 此策略作为路由实例中的 OSPF 导出策略应用。 [edit policy-options policy-statement parent_vpn_routes] user@R4# set from protocol bgp user@R4# set then accept 配置 VPN 路由和转发 （VRF） 实例。 [edit routing-instances vpn-1] user@R4# set instance-type vrf user@R4# set interface vt-1/2/0.4 user@R4# set interface ge-1/2/1.17 user@R4# set interface lo0.104 user@R4# set route-distinguisher 100:100 user@R4# set vrf-target target:1:1 user@R4# set protocols ospf export parent_vpn_routes user@R4# set protocols ospf area 0.0.0.0 interface lo0.104 passive user@R4# set protocols ospf area 0.0.0.0 interface ge-1/2/1.17 user@R4# set protocols pim rp static address 172.16.100.2 user@R4# set protocols pim interface ge-1/2/1.17 mode sparse user@R4# set protocols mvpn 配置路由器 ID 和自治系统 （AS） 编号。 [edit routing-options] user@R4# set router-id 172.16.1.4 user@R4# set autonomous-system 1001 如果完成设备配置，请提交配置。 user@R4# commit",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@R4# set ge-1/2/0 unit 10 family inet address 10.1.1.10/30",
                    "user@R4# set ge-1/2/0 unit 10 family mpls",
                    "user@R4# set ge-1/2/1 unit 17 family inet address 10.1.1.17/30",
                    "user@R4# set ge-1/2/1 unit 17 family mpls",
                    "user@R4# set vt-1/2/0 unit 4 family inet",
                    "user@R4# set lo0 unit 4 family inet address 172.16.1.4/32",
                    "user@R4# set lo0 unit 104 family inet address 172.16.100.4/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "在接口上配置 MPLS 和信令协议。",
                  "code": [
                    "[edit protocols]",
                    "user@R4# set mpls interface all",
                    "user@R4# set mpls interface ge-1/2/0.10",
                    "user@R4# set rsvp interface all aggregate",
                    "user@R4# set ldp interface ge-1/2/0.10",
                    "user@R4# set ldp p2mp"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group ibgp]",
                    "user@R4# set type internal",
                    "user@R4# set local-address 172.16.1.4",
                    "user@R4# set family inet-vpn unicast",
                    "user@R4# set family inet-vpn any",
                    "user@R4# set family inet-mvpn signaling damping",
                    "user@R4# set neighbor 172.16.1.2 import dampPolicy",
                    "user@R4# set neighbor 172.16.1.5"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置内部网关协议。",
                  "code": [
                    "[edit protocols ospf]",
                    "user@R4# set traffic-engineering",
                    "[edit protocols ospf area 0.0.0.0]",
                    "user@R4# set interface all",
                    "user@R4# set interface lo0.4 passive",
                    "user@R4# set interface ge-1/2/0.10"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置使用 nlri-route-type 匹配条件的阻尼策略，以仅抑制 MVPN 路由类型 3、4 和 5。",
                  "code": [
                    "[edit policy-options policy-statement dampPolicy term term1]",
                    "user@R4# set from family inet-mvpn",
                    "user@R4# set from nlri-route-type 3",
                    "user@R4# set from nlri-route-type 4",
                    "user@R4# set from nlri-route-type 5",
                    "user@R4# set then accept"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置策略以 damping 禁用 BGP 路由抖动抑制。",
                  "code": [
                    "[edit policy-options policy-statement dampPolicy]",
                    "user@R4# set then damping no-damp",
                    "user@R4# set then accept",
                    "[edit policy-options]",
                    "user@R4# set damping no-damp disable"
                  ]
                },
                {
                  "step": 7,
                  "description": "将 配置为 parent_vpn_routes 接受不属于地址族的 inet-mvpn 所有其他 BGP 路由。",
                  "code": [
                    "[edit policy-options policy-statement parent_vpn_routes]",
                    "user@R4# set from protocol bgp",
                    "user@R4# set then accept"
                  ]
                },
                {
                  "step": 8,
                  "description": "配置 VPN 路由和转发 （VRF） 实例。",
                  "code": [
                    "[edit routing-instances vpn-1]",
                    "user@R4# set instance-type vrf",
                    "user@R4# set interface vt-1/2/0.4",
                    "user@R4# set interface ge-1/2/1.17",
                    "user@R4# set interface lo0.104",
                    "user@R4# set route-distinguisher 100:100",
                    "user@R4# set vrf-target target:1:1",
                    "user@R4# set protocols ospf export parent_vpn_routes",
                    "user@R4# set protocols ospf area 0.0.0.0 interface lo0.104 passive",
                    "user@R4# set protocols ospf area 0.0.0.0 interface ge-1/2/1.17",
                    "user@R4# set protocols pim rp static address 172.16.100.2",
                    "user@R4# set protocols pim interface ge-1/2/1.17 mode sparse",
                    "user@R4# set protocols mvpn"
                  ]
                },
                {
                  "step": 9,
                  "description": "配置路由器 ID 和自治系统 （AS） 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@R4# set router-id 172.16.1.4",
                    "user@R4# set autonomous-system 1001"
                  ]
                },
                {
                  "step": 10,
                  "description": "如果完成设备配置，请提交配置。",
                  "code": [
                    "user@R4# commit"
                  ]
                }
              ]
            }
          ]
        },
        {
          "title": "结果",
          "level": 4,
          "content": "在配置模式下，输入 show interfaces 、 show protocols 、 show routing-instances show policy-options 和 show routing-options 命令来确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
          "code": [
            "user@R4#show interfacesge-1/2/0 {\n    unit 10 {\n        family inet {\n            address 10.1.1.10/30;\n        }\n        family mpls;\n    }\n}\nge-1/2/1 {\n    unit 17 {\n        family inet {\n            address 10.1.1.17/30;\n        }\n        family mpls;\n    }\n}\nvt-1/2/0 {\n    unit 4 {\n        family inet;\n    }\n}\nlo0 {\n    unit 4 {\n        family inet {\n            address 172.16.1.4/32;\n        }\n    }\n    unit 104 {\n        family inet {\n            address 172.16.100.4/32;\n        }\n    }\n}",
            "user@R4#show protocolsrsvp {\n    interface all {\n        aggregate;\n    }\n}\nmpls {\n    interface all;\n    interface ge-1/2/0.10;\n}\nbgp {\n    group ibgp {\n        type internal;\n        local-address 172.16.1.4;\n        family inet-vpn {\n            unicast;\n            any;\n        }\n        family inet-mvpn {\n            signaling {\n                damping;\n            }\n        }\n        neighbor 172.16.1.2 {\n            import dampPolicy;\n        }\n        neighbor 172.16.1.5;\n    }\n}\nospf {\n    traffic-engineering;\n    area 0.0.0.0 {\n        interface all;\n        interface lo0.4 {\n            passive;\n        }\n        interface ge-1/2/0.10;\n    }\n}\nldp {\n    interface ge-1/2/0.10;\n    p2mp;\n}",
            "user@R4#show policy-optionspolicy-statement dampPolicy {\n    term term1 {\n        from {\n            family inet-mvpn;\n            nlri-route-type [ 3 4 5 ];\n        }\n        then accept;\n    }\n    then {\n        damping no-damp;\n        accept;\n    }\n}\npolicy-statement parent_vpn_routes {\n    from protocol bgp;\n    then accept;\n}\ndamping no-damp {\n    disable;\n}",
            "user@R4#show routing-instancesvpn-1 {\n    instance-type vrf;\n    interface vt-1/2/0.4;\n    interface ge-1/2/1.17;\n    interface lo0.104;\n    route-distinguisher 100:100;\n    vrf-target target:1:1;\n    protocols {\n        ospf {\n            export parent_vpn_routes;\n            area 0.0.0.0 {\n                interface lo0.104 {\n                    passive;\n                }\n                interface ge-1/2/1.17;\n            }\n        }\n        pim {\n            rp {\n                static {\n                    address 172.16.100.2;\n                }\n            }\n            interface ge-1/2/1.17 {\n                mode sparse;\n            }\n        }\n        mvpn;\n    }\n}",
            "user@R4#show routing-optonsrouter-id 172.16.1.4;\nautonomous-system 1001;"
          ]
        }
      ]
    }
  ],
  "content": "此示例说明如何配置具有 BGP 路由抖动抑制的多协议 BGP 组播 VPN（也称为下一代 MVPN）。 要求 此示例使用 Junos OS 12.2 版。Junos OS 12.2 版中引入了对 MBGP MVPN 的 BGP 路由抖动阻尼支持，特别是在地址族的基础上。 概述 BGP 路由抖动阻尼有助于减少在链路间歇性故障时反复撤销和重新播发路由而导致的路由不稳定。 此示例使用默认阻尼参数，并演示了具有三个提供商边缘 （PE） 路由设备、三个客户边缘 （CE） 路由设备和一个提供商 （P） 路由设备的 MBGP MVPN 方案。 拓扑学 图 4 显示了此示例中使用的拓扑。 图 4： 具有 BGP 路由抖动阻尼功能的 MBGP MVPN 在 PE 设备 R4 上，为地址族 inet-mvpn 配置了 BGP 路由抖动抑制。名为 dampPolicy 的路由策略使用 nlri-route-type 匹配条件来仅抑制 MVPN 路由类型 3、4 和 5。所有其他 MVPN 路由类型均不会受到抑制。 此示例显示了本节 CLI 快速配置 中所有设备上的完整配置。本节 配置设备 R4 介绍 PE 设备 R4 的分步配置"
}