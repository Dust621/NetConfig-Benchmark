{
  "title": "示例：配置 BGP 静态路由以防止路由抖动",
  "sections": [
    {
      "title": "要求",
      "level": 3,
      "content": "此示例使用以下硬件和软件组件： 七个在连接的接口上启用了 BGP 的 MX 系列路由器 在所有设备上运行的 Junos OS 14.2 或更高版本 此示例使用以下硬件和软件组件： 七个在连接的接口上启用了 BGP 的 MX 系列路由器 在所有设备上运行的 Junos OS 14.2 或更高版本"
    },
    {
      "title": "概述",
      "level": 3,
      "content": "从 Junos OS 14.2 版开始，您可以在 BGP 网络中配置和通告 BGP 静态路由。您可以在 BGP 网络中通告 BGP 静态路由，即使它不是前缀的活动路由。除非手动删除 BGP 静态路由，否则不会发生抖动。您可以定义一个策略，用于确定需要播发哪些 BGP 静态路由并将其包含在播发中。无论播发路由器获知的动态路由信息如何，对等路由器都会接收这些 BGP 静态路由的通告。 在示例 BGP 网络中，设备 CE1、CE2 和 CE3 直接连接到路由器 PE1、PE2 和 PE3。PE1 和 PE2 都连接到路由器 P。路由器 P 直接连接到路由器 PE3。EBGP 在提供商边缘和客户边缘路由器上配置。IBGP 在直接连接的提供商边缘路由器上进行配置。IGP 协议 IS-IS 在所有提供商路由器上配置。在路由器 PE1 上配置 BGP 静态路由，以确保 CE1 后面的客户路由 10.0.0.28 不会发生抖动。提供商路由器 PE2 配置为接收 BGP 静态路由。目标是仅向 CE2 播发 BGP 静态路由，而不播发到 CE3，并证明配置的 BGP 静态路由不会抖动。 拓扑学 图 5 显示了示例拓扑。 图 5： 配置 BGP 静态路由 从 Junos OS 14.2 版开始，您可以在 BGP 网络中配置和通告 BGP 静态路由。您可以在 BGP 网络中通告 BGP 静态路由，即使它不是前缀的活动路由。除非手动删除 BGP 静态路由，否则不会发生抖动。您可以定义一个策略，用于确定需要播发哪些 BGP 静态路由并将其包含在播发中。无论播发路由器获知的动态路由信息如何，对等路由器都会接收这些 BGP 静态路由的通告。 在示例 BGP 网络中，设备 CE1、CE2 和 CE3 直接连接到路由器 PE1、PE2 和 PE3。PE1 和 PE2 都连接到路由器 P。路由器 P 直接连接到路由器 PE3。EBGP 在提供商边缘和客户边缘路由器上配置。IBGP 在直接连接的提供商边缘路由器上进行配置。IGP 协议 IS-IS 在所有提供商路由器上配置。在路由器 PE1 上配置 BGP 静态路由，以确保 CE1 后面的客户路由 10.0.0.28 不会发生抖动。提供商路由器 PE2 配置为接收 BGP 静态路由。目标是仅向 CE2 播发 BGP 静态路由，而不播发到 CE3，并证明配置的 BGP 静态路由不会抖动。 拓扑学 图 5 显示了示例拓扑。 图 5： 配置 BGP 静态路由 图 5 显示了示例拓扑。 图 5： 配置 BGP 静态路由",
      "sections": [
        {
          "title": "拓扑学",
          "level": 4,
          "content": "图 5 显示了示例拓扑。 图 5： 配置 BGP 静态路由",
          "images": [
            "BGP 会话和路由抖动\\images\\9_示例：配置_BGP_静态路由以防止路由抖_1.gif"
          ]
        }
      ]
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改详细信息，以便与网络配置匹配，将命令复制并粘贴到 [edit] 层级的 CLI 中，然后从配置模式进入 commit 。 路由器 P set interfaces ge-1/0/0 unit 2 description P->PE1 set interfaces ge-1/0/0 unit 2 family inet address 10.0.0.2/29 set interfaces ge-1/0/0 unit 2 family iso set interfaces ge-1/0/1 unit 5 description P->PE2 set interfaces ge-1/0/1 unit 5 family inet address 10.0.0.5/29 set interfaces ge-1/0/1 unit 5 family iso set interfaces ge-1/1/2 unit 3 description P->PE3 set interfaces ge-1/1/2 unit 3 family inet address 10.0.0.3/29 set interfaces ge-1/1/2 unit 3 family iso set interfaces lo0 unit 0 family inet address 10.255.102.146/32 primary set interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1050.00 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 10.255.102.146 set protocols bgp group ibgp neighbor 10.255.102.128 description PE1 set protocols bgp group ibgp neighbor 10.255.102.178 description PE2 set protocols bgp group ibgp neighbor 10.255.102.156 description PE3 set protocols isis interface ge-1/0/0.2 set protocols isis interface ge-1/0/1.5 set protocols isis interface ge-1/1/2.3 set protocols isis interface lo0.0 passive set routing-options router-id 10.255.102.146 set routing-options autonomous-system 64496 路由器 PE1 set interfaces ge-1/0/0 unit 1 description PE1->P set interfaces ge-1/0/0 unit 1 family inet address 10.0.0.1/29 set interfaces ge-1/0/0 unit 1 family iso set interfaces ge-1/1/0 unit 10 description PE1->CE1 set interfaces ge-1/1/0 unit 10 family inet address 10.0.0.10/30 set interfaces lo0 unit 0 family inet address 10.255.102.128/32 set interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1010.00 set protocols bgp group ebgp type external set protocols bgp group ebgp peer-as 64497 set protocols bgp group ebgp neighbor 10.0.0.9 description CE1 set protocols bgp group ebgp neighbor 10.0.0.9 local-address 10.0.0.10 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 10.255.102.128 set protocols bgp group ibgp export export-self set protocols bgp group ibgp neighbor 10.255.102.146 description P set protocols bgp group ibgp neighbor 10.255.102.178 description PE2 set protocols bgp group ibgp neighbor 10.255.102.178 advertise-bgp-static set protocols bgp group ibgp neighbor 10.255.102.156 description PE3 set protocols isis interface ge-1/0/0.1 set protocols isis interface lo0.0 passive set policy-options policy-statement export-self then next-hop self set routing-options bgp-static route 10.0.0.28/32 preference2 4294967195 set routing-options bgp-static route 10.0.0.28/32 as-path path 64497 set routing-options router-id 10.255.102.128 set routing-options autonomous-system 64496 路由器 PE2 set interfaces ge-1/0/1 unit 6 description PE2->P set interfaces ge-1/0/1 unit 6 family inet address 10.0.0.6/29 set interfaces ge-1/0/1 unit 6 family iso set interfaces ge-1/1/2 unit 14 description PE2->CE2 set interfaces ge-1/1/2 unit 14 family inet address 10.0.0.14/30 set interfaces lo0 unit 0 family inet address 10.255.102.178/32 set interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1030.00 set protocols bgp group ebgp type external set protocols bgp group ebgp peer-as 64498 set protocols bgp group ebgp neighbor 10.0.0.13 description CE2 set protocols bgp group ebgp neighbor 10.0.0.13 local-address 10.0.0.14 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 10.255.102.178 set protocols bgp group ibgp export export-self set protocols bgp group ibgp neighbor 10.255.102.146 description P set protocols bgp group ibgp neighbor 10.255.102.128 description PE1 set protocols bgp group ibgp neighbor 10.255.102.156 description PE3 set protocols isis interface ge-1/0/1.6 set protocols isis interface lo0.0 passive set policy-options policy-statement export-self then next-hop self set routing-options router-id 10.255.102.178 set routing-options autonomous-system 64496 路由器 PE3 set interfaces ge-2/0/1 unit 4 description PE3->P set interfaces ge-2/0/1 unit 4 family inet address 10.0.0.4/29 set interfaces ge-2/0/5 unit 18 description PE3->CE3 set interfaces ge-2/0/5 unit 18 family inet address 10.0.0.18/30 set interfaces lo0 unit 0 family inet address 10.255.102.156/32 set interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1070.00 set protocols bgp group ebgp type external set protocols bgp group ebgp peer-as 64499 set protocols bgp group ebgp neighbor 10.0.0.17 description CE3 set protocols bgp group ebgp neighbor 10.0.0.17 local-address 10.0.0.18 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 10.255.102.156 set protocols bgp group ibgp export export-self set protocols bgp group ibgp neighbor 10.255.102.146 description P set protocols bgp group ibgp neighbor 10.255.102.128 description PE1 set protocols bgp group ibgp neighbor 10.255.102.178 description PE2 set protocols isis interface ge-2/0/1.4 set protocols isis interface lo0.0 passive set policy-options policy-statement export-self then next-hop self set routing-options router-id 10.255.102.156 set routing-options autonomous-system 64496 路由器 CE1 set interfaces ge-2/0/8 unit 9 description CE1->PE1 set interfaces ge-2/0/8 unit 9 family inet address 10.0.0.9/30 set interfaces lo0 unit 0 family inet address 127.255.102.166/32 set interfaces lo0 unit 0 family inet address 10.0.0.28/32 set protocols bgp group ebgp type external set protocols bgp group ebgp export export-direct set protocols bgp group ebgp peer-as 64496 set protocols bgp group ebgp neighbor 10.0.0.10 description PE1 set protocols bgp group ebgp neighbor 10.0.0.10 local-address 10.0.0.9 set policy-options policy-statement export-direct from protocol direct route-filter 10.0.0.0/29 or longer set policy-options policy-statement export-direct then accept set routing-options autonomous-system 64497 路由器 CE2 set interfaces ge-2/0/0 unit 13 description CE2->PE2 set interfaces ge-2/0/0 unit 13 family inet address 10.0.0.13/30 set interfaces lo0 unit 0 family inet address 127.255.102.176/32 set protocols bgp group ebgp type external set protocols bgp export export-direct set protocols bgp group ebgp peer-as 64496 set protocols bgp group ebgp neighbor 10.0.0.14 description PE2 set protocols bgp group ebgp neighbor 10.0.0.14 local-address 10.0.0.13 set policy-options policy-statement export-direct from protocol direct route-filter 10.0.0.0/29 or longer set policy-options policy-statement export-direct then accept set routing-options router-id 127.255.102.176 set routing-options autonomous-system 64498 路由器 CE3 set interfaces ge-2/0/5 unit 17 description CE3->PE3 set interfaces ge-2/0/5 unit 17 family inet address 10.0.0.17/30 set interfaces lo0 unit 0 family inet address 127.255.102.186/32 set protocols bgp group ebgp type external set protocols bgp export export-direct set protocols bgp group ebgp peer-as 64496 set protocols bgp group ebgp neighbor 10.0.0.18 description PE3 set protocols bgp group ebgp neighbor 10.0.0.18 local-address 10.0.0.17 set policy-options policy-statement export-direct from protocol direct route-filter 10.0.0.0/29 or longer set policy-options policy-statement export-direct then accept set routing-options router-id 127.255.102.186 set routing-options autonomous-system 64499 以下示例要求您在配置层次结构中导航各个级别。有关导航 CLI 的信息，请参阅 CLI 用户指南中的在配置模式下使用 CLI 编辑器。 要配置路由器 PE1： 使用 IPv4 地址配置接口。 [edit interfaces] user@PE1# set ge-1/0/0 unit 1 description PE1->P user@PE1# set ge-1/0/0 unit 1 family inet address 10.0.0.1/29 user@PE1# set ge-1/1/0 unit 10 description PE1->CE1 user@PE1# set ge-1/1/0 unit 10 family inet address 10.0.0.10/30 在连接到提供商路由器的接口上启用 IS-IS 协议，以便学习和交换获知的路由。 [edit interfaces] user@PE1# set ge-1/0/0 unit 1 family iso 为 inet 和 IS-IS 配置环路地址。 [edit interfaces lo0 unit 0] user@PE1# set family inet address 10.255.102.128/32 user@PE1# set family iso address 49.0001.1720.1600.1010.00 配置 IS-IS 接口。 [edit protocols isis] user@PE1# set interface ge-1/0/0.1 user@PE1# set interface lo0.0 passive 配置 EBGP。 [edit protocols bgp group ebgp] user@PE1# set type external user@PE1# set peer-as 64497 user@PE1# set neighbor 10.0.0.9 description CE1 user@PE1# set neighbor 10.0.0.9 local-address 10.0.0.10 在连接到提供商网络的内部路由器上配置 IBGP 邻居。 [edit protocols bgp group ibgp] user@PE1# set type internal user@PE1# set local-address 10.255.102.128 user@PE1# set export export-self user@PE1# set neighbor 10.255.102.146 description P user@PE1# set neighbor 10.255.102.178 description PE2 user@PE1# set neighbor 10.255.102.156 description PE3 配置 BGP 静态路由。 [edit routing-options] user@PE1# set bgp-static route 10.0.0.28/32 preference2 4294967195 user@PE1# set bgp-static route 10.0.0.28/32 as-path path 64497 配置 BGP 邻居 PE2 以接收 BGP 静态通告。 [edit protocols bgp group ibgp neighbor 10.255.102.178] user@PE1# set advertise-bgp-static 定义用于将路由导出到 BGP 网络的策略。 [edit policy-options policy-statement export-self] user@PE1# set then next-hop self 将策略应用于 IBGP 组。 [edit protocols bgp group ibgp] user@PE1# set export export-self 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@PE1# set router-id 10.255.102.128 user@PE1# set autonomous-system 64496 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 [edit] user@PE1> show interfaces ge-1/0/0 { unit 1 { description PE1->P; family inet { address 10.0.0.1/29; } family iso; } ge-1/1/0 { unit 10 { description PE1->CE1; family inet { address 10.0.0.10/30; } } } } lo0 { unit 0{ family inet { address 10.255.102.128/32; } family iso { address 49.0001.1720.1600.1010.00; } } } [edit] user@PE1> show protocols bgp { group ebgp { type external; peer-as 64497; neighbor 10.0.0.9 { description CE1; local-address 10.0.0.10; } } group ibgp { type internal; local-address 10.255.102.128; export export-self; neighbor 10.255.102.146 { description P; } neighbor 10.255.102.178 { description PE2; advertise-bgp-static; } neighbor 10.255.102.156 { description PE3; } } } isis { interface ge-1/0/0.1; interface lo0.0 { passive; } } [edit] user@PE1> show routing-options bgp-static { route 10.0.0.28/32 { preference2 4294967195; as-path { path 64497; } } } router-id 10.255.102.128; autonomous-system 64496; [edit] user@PE1> show policy-options policy-statement export-self { then { next-hop self; } } 如果完成设备配置，请从配置模式输入 commit 。 [edit] user@PE1# commit",
      "sections": [
        {
          "title": "CLI 快速配置",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改详细信息，以便与网络配置匹配，将命令复制并粘贴到 [edit] 层级的 CLI 中，然后从配置模式进入 commit 。 路由器 P set interfaces ge-1/0/0 unit 2 description P->PE1 set interfaces ge-1/0/0 unit 2 family inet address 10.0.0.2/29 set interfaces ge-1/0/0 unit 2 family iso set interfaces ge-1/0/1 unit 5 description P->PE2 set interfaces ge-1/0/1 unit 5 family inet address 10.0.0.5/29 set interfaces ge-1/0/1 unit 5 family iso set interfaces ge-1/1/2 unit 3 description P->PE3 set interfaces ge-1/1/2 unit 3 family inet address 10.0.0.3/29 set interfaces ge-1/1/2 unit 3 family iso set interfaces lo0 unit 0 family inet address 10.255.102.146/32 primary set interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1050.00 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 10.255.102.146 set protocols bgp group ibgp neighbor 10.255.102.128 description PE1 set protocols bgp group ibgp neighbor 10.255.102.178 description PE2 set protocols bgp group ibgp neighbor 10.255.102.156 description PE3 set protocols isis interface ge-1/0/0.2 set protocols isis interface ge-1/0/1.5 set protocols isis interface ge-1/1/2.3 set protocols isis interface lo0.0 passive set routing-options router-id 10.255.102.146 set routing-options autonomous-system 64496 路由器 PE1 set interfaces ge-1/0/0 unit 1 description PE1->P set interfaces ge-1/0/0 unit 1 family inet address 10.0.0.1/29 set interfaces ge-1/0/0 unit 1 family iso set interfaces ge-1/1/0 unit 10 description PE1->CE1 set interfaces ge-1/1/0 unit 10 family inet address 10.0.0.10/30 set interfaces lo0 unit 0 family inet address 10.255.102.128/32 set interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1010.00 set protocols bgp group ebgp type external set protocols bgp group ebgp peer-as 64497 set protocols bgp group ebgp neighbor 10.0.0.9 description CE1 set protocols bgp group ebgp neighbor 10.0.0.9 local-address 10.0.0.10 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 10.255.102.128 set protocols bgp group ibgp export export-self set protocols bgp group ibgp neighbor 10.255.102.146 description P set protocols bgp group ibgp neighbor 10.255.102.178 description PE2 set protocols bgp group ibgp neighbor 10.255.102.178 advertise-bgp-static set protocols bgp group ibgp neighbor 10.255.102.156 description PE3 set protocols isis interface ge-1/0/0.1 set protocols isis interface lo0.0 passive set policy-options policy-statement export-self then next-hop self set routing-options bgp-static route 10.0.0.28/32 preference2 4294967195 set routing-options bgp-static route 10.0.0.28/32 as-path path 64497 set routing-options router-id 10.255.102.128 set routing-options autonomous-system 64496 路由器 PE2 set interfaces ge-1/0/1 unit 6 description PE2->P set interfaces ge-1/0/1 unit 6 family inet address 10.0.0.6/29 set interfaces ge-1/0/1 unit 6 family iso set interfaces ge-1/1/2 unit 14 description PE2->CE2 set interfaces ge-1/1/2 unit 14 family inet address 10.0.0.14/30 set interfaces lo0 unit 0 family inet address 10.255.102.178/32 set interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1030.00 set protocols bgp group ebgp type external set protocols bgp group ebgp peer-as 64498 set protocols bgp group ebgp neighbor 10.0.0.13 description CE2 set protocols bgp group ebgp neighbor 10.0.0.13 local-address 10.0.0.14 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 10.255.102.178 set protocols bgp group ibgp export export-self set protocols bgp group ibgp neighbor 10.255.102.146 description P set protocols bgp group ibgp neighbor 10.255.102.128 description PE1 set protocols bgp group ibgp neighbor 10.255.102.156 description PE3 set protocols isis interface ge-1/0/1.6 set protocols isis interface lo0.0 passive set policy-options policy-statement export-self then next-hop self set routing-options router-id 10.255.102.178 set routing-options autonomous-system 64496 路由器 PE3 set interfaces ge-2/0/1 unit 4 description PE3->P set interfaces ge-2/0/1 unit 4 family inet address 10.0.0.4/29 set interfaces ge-2/0/5 unit 18 description PE3->CE3 set interfaces ge-2/0/5 unit 18 family inet address 10.0.0.18/30 set interfaces lo0 unit 0 family inet address 10.255.102.156/32 set interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1070.00 set protocols bgp group ebgp type external set protocols bgp group ebgp peer-as 64499 set protocols bgp group ebgp neighbor 10.0.0.17 description CE3 set protocols bgp group ebgp neighbor 10.0.0.17 local-address 10.0.0.18 set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 10.255.102.156 set protocols bgp group ibgp export export-self set protocols bgp group ibgp neighbor 10.255.102.146 description P set protocols bgp group ibgp neighbor 10.255.102.128 description PE1 set protocols bgp group ibgp neighbor 10.255.102.178 description PE2 set protocols isis interface ge-2/0/1.4 set protocols isis interface lo0.0 passive set policy-options policy-statement export-self then next-hop self set routing-options router-id 10.255.102.156 set routing-options autonomous-system 64496 路由器 CE1 set interfaces ge-2/0/8 unit 9 description CE1->PE1 set interfaces ge-2/0/8 unit 9 family inet address 10.0.0.9/30 set interfaces lo0 unit 0 family inet address 127.255.102.166/32 set interfaces lo0 unit 0 family inet address 10.0.0.28/32 set protocols bgp group ebgp type external set protocols bgp group ebgp export export-direct set protocols bgp group ebgp peer-as 64496 set protocols bgp group ebgp neighbor 10.0.0.10 description PE1 set protocols bgp group ebgp neighbor 10.0.0.10 local-address 10.0.0.9 set policy-options policy-statement export-direct from protocol direct route-filter 10.0.0.0/29 or longer set policy-options policy-statement export-direct then accept set routing-options autonomous-system 64497 路由器 CE2 set interfaces ge-2/0/0 unit 13 description CE2->PE2 set interfaces ge-2/0/0 unit 13 family inet address 10.0.0.13/30 set interfaces lo0 unit 0 family inet address 127.255.102.176/32 set protocols bgp group ebgp type external set protocols bgp export export-direct set protocols bgp group ebgp peer-as 64496 set protocols bgp group ebgp neighbor 10.0.0.14 description PE2 set protocols bgp group ebgp neighbor 10.0.0.14 local-address 10.0.0.13 set policy-options policy-statement export-direct from protocol direct route-filter 10.0.0.0/29 or longer set policy-options policy-statement export-direct then accept set routing-options router-id 127.255.102.176 set routing-options autonomous-system 64498 路由器 CE3 set interfaces ge-2/0/5 unit 17 description CE3->PE3 set interfaces ge-2/0/5 unit 17 family inet address 10.0.0.17/30 set interfaces lo0 unit 0 family inet address 127.255.102.186/32 set protocols bgp group ebgp type external set protocols bgp export export-direct set protocols bgp group ebgp peer-as 64496 set protocols bgp group ebgp neighbor 10.0.0.18 description PE3 set protocols bgp group ebgp neighbor 10.0.0.18 local-address 10.0.0.17 set policy-options policy-statement export-direct from protocol direct route-filter 10.0.0.0/29 or longer set policy-options policy-statement export-direct then accept set routing-options router-id 127.255.102.186 set routing-options autonomous-system 64499",
          "commands_by_device": {
            "路由器 P": "set interfaces ge-1/0/0 unit 2 description P->PE1\nset interfaces ge-1/0/0 unit 2 family inet address 10.0.0.2/29\nset interfaces ge-1/0/0 unit 2 family iso\nset interfaces ge-1/0/1 unit 5 description P->PE2\nset interfaces ge-1/0/1 unit 5 family inet address 10.0.0.5/29\nset interfaces ge-1/0/1 unit 5 family iso\nset interfaces ge-1/1/2 unit 3 description P->PE3\nset interfaces ge-1/1/2 unit 3 family inet address 10.0.0.3/29\nset interfaces ge-1/1/2 unit 3 family iso\nset interfaces lo0 unit 0 family inet address 10.255.102.146/32 primary\nset interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1050.00\nset protocols bgp group ibgp type internal\nset protocols bgp group ibgp local-address 10.255.102.146\nset protocols bgp group ibgp neighbor 10.255.102.128 description PE1\nset protocols bgp group ibgp neighbor 10.255.102.178 description PE2\nset protocols bgp group ibgp neighbor 10.255.102.156 description PE3\nset protocols isis interface ge-1/0/0.2\nset protocols isis interface ge-1/0/1.5\nset protocols isis interface ge-1/1/2.3\nset protocols isis interface lo0.0 passive\nset routing-options router-id 10.255.102.146\nset routing-options autonomous-system 64496",
            "路由器 PE1": "set interfaces ge-1/0/0 unit 1 description PE1->P\nset interfaces ge-1/0/0 unit 1 family inet address 10.0.0.1/29\nset interfaces ge-1/0/0 unit 1 family iso\nset interfaces ge-1/1/0 unit 10 description PE1->CE1\nset interfaces ge-1/1/0 unit 10 family inet address 10.0.0.10/30\nset interfaces lo0 unit 0 family inet address 10.255.102.128/32\nset interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1010.00\nset protocols bgp group ebgp type external\nset protocols bgp group ebgp peer-as 64497\nset protocols bgp group ebgp neighbor 10.0.0.9 description CE1\nset protocols bgp group ebgp neighbor 10.0.0.9 local-address 10.0.0.10\nset protocols bgp group ibgp type internal\nset protocols bgp group ibgp local-address 10.255.102.128\nset protocols bgp group ibgp export export-self\nset protocols bgp group ibgp neighbor 10.255.102.146 description P\nset protocols bgp group ibgp neighbor 10.255.102.178 description PE2\nset protocols bgp group ibgp neighbor 10.255.102.178 advertise-bgp-static\nset protocols bgp group ibgp neighbor 10.255.102.156 description PE3\nset protocols isis interface ge-1/0/0.1\nset protocols isis interface lo0.0 passive\nset policy-options policy-statement export-self then next-hop self\nset routing-options bgp-static route 10.0.0.28/32 preference2 4294967195\nset routing-options bgp-static route 10.0.0.28/32 as-path path 64497\nset routing-options router-id 10.255.102.128\nset routing-options autonomous-system 64496",
            "路由器 PE2": "set interfaces ge-1/0/1 unit 6 description PE2->P\nset interfaces ge-1/0/1 unit 6 family inet address 10.0.0.6/29\nset interfaces ge-1/0/1 unit 6 family iso\nset interfaces ge-1/1/2 unit 14 description PE2->CE2\nset interfaces ge-1/1/2 unit 14 family inet address 10.0.0.14/30\nset interfaces lo0 unit 0 family inet address 10.255.102.178/32\nset interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1030.00\nset protocols bgp group ebgp type external\nset protocols bgp group ebgp peer-as 64498\nset protocols bgp group ebgp neighbor 10.0.0.13 description CE2\nset protocols bgp group ebgp neighbor 10.0.0.13 local-address 10.0.0.14\nset protocols bgp group ibgp type internal\nset protocols bgp group ibgp local-address 10.255.102.178\nset protocols bgp group ibgp export export-self\nset protocols bgp group ibgp neighbor 10.255.102.146 description P\nset protocols bgp group ibgp neighbor 10.255.102.128 description PE1\nset protocols bgp group ibgp neighbor 10.255.102.156 description PE3\nset protocols isis interface ge-1/0/1.6\nset protocols isis interface lo0.0 passive\nset policy-options policy-statement export-self then next-hop self\nset routing-options router-id 10.255.102.178\nset routing-options autonomous-system 64496",
            "路由器 PE3": "set interfaces ge-2/0/1 unit 4 description PE3->P\nset interfaces ge-2/0/1 unit 4 family inet address 10.0.0.4/29\nset interfaces ge-2/0/5 unit 18 description PE3->CE3\nset interfaces ge-2/0/5 unit 18 family inet address 10.0.0.18/30\nset interfaces lo0 unit 0 family inet address 10.255.102.156/32\nset interfaces lo0 unit 0 family iso address 49.0001.1720.1600.1070.00\nset protocols bgp group ebgp type external\nset protocols bgp group ebgp peer-as 64499\nset protocols bgp group ebgp neighbor 10.0.0.17 description CE3\nset protocols bgp group ebgp neighbor 10.0.0.17 local-address 10.0.0.18\nset protocols bgp group ibgp type internal\nset protocols bgp group ibgp local-address 10.255.102.156\nset protocols bgp group ibgp export export-self\nset protocols bgp group ibgp neighbor 10.255.102.146 description P\nset protocols bgp group ibgp neighbor 10.255.102.128 description PE1\nset protocols bgp group ibgp neighbor 10.255.102.178 description PE2\nset protocols isis interface ge-2/0/1.4\nset protocols isis interface lo0.0 passive\nset policy-options policy-statement export-self then next-hop self\nset routing-options router-id 10.255.102.156\nset routing-options autonomous-system 64496",
            "路由器 CE1": "set interfaces ge-2/0/8 unit 9 description CE1->PE1\nset interfaces ge-2/0/8 unit 9 family inet address 10.0.0.9/30\nset interfaces lo0 unit 0 family inet address 127.255.102.166/32\nset interfaces lo0 unit 0 family inet address 10.0.0.28/32\nset protocols bgp group ebgp type external\nset protocols bgp group ebgp export export-direct\nset protocols bgp group ebgp peer-as 64496\nset protocols bgp group ebgp neighbor 10.0.0.10 description PE1\nset protocols bgp group ebgp neighbor 10.0.0.10 local-address 10.0.0.9\nset policy-options policy-statement export-direct from protocol direct route-filter 10.0.0.0/29 or longer\nset policy-options policy-statement export-direct then accept\nset routing-options autonomous-system 64497",
            "路由器 CE2": "set interfaces ge-2/0/0 unit 13 description CE2->PE2\nset interfaces ge-2/0/0 unit 13 family inet address 10.0.0.13/30\nset interfaces lo0 unit 0 family inet address 127.255.102.176/32\nset protocols bgp group ebgp type external\nset protocols bgp export export-direct\nset protocols bgp group ebgp peer-as 64496\nset protocols bgp group ebgp neighbor 10.0.0.14 description PE2\nset protocols bgp group ebgp neighbor 10.0.0.14 local-address 10.0.0.13\nset policy-options policy-statement export-direct from protocol direct route-filter 10.0.0.0/29 or longer\nset policy-options policy-statement export-direct then accept\nset routing-options router-id 127.255.102.176\nset routing-options autonomous-system 64498",
            "路由器 CE3": "set interfaces ge-2/0/5 unit 17 description CE3->PE3\nset interfaces ge-2/0/5 unit 17 family inet address 10.0.0.17/30\nset interfaces lo0 unit 0 family inet address 127.255.102.186/32\nset protocols bgp group ebgp type external\nset protocols bgp export export-direct\nset protocols bgp group ebgp peer-as 64496\nset protocols bgp group ebgp neighbor 10.0.0.18 description PE3\nset protocols bgp group ebgp neighbor 10.0.0.18 local-address 10.0.0.17\nset policy-options policy-statement export-direct from protocol direct route-filter 10.0.0.0/29 or longer\nset policy-options policy-statement export-direct then accept\nset routing-options router-id 127.255.102.186\nset routing-options autonomous-system 64499"
          }
        },
        {
          "title": "程序",
          "level": 4,
          "content": "以下示例要求您在配置层次结构中导航各个级别。有关导航 CLI 的信息，请参阅 CLI 用户指南中的在配置模式下使用 CLI 编辑器。 要配置路由器 PE1： 使用 IPv4 地址配置接口。 [edit interfaces] user@PE1# set ge-1/0/0 unit 1 description PE1->P user@PE1# set ge-1/0/0 unit 1 family inet address 10.0.0.1/29 user@PE1# set ge-1/1/0 unit 10 description PE1->CE1 user@PE1# set ge-1/1/0 unit 10 family inet address 10.0.0.10/30 在连接到提供商路由器的接口上启用 IS-IS 协议，以便学习和交换获知的路由。 [edit interfaces] user@PE1# set ge-1/0/0 unit 1 family iso 为 inet 和 IS-IS 配置环路地址。 [edit interfaces lo0 unit 0] user@PE1# set family inet address 10.255.102.128/32 user@PE1# set family iso address 49.0001.1720.1600.1010.00 配置 IS-IS 接口。 [edit protocols isis] user@PE1# set interface ge-1/0/0.1 user@PE1# set interface lo0.0 passive 配置 EBGP。 [edit protocols bgp group ebgp] user@PE1# set type external user@PE1# set peer-as 64497 user@PE1# set neighbor 10.0.0.9 description CE1 user@PE1# set neighbor 10.0.0.9 local-address 10.0.0.10 在连接到提供商网络的内部路由器上配置 IBGP 邻居。 [edit protocols bgp group ibgp] user@PE1# set type internal user@PE1# set local-address 10.255.102.128 user@PE1# set export export-self user@PE1# set neighbor 10.255.102.146 description P user@PE1# set neighbor 10.255.102.178 description PE2 user@PE1# set neighbor 10.255.102.156 description PE3 配置 BGP 静态路由。 [edit routing-options] user@PE1# set bgp-static route 10.0.0.28/32 preference2 4294967195 user@PE1# set bgp-static route 10.0.0.28/32 as-path path 64497 配置 BGP 邻居 PE2 以接收 BGP 静态通告。 [edit protocols bgp group ibgp neighbor 10.255.102.178] user@PE1# set advertise-bgp-static 定义用于将路由导出到 BGP 网络的策略。 [edit policy-options policy-statement export-self] user@PE1# set then next-hop self 将策略应用于 IBGP 组。 [edit protocols bgp group ibgp] user@PE1# set export export-self 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@PE1# set router-id 10.255.102.128 user@PE1# set autonomous-system 64496",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "使用 IPv4 地址配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE1# set ge-1/0/0 unit 1 description PE1->P ",
                    "user@PE1# set ge-1/0/0 unit 1 family inet address 10.0.0.1/29",
                    "user@PE1# set ge-1/1/0 unit 10 description PE1->CE1 ",
                    "user@PE1# set ge-1/1/0 unit 10 family inet address 10.0.0.10/30"
                  ]
                },
                {
                  "step": 2,
                  "description": "在连接到提供商路由器的接口上启用 IS-IS 协议，以便学习和交换获知的路由。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE1# set ge-1/0/0 unit 1 family iso"
                  ]
                },
                {
                  "step": 3,
                  "description": "为 inet 和 IS-IS 配置环路地址。",
                  "code": [
                    "[edit interfaces lo0 unit 0]",
                    "user@PE1# set family inet address 10.255.102.128/32",
                    "user@PE1# set family iso address 49.0001.1720.1600.1010.00"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置 IS-IS 接口。",
                  "code": [
                    "[edit protocols isis]",
                    "user@PE1# set interface ge-1/0/0.1",
                    "user@PE1# set interface lo0.0 passive"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置 EBGP。",
                  "code": [
                    "[edit protocols bgp group ebgp]",
                    "user@PE1# set type external",
                    "user@PE1# set peer-as 64497",
                    "user@PE1# set neighbor 10.0.0.9 description CE1",
                    "user@PE1# set neighbor 10.0.0.9 local-address 10.0.0.10"
                  ]
                },
                {
                  "step": 6,
                  "description": "在连接到提供商网络的内部路由器上配置 IBGP 邻居。",
                  "code": [
                    "[edit protocols bgp group ibgp]",
                    "user@PE1# set type internal",
                    "user@PE1# set local-address 10.255.102.128",
                    "user@PE1# set export export-self",
                    "user@PE1# set neighbor 10.255.102.146 description P",
                    "user@PE1# set neighbor 10.255.102.178 description PE2",
                    "user@PE1# set neighbor 10.255.102.156 description PE3"
                  ]
                },
                {
                  "step": 7,
                  "description": "配置 BGP 静态路由。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE1# set bgp-static route 10.0.0.28/32 preference2 4294967195",
                    "user@PE1# set bgp-static route 10.0.0.28/32 as-path path 64497"
                  ]
                },
                {
                  "step": 8,
                  "description": "配置 BGP 邻居 PE2 以接收 BGP 静态通告。",
                  "code": [
                    "[edit protocols bgp group ibgp neighbor 10.255.102.178]",
                    "user@PE1# set advertise-bgp-static"
                  ]
                },
                {
                  "step": 9,
                  "description": "定义用于将路由导出到 BGP 网络的策略。",
                  "code": [
                    "[edit policy-options policy-statement export-self]",
                    "user@PE1# set then next-hop self"
                  ]
                },
                {
                  "step": 10,
                  "description": "将策略应用于 IBGP 组。",
                  "code": [
                    "[edit protocols bgp group ibgp]",
                    "user@PE1# set export export-self"
                  ]
                },
                {
                  "step": 11,
                  "description": "配置路由器 ID 和自治系统 (AS) 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE1# set router-id 10.255.102.128",
                    "user@PE1# set autonomous-system 64496"
                  ]
                }
              ]
            }
          ]
        },
        {
          "title": "结果",
          "level": 4,
          "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。",
          "code": [
            "[edit]\nuser@PE1>show interfacesge-1/0/0 {\n    unit 1 {\n        description PE1->P;\n        family inet {\n            address 10.0.0.1/29;\n        }\n        family iso;\n    }\n    ge-1/1/0 {\n        unit 10 {\n            description PE1->CE1;\n            family inet {\n                address 10.0.0.10/30;\n            }\n        }\n    }\n}\nlo0 {\n    unit 0{\n        family inet {\n            address 10.255.102.128/32;\n        }\n        family iso {\n            address 49.0001.1720.1600.1010.00;\n        }\n    }\n}",
            "[edit]\nuser@PE1>show protocolsbgp {\n    group ebgp {\n        type external;\n        peer-as 64497;\n        neighbor 10.0.0.9 {\n            description CE1;\n            local-address 10.0.0.10;\n        }\n    }\n    group ibgp {\n        type internal;\n        local-address 10.255.102.128;\n        export export-self;\n        neighbor 10.255.102.146 {\n            description P;\n        }\n        neighbor 10.255.102.178 {\n            description PE2;\n            advertise-bgp-static;\n        }\n        neighbor 10.255.102.156 {\n            description PE3;\n        }\n    }\n}\nisis {\n    interface ge-1/0/0.1;\n    interface lo0.0 {\n        passive;\n    }\n}",
            "[edit]\nuser@PE1>show routing-optionsbgp-static {\n    route 10.0.0.28/32 {\n        preference2 4294967195;\n        as-path {\n            path 64497;\n        }\n    }\n}\nrouter-id 10.255.102.128;\nautonomous-system 64496;",
            "[edit]\nuser@PE1>show policy-optionspolicy-statement export-self {\n    then {\n        next-hop self;\n    }\n}",
            "[edit]\nuser@PE1#commit"
          ]
        },
        {
          "title": "验证配置的主机是否接收 BGP 静态路由",
          "level": 4,
          "content": "目的 验证 BGP 静态路由是否正在播发到配置为接收它的主机。 验证 BGP 静态路由是否正在播发到配置为接收它的主机。 在设备 CE2 和 CE3 上，在操作模式下，运行 show route protocol bgp 命令以在路由表中显示获知的路由。 user@CE2> show route protocol bgp inet.0: 6 destinations, 6 routes (6 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 10.0.0.28/32 *[BGP/170] 01:52:10, localpref 100 AS path: 64496 64497 I, validation-state: unverified > to 10.0.0.14 via ge-2/0/0.13 1.0.0.29/32 *[BGP/170] 01:52:06, localpref 100 AS path: 64496 64499 I, validation-state: unverified > to 10.0.0.14 via ge-2/0/0.13 iso.0: 1 destinations, 1 routes (1 active, 0 holddown, 0 hidden) inet6.0: 6 destinations, 6 routes (6 active, 0 holddown, 0 hidden) user@CE3> show route protocol bgp inet.0: 6 destinations, 6 routes (6 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 1.0.0.28/32 *[BGP/170] 01:52:19, localpref 100 AS path: 64496 64497 I, validation-state: unverified > to 10.0.0.18 via ge-2/0/5.17 1.0.0.29/32 *[BGP/170] 01:52:15, localpref 100 AS path: 64496 64498 I, validation-state: unverified > to 10.0.0.18 via ge-2/0/5.17 iso.0: 1 destinations, 1 routes (1 active, 0 holddown, 0 hidden) inet6.0: 6 destinations, 6 routes (6 active, 0 holddown, 0 hidden) 意义 设备 CE2 和 CE3 都有到 10.0.0.28/32 的路由。CE2 已收到 BGP 静态路由，CE3 已收到动态学习的路由，但您无法区分。 设备 CE2 和 CE3 都有到 10.0.0.28/32 的路由。CE2 已收到 BGP 静态路由，CE3 已收到动态学习的路由，但您无法区分。"
        },
        {
          "title": "验证配置的 BGP 静态路由不会发生抖动",
          "level": 4,
          "content": "目的 验证即使路由器 PE1 和设备 CE1 之间的 BGP 对等会话关闭，BGP 静态路由也不会翻动。 验证即使路由器 PE1 和设备 CE1 之间的 BGP 对等会话关闭，BGP 静态路由也不会翻动。 停用路由器 PE1 和设备 CE1 之间的 BGP 对等会话。PE1 没有到 10.0.0.28/32 的动态学习路由，但仍具有配置的 BGP 静态路由。 [edit] user@PE1# deactivate protocols bgp group ebgp user@PE1# commit user@PE1> show route 10.0.0.28/32 inet.0: 13 destinations, 13 routes (13 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 10.0.0.28/32 *[BGP-Static/4294967292/-101] 02:46:21 Discard user@CE2> show route protocol bgp inet.0: 6 destinations, 6 routes (6 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 10.0.0.28/32 *[BGP/170] 01:52:48, localpref 100 AS path: 64496 64497 I, validation-state: unverified > to 10.0.0.18 via ge-2/0/5.17 1.0.0.29/32 *[BGP/170] 01:52:44, localpref 100 AS path: 64496 64499 I, validation-state: unverified > to 10.0.0.18 via ge-2/0/5.17 iso.0: 1 destinations, 1 routes (1 active, 0 holddown, 0 hidden) inet6.0: 6 destinations, 6 routes (6 active, 0 holddown, 0 hidden) user@CE3> show route protocol bgp inet.0: 5 destinations, 5 routes (5 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 10.0.0.29/32 *[BGP/170] 01:52:47, localpref 100 AS path: 64496 64498 I, validation-state: unverified > to 10.0.0.18 via ge-2/0/5.17 iso.0: 1 destinations, 1 routes (1 active, 0 holddown, 0 hidden) inet6.0: 6 destinations, 6 routes (6 active, 0 holddown, 0 hidden) 意义 路由器 PE1 和设备 CE2 仍具有配置的 BGP 静态路由。但是，设备 CE3 没有到 10.0.0.28/32 的路由，因为此前缀已抖动。除非手动删除，否则 BGP 静态路由不会翻动。 路由器 PE1 和设备 CE2 仍具有配置的 BGP 静态路由。但是，设备 CE3 没有到 10.0.0.28/32 的路由，因为此前缀已抖动。除非手动删除，否则 BGP 静态路由不会翻动。"
        }
      ]
    }
  ],
  "content": "此示例说明如何配置 BGP 静态路由。BGP 主机仅将这些 BGP 静态路由播发给配置为接收这些路由的邻接方。配置 BGP 静态路由以确保前缀不会抖动。但是，如果 BGP 静态路由是全局配置的，则必须显式配置每个邻居、组或所有邻居才能接收它们。 要求 此示例使用以下硬件和软件组件： 七个在连接的接口上启用了 BGP 的 MX 系列路由器 在所有设备上运行的 Junos OS 14.2 或更高版本 概述 从 Junos OS 14.2 版开始，您可以在 BGP 网络中配置和通告 BGP 静态路由。您可以在 BGP 网络中通告 BGP 静态路由，即使它不是前缀的活动路由。除非手动删除 BGP 静态路由，否则不会发生抖动。您可以定义一个策略，用于确定需要播发哪些 BGP 静态路由并将其包含在播发中。无论播发路由器获知的动态路由信息如何，对等路由器都会接收这些 BGP 静态路由的通告。 在示例 BGP 网络中，设备 CE1、CE2 和 CE3 直接连接到路由器 PE1、PE2 和 PE3。PE1 和 PE2 都连接到路由器 P。路由器 P 直接连接到路由器 PE3。EBGP 在提供商边缘和客户边缘路由器上配置。IBGP 在直接连接的提供商边缘路由器上进行配置。IGP 协议 IS-IS 在所有提供商路由器上配置。在路由器 PE1 上配置 BGP 静态路由，以确保 CE1 后面的客户路由 10.0.0.28 不会发生抖动。提供商路由器 PE2 配置为接收 BGP 静态路由。目标是仅向 CE2 播发 BGP 静态路由，而不播发到 CE3，并证明配置的 BGP 静态路由不会抖动。 拓扑学 图 5 显示了示例拓扑"
}