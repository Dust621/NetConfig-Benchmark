{
  "title": "配置路由策略以控制 BGP 路由通告",
  "sections": [
    {
      "title": "配置 BGP 以向内部对等方播发最佳外部路由",
      "level": 3,
      "content": "通常，已部署的 BGP 实现不会将具有最高本地优先级值的外部路由通告给内部对等方，除非它是最佳路由。尽管早期版本的 BGP 版本 4 规范 RFC 1771 要求此行为，但通常不会遵循此行为，以便最大程度地减少播发信息量并防止路由环路。但是，在某些情况下，宣传最佳外部路由是有益的，特别是可能导致 IBGP 路由振荡的情况。 在 Junos OS 9.3 及更高版本中，您可以将 BGP 配置为将最佳外部路由播发到内部 BGP （IBGP） 网格组、路由反射器群集或自治系统 （AS） 联合中，即使最佳路由是内部路由也是如此。 注： 要在路由反射器上配置 advertise-external 语句，必须使用该 no-client-reflect 语句禁用群集内反射。 要在路由反射器上配置 advertise-external 语句，必须使用该 no-client-reflect 语句禁用群集内反射。 将路由设备配置为集群的路由反射器时，如果路由反射器通告的路由是从具有相同集群标识符的内部对等方接收的，或者两个对等方均未配置集群标识符，则该路由反射器通告的路由被视为内部路由。从属于另一个集群（即具有不同集群标识符）的内部对等方接收的路由被视为外部路由。 在联合体中，当向联合体边界路由器播发路由时，来自不同联合体子 AS 的任何路由都会被视为外部。 您还可以将 BGP 配置为仅在路由选择过程到达评估多出口鉴别器 （MED） 指标的点时通告外部路由。因此，如果外部路由的 AS 路径比活动路径更差（即更长），则不会对其进行播发。 Junos OS 还支持配置与播发路由状态匹配的 BGP 导出策略。您可以在活动或非活动路由上进行匹配。有关更多信息，请参阅 《路由策略》、《防火墙过滤器和流量监管器用户指南》。 要将 BGP 配置为向内部对等方播发最佳外部路径，请包含以下 advertise-external 语句： advertise-external; 注： 该 advertise-external 语句在组和邻居级别均受支持。如果在邻居级别配置语句，则必须为组中的所有邻居配置该语句。否则，该组将自动拆分为不同的组。 有关可在其中配置此语句的层次结构级别的完整列表，请参阅此语句的语句摘要部分。 该 advertise-external 语句在组和邻居级别均受支持。如果在邻居级别配置语句，则必须为组中的所有邻居配置该语句。否则，该组将自动拆分为不同的组。 有关可在其中配置此语句的层次结构级别的完整列表，请参阅此语句的语句摘要部分。 要将 BGP 配置为仅在路由选择过程到达评估 MED 值的点时通告最佳外部路径，请包含以下 conditional 语句： advertise-external { conditional; }"
    },
    {
      "title": "配置 BGP 与路由表交换路由的频率",
      "level": 3,
      "content": "BGP 将从更新消息收到的路由信息存储在路由表中，路由表将活动路由从路由表导出到 BGP 中。然后，BGP 将导出的路由通告给对等方。默认情况下，BGP 和路由表之间的路由信息交换在收到路由后立即进行。这种路由信息的即时交换可能会导致网络可访问性信息不稳定。为了防止这种情况，您可以延迟 BGP 和路由表交换路由信息之间的时间。 要配置 BGP 和路由表交换路由信息的频率，请包含以下 out-delay 语句： out-delay seconds ; 默认情况下，路由表会保留从 BGP 获知的一些路由信息。要使路由表保留全部或不保留此信息，请包含以下 keep 语句： keep (all | none); 有关可包含这些语句的层次结构级别的列表，请参阅这些语句的语句摘要部分。 路由表可以通过以下方式之一保留从 BGP 获知的路由信息： 默认值（省略语句） keep — 保留从 BGP 获知的所有路由信息，AS 路径是循环的且环路包含本地 AS 的路由除外。 keep all — 保留从 BGP 获知的所有路由信息。 keep none — 丢弃从对等方接收但被导入策略或其他健全性检查（如 AS 路径或下一跃点）拒绝的路由。配置 keep none BGP 会话且入站策略更改时，Junos OS 会强制重新播发对等方播发的全套路由。 在 AS 路径修复情况下，理论上，当 AS 路径环路限制发生更改时，具有环路的路由在软重新配置期间可用。但是，默认值和 keep all 之间存在显著的内存使用差异。 请考虑以下方案： 对等方将路由重新播发回它从中获知路由的对等方。 在以下情况下可能会发生这种情况： 另一供应商的路由设备将路由播发回发送对等方。 Junos OS 对等方不将路由重新播发回发送对等方的默认行为将通过配置 advertise-peer-as 覆盖。 提供商边缘 （PE） 路由设备会丢弃没有任何预期路由目标的任何 VPN 路由。 配置后 keep all ，将覆盖在上述方案中丢弃收到的路由的行为。"
    }
  ],
  "content": "另请参阅 示例：配置基于 BGP 前缀的出站路由过滤"
}