{
  "title": "示例：配置路由策略以将具有特定公共组标记的 BGP 路由重新分发到 IS-IS 中",
  "sections": [
    {
      "title": "要求",
      "level": 3,
      "content": "配置此示例之前，不需要除设备初始化之外的特殊配置。"
    },
    {
      "title": "概述",
      "level": 3,
      "content": "图 1 显示了此示例中使用的拓扑。 图 1： 将具有特定公共组标记的 BGP 路由重新分发到 IS-IS 中 在此示例中，设备 A、设备 B、设备 C 和设备 D 位于自治系统 （AS） 1 中，并且正在运行 IS-IS。除设备 D 外，所有 AS 1 设备都在运行内部 BGP （IBGP）。 设备 E 位于 AS 2 中，与设备 C 具有外部 BGP （EBGP） 对等会话。设备 E 有两个静态路由：10.2.0.0/16 和 10.3.0.0/16。这些路由使用 Edu 2：5 社区属性进行标记，并通过 EBGP 向设备 C 播发。 设备 C 接受使用 Edu 2：5 社区属性标记的 BGP 路由，将这些路由重新分发到 IS-IS，并将 IS-IS 衡量指标 63 应用于这些路由。 CLI 快速配置 显示了 中 图 1所有设备的配置。#d206e65__d206e386本节介绍设备 C 和设备 E 上的步骤。 图 1 显示了此示例中使用的拓扑。 图 1： 将具有特定公共组标记的 BGP 路由重新分发到 IS-IS 中 在此示例中，设备 A、设备 B、设备 C 和设备 D 位于自治系统 （AS） 1 中，并且正在运行 IS-IS。除设备 D 外，所有 AS 1 设备都在运行内部 BGP （IBGP）。 设备 E 位于 AS 2 中，与设备 C 具有外部 BGP （EBGP） 对等会话。设备 E 有两个静态路由：10.2.0.0/16 和 10.3.0.0/16。这些路由使用 Edu 2：5 社区属性进行标记，并通过 EBGP 向设备 C 播发。 设备 C 接受使用 Edu 2：5 社区属性标记的 BGP 路由，将这些路由重新分发到 IS-IS，并将 IS-IS 衡量指标 63 应用于这些路由。 CLI 快速配置 显示了 中 图 1所有设备的配置。#d206e65__d206e386本节介绍设备 C 和设备 E 上的步骤。"
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 A set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.5/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.1/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0001.00 set protocols bgp group int type internal set protocols bgp group int local-address 192.168.0.1 set protocols bgp group int neighbor 192.168.0.2 set protocols bgp group int neighbor 192.168.0.3 set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface lo0.0 set routing-options router-id 192.168.0.1 set routing-options autonomous-system 1 设备 B set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.6/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces fe-1/2/1 unit 0 family inet address 10.0.0.9/30 set interfaces fe-1/2/1 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.2/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0002.00 set protocols bgp group int type internal set protocols bgp group int local-address 192.168.0.2 set protocols bgp group int neighbor 192.168.0.1 set protocols bgp group int neighbor 192.168.0.3 set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface fe-1/2/1.0 level 1 disable set protocols isis interface lo0.0 set routing-options router-id 192.168.0.2 set routing-options autonomous-system 1 设备 C set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.10/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces fe-1/2/1 unit 0 family inet address 10.0.0.13/30 set interfaces fe-1/2/1 unit 0 family iso set interfaces fe-1/2/2 unit 0 family inet address 10.0.0.25/30 set interfaces fe-1/2/2 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.3/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0003.00 set protocols bgp group int type internal set protocols bgp group int local-address 192.168.0.3 set protocols bgp group int neighbor 192.168.0.1 set protocols bgp group int neighbor 192.168.0.2 set protocols bgp group external-peers type external set protocols bgp group external-peers export send-isis-and-direct set protocols bgp group external-peers peer-as 2 set protocols bgp group external-peers neighbor 10.0.0.26 set protocols isis export Edu-to-isis set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface fe-1/2/1.0 level 1 disable set protocols isis interface fe-1/2/2.0 level 1 disable set protocols isis interface fe-1/2/2.0 level 2 passive set protocols isis interface lo0.0 set policy-options policy-statement Edu-to-isis term 1 from protocol bgp set policy-options policy-statement Edu-to-isis term 1 from community Edu set policy-options policy-statement Edu-to-isis term 1 then metric 63 set policy-options policy-statement Edu-to-isis term 1 then accept set policy-options policy-statement send-isis-and-direct term 1 from protocol isis set policy-options policy-statement send-isis-and-direct term 1 from protocol direct set policy-options policy-statement send-isis-and-direct term 1 from route-filter 10.0.0.0/16 orlonger set policy-options policy-statement send-isis-and-direct term 1 from route-filter 192.168.0.0/16 orlonger set policy-options policy-statement send-isis-and-direct term 1 then accept set policy-options community Edu members 2:5 set routing-options router-id 192.168.0.3 set routing-options autonomous-system 1 设备 D set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.14/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.4/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0004.00 set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface lo0.0 set routing-options router-id 192.168.0.4 set routing-options autonomous-system 1 设备 E set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.26/30 set interfaces lo0 unit 7 family inet address 192.168.0.5/32 primary set interfaces lo0 unit 7 family inet address 10.2.0.1/32 set interfaces lo0 unit 7 family inet address 10.3.0.1/32 set protocols bgp group external-peers type external set protocols bgp group external-peers export statics set protocols bgp group external-peers peer-as 1 set protocols bgp group external-peers neighbor 10.0.0.25 set policy-options policy-statement statics from protocol static set policy-options policy-statement statics then community add Edu set policy-options policy-statement statics then accept set policy-options community Edu members 2:5 set routing-options static route 10.2.0.0/16 reject set routing-options static route 10.2.0.0/16 install set routing-options static route 10.3.0.0/16 reject set routing-options static route 10.3.0.0/16 install set routing-options router-id 192.168.0.5 set routing-options autonomous-system 2 下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南中的在配置模式下使用 CLI 编辑器。 要配置设备 E： 配置接口。 [edit interfaces] user@E# set fe-1/2/0 unit 0 family inet address 10.0.0.26/30 user@E# set lo0 unit 7 family inet address 192.168.0.5/32 primary user@E# set lo0 unit 7 family inet address 10.2.0.1/32 user@E# set lo0 unit 7 family inet address 10.3.0.1/32 statics 配置策略，这会将 Edu 社区属性添加到静态路由。 [edit policy-options] user@E# set policy-statement statics from protocol static user@E# set policy-statement statics then community add Edu user@E# set policy-statement statics then accept user@E# set community Edu members 2:5 配置 EBGP 并应用 statics 策略。 [edit protocols bgp group external-peers] user@E# set type external user@E# set export statics user@E# set peer-as 1 user@E# set protocols bgp group external-peers neighbor 10.0.0.25 配置静态路由。 [edit routing-options static] user@E# set route 10.2.0.0/16 reject user@E# set route 10.2.0.0/16 install user@E# set route 10.3.0.0/16 reject user@E# set route 10.3.0.0/16 install 配置路由器 ID 和 AS 编号。 [edit routing-options] user@E# set router-id 192.168.0.5 user@E# set autonomous-system 2 要配置设备 C： [edit interfaces] user@C# set fe-1/2/0 unit 0 family inet address 10.0.0.10/30 user@C# set fe-1/2/0 unit 0 family iso user@C# set fe-1/2/1 unit 0 family inet address 10.0.0.13/30 user@C# set fe-1/2/1 unit 0 family iso user@C# set fe-1/2/2 unit 0 family inet address 10.0.0.25/30 user@C# set fe-1/2/2 unit 0 family iso user@C# set lo0 unit 0 family inet address 192.168.0.3/32 user@C# set lo0 unit 0 family iso address 49.0002.0192.0168.0003.00 配置 IBGP。 [edit protocols bgp group int] user@C# set type internal user@C# set local-address 192.168.0.3 user@C# set neighbor 192.168.0.1 user@C# set neighbor 192.168.0.2 配置 Edu 到 ISIS 策略，该策略将重新分配从设备 E 获知的 Edu 标记的 BGP 路由，并应用指标 63。 [edit policy-options] user@C# set policy-statement Edu-to-isis term 1 from protocol bgp user@C# set policy-statement Edu-to-isis term 1 from community Edu user@C# set policy-statement Edu-to-isis term 1 then metric 63 user@C# set policy-statement Edu-to-isis term 1 then accept user@C# set community Edu members 2:5 在接口上启用 IS-IS，并应用 Edu-to-ISIS 策略。 [edit protocols isis] user@C# set export Edu-to-isis user@C# set interface fe-1/2/0.0 level 1 disable user@C# set interface fe-1/2/1.0 level 1 disable user@C# set interface fe-1/2/2.0 level 1 disable user@C# set interface fe-1/2/2.0 level 2 passive user@C# set interface lo0.0 配置发送 ISIS 和直接策略，该策略通过 EBGP 将路由重新分发到设备 E。 如果没有此策略，设备 E 将无法连接到 AS 1 中的网络。 [edit policy-options policy-statement send-isis-and-direct term 1] user@C# set from protocol isis user@C# set from protocol direct user@C# set from route-filter 10.0.0.0/16 orlonger user@C# set from route-filter 192.168.0.0/16 orlonger user@C# set then accept 配置 EBGP 并应用发送 ISIS 和直接策略。 [edit protocols bgp group external-peers] user@C# set type external user@C# set export send-isis-and-direct user@C# set peer-as 2 user@C# set neighbor 10.0.0.26 配置路由器 ID 和自治系统 （AS） 编号。 [edit routing-options] user@C# set router-id 192.168.0.3 user@C# set autonomous-system 1 在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@E# show interfaces fe-1/2/0 { unit 0 { family inet { address 10.0.0.26/30; } } } lo0 { unit 0 { family inet { address 192.168.0.5/32 { primary; } address 10.2.0.1/32; address 10.3.0.1/32; } } } user@E# show protocols bgp { group external-peers { type external; export statics; peer-as 1; neighbor 10.0.0.25; } } user@E# show policy-options policy-statement statics { from protocol static; then { community add Edu; accept; } } community Edu members 2:5; user@E# show routing-options static { route 10.2.0.0/16 { reject; install; } route 10.3.0.0/16 { reject; install; } } router-id 192.168.0.5; autonomous-system 2; user@C# show interfaces fe-1/2/0 { unit 0 { family inet { address 10.0.0.10/30; } family iso; } } fe-1/2/1 { unit 0 { family inet { address 10.0.0.13/30; } family iso; } } fe-1/2/2 { unit 0 { family inet { address 10.0.0.25/30; } family iso; } } lo0 { unit 0 { family inet { address 192.168.0.3/32; } family iso { address 49.0002.0192.0168.0003.00; } } } user@C# show protocols bgp { group int { type internal; local-address 192.168.0.3; neighbor 192.168.0.1; neighbor 192.168.0.2; } group external-peers { type external; export send-isis-and-direct; peer-as 2; neighbor 10.0.0.26; } } isis { export Edu-to-isis; interface fe-1/2/0.0 { level 1 disable; } interface fe-1/2/1.0 { level 1 disable; } interface fe-1/2/2.0 { level 1 disable; level 2 passive; } interface lo0.0; } user@C# show policy-options policy-statement Edu-to-isis { term 1 { from { protocol bgp; community Edu; } then { metric 63; accept; } } } policy-statement send-isis-and-direct { term 1 { from { protocol [ isis direct ]; route-filter 10.0.0.0/16 orlonger; route-filter 192.168.0.0/16 orlonger; } then accept; } } community Edu members 2:5; user@C# show routing-options router-id 192.168.0.3; autonomous-system 1; 如果完成设备配置，请从配置模式输入 commit 。",
      "sections": [
        {
          "title": "程序",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 A set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.5/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.1/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0001.00 set protocols bgp group int type internal set protocols bgp group int local-address 192.168.0.1 set protocols bgp group int neighbor 192.168.0.2 set protocols bgp group int neighbor 192.168.0.3 set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface lo0.0 set routing-options router-id 192.168.0.1 set routing-options autonomous-system 1 设备 B set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.6/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces fe-1/2/1 unit 0 family inet address 10.0.0.9/30 set interfaces fe-1/2/1 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.2/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0002.00 set protocols bgp group int type internal set protocols bgp group int local-address 192.168.0.2 set protocols bgp group int neighbor 192.168.0.1 set protocols bgp group int neighbor 192.168.0.3 set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface fe-1/2/1.0 level 1 disable set protocols isis interface lo0.0 set routing-options router-id 192.168.0.2 set routing-options autonomous-system 1 设备 C set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.10/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces fe-1/2/1 unit 0 family inet address 10.0.0.13/30 set interfaces fe-1/2/1 unit 0 family iso set interfaces fe-1/2/2 unit 0 family inet address 10.0.0.25/30 set interfaces fe-1/2/2 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.3/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0003.00 set protocols bgp group int type internal set protocols bgp group int local-address 192.168.0.3 set protocols bgp group int neighbor 192.168.0.1 set protocols bgp group int neighbor 192.168.0.2 set protocols bgp group external-peers type external set protocols bgp group external-peers export send-isis-and-direct set protocols bgp group external-peers peer-as 2 set protocols bgp group external-peers neighbor 10.0.0.26 set protocols isis export Edu-to-isis set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface fe-1/2/1.0 level 1 disable set protocols isis interface fe-1/2/2.0 level 1 disable set protocols isis interface fe-1/2/2.0 level 2 passive set protocols isis interface lo0.0 set policy-options policy-statement Edu-to-isis term 1 from protocol bgp set policy-options policy-statement Edu-to-isis term 1 from community Edu set policy-options policy-statement Edu-to-isis term 1 then metric 63 set policy-options policy-statement Edu-to-isis term 1 then accept set policy-options policy-statement send-isis-and-direct term 1 from protocol isis set policy-options policy-statement send-isis-and-direct term 1 from protocol direct set policy-options policy-statement send-isis-and-direct term 1 from route-filter 10.0.0.0/16 orlonger set policy-options policy-statement send-isis-and-direct term 1 from route-filter 192.168.0.0/16 orlonger set policy-options policy-statement send-isis-and-direct term 1 then accept set policy-options community Edu members 2:5 set routing-options router-id 192.168.0.3 set routing-options autonomous-system 1 设备 D set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.14/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.4/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0004.00 set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface lo0.0 set routing-options router-id 192.168.0.4 set routing-options autonomous-system 1 设备 E set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.26/30 set interfaces lo0 unit 7 family inet address 192.168.0.5/32 primary set interfaces lo0 unit 7 family inet address 10.2.0.1/32 set interfaces lo0 unit 7 family inet address 10.3.0.1/32 set protocols bgp group external-peers type external set protocols bgp group external-peers export statics set protocols bgp group external-peers peer-as 1 set protocols bgp group external-peers neighbor 10.0.0.25 set policy-options policy-statement statics from protocol static set policy-options policy-statement statics then community add Edu set policy-options policy-statement statics then accept set policy-options community Edu members 2:5 set routing-options static route 10.2.0.0/16 reject set routing-options static route 10.2.0.0/16 install set routing-options static route 10.3.0.0/16 reject set routing-options static route 10.3.0.0/16 install set routing-options router-id 192.168.0.5 set routing-options autonomous-system 2 下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南中的在配置模式下使用 CLI 编辑器。 要配置设备 E： 配置接口。 [edit interfaces] user@E# set fe-1/2/0 unit 0 family inet address 10.0.0.26/30 user@E# set lo0 unit 7 family inet address 192.168.0.5/32 primary user@E# set lo0 unit 7 family inet address 10.2.0.1/32 user@E# set lo0 unit 7 family inet address 10.3.0.1/32 statics 配置策略，这会将 Edu 社区属性添加到静态路由。 [edit policy-options] user@E# set policy-statement statics from protocol static user@E# set policy-statement statics then community add Edu user@E# set policy-statement statics then accept user@E# set community Edu members 2:5 配置 EBGP 并应用 statics 策略。 [edit protocols bgp group external-peers] user@E# set type external user@E# set export statics user@E# set peer-as 1 user@E# set protocols bgp group external-peers neighbor 10.0.0.25 配置静态路由。 [edit routing-options static] user@E# set route 10.2.0.0/16 reject user@E# set route 10.2.0.0/16 install user@E# set route 10.3.0.0/16 reject user@E# set route 10.3.0.0/16 install 配置路由器 ID 和 AS 编号。 [edit routing-options] user@E# set router-id 192.168.0.5 user@E# set autonomous-system 2 要配置设备 C： [edit interfaces] user@C# set fe-1/2/0 unit 0 family inet address 10.0.0.10/30 user@C# set fe-1/2/0 unit 0 family iso user@C# set fe-1/2/1 unit 0 family inet address 10.0.0.13/30 user@C# set fe-1/2/1 unit 0 family iso user@C# set fe-1/2/2 unit 0 family inet address 10.0.0.25/30 user@C# set fe-1/2/2 unit 0 family iso user@C# set lo0 unit 0 family inet address 192.168.0.3/32 user@C# set lo0 unit 0 family iso address 49.0002.0192.0168.0003.00 配置 IBGP。 [edit protocols bgp group int] user@C# set type internal user@C# set local-address 192.168.0.3 user@C# set neighbor 192.168.0.1 user@C# set neighbor 192.168.0.2 配置 Edu 到 ISIS 策略，该策略将重新分配从设备 E 获知的 Edu 标记的 BGP 路由，并应用指标 63。 [edit policy-options] user@C# set policy-statement Edu-to-isis term 1 from protocol bgp user@C# set policy-statement Edu-to-isis term 1 from community Edu user@C# set policy-statement Edu-to-isis term 1 then metric 63 user@C# set policy-statement Edu-to-isis term 1 then accept user@C# set community Edu members 2:5 在接口上启用 IS-IS，并应用 Edu-to-ISIS 策略。 [edit protocols isis] user@C# set export Edu-to-isis user@C# set interface fe-1/2/0.0 level 1 disable user@C# set interface fe-1/2/1.0 level 1 disable user@C# set interface fe-1/2/2.0 level 1 disable user@C# set interface fe-1/2/2.0 level 2 passive user@C# set interface lo0.0 配置发送 ISIS 和直接策略，该策略通过 EBGP 将路由重新分发到设备 E。 如果没有此策略，设备 E 将无法连接到 AS 1 中的网络。 [edit policy-options policy-statement send-isis-and-direct term 1] user@C# set from protocol isis user@C# set from protocol direct user@C# set from route-filter 10.0.0.0/16 orlonger user@C# set from route-filter 192.168.0.0/16 orlonger user@C# set then accept 配置 EBGP 并应用发送 ISIS 和直接策略。 [edit protocols bgp group external-peers] user@C# set type external user@C# set export send-isis-and-direct user@C# set peer-as 2 user@C# set neighbor 10.0.0.26 配置路由器 ID 和自治系统 （AS） 编号。 [edit routing-options] user@C# set router-id 192.168.0.3 user@C# set autonomous-system 1 在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@E# show interfaces fe-1/2/0 { unit 0 { family inet { address 10.0.0.26/30; } } } lo0 { unit 0 { family inet { address 192.168.0.5/32 { primary; } address 10.2.0.1/32; address 10.3.0.1/32; } } } user@E# show protocols bgp { group external-peers { type external; export statics; peer-as 1; neighbor 10.0.0.25; } } user@E# show policy-options policy-statement statics { from protocol static; then { community add Edu; accept; } } community Edu members 2:5; user@E# show routing-options static { route 10.2.0.0/16 { reject; install; } route 10.3.0.0/16 { reject; install; } } router-id 192.168.0.5; autonomous-system 2; user@C# show interfaces fe-1/2/0 { unit 0 { family inet { address 10.0.0.10/30; } family iso; } } fe-1/2/1 { unit 0 { family inet { address 10.0.0.13/30; } family iso; } } fe-1/2/2 { unit 0 { family inet { address 10.0.0.25/30; } family iso; } } lo0 { unit 0 { family inet { address 192.168.0.3/32; } family iso { address 49.0002.0192.0168.0003.00; } } } user@C# show protocols bgp { group int { type internal; local-address 192.168.0.3; neighbor 192.168.0.1; neighbor 192.168.0.2; } group external-peers { type external; export send-isis-and-direct; peer-as 2; neighbor 10.0.0.26; } } isis { export Edu-to-isis; interface fe-1/2/0.0 { level 1 disable; } interface fe-1/2/1.0 { level 1 disable; } interface fe-1/2/2.0 { level 1 disable; level 2 passive; } interface lo0.0; } user@C# show policy-options policy-statement Edu-to-isis { term 1 { from { protocol bgp; community Edu; } then { metric 63; accept; } } } policy-statement send-isis-and-direct { term 1 { from { protocol [ isis direct ]; route-filter 10.0.0.0/16 orlonger; route-filter 192.168.0.0/16 orlonger; } then accept; } } community Edu members 2:5; user@C# show routing-options router-id 192.168.0.3; autonomous-system 1; 如果完成设备配置，请从配置模式输入 commit 。",
          "sections": [
            {
              "title": "CLI 快速配置",
              "level": 5,
              "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 A set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.5/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.1/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0001.00 set protocols bgp group int type internal set protocols bgp group int local-address 192.168.0.1 set protocols bgp group int neighbor 192.168.0.2 set protocols bgp group int neighbor 192.168.0.3 set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface lo0.0 set routing-options router-id 192.168.0.1 set routing-options autonomous-system 1 设备 B set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.6/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces fe-1/2/1 unit 0 family inet address 10.0.0.9/30 set interfaces fe-1/2/1 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.2/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0002.00 set protocols bgp group int type internal set protocols bgp group int local-address 192.168.0.2 set protocols bgp group int neighbor 192.168.0.1 set protocols bgp group int neighbor 192.168.0.3 set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface fe-1/2/1.0 level 1 disable set protocols isis interface lo0.0 set routing-options router-id 192.168.0.2 set routing-options autonomous-system 1 设备 C set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.10/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces fe-1/2/1 unit 0 family inet address 10.0.0.13/30 set interfaces fe-1/2/1 unit 0 family iso set interfaces fe-1/2/2 unit 0 family inet address 10.0.0.25/30 set interfaces fe-1/2/2 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.3/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0003.00 set protocols bgp group int type internal set protocols bgp group int local-address 192.168.0.3 set protocols bgp group int neighbor 192.168.0.1 set protocols bgp group int neighbor 192.168.0.2 set protocols bgp group external-peers type external set protocols bgp group external-peers export send-isis-and-direct set protocols bgp group external-peers peer-as 2 set protocols bgp group external-peers neighbor 10.0.0.26 set protocols isis export Edu-to-isis set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface fe-1/2/1.0 level 1 disable set protocols isis interface fe-1/2/2.0 level 1 disable set protocols isis interface fe-1/2/2.0 level 2 passive set protocols isis interface lo0.0 set policy-options policy-statement Edu-to-isis term 1 from protocol bgp set policy-options policy-statement Edu-to-isis term 1 from community Edu set policy-options policy-statement Edu-to-isis term 1 then metric 63 set policy-options policy-statement Edu-to-isis term 1 then accept set policy-options policy-statement send-isis-and-direct term 1 from protocol isis set policy-options policy-statement send-isis-and-direct term 1 from protocol direct set policy-options policy-statement send-isis-and-direct term 1 from route-filter 10.0.0.0/16 orlonger set policy-options policy-statement send-isis-and-direct term 1 from route-filter 192.168.0.0/16 orlonger set policy-options policy-statement send-isis-and-direct term 1 then accept set policy-options community Edu members 2:5 set routing-options router-id 192.168.0.3 set routing-options autonomous-system 1 设备 D set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.14/30 set interfaces fe-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 192.168.0.4/32 set interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0004.00 set protocols isis interface fe-1/2/0.0 level 1 disable set protocols isis interface lo0.0 set routing-options router-id 192.168.0.4 set routing-options autonomous-system 1 设备 E set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.26/30 set interfaces lo0 unit 7 family inet address 192.168.0.5/32 primary set interfaces lo0 unit 7 family inet address 10.2.0.1/32 set interfaces lo0 unit 7 family inet address 10.3.0.1/32 set protocols bgp group external-peers type external set protocols bgp group external-peers export statics set protocols bgp group external-peers peer-as 1 set protocols bgp group external-peers neighbor 10.0.0.25 set policy-options policy-statement statics from protocol static set policy-options policy-statement statics then community add Edu set policy-options policy-statement statics then accept set policy-options community Edu members 2:5 set routing-options static route 10.2.0.0/16 reject set routing-options static route 10.2.0.0/16 install set routing-options static route 10.3.0.0/16 reject set routing-options static route 10.3.0.0/16 install set routing-options router-id 192.168.0.5 set routing-options autonomous-system 2",
              "commands_by_device": {
                "设备 A": "set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.5/30\nset interfaces fe-1/2/0 unit 0 family iso\nset interfaces lo0 unit 0 family inet address 192.168.0.1/32\nset interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0001.00\nset protocols bgp group int type internal\nset protocols bgp group int local-address 192.168.0.1\nset protocols bgp group int neighbor 192.168.0.2\nset protocols bgp group int neighbor 192.168.0.3\nset protocols isis interface fe-1/2/0.0 level 1 disable\nset protocols isis interface lo0.0\nset routing-options router-id 192.168.0.1\nset routing-options autonomous-system 1",
                "设备 B": "set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.6/30\nset interfaces fe-1/2/0 unit 0 family iso\nset interfaces fe-1/2/1 unit 0 family inet address 10.0.0.9/30\nset interfaces fe-1/2/1 unit 0 family iso\nset interfaces lo0 unit 0 family inet address 192.168.0.2/32\nset interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0002.00\nset protocols bgp group int type internal\nset protocols bgp group int local-address 192.168.0.2\nset protocols bgp group int neighbor 192.168.0.1\nset protocols bgp group int neighbor 192.168.0.3\nset protocols isis interface fe-1/2/0.0 level 1 disable\nset protocols isis interface fe-1/2/1.0 level 1 disable\nset protocols isis interface lo0.0\nset routing-options router-id 192.168.0.2\nset routing-options autonomous-system 1",
                "设备 C": "set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.10/30\nset interfaces fe-1/2/0 unit 0 family iso\nset interfaces fe-1/2/1 unit 0 family inet address 10.0.0.13/30\nset interfaces fe-1/2/1 unit 0 family iso\nset interfaces fe-1/2/2 unit 0 family inet address 10.0.0.25/30\nset interfaces fe-1/2/2 unit 0 family iso\nset interfaces lo0 unit 0 family inet address 192.168.0.3/32\nset interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0003.00\nset protocols bgp group int type internal\nset protocols bgp group int local-address 192.168.0.3\nset protocols bgp group int neighbor 192.168.0.1\nset protocols bgp group int neighbor 192.168.0.2\nset protocols bgp group external-peers type external\nset protocols bgp group external-peers export send-isis-and-direct\nset protocols bgp group external-peers peer-as 2\nset protocols bgp group external-peers neighbor 10.0.0.26\nset protocols isis export Edu-to-isis\nset protocols isis interface fe-1/2/0.0 level 1 disable\nset protocols isis interface fe-1/2/1.0 level 1 disable\nset protocols isis interface fe-1/2/2.0 level 1 disable\nset protocols isis interface fe-1/2/2.0 level 2 passive\nset protocols isis interface lo0.0\nset policy-options policy-statement Edu-to-isis term 1 from protocol bgp\nset policy-options policy-statement Edu-to-isis term 1 from community Edu\nset policy-options policy-statement Edu-to-isis term 1 then metric 63\nset policy-options policy-statement Edu-to-isis term 1 then accept\nset policy-options policy-statement send-isis-and-direct term 1 from protocol isis\nset policy-options policy-statement send-isis-and-direct term 1 from protocol direct\nset policy-options policy-statement send-isis-and-direct term 1 from route-filter 10.0.0.0/16 orlonger\nset policy-options policy-statement send-isis-and-direct term 1 from route-filter 192.168.0.0/16 orlonger\nset policy-options policy-statement send-isis-and-direct term 1 then accept\nset policy-options community Edu members 2:5\nset routing-options router-id 192.168.0.3\nset routing-options autonomous-system 1",
                "设备 D": "set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.14/30\nset interfaces fe-1/2/0 unit 0 family iso\nset interfaces lo0 unit 0 family inet address 192.168.0.4/32\nset interfaces lo0 unit 0 family iso address 49.0002.0192.0168.0004.00\nset protocols isis interface fe-1/2/0.0 level 1 disable\nset protocols isis interface lo0.0\nset routing-options router-id 192.168.0.4\nset routing-options autonomous-system 1",
                "设备 E": "set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.26/30\nset interfaces lo0 unit 7 family inet address 192.168.0.5/32 primary\nset interfaces lo0 unit 7 family inet address 10.2.0.1/32\nset interfaces lo0 unit 7 family inet address 10.3.0.1/32\nset protocols bgp group external-peers type external\nset protocols bgp group external-peers export statics\nset protocols bgp group external-peers peer-as 1\nset protocols bgp group external-peers neighbor 10.0.0.25\nset policy-options policy-statement statics from protocol static\nset policy-options policy-statement statics then community add Edu\nset policy-options policy-statement statics then accept\nset policy-options community Edu members 2:5\nset routing-options static route 10.2.0.0/16 reject\nset routing-options static route 10.2.0.0/16 install\nset routing-options static route 10.3.0.0/16 reject\nset routing-options static route 10.3.0.0/16 install\nset routing-options router-id 192.168.0.5\nset routing-options autonomous-system 2"
              }
            },
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@E# set fe-1/2/0 unit 0 family inet address 10.0.0.26/30",
                    "user@E# set lo0 unit 7 family inet address 192.168.0.5/32 primary",
                    "user@E# set lo0 unit 7 family inet address 10.2.0.1/32",
                    "user@E# set lo0 unit 7 family inet address 10.3.0.1/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "statics 配置策略，这会将 Edu 社区属性添加到静态路由。",
                  "code": [
                    "[edit policy-options]",
                    "user@E# set policy-statement statics from protocol static",
                    "user@E# set policy-statement statics then community add Edu",
                    "user@E# set policy-statement statics then accept",
                    "user@E# set community Edu members 2:5"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 EBGP 并应用 statics 策略。",
                  "code": [
                    "[edit protocols bgp group external-peers]",
                    "user@E# set type external",
                    "user@E# set export statics",
                    "user@E# set peer-as 1",
                    "user@E# set protocols bgp group external-peers neighbor 10.0.0.25"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置静态路由。",
                  "code": [
                    "[edit routing-options static]",
                    "user@E# set route 10.2.0.0/16 reject",
                    "user@E# set route 10.2.0.0/16 install",
                    "user@E# set route 10.3.0.0/16 reject",
                    "user@E# set route 10.3.0.0/16 install"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置路由器 ID 和 AS 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@E# set router-id 192.168.0.5",
                    "user@E# set autonomous-system 2"
                  ]
                }
              ]
            },
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@C# set fe-1/2/0 unit 0 family inet address 10.0.0.10/30",
                    "user@C# set fe-1/2/0 unit 0 family iso",
                    "user@C# set fe-1/2/1 unit 0 family inet address 10.0.0.13/30",
                    "user@C# set fe-1/2/1 unit 0 family iso",
                    "user@C# set fe-1/2/2 unit 0 family inet address 10.0.0.25/30",
                    "user@C# set fe-1/2/2 unit 0 family iso",
                    "user@C# set lo0 unit 0 family inet address 192.168.0.3/32",
                    "user@C# set lo0 unit 0 family iso address 49.0002.0192.0168.0003.00"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 IBGP。",
                  "code": [
                    "[edit protocols bgp group int]",
                    "user@C# set type internal",
                    "user@C# set local-address 192.168.0.3",
                    "user@C# set neighbor 192.168.0.1",
                    "user@C# set neighbor 192.168.0.2"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 Edu 到 ISIS 策略，该策略将重新分配从设备 E 获知的 Edu 标记的 BGP 路由，并应用指标 63。",
                  "code": [
                    "[edit policy-options]",
                    "user@C# set policy-statement Edu-to-isis term 1 from protocol bgp",
                    "user@C# set policy-statement Edu-to-isis term 1 from community Edu",
                    "user@C# set policy-statement Edu-to-isis term 1 then metric 63",
                    "user@C# set policy-statement Edu-to-isis term 1 then accept",
                    "user@C# set community Edu members 2:5"
                  ]
                },
                {
                  "step": 4,
                  "description": "在接口上启用 IS-IS，并应用 Edu-to-ISIS 策略。",
                  "code": [
                    "[edit protocols isis]",
                    "user@C# set export Edu-to-isis",
                    "user@C# set interface fe-1/2/0.0 level 1 disable",
                    "user@C# set interface fe-1/2/1.0 level 1 disable",
                    "user@C# set interface fe-1/2/2.0 level 1 disable",
                    "user@C# set interface fe-1/2/2.0 level 2 passive",
                    "user@C# set interface lo0.0"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置发送 ISIS 和直接策略，该策略通过 EBGP 将路由重新分发到设备 E。",
                  "code": [
                    "[edit policy-options policy-statement send-isis-and-direct term 1]",
                    "user@C# set from protocol isis",
                    "user@C# set from protocol direct",
                    "user@C# set from route-filter 10.0.0.0/16 orlonger",
                    "user@C# set from route-filter 192.168.0.0/16 orlonger",
                    "user@C# set then accept"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置 EBGP 并应用发送 ISIS 和直接策略。",
                  "code": [
                    "[edit protocols bgp group external-peers]",
                    "user@C# set type external",
                    "user@C# set export send-isis-and-direct",
                    "user@C# set peer-as 2",
                    "user@C# set neighbor 10.0.0.26"
                  ]
                },
                {
                  "step": 7,
                  "description": "配置路由器 ID 和自治系统 （AS） 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@C# set router-id 192.168.0.3",
                    "user@C# set autonomous-system 1"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 设备 E 设备 C 如果完成设备配置，请从配置模式输入 commit 。",
              "code": [
                "user@E#show interfacesfe-1/2/0 {\n    unit 0 {\n        family inet {\n            address 10.0.0.26/30;\n        }\n    }\n}\nlo0 {\n    unit 0 {\n        family inet {\n            address 192.168.0.5/32 {\n                primary;\n            }\n            address 10.2.0.1/32;\n            address 10.3.0.1/32;\n        }\n    }\n}",
                "user@E#show protocolsbgp {\n    group external-peers {\n        type external;\n        export statics;\n        peer-as 1;\n        neighbor 10.0.0.25;\n    }\n}",
                "user@E#show policy-optionspolicy-statement statics {\n    from protocol static;\n    then {\n        community add Edu;\n        accept;\n    }\n}\ncommunity Edu members 2:5;",
                "user@E#show routing-optionsstatic {\n    route 10.2.0.0/16 {\n        reject;\n        install;\n    }\n    route 10.3.0.0/16 {\n        reject;\n        install;\n    }\n}\nrouter-id 192.168.0.5;\nautonomous-system 2;",
                "user@C#show interfacesfe-1/2/0 {\n    unit 0 {\n        family inet {\n            address 10.0.0.10/30;\n        }\n        family iso;\n    }\n}\nfe-1/2/1 {\n    unit 0 {\n        family inet {\n            address 10.0.0.13/30;\n        }\n        family iso;\n    }\n}\nfe-1/2/2 {\n    unit 0 {\n        family inet {\n            address 10.0.0.25/30;\n        }\n        family iso;\n    }\n}\nlo0 {\n    unit 0 {\n        family inet {\n            address 192.168.0.3/32;\n        }\n        family iso {\n            address 49.0002.0192.0168.0003.00;\n        }\n    }\n}",
                "user@C#show protocolsbgp {\n    group int {\n        type internal;\n        local-address 192.168.0.3;\n        neighbor 192.168.0.1;\n        neighbor 192.168.0.2;\n    }\n    group external-peers {\n        type external;\n        export send-isis-and-direct;\n        peer-as 2;\n        neighbor 10.0.0.26;\n    }\n}\nisis {\n    export Edu-to-isis;\n    interface fe-1/2/0.0 {\n        level 1 disable;\n    }\n    interface fe-1/2/1.0 {\n        level 1 disable;\n    }\n    interface fe-1/2/2.0 {\n        level 1 disable;\n        level 2 passive;\n    }\n    interface lo0.0;\n}",
                "user@C#show policy-optionspolicy-statement Edu-to-isis {\n    term 1 {\n        from {\n            protocol bgp;\n            community Edu;\n        }\n        then {\n            metric 63;\n            accept;\n        }\n    }\n}\npolicy-statement send-isis-and-direct {\n    term 1 {\n        from {\n            protocol [ isis direct ];\n            route-filter 10.0.0.0/16 orlonger;\n            route-filter 192.168.0.0/16 orlonger;\n        }\n        then accept;\n    }\n}\ncommunity Edu members 2:5;",
                "user@C#show routing-optionsrouter-id 192.168.0.3;\nautonomous-system 1;"
              ]
            }
          ]
        }
      ]
    }
  ],
  "content": "此示例定义了一个策略，该策略从社区获取 BGP 路由 Edu ，并将其放入指标为 63 的 IS-IS 中。 要求 配置此示例之前，不需要除设备初始化之外的特殊配置。 概述 图 1 显示了此示例中使用的拓扑。 图 1： 将具有特定公共组标记的 BGP 路由重新分发到 IS-IS 中 在此示例中，设备 A、设备 B、设备 C 和设备 D 位于自治系统 （AS） 1 中，并且正在运行 IS-IS。除设备 D 外，所有 AS 1 设备都在运行内部 BGP （IBGP）。 设备 E 位于 AS 2 中，与设备 C 具有外部 BGP （EBGP） 对等会话。设备 E 有两个静态路由：10.2.0.0/16 和 10.3.0.0/16。这些路由使用 Edu 2：5 社区属性进行标记，并通过 EBGP 向设备 C 播发。 设备 C 接受使用 Edu 2：5 社区属性标记的 BGP 路由，将这些路由重新分发到 IS-IS，并将 IS-IS 衡量指标 63 应用于这些路由。 CLI 快速配置 显示了 中 图 1所有设备的配置。#d206e65__d206e386本节介绍设备 C 和设备 E 上的步骤"
}