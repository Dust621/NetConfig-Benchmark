{
  "title": "示例：配置 BGP 路由的本地首选项值",
  "sections": [
    {
      "title": "要求",
      "level": 3,
      "content": "在配置此示例之前，不需要除设备初始化之外的特殊配置。"
    },
    {
      "title": "概述",
      "level": 3,
      "content": "要更改 path 属性中通告的本地首选项指标，必须包含该语句， local-preference 并指定一个介于 0 到 4,294,967,295 （2 32 – 1） 之间的值。 您可能希望更喜欢一条路径而不是另一条路径有几个原因。例如，与其他路径相比，一条路径的使用成本可能更低、带宽更高或可能更稳定。 图 3 显示了具有内部对等会话和到相邻 AS 的多个出口点的典型网络。 要到达设备 R4，设备 R1 可以采用通过设备 R2 或设备 R3 的路径。默认情况下，任一路由的本地首选项为 100。当本地首选项相等时，Junos OS 将制定打破联系和选择路径的规则。（请参阅 了解 BGP 路径选择。）在此示例中，活动路由通过设备 R2，因为设备 R2 的路由器 ID 低于设备 R3 的路由器 ID。下面的示例演示如何使用本地首选项的显式设置重写默认行为。该示例在设备 R3 上配置本地优先级 300，从而使设备 R3 成为到达设备 R4 的首选路径。"
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 R1 set interfaces fe-1/2/0 unit 1 family inet address 12.12.12.1/24 set interfaces fe-1/2/1 unit 2 family inet address 13.13.13.1/24 set interfaces lo0 unit 1 family inet address 192.168.1.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.1.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.2.1 set protocols bgp group internal neighbor 192.168.3.1 set protocols ospf area 0.0.0.0 interface lo0.1 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.1 set protocols ospf area 0.0.0.0 interface fe-1/2/1.2 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.1.1 设备 R2 set interfaces fe-1/2/0 unit 3 family inet address 12.12.12.2/24 set interfaces fe-1/2/1 unit 4 family inet address 24.24.24.2/24 set interfaces lo0 unit 2 family inet address 192.168.2.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.2.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.1.1 set protocols bgp group internal neighbor 192.168.3.1 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 4 set protocols bgp group external neighbor 24.24.24.4 set protocols ospf area 0.0.0.0 interface lo0.2 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.3 set protocols ospf area 0.0.0.0 interface fe-1/2/1.4 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.2.1 设备 R3 set interfaces fe-1/2/0 unit 5 family inet address 13.13.13.3/24 set interfaces fe-1/2/1 unit 6 family inet address 34.34.34.3/24 set interfaces lo0 unit 3 family inet address 192.168.3.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.3.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.1.1 set protocols bgp group internal neighbor 192.168.2.1 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 4 set protocols bgp group external neighbor 34.34.34.4 set protocols ospf area 0.0.0.0 interface lo0.3 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.5 set protocols ospf area 0.0.0.0 interface fe-1/2/1.6 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.3.1 设备 R4 set interfaces fe-1/2/0 unit 7 family inet address 24.24.24.4/24 set interfaces fe-1/2/1 unit 8 family inet address 34.34.34.4/24 set interfaces lo0 unit 4 family inet address 192.168.4.1/32 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 123 set protocols bgp group external neighbor 34.34.34.3 set protocols bgp group external neighbor 24.24.24.2 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 4 set routing-options router-id 192.168.4.1 下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R1： 配置接口。 [edit interfaces fe-1/2/0 unit 1] user@R1# set family inet address 12.12.12.1/24 [edit interfaces fe-1/2/1 unit 2] user@R1# set family inet address 13.13.13.1/24 [edit interfaces lo0 unit 1] user@R1# set family inet address 192.168.1.1/32 配置 BGP。 [edit protocols bgp group internal] user@R1# set type internal user@R1# set local-address 192.168.1.1 user@R1# set export send-direct user@R1# set neighbor 192.168.2.1 user@R1# set neighbor 192.168.3.1 配置 OSPF。 [edit protocols ospf area 0.0.0.0] user@R1# set interface lo0.1 passive user@R1# set interface fe-1/2/0.1 user@R1# set interface fe-1/2/1.2 配置接受直接路由的策略。 注： 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 [edit policy-options policy-statement send-direct term 1] user@R1# set from protocol direct user@R1# set then accept 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@R1# set autonomous-system 123 user@R1# set router-id 192.168.1.1 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R1# show interfaces fe-1/2/0 { unit 1 { family inet { address 12.12.12.1/24; } } } fe-1/2/1 { unit 2 { family inet { address 13.13.13.1/24; } } } lo0 { unit 1 { family inet { address 192.168.1.1/32; } } } user@R1# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R1# show protocols bgp { group internal { type internal; local-address 192.168.1.1; export send-direct; neighbor 192.168.2.1; neighbor 192.168.3.1; } } ospf { area 0.0.0.0 { interface lo0.1 { passive; } interface fe-1/2/0.1; interface fe-1/2/1.2; } } user@R1# show routing-options autonomous-system 123; router-id 192.168.1.1; 如果完成设备配置，请从配置模式输入 commit 。 要配置设备 R2： [edit interfaces fe-1/2/0 unit 3] user@R2# set family inet address 12.12.12.21/24 [edit interfaces fe-1/2/1 unit 4] user@R2# set family inet address 24.24.24.2/24 [edit interfaces lo0 unit 2] user@R2# set family inet address 192.168.2.1/32 [edit protocols bgp group internal] user@R2# set type internal user@R2# set local-address 192.168.2.1 user@R2# set export send-direct user@R2# set neighbor 192.168.1.1 user@R2# set neighbor 192.168.3.1 [edit protocols bgp group external] user@R2# set type external user@R2# set export send-direct user@R2# set peer-as 4 user@R2# set neighbor 24.24.24.4 [edit protocols ospf area 0.0.0.0] user@R2# set interface lo0.2 passive user@R2# set interface fe-1/2/0.3 user@R2# set interface fe-1/2/1.4 [edit policy-options policy-statement send-direct term 1] user@R2# set from protocol direct user@R2# set then accept [edit routing-options] user@R2# set autonomous-system 123 user@R2# set router-id 192.168.2.1 user@R2# show interfaces fe-1/2/0 { unit 3 { family inet { address 12.12.12.2/24; } } } fe-1/2/1 { unit 4 { family inet { address 24.24.24.2/24; } } } lo0 { unit 2 { family inet { address 192.168.2.1/32; } } } user@R2# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R2# show protocols bgp { group internal { type internal; local-address 192.168.2.1; export send-direct; neighbor 192.168.1.1; neighbor 192.168.3.1; } group external { type external; export send-direct; peer-as 4; neighbor 24.24.24.4; } } ospf { area 0.0.0.0 { interface lo0.2 { passive; } interface fe-1/2/0.3; interface fe-1/2/1.4; } } user@R2# show routing-options autonomous-system 123; router-id 192.168.2.1; 要配置设备 R3： [edit interfaces fe-1/2/0 unit 5] user@R3# set family inet address 13.13.13.3/24 [edit interfaces fe-1/2/1 unit 6] user@R3# set family inet address 34.34.34.3/24 [edit interfaces lo0 unit 3] user@R3# set family inet address 192.168.3.1/32 [edit protocols bgp group internal] user@R3# set type internal user@R3# set local-address 192.168.3.1 user@R3# set export send-direct user@R3# set neighbor 192.168.1.1 user@R3# set neighbor 192.168.2.1 [edit protocols bgp group external] user@R3# set type external user@R3# set export send-direct user@R3# set peer-as 4 user@R3# set neighbor 34.34.34.4 [edit protocols ospf area 0.0.0.0] user@R3# set interface lo0.3 passive user@R3# set interface fe-1/2/0.5 user@R3# set interface fe-1/2/1.6 [edit policy-options policy-statement send-direct term 1] user@R3# set from protocol direct user@R3# set then accept [edit routing-options] user@R3# set autonomous-system 123 user@R3# set router-id 192.168.3.1 user@R3# show interfaces fe-1/2/0 { unit 5 { family inet { address 13.13.13.3/24; } } } fe-1/2/1 { unit 6 { family inet { address 34.34.34.3/24; } } } lo0 { unit 3 { family inet { address 192.168.3.1/32; } } } user@R3# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R3# show protocols bgp { group internal { type internal; local-address 192.168.3.1; export send-direct; neighbor 192.168.1.1; neighbor 192.168.2.1; } group external { type external; export send-direct; peer-as 4; neighbor 34.34.34.4; } } ospf { area 0.0.0.0 { interface lo0.3 { passive; } interface fe-1/2/0.5; interface fe-1/2/1.6; } } user@R3# show routing-options autonomous-system 123; router-id 192.168.3.1; 要配置设备 R4： [edit interfaces fe-1/2/0 unit 7] user@R4# set family inet address 24.24.24.4/24 [edit interfaces fe-1/2/1 unit 8] user@R4# set family inet address 34.34.34.4/24 [edit interfaces lo0 unit 4] user@R4# set family inet address 192.168.4.1/32 [edit protocols bgp group external] user@R4# set type external user@R4# set export send-direct user@R4# set peer-as 123 user@R4# set neighbor 34.34.34.3 user@R4# set neighbor 24.24.24.2 [edit policy-options policy-statement send-direct term 1] user@R4# set from protocol direct user@R4# set then accept [edit routing-options] user@R4# set autonomous-system 4 user@R4# set router-id 192.168.4.1 user@R4# show interfaces fe-1/2/0 { unit 7 { family inet { address 24.24.24.4/24; } } } fe-1/2/1 { unit 8 { family inet { address 34.34.34.4/24; } } } lo0 { unit 4 { family inet { address 192.168.4.1/32; } } } user@R4# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R4# show protocols bgp { group external { type external; export send-direct; peer-as 123; neighbor 34.34.34.3; neighbor 24.24.24.2; } } user@R4# show routing-options autonomous-system 4; router-id 192.168.4.1;",
      "sections": [
        {
          "title": "CLI 快速配置",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 R1 set interfaces fe-1/2/0 unit 1 family inet address 12.12.12.1/24 set interfaces fe-1/2/1 unit 2 family inet address 13.13.13.1/24 set interfaces lo0 unit 1 family inet address 192.168.1.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.1.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.2.1 set protocols bgp group internal neighbor 192.168.3.1 set protocols ospf area 0.0.0.0 interface lo0.1 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.1 set protocols ospf area 0.0.0.0 interface fe-1/2/1.2 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.1.1 设备 R2 set interfaces fe-1/2/0 unit 3 family inet address 12.12.12.2/24 set interfaces fe-1/2/1 unit 4 family inet address 24.24.24.2/24 set interfaces lo0 unit 2 family inet address 192.168.2.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.2.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.1.1 set protocols bgp group internal neighbor 192.168.3.1 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 4 set protocols bgp group external neighbor 24.24.24.4 set protocols ospf area 0.0.0.0 interface lo0.2 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.3 set protocols ospf area 0.0.0.0 interface fe-1/2/1.4 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.2.1 设备 R3 set interfaces fe-1/2/0 unit 5 family inet address 13.13.13.3/24 set interfaces fe-1/2/1 unit 6 family inet address 34.34.34.3/24 set interfaces lo0 unit 3 family inet address 192.168.3.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.3.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.1.1 set protocols bgp group internal neighbor 192.168.2.1 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 4 set protocols bgp group external neighbor 34.34.34.4 set protocols ospf area 0.0.0.0 interface lo0.3 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.5 set protocols ospf area 0.0.0.0 interface fe-1/2/1.6 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.3.1 设备 R4 set interfaces fe-1/2/0 unit 7 family inet address 24.24.24.4/24 set interfaces fe-1/2/1 unit 8 family inet address 34.34.34.4/24 set interfaces lo0 unit 4 family inet address 192.168.4.1/32 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 123 set protocols bgp group external neighbor 34.34.34.3 set protocols bgp group external neighbor 24.24.24.2 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 4 set routing-options router-id 192.168.4.1",
          "commands_by_device": {
            "设备 R1": "set interfaces fe-1/2/0 unit 1 family inet address 12.12.12.1/24\nset interfaces fe-1/2/1 unit 2 family inet address 13.13.13.1/24\nset interfaces lo0 unit 1 family inet address 192.168.1.1/32\nset protocols bgp group internal type internal\nset protocols bgp group internal local-address 192.168.1.1\nset protocols bgp group internal export send-direct\nset protocols bgp group internal neighbor 192.168.2.1\nset protocols bgp group internal neighbor 192.168.3.1\nset protocols ospf area 0.0.0.0 interface lo0.1 passive\nset protocols ospf area 0.0.0.0 interface fe-1/2/0.1\nset protocols ospf area 0.0.0.0 interface fe-1/2/1.2\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset routing-options autonomous-system 123\nset routing-options router-id 192.168.1.1",
            "设备 R2": "set interfaces fe-1/2/0 unit 3 family inet address 12.12.12.2/24\nset interfaces fe-1/2/1 unit 4 family inet address 24.24.24.2/24\nset interfaces lo0 unit 2 family inet address 192.168.2.1/32\nset protocols bgp group internal type internal\nset protocols bgp group internal local-address 192.168.2.1\nset protocols bgp group internal export send-direct\nset protocols bgp group internal neighbor 192.168.1.1\nset protocols bgp group internal neighbor 192.168.3.1\nset protocols bgp group external type external\nset protocols bgp group external export send-direct\nset protocols bgp group external peer-as 4\nset protocols bgp group external neighbor 24.24.24.4\nset protocols ospf area 0.0.0.0 interface lo0.2 passive\nset protocols ospf area 0.0.0.0 interface fe-1/2/0.3\nset protocols ospf area 0.0.0.0 interface fe-1/2/1.4\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset routing-options autonomous-system 123\nset routing-options router-id 192.168.2.1",
            "设备 R3": "set interfaces fe-1/2/0 unit 5 family inet address 13.13.13.3/24\nset interfaces fe-1/2/1 unit 6 family inet address 34.34.34.3/24\nset interfaces lo0 unit 3 family inet address 192.168.3.1/32\nset protocols bgp group internal type internal\nset protocols bgp group internal local-address 192.168.3.1\nset protocols bgp group internal export send-direct\nset protocols bgp group internal neighbor 192.168.1.1\nset protocols bgp group internal neighbor 192.168.2.1\nset protocols bgp group external type external\nset protocols bgp group external export send-direct\nset protocols bgp group external peer-as 4\nset protocols bgp group external neighbor 34.34.34.4\nset protocols ospf area 0.0.0.0 interface lo0.3 passive\nset protocols ospf area 0.0.0.0 interface fe-1/2/0.5\nset protocols ospf area 0.0.0.0 interface fe-1/2/1.6\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset routing-options autonomous-system 123\nset routing-options router-id 192.168.3.1",
            "设备 R4": "set interfaces fe-1/2/0 unit 7 family inet address 24.24.24.4/24\nset interfaces fe-1/2/1 unit 8 family inet address 34.34.34.4/24\nset interfaces lo0 unit 4 family inet address 192.168.4.1/32\nset protocols bgp group external type external\nset protocols bgp group external export send-direct\nset protocols bgp group external peer-as 123\nset protocols bgp group external neighbor 34.34.34.3\nset protocols bgp group external neighbor 24.24.24.2\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset routing-options autonomous-system 4\nset routing-options router-id 192.168.4.1"
          }
        },
        {
          "title": "配置设备 R1",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R1： 配置接口。 [edit interfaces fe-1/2/0 unit 1] user@R1# set family inet address 12.12.12.1/24 [edit interfaces fe-1/2/1 unit 2] user@R1# set family inet address 13.13.13.1/24 [edit interfaces lo0 unit 1] user@R1# set family inet address 192.168.1.1/32 配置 BGP。 [edit protocols bgp group internal] user@R1# set type internal user@R1# set local-address 192.168.1.1 user@R1# set export send-direct user@R1# set neighbor 192.168.2.1 user@R1# set neighbor 192.168.3.1 配置 OSPF。 [edit protocols ospf area 0.0.0.0] user@R1# set interface lo0.1 passive user@R1# set interface fe-1/2/0.1 user@R1# set interface fe-1/2/1.2 配置接受直接路由的策略。 注： 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 [edit policy-options policy-statement send-direct term 1] user@R1# set from protocol direct user@R1# set then accept 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@R1# set autonomous-system 123 user@R1# set router-id 192.168.1.1 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R1# show interfaces fe-1/2/0 { unit 1 { family inet { address 12.12.12.1/24; } } } fe-1/2/1 { unit 2 { family inet { address 13.13.13.1/24; } } } lo0 { unit 1 { family inet { address 192.168.1.1/32; } } } user@R1# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R1# show protocols bgp { group internal { type internal; local-address 192.168.1.1; export send-direct; neighbor 192.168.2.1; neighbor 192.168.3.1; } } ospf { area 0.0.0.0 { interface lo0.1 { passive; } interface fe-1/2/0.1; interface fe-1/2/1.2; } } user@R1# show routing-options autonomous-system 123; router-id 192.168.1.1; 如果完成设备配置，请从配置模式输入 commit 。",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces fe-1/2/0 unit 1]",
                    "user@R1# set family inet address 12.12.12.1/24",
                    "[edit interfaces fe-1/2/1 unit 2]",
                    "user@R1# set family inet address 13.13.13.1/24",
                    "[edit interfaces lo0 unit 1]",
                    "user@R1# set family inet address 192.168.1.1/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group internal]",
                    "user@R1# set type internal",
                    "user@R1# set local-address 192.168.1.1",
                    "user@R1# set export send-direct",
                    "user@R1# set neighbor 192.168.2.1",
                    "user@R1# set neighbor 192.168.3.1"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 OSPF。",
                  "code": [
                    "[edit protocols ospf area 0.0.0.0]",
                    "user@R1# set interface lo0.1 passive",
                    "user@R1# set interface fe-1/2/0.1",
                    "user@R1# set interface fe-1/2/1.2"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置接受直接路由的策略。",
                  "code": [
                    "[edit policy-options policy-statement send-direct term 1]",
                    "user@R1# set from protocol direct",
                    "user@R1# set then accept"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置路由器 ID 和自治系统 (AS) 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@R1# set autonomous-system 123",
                    "user@R1# set router-id 192.168.1.1"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。",
              "code": [
                "user@R1#show interfacesfe-1/2/0 {\n    unit 1 {\n        family inet {\n            address 12.12.12.1/24;\n        }\n    }\n}\nfe-1/2/1 {\n    unit 2 {\n        family inet {\n            address 13.13.13.1/24;\n        }\n    }\n}\nlo0 {\n    unit 1 {\n        family inet {\n            address 192.168.1.1/32;\n        }\n    }\n}",
                "user@R1#show policy-optionspolicy-statement send-direct {\n    term 1 {\n        from protocol direct;\n        then accept;\n    }\n}",
                "user@R1#show protocolsbgp {\n    group internal {\n        type internal;\n        local-address 192.168.1.1;\n        export send-direct;\n        neighbor 192.168.2.1;\n        neighbor 192.168.3.1;\n    }\n}\nospf {\n    area 0.0.0.0 {\n        interface lo0.1 {\n            passive;\n        }\n        interface fe-1/2/0.1;\n        interface fe-1/2/1.2;\n    }\n}",
                "user@R1#show routing-optionsautonomous-system 123;\nrouter-id 192.168.1.1;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 R2",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R2： 配置接口。 [edit interfaces fe-1/2/0 unit 3] user@R2# set family inet address 12.12.12.21/24 [edit interfaces fe-1/2/1 unit 4] user@R2# set family inet address 24.24.24.2/24 [edit interfaces lo0 unit 2] user@R2# set family inet address 192.168.2.1/32 配置 BGP。 [edit protocols bgp group internal] user@R2# set type internal user@R2# set local-address 192.168.2.1 user@R2# set export send-direct user@R2# set neighbor 192.168.1.1 user@R2# set neighbor 192.168.3.1 [edit protocols bgp group external] user@R2# set type external user@R2# set export send-direct user@R2# set peer-as 4 user@R2# set neighbor 24.24.24.4 配置 OSPF。 [edit protocols ospf area 0.0.0.0] user@R2# set interface lo0.2 passive user@R2# set interface fe-1/2/0.3 user@R2# set interface fe-1/2/1.4 配置接受直接路由的策略。 注： 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 [edit policy-options policy-statement send-direct term 1] user@R2# set from protocol direct user@R2# set then accept 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@R2# set autonomous-system 123 user@R2# set router-id 192.168.2.1 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R2# show interfaces fe-1/2/0 { unit 3 { family inet { address 12.12.12.2/24; } } } fe-1/2/1 { unit 4 { family inet { address 24.24.24.2/24; } } } lo0 { unit 2 { family inet { address 192.168.2.1/32; } } } user@R2# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R2# show protocols bgp { group internal { type internal; local-address 192.168.2.1; export send-direct; neighbor 192.168.1.1; neighbor 192.168.3.1; } group external { type external; export send-direct; peer-as 4; neighbor 24.24.24.4; } } ospf { area 0.0.0.0 { interface lo0.2 { passive; } interface fe-1/2/0.3; interface fe-1/2/1.4; } } user@R2# show routing-options autonomous-system 123; router-id 192.168.2.1; 如果完成设备配置，请从配置模式输入 commit 。",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces fe-1/2/0 unit 3]",
                    "user@R2# set family inet address 12.12.12.21/24",
                    "[edit interfaces fe-1/2/1 unit 4]",
                    "user@R2# set family inet address 24.24.24.2/24",
                    "[edit interfaces lo0 unit 2]",
                    "user@R2# set family inet address 192.168.2.1/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group internal]",
                    "user@R2# set type internal",
                    "user@R2# set local-address 192.168.2.1",
                    "user@R2# set export send-direct",
                    "user@R2# set neighbor 192.168.1.1",
                    "user@R2# set neighbor 192.168.3.1",
                    "[edit protocols bgp group external]",
                    "user@R2# set type external",
                    "user@R2# set export send-direct",
                    "user@R2# set peer-as 4",
                    "user@R2# set neighbor 24.24.24.4"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 OSPF。",
                  "code": [
                    "[edit protocols ospf area 0.0.0.0]",
                    "user@R2# set interface lo0.2 passive",
                    "user@R2# set interface fe-1/2/0.3",
                    "user@R2# set interface fe-1/2/1.4"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置接受直接路由的策略。",
                  "code": [
                    "[edit policy-options policy-statement send-direct term 1]",
                    "user@R2# set from protocol direct",
                    "user@R2# set then accept"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置路由器 ID 和自治系统 (AS) 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@R2# set autonomous-system 123",
                    "user@R2# set router-id 192.168.2.1"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。",
              "code": [
                "user@R2#show interfacesfe-1/2/0 {\n    unit 3 {\n        family inet {\n            address 12.12.12.2/24;\n        }\n    }\n}\nfe-1/2/1 {\n    unit 4 {\n        family inet {\n            address 24.24.24.2/24;\n        }\n    }\n}\nlo0 {\n    unit 2 {\n        family inet {\n            address 192.168.2.1/32;\n        }\n    }\n}",
                "user@R2#show policy-optionspolicy-statement send-direct {\n    term 1 {\n        from protocol direct;\n        then accept;\n    }\n}",
                "user@R2#show protocolsbgp {\n    group internal {\n        type internal;\n        local-address 192.168.2.1;\n        export send-direct;\n        neighbor 192.168.1.1;\n        neighbor 192.168.3.1;\n    }\n    group external {\n        type external;\n        export send-direct;\n        peer-as 4;\n        neighbor 24.24.24.4;\n    }\n}\nospf {\n    area 0.0.0.0 {\n        interface lo0.2 {\n            passive;\n        }\n        interface fe-1/2/0.3;\n        interface fe-1/2/1.4;\n    }\n}",
                "user@R2#show routing-optionsautonomous-system 123;\nrouter-id 192.168.2.1;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 R3",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R3： 配置接口。 [edit interfaces fe-1/2/0 unit 5] user@R3# set family inet address 13.13.13.3/24 [edit interfaces fe-1/2/1 unit 6] user@R3# set family inet address 34.34.34.3/24 [edit interfaces lo0 unit 3] user@R3# set family inet address 192.168.3.1/32 配置 BGP。 [edit protocols bgp group internal] user@R3# set type internal user@R3# set local-address 192.168.3.1 user@R3# set export send-direct user@R3# set neighbor 192.168.1.1 user@R3# set neighbor 192.168.2.1 [edit protocols bgp group external] user@R3# set type external user@R3# set export send-direct user@R3# set peer-as 4 user@R3# set neighbor 34.34.34.4 配置 OSPF。 [edit protocols ospf area 0.0.0.0] user@R3# set interface lo0.3 passive user@R3# set interface fe-1/2/0.5 user@R3# set interface fe-1/2/1.6 配置接受直接路由的策略。 注： 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 [edit policy-options policy-statement send-direct term 1] user@R3# set from protocol direct user@R3# set then accept 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@R3# set autonomous-system 123 user@R3# set router-id 192.168.3.1 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R3# show interfaces fe-1/2/0 { unit 5 { family inet { address 13.13.13.3/24; } } } fe-1/2/1 { unit 6 { family inet { address 34.34.34.3/24; } } } lo0 { unit 3 { family inet { address 192.168.3.1/32; } } } user@R3# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R3# show protocols bgp { group internal { type internal; local-address 192.168.3.1; export send-direct; neighbor 192.168.1.1; neighbor 192.168.2.1; } group external { type external; export send-direct; peer-as 4; neighbor 34.34.34.4; } } ospf { area 0.0.0.0 { interface lo0.3 { passive; } interface fe-1/2/0.5; interface fe-1/2/1.6; } } user@R3# show routing-options autonomous-system 123; router-id 192.168.3.1; 如果完成设备配置，请从配置模式输入 commit 。",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces fe-1/2/0 unit 5]",
                    "user@R3# set family inet address 13.13.13.3/24",
                    "[edit interfaces fe-1/2/1 unit 6]",
                    "user@R3# set family inet address 34.34.34.3/24",
                    "[edit interfaces lo0 unit 3]",
                    "user@R3# set family inet address 192.168.3.1/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group internal]",
                    "user@R3# set type internal",
                    "user@R3# set local-address 192.168.3.1",
                    "user@R3# set export send-direct",
                    "user@R3# set neighbor 192.168.1.1",
                    "user@R3# set neighbor 192.168.2.1",
                    "[edit protocols bgp group external]",
                    "user@R3# set type external",
                    "user@R3# set export send-direct",
                    "user@R3# set peer-as 4",
                    "user@R3# set neighbor 34.34.34.4"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 OSPF。",
                  "code": [
                    "[edit protocols ospf area 0.0.0.0]",
                    "user@R3# set interface lo0.3 passive",
                    "user@R3# set interface fe-1/2/0.5",
                    "user@R3# set interface fe-1/2/1.6"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置接受直接路由的策略。",
                  "code": [
                    "[edit policy-options policy-statement send-direct term 1]",
                    "user@R3# set from protocol direct",
                    "user@R3# set then accept"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置路由器 ID 和自治系统 (AS) 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@R3# set autonomous-system 123",
                    "user@R3# set router-id 192.168.3.1"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。",
              "code": [
                "user@R3#show interfacesfe-1/2/0 {\n    unit 5 {\n        family inet {\n            address 13.13.13.3/24;\n        }\n    }\n}\nfe-1/2/1 {\n    unit 6 {\n        family inet {\n            address 34.34.34.3/24;\n        }\n    }\n}\nlo0 {\n    unit 3 {\n        family inet {\n            address 192.168.3.1/32;\n        }\n    }\n}",
                "user@R3#show policy-optionspolicy-statement send-direct {\n    term 1 {\n        from protocol direct;\n        then accept;\n    }\n}",
                "user@R3#show protocolsbgp {\n    group internal {\n        type internal;\n        local-address 192.168.3.1;\n        export send-direct;\n        neighbor 192.168.1.1;\n        neighbor 192.168.2.1;\n    }\n    group external {\n        type external;\n        export send-direct;\n        peer-as 4;\n        neighbor 34.34.34.4;\n    }\n}\nospf {\n    area 0.0.0.0 {\n        interface lo0.3 {\n            passive;\n        }\n        interface fe-1/2/0.5;\n        interface fe-1/2/1.6;\n    }\n}",
                "user@R3#show routing-optionsautonomous-system 123;\nrouter-id 192.168.3.1;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 R4",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R4： 配置接口。 [edit interfaces fe-1/2/0 unit 7] user@R4# set family inet address 24.24.24.4/24 [edit interfaces fe-1/2/1 unit 8] user@R4# set family inet address 34.34.34.4/24 [edit interfaces lo0 unit 4] user@R4# set family inet address 192.168.4.1/32 配置 BGP。 [edit protocols bgp group external] user@R4# set type external user@R4# set export send-direct user@R4# set peer-as 123 user@R4# set neighbor 34.34.34.3 user@R4# set neighbor 24.24.24.2 配置接受直接路由的策略。 注： 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 [edit policy-options policy-statement send-direct term 1] user@R4# set from protocol direct user@R4# set then accept 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@R4# set autonomous-system 4 user@R4# set router-id 192.168.4.1 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R4# show interfaces fe-1/2/0 { unit 7 { family inet { address 24.24.24.4/24; } } } fe-1/2/1 { unit 8 { family inet { address 34.34.34.4/24; } } } lo0 { unit 4 { family inet { address 192.168.4.1/32; } } } user@R4# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R4# show protocols bgp { group external { type external; export send-direct; peer-as 123; neighbor 34.34.34.3; neighbor 24.24.24.2; } } user@R4# show routing-options autonomous-system 4; router-id 192.168.4.1; 如果完成设备配置，请从配置模式输入 commit 。",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces fe-1/2/0 unit 7]",
                    "user@R4# set family inet address 24.24.24.4/24",
                    "[edit interfaces fe-1/2/1 unit 8]",
                    "user@R4# set family inet address 34.34.34.4/24",
                    "[edit interfaces lo0 unit 4]",
                    "user@R4# set family inet address 192.168.4.1/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group external]",
                    "user@R4# set type external",
                    "user@R4# set export send-direct",
                    "user@R4# set peer-as 123",
                    "user@R4# set neighbor 34.34.34.3",
                    "user@R4# set neighbor 24.24.24.2"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置接受直接路由的策略。",
                  "code": [
                    "[edit policy-options policy-statement send-direct term 1]",
                    "user@R4# set from protocol direct",
                    "user@R4# set then accept"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置路由器 ID 和自治系统 (AS) 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@R4# set autonomous-system 4",
                    "user@R4# set router-id 192.168.4.1"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。",
              "code": [
                "user@R4#show interfacesfe-1/2/0 {\n    unit 7 {\n        family inet {\n            address 24.24.24.4/24;\n        }\n    }\n}\nfe-1/2/1 {\n    unit 8 {\n        family inet {\n            address 34.34.34.4/24;\n        }\n    }\n}\nlo0 {\n    unit 4 {\n        family inet {\n            address 192.168.4.1/32;\n        }\n    }\n}",
                "user@R4#show policy-optionspolicy-statement send-direct {\n    term 1 {\n        from protocol direct;\n        then accept;\n    }\n}",
                "user@R4#show protocolsbgp {\n    group external {\n        type external;\n        export send-direct;\n        peer-as 123;\n        neighbor 34.34.34.3;\n        neighbor 24.24.24.2;\n    }\n}",
                "user@R4#show routing-optionsautonomous-system 4;\nrouter-id 192.168.4.1;"
              ]
            }
          ]
        }
      ]
    }
  ],
  "content": "此示例说明如何在内部 BGP （IBGP） 对等会话中配置本地首选项。 要求 在配置此示例之前，不需要除设备初始化之外的特殊配置"
}