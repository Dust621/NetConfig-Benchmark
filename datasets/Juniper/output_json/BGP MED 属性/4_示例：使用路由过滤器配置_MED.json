{
  "title": "示例：使用路由过滤器配置 MED",
  "sections": [
    {
      "title": "要求",
      "level": 3,
      "content": "在配置此示例之前，不需要除设备初始化之外的特殊配置。"
    },
    {
      "title": "概述",
      "level": 3,
      "content": "要配置在 BGP 更新消息中修改播发的 MED 指标的路由过滤器策略，请在策略操作中包含该 metric 语句。 图 3 显示了具有内部对等会话和到相邻自治系统 （AS） 的多个出口点的典型网络。 设备 R4 具有多个环路接口，配置为模拟播发的前缀。额外的环路接口地址为 172.16.44.0/32 和 172.16.144.0/32。此示例说明如何配置设备 R4，以便为除 172.16.144.0 之外的所有路由将 MED 值 30 播发至设备 R3。对于 172.16.144.0，MED 值 10 将播发至设备 3。无论路由前缀如何，MED 值 20 都会播发至设备 R2。"
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 R1 set interfaces fe-1/2/0 unit 1 family inet address 172.16.12.1/24 set interfaces fe-1/2/1 unit 2 family inet address 172.16.13.1/24 set interfaces lo0 unit 1 family inet address 192.168.1.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.1.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.2.1 set protocols bgp group internal neighbor 192.168.3.1 set protocols ospf area 0.0.0.0 interface lo0.1 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.1 set protocols ospf area 0.0.0.0 interface fe-1/2/1.2 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.1.1 设备 R2 set interfaces fe-1/2/0 unit 3 family inet address 172.16.12.2/24 set interfaces fe-1/2/1 unit 4 family inet address 172.16.24.2/24 set interfaces lo0 unit 2 family inet address 192.168.2.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.2.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.1.1 set protocols bgp group internal neighbor 192.168.3.1 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 4 set protocols bgp group external neighbor 172.16.24.4 set protocols ospf area 0.0.0.0 interface lo0.2 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.3 set protocols ospf area 0.0.0.0 interface fe-1/2/1.4 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.2.1 设备 R3 set interfaces fe-1/2/0 unit 5 family inet address 172.16.13.3/24 set interfaces fe-1/2/1 unit 6 family inet address 172.16.34.3/24 set interfaces lo0 unit 3 family inet address 192.168.3.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.3.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.1.1 set protocols bgp group internal neighbor 192.168.2.1 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 4 set protocols bgp group external neighbor 172.16.34.4 set protocols ospf area 0.0.0.0 interface lo0.3 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.5 set protocols ospf area 0.0.0.0 interface fe-1/2/1.6 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.3.1 设备 R4 set interfaces fe-1/2/0 unit 7 family inet address 172.16.24.4/24 set interfaces fe-1/2/1 unit 8 family inet address 172.16.34.4/24 set interfaces lo0 unit 4 family inet address 192.168.4.1/32 set interfaces lo0 unit 4 family inet address 172.16.44.0/32 set interfaces lo0 unit 4 family inet address 172.16.144.0/32 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 123 set protocols bgp group external neighbor 172.16.34.3 export med-10 set protocols bgp group external neighbor 172.16.34.3 export med-30 set protocols bgp group external neighbor 172.16.24.2 metric-out 20 set policy-options policy-statement med-10 from route-filter 172.16.144.0/32 exact set policy-options policy-statement med-10 then metric 10 set policy-options policy-statement med-10 then accept set policy-options policy-statement med-30 from route-filter 0.0.0.0/0 longer set policy-options policy-statement med-30 then metric 30 set policy-options policy-statement med-30 then accept set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 4 set routing-options router-id 192.168.4.1 下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R1： 配置设备接口。 [edit interfaces fe-1/2/0 unit 1] user@R1# set family inet address 172.16.12.1/24 [edit interfaces fe-1/2/1 unit 2] user@R1# set family inet address 172.16.13.1/24 [edit interfaces lo0 unit 1] user@R1# set family inet address 192.168.1.1/32 配置 BGP。 [edit protocols bgp group internal] user@R1# set type internal user@R1# set local-address 192.168.1.1 user@R1# set export send-direct user@R1# set neighbor 192.168.2.1 user@R1# set neighbor 192.168.3.1 配置 OSPF。 [edit protocols ospf area 0.0.0.0] user@R1# set interface lo0.1 passive user@R1# set interface fe-1/2/0.1 user@R1# set interface fe-1/2/1.2 配置接受直接路由的策略。 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 [edit policy-options policy-statement send-direct term 1] user@R1# set from protocol direct user@R1# set then accept 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@R1# set autonomous-system 123 user@R1# set router-id 192.168.1.1 在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R1# show interfaces fe-1/2/0 { unit 1 { family inet { address 172.16.12.1/24; } } } fe-1/2/1 { unit 2 { family inet { address 172.16.13.1/24; } } } lo0 { unit 1 { family inet { address 192.168.1.1/32; } } } user@R1# show protocols bgp { group internal { type internal; local-address 192.168.1.1; export send-direct; neighbor 192.168.2.1; neighbor 192.168.3.1; } } ospf { area 0.0.0.0 { interface lo0.1 { passive; } interface fe-1/2/0.1; interface fe-1/2/1.2; } } user@R1# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R1# show routing-options autonomous-system 123; router-id 192.168.1.1; 如果完成设备配置，请从配置模式输入 commit 。 要配置设备 R2： [edit interfaces fe-1/2/0 unit 3] user@R2# set family inet address 172.16.12.21/24 [edit interfaces fe-1/2/1 unit 4] user@R2# set family inet address 172.16.24.2/24 [edit interfaces lo0 unit 2] user@R2# set family inet address 192.168.2.1/32 [edit protocols bgp group internal] user@R2# set type internal user@R2# set local-address 192.168.2.1 user@R2# set export send-direct user@R2# set neighbor 192.168.1.1 user@R2# set neighbor 192.168.3.1 [edit protocols bgp group external] user@R2# set type external user@R2# set export send-direct user@R2# set peer-as 4 user@R2# set neighbor 172.16.24.4 [edit protocols ospf area 0.0.0.0] user@R2# set interface lo0.2 passive user@R2# set interface fe-1/2/0.3 user@R2# set interface fe-1/2/1.4 [edit policy-options policy-statement send-direct term 1] user@R2# set from protocol direct user@R2# set then accept [edit routing-options] user@R2# set autonomous-system 123 user@R2# set router-id 192.168.2.1 user@R2# show interfaces fe-1/2/0 { unit 3 { family inet { address 172.16.12.2/24; } } } fe-1/2/1 { unit 4 { family inet { address 172.16.24.2/24; } } } lo0 { unit 2 { family inet { address 192.168.2.1/32; } } } user@R2# show protocols bgp { group internal { type internal; local-address 192.168.2.1; export send-direct; neighbor 192.168.1.1; neighbor 192.168.3.1; } group external { type external; export send-direct; peer-as 4; neighbor 172.16.24.4; } } ospf { area 0.0.0.0 { interface lo0.2 { passive; } interface fe-1/2/0.3; interface fe-1/2/1.4; } } user@R2# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R2# show routing-options autonomous-system 123; router-id 192.168.2.1; 要配置设备 R3： [edit interfaces fe-1/2/0 unit 5] user@R3# set family inet address 172.16.13.3/24 [edit interfaces fe-1/2/1 unit 6] user@R3# set family inet address 172.16.34.3/24 [edit interfaces lo0 unit 3] user@R3# set family inet address 192.168.3.1/32 [edit protocols bgp group internal] user@R3# set type internal user@R3# set local-address 192.168.3.1 user@R3# set export send-direct user@R3# set neighbor 192.168.1.1 user@R3# set neighbor 192.168.2.1 [edit protocols bgp group external] user@R3# set type external user@R3# set export send-direct user@R3# set peer-as 4 user@R3# set neighbor 172.16.34.4 [edit protocols ospf area 0.0.0.0] user@R3# set interface lo0.3 passive user@R3# set interface fe-1/2/0.5 user@R3# set interface fe-1/2/1.6 [edit policy-options policy-statement send-direct term 1] user@R3# set from protocol direct user@R3# set then accept [edit routing-options] user@R3# set autonomous-system 123 user@R3# set router-id 192.168.3.1 user@R3# show interfaces fe-1/2/0 { unit 5 { family inet { address 172.16.13.3/24; } } } fe-1/2/1 { unit 6 { family inet { address 172.16.34.3/24; } } } lo0 { unit 3 { family inet { address 192.168.3.1/32; } } } user@R3# show protocols bgp { group internal { type internal; local-address 192.168.3.1; export send-direct; neighbor 192.168.1.1; neighbor 192.168.2.1; } group external { type external; export send-direct; peer-as 4; neighbor 172.16.34.4; } } ospf { area 0.0.0.0 { interface lo0.3 { passive; } interface fe-1/2/0.5; interface fe-1/2/1.6; } } user@R3# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R3# show routing-options autonomous-system 123; router-id 192.168.3.1; 要配置设备 R4： [edit interfaces fe-1/2/0 unit 7] user@R4# set family inet address 172.16.24.4/24 [edit interfaces fe-1/2/1 unit 8] user@R4# set family inet address 172.16.34.4/24 [edit interfaces lo0 unit 4] user@R4# set family inet address 192.168.4.1/32 user@R4# set family inet address 172.16.44.0/32 user@R4# set family inet address 172.16.144.0/32 设备 R4 具有多个环路接口地址，用于模拟播发前缀。 [edit policy-options policy-statement send-direct term 1] user@R4# set from protocol direct user@R4# set then accept [edit protocols bgp group external] user@R4# set type external user@R4# set export send-direct user@R4# set peer-as 123 配置两个 MED 策略。 [edit policy-options] set policy-statement med-10 from route-filter 172.16.144.0/32 exact set policy-statement med-10 then metric 10 set policy-statement med-10 then accept set policy-statement med-30 from route-filter 0.0.0.0/0 longer set policy-statement med-30 then metric 30 set policy-statement med-30 then accept 配置两个 EBGP 邻接方，将两个 MED 策略应用于设备 R3，并将 MED 值 20 应用于设备 R2。 [edit protocols bgp group external] user@R4# set neighbor 172.16.34.3 export med-10 user@R4# set neighbor 172.16.34.3 export med-30 user@R4# set neighbor 172.16.24.2 metric-out 20 [edit routing-options] user@R4# set autonomous-system 4 user@R4# set router-id 192.168.4.1 user@R4# show interfaces fe-1/2/0 { unit 7 { family inet { address 172.16.24.4/24; } } } fe-1/2/1 { unit 8 { family inet { address 172.16.34.4/24; } } } lo0 { unit 4 { family inet { address 192.168.4.1/32; address 172.16.44.0/32; address 172.16.144.0/32; } } } user@R4# show protocols bgp { group external { type external; export send-direct; peer-as 123; neighbor 172.16.24.2 { metric-out 20; } neighbor 172.16.34.3 { export [ med-10 med-30 ]; } } } user@R4# show policy-options policy-statement med-10 { from { route-filter 172.16.144.0/32 exact; } then { metric 10; accept; } } policy-statement med-30 { from { route-filter 0.0.0.0/0 longer; } then { metric 30; accept; } } policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R4# show routing-options autonomous-system 4; router-id 192.168.4.1;",
      "sections": [
        {
          "title": "CLI 快速配置",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 R1 set interfaces fe-1/2/0 unit 1 family inet address 172.16.12.1/24 set interfaces fe-1/2/1 unit 2 family inet address 172.16.13.1/24 set interfaces lo0 unit 1 family inet address 192.168.1.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.1.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.2.1 set protocols bgp group internal neighbor 192.168.3.1 set protocols ospf area 0.0.0.0 interface lo0.1 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.1 set protocols ospf area 0.0.0.0 interface fe-1/2/1.2 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.1.1 设备 R2 set interfaces fe-1/2/0 unit 3 family inet address 172.16.12.2/24 set interfaces fe-1/2/1 unit 4 family inet address 172.16.24.2/24 set interfaces lo0 unit 2 family inet address 192.168.2.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.2.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.1.1 set protocols bgp group internal neighbor 192.168.3.1 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 4 set protocols bgp group external neighbor 172.16.24.4 set protocols ospf area 0.0.0.0 interface lo0.2 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.3 set protocols ospf area 0.0.0.0 interface fe-1/2/1.4 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.2.1 设备 R3 set interfaces fe-1/2/0 unit 5 family inet address 172.16.13.3/24 set interfaces fe-1/2/1 unit 6 family inet address 172.16.34.3/24 set interfaces lo0 unit 3 family inet address 192.168.3.1/32 set protocols bgp group internal type internal set protocols bgp group internal local-address 192.168.3.1 set protocols bgp group internal export send-direct set protocols bgp group internal neighbor 192.168.1.1 set protocols bgp group internal neighbor 192.168.2.1 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 4 set protocols bgp group external neighbor 172.16.34.4 set protocols ospf area 0.0.0.0 interface lo0.3 passive set protocols ospf area 0.0.0.0 interface fe-1/2/0.5 set protocols ospf area 0.0.0.0 interface fe-1/2/1.6 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 123 set routing-options router-id 192.168.3.1 设备 R4 set interfaces fe-1/2/0 unit 7 family inet address 172.16.24.4/24 set interfaces fe-1/2/1 unit 8 family inet address 172.16.34.4/24 set interfaces lo0 unit 4 family inet address 192.168.4.1/32 set interfaces lo0 unit 4 family inet address 172.16.44.0/32 set interfaces lo0 unit 4 family inet address 172.16.144.0/32 set protocols bgp group external type external set protocols bgp group external export send-direct set protocols bgp group external peer-as 123 set protocols bgp group external neighbor 172.16.34.3 export med-10 set protocols bgp group external neighbor 172.16.34.3 export med-30 set protocols bgp group external neighbor 172.16.24.2 metric-out 20 set policy-options policy-statement med-10 from route-filter 172.16.144.0/32 exact set policy-options policy-statement med-10 then metric 10 set policy-options policy-statement med-10 then accept set policy-options policy-statement med-30 from route-filter 0.0.0.0/0 longer set policy-options policy-statement med-30 then metric 30 set policy-options policy-statement med-30 then accept set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set routing-options autonomous-system 4 set routing-options router-id 192.168.4.1",
          "commands_by_device": {
            "设备 R1": "set interfaces fe-1/2/0 unit 1 family inet address 172.16.12.1/24\nset interfaces fe-1/2/1 unit 2 family inet address 172.16.13.1/24\nset interfaces lo0 unit 1 family inet address 192.168.1.1/32\nset protocols bgp group internal type internal\nset protocols bgp group internal local-address 192.168.1.1\nset protocols bgp group internal export send-direct\nset protocols bgp group internal neighbor 192.168.2.1\nset protocols bgp group internal neighbor 192.168.3.1\nset protocols ospf area 0.0.0.0 interface lo0.1 passive\nset protocols ospf area 0.0.0.0 interface fe-1/2/0.1\nset protocols ospf area 0.0.0.0 interface fe-1/2/1.2\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset routing-options autonomous-system 123\nset routing-options router-id 192.168.1.1",
            "设备 R2": "set interfaces fe-1/2/0 unit 3 family inet address 172.16.12.2/24\nset interfaces fe-1/2/1 unit 4 family inet address 172.16.24.2/24\nset interfaces lo0 unit 2 family inet address 192.168.2.1/32\nset protocols bgp group internal type internal\nset protocols bgp group internal local-address 192.168.2.1\nset protocols bgp group internal export send-direct\nset protocols bgp group internal neighbor 192.168.1.1\nset protocols bgp group internal neighbor 192.168.3.1\nset protocols bgp group external type external\nset protocols bgp group external export send-direct\nset protocols bgp group external peer-as 4\nset protocols bgp group external neighbor 172.16.24.4\nset protocols ospf area 0.0.0.0 interface lo0.2 passive\nset protocols ospf area 0.0.0.0 interface fe-1/2/0.3\nset protocols ospf area 0.0.0.0 interface fe-1/2/1.4\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset routing-options autonomous-system 123\nset routing-options router-id 192.168.2.1",
            "设备 R3": "set interfaces fe-1/2/0 unit 5 family inet address 172.16.13.3/24\nset interfaces fe-1/2/1 unit 6 family inet address 172.16.34.3/24\nset interfaces lo0 unit 3 family inet address 192.168.3.1/32\nset protocols bgp group internal type internal\nset protocols bgp group internal local-address 192.168.3.1\nset protocols bgp group internal export send-direct\nset protocols bgp group internal neighbor 192.168.1.1\nset protocols bgp group internal neighbor 192.168.2.1\nset protocols bgp group external type external\nset protocols bgp group external export send-direct\nset protocols bgp group external peer-as 4\nset protocols bgp group external neighbor 172.16.34.4\nset protocols ospf area 0.0.0.0 interface lo0.3 passive\nset protocols ospf area 0.0.0.0 interface fe-1/2/0.5\nset protocols ospf area 0.0.0.0 interface fe-1/2/1.6\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset routing-options autonomous-system 123\nset routing-options router-id 192.168.3.1",
            "设备 R4": "set interfaces fe-1/2/0 unit 7 family inet address 172.16.24.4/24\nset interfaces fe-1/2/1 unit 8 family inet address 172.16.34.4/24\nset interfaces lo0 unit 4 family inet address 192.168.4.1/32\nset interfaces lo0 unit 4 family inet address 172.16.44.0/32\nset interfaces lo0 unit 4 family inet address 172.16.144.0/32\nset protocols bgp group external type external\nset protocols bgp group external export send-direct\nset protocols bgp group external peer-as 123\nset protocols bgp group external neighbor 172.16.34.3 export med-10\nset protocols bgp group external neighbor 172.16.34.3 export med-30\nset protocols bgp group external neighbor 172.16.24.2 metric-out 20\nset policy-options policy-statement med-10 from route-filter 172.16.144.0/32 exact\nset policy-options policy-statement med-10 then metric 10\nset policy-options policy-statement med-10 then accept\nset policy-options policy-statement med-30 from route-filter 0.0.0.0/0 longer\nset policy-options policy-statement med-30 then metric 30\nset policy-options policy-statement med-30 then accept\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset routing-options autonomous-system 4\nset routing-options router-id 192.168.4.1"
          }
        },
        {
          "title": "配置设备 R1",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R1： 配置设备接口。 [edit interfaces fe-1/2/0 unit 1] user@R1# set family inet address 172.16.12.1/24 [edit interfaces fe-1/2/1 unit 2] user@R1# set family inet address 172.16.13.1/24 [edit interfaces lo0 unit 1] user@R1# set family inet address 192.168.1.1/32 配置 BGP。 [edit protocols bgp group internal] user@R1# set type internal user@R1# set local-address 192.168.1.1 user@R1# set export send-direct user@R1# set neighbor 192.168.2.1 user@R1# set neighbor 192.168.3.1 配置 OSPF。 [edit protocols ospf area 0.0.0.0] user@R1# set interface lo0.1 passive user@R1# set interface fe-1/2/0.1 user@R1# set interface fe-1/2/1.2 配置接受直接路由的策略。 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 [edit policy-options policy-statement send-direct term 1] user@R1# set from protocol direct user@R1# set then accept 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@R1# set autonomous-system 123 user@R1# set router-id 192.168.1.1 在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R1# show interfaces fe-1/2/0 { unit 1 { family inet { address 172.16.12.1/24; } } } fe-1/2/1 { unit 2 { family inet { address 172.16.13.1/24; } } } lo0 { unit 1 { family inet { address 192.168.1.1/32; } } } user@R1# show protocols bgp { group internal { type internal; local-address 192.168.1.1; export send-direct; neighbor 192.168.2.1; neighbor 192.168.3.1; } } ospf { area 0.0.0.0 { interface lo0.1 { passive; } interface fe-1/2/0.1; interface fe-1/2/1.2; } } user@R1# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R1# show routing-options autonomous-system 123; router-id 192.168.1.1; 如果完成设备配置，请从配置模式输入 commit 。",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置设备接口。",
                  "code": [
                    "[edit interfaces fe-1/2/0 unit 1]",
                    "user@R1# set family inet address 172.16.12.1/24",
                    "[edit interfaces fe-1/2/1 unit 2]",
                    "user@R1# set family inet address 172.16.13.1/24",
                    "[edit interfaces lo0 unit 1]",
                    "user@R1# set family inet address 192.168.1.1/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group internal]",
                    "user@R1# set type internal",
                    "user@R1# set local-address 192.168.1.1",
                    "user@R1# set export send-direct",
                    "user@R1# set neighbor 192.168.2.1",
                    "user@R1# set neighbor 192.168.3.1"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 OSPF。",
                  "code": [
                    "[edit protocols ospf area 0.0.0.0]",
                    "user@R1# set interface lo0.1 passive",
                    "user@R1# set interface fe-1/2/0.1",
                    "user@R1# set interface fe-1/2/1.2"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置接受直接路由的策略。",
                  "code": [
                    "[edit policy-options policy-statement send-direct term 1]",
                    "user@R1# set from protocol direct",
                    "user@R1# set then accept"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置路由器 ID 和自治系统 (AS) 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@R1# set autonomous-system 123",
                    "user@R1# set router-id 192.168.1.1"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。",
              "code": [
                "user@R1#show interfacesfe-1/2/0 {\n    unit 1 {\n        family inet {\n            address 172.16.12.1/24;\n        }\n    }\n}\nfe-1/2/1 {\n    unit 2 {\n        family inet {\n            address 172.16.13.1/24;\n        }\n    }\n}\nlo0 {\n    unit 1 {\n        family inet {\n            address 192.168.1.1/32;\n        }\n    }\n}",
                "user@R1#show protocolsbgp {\n    group internal {\n        type internal;\n        local-address 192.168.1.1;\n        export send-direct;\n        neighbor 192.168.2.1;\n        neighbor 192.168.3.1;\n    }\n}\nospf {\n    area 0.0.0.0 {\n        interface lo0.1 {\n            passive;\n        }\n        interface fe-1/2/0.1;\n        interface fe-1/2/1.2;\n    }\n}",
                "user@R1#show policy-optionspolicy-statement send-direct {\n    term 1 {\n        from protocol direct;\n        then accept;\n    }\n}",
                "user@R1#show routing-optionsautonomous-system 123;\nrouter-id 192.168.1.1;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 R2",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R2： 配置设备接口。 [edit interfaces fe-1/2/0 unit 3] user@R2# set family inet address 172.16.12.21/24 [edit interfaces fe-1/2/1 unit 4] user@R2# set family inet address 172.16.24.2/24 [edit interfaces lo0 unit 2] user@R2# set family inet address 192.168.2.1/32 配置 BGP。 [edit protocols bgp group internal] user@R2# set type internal user@R2# set local-address 192.168.2.1 user@R2# set export send-direct user@R2# set neighbor 192.168.1.1 user@R2# set neighbor 192.168.3.1 [edit protocols bgp group external] user@R2# set type external user@R2# set export send-direct user@R2# set peer-as 4 user@R2# set neighbor 172.16.24.4 配置 OSPF。 [edit protocols ospf area 0.0.0.0] user@R2# set interface lo0.2 passive user@R2# set interface fe-1/2/0.3 user@R2# set interface fe-1/2/1.4 配置接受直接路由的策略。 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 [edit policy-options policy-statement send-direct term 1] user@R2# set from protocol direct user@R2# set then accept 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@R2# set autonomous-system 123 user@R2# set router-id 192.168.2.1 在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R2# show interfaces fe-1/2/0 { unit 3 { family inet { address 172.16.12.2/24; } } } fe-1/2/1 { unit 4 { family inet { address 172.16.24.2/24; } } } lo0 { unit 2 { family inet { address 192.168.2.1/32; } } } user@R2# show protocols bgp { group internal { type internal; local-address 192.168.2.1; export send-direct; neighbor 192.168.1.1; neighbor 192.168.3.1; } group external { type external; export send-direct; peer-as 4; neighbor 172.16.24.4; } } ospf { area 0.0.0.0 { interface lo0.2 { passive; } interface fe-1/2/0.3; interface fe-1/2/1.4; } } user@R2# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R2# show routing-options autonomous-system 123; router-id 192.168.2.1; 如果完成设备配置，请从配置模式输入 commit 。",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置设备接口。",
                  "code": [
                    "[edit interfaces fe-1/2/0 unit 3]",
                    "user@R2# set family inet address 172.16.12.21/24",
                    "[edit interfaces fe-1/2/1 unit 4]",
                    "user@R2# set family inet address 172.16.24.2/24",
                    "[edit interfaces lo0 unit 2]",
                    "user@R2# set family inet address 192.168.2.1/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group internal]",
                    "user@R2# set type internal",
                    "user@R2# set local-address 192.168.2.1",
                    "user@R2# set export send-direct",
                    "user@R2# set neighbor 192.168.1.1",
                    "user@R2# set neighbor 192.168.3.1",
                    "[edit protocols bgp group external]",
                    "user@R2# set type external",
                    "user@R2# set export send-direct",
                    "user@R2# set peer-as 4",
                    "user@R2# set neighbor 172.16.24.4"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 OSPF。",
                  "code": [
                    "[edit protocols ospf area 0.0.0.0]",
                    "user@R2# set interface lo0.2 passive",
                    "user@R2# set interface fe-1/2/0.3",
                    "user@R2# set interface fe-1/2/1.4"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置接受直接路由的策略。",
                  "code": [
                    "[edit policy-options policy-statement send-direct term 1]",
                    "user@R2# set from protocol direct",
                    "user@R2# set then accept"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置路由器 ID 和自治系统 (AS) 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@R2# set autonomous-system 123",
                    "user@R2# set router-id 192.168.2.1"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。",
              "code": [
                "user@R2#show interfacesfe-1/2/0 {\n    unit 3 {\n        family inet {\n            address 172.16.12.2/24;\n        }\n    }\n}\nfe-1/2/1 {\n    unit 4 {\n        family inet {\n            address 172.16.24.2/24;\n        }\n    }\n}\nlo0 {\n    unit 2 {\n        family inet {\n            address 192.168.2.1/32;\n        }\n    }\n}",
                "user@R2#show protocolsbgp {\n    group internal {\n        type internal;\n        local-address 192.168.2.1;\n        export send-direct;\n        neighbor 192.168.1.1;\n        neighbor 192.168.3.1;\n    }\n    group external {\n        type external;\n        export send-direct;\n        peer-as 4;\n        neighbor 172.16.24.4;\n    }\n}\nospf {\n    area 0.0.0.0 {\n        interface lo0.2 {\n            passive;\n        }\n        interface fe-1/2/0.3;\n        interface fe-1/2/1.4;\n    }\n}",
                "user@R2#show policy-optionspolicy-statement send-direct {\n    term 1 {\n        from protocol direct;\n        then accept;\n    }\n}",
                "user@R2#show routing-optionsautonomous-system 123;\nrouter-id 192.168.2.1;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 R3",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R3： 配置设备接口。 [edit interfaces fe-1/2/0 unit 5] user@R3# set family inet address 172.16.13.3/24 [edit interfaces fe-1/2/1 unit 6] user@R3# set family inet address 172.16.34.3/24 [edit interfaces lo0 unit 3] user@R3# set family inet address 192.168.3.1/32 配置 BGP。 [edit protocols bgp group internal] user@R3# set type internal user@R3# set local-address 192.168.3.1 user@R3# set export send-direct user@R3# set neighbor 192.168.1.1 user@R3# set neighbor 192.168.2.1 [edit protocols bgp group external] user@R3# set type external user@R3# set export send-direct user@R3# set peer-as 4 user@R3# set neighbor 172.16.34.4 配置 OSPF。 [edit protocols ospf area 0.0.0.0] user@R3# set interface lo0.3 passive user@R3# set interface fe-1/2/0.5 user@R3# set interface fe-1/2/1.6 配置接受直接路由的策略。 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 [edit policy-options policy-statement send-direct term 1] user@R3# set from protocol direct user@R3# set then accept 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@R3# set autonomous-system 123 user@R3# set router-id 192.168.3.1 在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R3# show interfaces fe-1/2/0 { unit 5 { family inet { address 172.16.13.3/24; } } } fe-1/2/1 { unit 6 { family inet { address 172.16.34.3/24; } } } lo0 { unit 3 { family inet { address 192.168.3.1/32; } } } user@R3# show protocols bgp { group internal { type internal; local-address 192.168.3.1; export send-direct; neighbor 192.168.1.1; neighbor 192.168.2.1; } group external { type external; export send-direct; peer-as 4; neighbor 172.16.34.4; } } ospf { area 0.0.0.0 { interface lo0.3 { passive; } interface fe-1/2/0.5; interface fe-1/2/1.6; } } user@R3# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R3# show routing-options autonomous-system 123; router-id 192.168.3.1; 如果完成设备配置，请从配置模式输入 commit 。",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置设备接口。",
                  "code": [
                    "[edit interfaces fe-1/2/0 unit 5]",
                    "user@R3# set family inet address 172.16.13.3/24",
                    "[edit interfaces fe-1/2/1 unit 6]",
                    "user@R3# set family inet address 172.16.34.3/24",
                    "[edit interfaces lo0 unit 3]",
                    "user@R3# set family inet address 192.168.3.1/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group internal]",
                    "user@R3# set type internal",
                    "user@R3# set local-address 192.168.3.1",
                    "user@R3# set export send-direct",
                    "user@R3# set neighbor 192.168.1.1",
                    "user@R3# set neighbor 192.168.2.1",
                    "[edit protocols bgp group external]",
                    "user@R3# set type external",
                    "user@R3# set export send-direct",
                    "user@R3# set peer-as 4",
                    "user@R3# set neighbor 172.16.34.4"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 OSPF。",
                  "code": [
                    "[edit protocols ospf area 0.0.0.0]",
                    "user@R3# set interface lo0.3 passive",
                    "user@R3# set interface fe-1/2/0.5",
                    "user@R3# set interface fe-1/2/1.6"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置接受直接路由的策略。",
                  "code": [
                    "[edit policy-options policy-statement send-direct term 1]",
                    "user@R3# set from protocol direct",
                    "user@R3# set then accept"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置路由器 ID 和自治系统 (AS) 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@R3# set autonomous-system 123",
                    "user@R3# set router-id 192.168.3.1"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。",
              "code": [
                "user@R3#show interfacesfe-1/2/0 {\n    unit 5 {\n        family inet {\n            address 172.16.13.3/24;\n        }\n    }\n}\nfe-1/2/1 {\n    unit 6 {\n        family inet {\n            address 172.16.34.3/24;\n        }\n    }\n}\nlo0 {\n    unit 3 {\n        family inet {\n            address 192.168.3.1/32;\n        }\n    }\n}",
                "user@R3#show protocolsbgp {\n    group internal {\n        type internal;\n        local-address 192.168.3.1;\n        export send-direct;\n        neighbor 192.168.1.1;\n        neighbor 192.168.2.1;\n    }\n    group external {\n        type external;\n        export send-direct;\n        peer-as 4;\n        neighbor 172.16.34.4;\n    }\n}\nospf {\n    area 0.0.0.0 {\n        interface lo0.3 {\n            passive;\n        }\n        interface fe-1/2/0.5;\n        interface fe-1/2/1.6;\n    }\n}",
                "user@R3#show policy-optionspolicy-statement send-direct {\n    term 1 {\n        from protocol direct;\n        then accept;\n    }\n}",
                "user@R3#show routing-optionsautonomous-system 123;\nrouter-id 192.168.3.1;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 R4",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R4： 配置设备接口。 [edit interfaces fe-1/2/0 unit 7] user@R4# set family inet address 172.16.24.4/24 [edit interfaces fe-1/2/1 unit 8] user@R4# set family inet address 172.16.34.4/24 [edit interfaces lo0 unit 4] user@R4# set family inet address 192.168.4.1/32 user@R4# set family inet address 172.16.44.0/32 user@R4# set family inet address 172.16.144.0/32 设备 R4 具有多个环路接口地址，用于模拟播发前缀。 配置接受直接路由的策略。 此方案的其他有用选项可能是接受通过 OSPF 或本地路由获知的路由。 [edit policy-options policy-statement send-direct term 1] user@R4# set from protocol direct user@R4# set then accept 配置 BGP。 [edit protocols bgp group external] user@R4# set type external user@R4# set export send-direct user@R4# set peer-as 123 配置两个 MED 策略。 [edit policy-options] set policy-statement med-10 from route-filter 172.16.144.0/32 exact set policy-statement med-10 then metric 10 set policy-statement med-10 then accept set policy-statement med-30 from route-filter 0.0.0.0/0 longer set policy-statement med-30 then metric 30 set policy-statement med-30 then accept 配置两个 EBGP 邻接方，将两个 MED 策略应用于设备 R3，并将 MED 值 20 应用于设备 R2。 [edit protocols bgp group external] user@R4# set neighbor 172.16.34.3 export med-10 user@R4# set neighbor 172.16.34.3 export med-30 user@R4# set neighbor 172.16.24.2 metric-out 20 配置路由器 ID 和自治系统 (AS) 编号。 [edit routing-options] user@R4# set autonomous-system 4 user@R4# set router-id 192.168.4.1 在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R4# show interfaces fe-1/2/0 { unit 7 { family inet { address 172.16.24.4/24; } } } fe-1/2/1 { unit 8 { family inet { address 172.16.34.4/24; } } } lo0 { unit 4 { family inet { address 192.168.4.1/32; address 172.16.44.0/32; address 172.16.144.0/32; } } } user@R4# show protocols bgp { group external { type external; export send-direct; peer-as 123; neighbor 172.16.24.2 { metric-out 20; } neighbor 172.16.34.3 { export [ med-10 med-30 ]; } } } user@R4# show policy-options policy-statement med-10 { from { route-filter 172.16.144.0/32 exact; } then { metric 10; accept; } } policy-statement med-30 { from { route-filter 0.0.0.0/0 longer; } then { metric 30; accept; } } policy-statement send-direct { term 1 { from protocol direct; then accept; } } user@R4# show routing-options autonomous-system 4; router-id 192.168.4.1; 如果完成设备配置，请从配置模式输入 commit 。",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置设备接口。",
                  "code": [
                    "[edit interfaces fe-1/2/0 unit 7]",
                    "user@R4# set family inet address 172.16.24.4/24",
                    "[edit interfaces fe-1/2/1 unit 8]",
                    "user@R4# set family inet address 172.16.34.4/24",
                    "[edit interfaces lo0 unit 4]",
                    "user@R4# set family inet address 192.168.4.1/32",
                    "user@R4# set family inet address 172.16.44.0/32",
                    "user@R4# set family inet address 172.16.144.0/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置接受直接路由的策略。",
                  "code": [
                    "[edit policy-options policy-statement send-direct term 1]",
                    "user@R4# set from protocol direct",
                    "user@R4# set then accept"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group external]",
                    "user@R4# set type external",
                    "user@R4# set export send-direct",
                    "user@R4# set peer-as 123"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置两个 MED 策略。",
                  "code": [
                    "[edit policy-options]",
                    "set policy-statement med-10 from route-filter 172.16.144.0/32 exact ",
                    "set policy-statement med-10 then metric 10 ",
                    "set policy-statement med-10 then accept ",
                    "set policy-statement med-30 from route-filter 0.0.0.0/0 longer ",
                    "set policy-statement med-30 then metric 30 ",
                    "set policy-statement med-30 then accept"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置两个 EBGP 邻接方，将两个 MED 策略应用于设备 R3，并将 MED 值 20 应用于设备 R2。",
                  "code": [
                    "[edit protocols bgp group external]",
                    "user@R4# set neighbor 172.16.34.3 export med-10",
                    "user@R4# set neighbor 172.16.34.3 export med-30",
                    "user@R4# set neighbor 172.16.24.2 metric-out 20"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置路由器 ID 和自治系统 (AS) 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@R4# set autonomous-system 4",
                    "user@R4# set router-id 192.168.4.1"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show protocols 、 show policy-options 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。",
              "code": [
                "user@R4#show interfacesfe-1/2/0 {\n    unit 7 {\n        family inet {\n            address 172.16.24.4/24;\n        }\n    }\n}\nfe-1/2/1 {\n    unit 8 {\n        family inet {\n            address 172.16.34.4/24;\n        }\n    }\n}\nlo0 {\n    unit 4 {\n        family inet {\n            address 192.168.4.1/32;\n            address 172.16.44.0/32;\n            address 172.16.144.0/32;\n        }\n    }\n}",
                "user@R4#show protocolsbgp {\n    group external {\n        type external;\n        export send-direct;\n        peer-as 123;\n        neighbor 172.16.24.2 {\n            metric-out 20;\n        }\n        neighbor 172.16.34.3 {\n            export [ med-10 med-30 ];\n        }\n    }\n}",
                "user@R4#show policy-optionspolicy-statement med-10 {\n    from {\n        route-filter 172.16.144.0/32 exact;\n    }\n    then {\n        metric 10;\n        accept;\n    }\n}\npolicy-statement med-30 {\n    from {\n        route-filter 0.0.0.0/0 longer;\n    }\n    then {\n        metric 30;\n        accept;\n    }\n}\npolicy-statement send-direct {\n    term 1 {\n        from protocol direct;\n        then accept;\n    }\n}",
                "user@R4#show routing-optionsautonomous-system 4;\nrouter-id 192.168.4.1;"
              ]
            }
          ]
        }
      ]
    }
  ],
  "content": "此示例说明如何配置使用路由筛选器修改要在 BGP 更新消息中播发的多出口鉴别器 （MED） 指标的策略。 要求 在配置此示例之前，不需要除设备初始化之外的特殊配置"
}