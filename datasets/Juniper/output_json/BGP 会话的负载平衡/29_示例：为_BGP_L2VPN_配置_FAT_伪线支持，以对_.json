{
  "title": "示例：为 BGP L2VPN 配置 FAT 伪线支持，以对 MPLS 流量进行负载平衡",
  "sections": [
    {
      "title": "要求",
      "level": 3,
      "content": "此示例使用以下硬件和软件组件： 五个 MX 系列路由器 在所有设备上运行的 Junos OS 16.1 或更高版本 在为 BGP L2VPN 配置 FAT 伪线支持之前，请确保配置路由和信令协议。 此示例使用以下硬件和软件组件： 五个 MX 系列路由器 在所有设备上运行的 Junos OS 16.1 或更高版本 在为 BGP L2VPN 配置 FAT 伪线支持之前，请确保配置路由和信令协议。"
    },
    {
      "title": "概述",
      "level": 3,
      "content": "Junos OS 允许仅在标签边缘路由器 （LER） 上配置 BGP 信号伪线（如 L2VPN）支持的流感知传输 （FAT） 流标签。这会导致中转路由器或标签交换路由器 （LSR） 跨等价多路径 （ECMP） 路径或链路聚合组 （LAG） 对 MPLS 数据包执行负载平衡，而无需对有效负载进行深度数据包检测。FAT 流标签可用于 VPWS 和 VPLS 伪线的 LDP 信号转发等效类（FEC 128 和 FEC 129）伪线。 图 15，显示了对设备 PE1 和设备 PE2 上配置的 BGP L2VPN 的 FAT 伪线支持。",
      "sections": [
        {
          "title": "拓扑学",
          "level": 4,
          "content": "图 15，显示了对设备 PE1 和设备 PE2 上配置的 BGP L2VPN 的 FAT 伪线支持。",
          "images": [
            "BGP 会话的负载平衡\\images\\29_示例：为_BGP_L2VPN_配置_FA_1.png"
          ]
        }
      ]
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改详细信息，以便与网络配置匹配，将命令复制并粘贴到 [edit] 层级的 CLI 中，然后从配置模式进入 commit 。 CE1 set interfaces ge-0/0/0 vlan-tagging set interfaces ge-0/0/0 unit 600 vlan-id 600 set interfaces ge-0/0/0 unit 600 family inet address 10.1.1.1/24 set interfaces lo0 unit 0 family inet address 10.255.255.8/32 PE1 set interfaces ge-0/0/0 vlan-tagging set interfaces ge-0/0/0 mtu 1600 set interfaces ge-0/0/0 encapsulation vlan-ccc set interfaces ge-0/0/0 unit 300 encapsulation vlan-ccc set interfaces ge-0/0/0 unit 300 vlan-id 600 set interfaces ge-0/0/0 unit 600 encapsulation vlan-vpls set interfaces ge-0/0/0 unit 600 vlan-id 600 set interfaces ge-0/0/0 unit 600 family vpls set interfaces ge-0/0/1 unit 0 family inet address 1.0.0.1/24 set interfaces ge-0/0/1 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.255.1/32 set routing-options nonstop-routing set routing-options router-id 10.255.255.1 set routing-options autonomous-system 100 set routing-options forwarding-table export exp-to-frwd set protocols rsvp interface all set protocols rsvp interface ge-0/0/1.0 set protocols rsvp interface lo0.0 set protocols mpls label-switched-path to-pe2 to 10.255.255.4 set protocols mpls interface ge-0/0/1.0 set protocols bgp group vpls-pe type internal set protocols bgp group vpls-pe local-address 10.255.255.1 set protocols bgp group vpls-pe family l2vpn auto-discovery-only set protocols bgp group vpls-pe family l2vpn signaling set protocols bgp group vpls-pe neighbor 10.255.255.4 set protocols bgp group vpls-pe neighbor 10.255.255.2 set protocols ospf traffic-engineering set protocols ospf area 0.0.0.0 interface lo0.0 passive set protocols ospf area 0.0.0.0 interface ge-0/0/1.0 set policy-options policy-statement exp-to-frwd term 0 from community vpls-com set policy-options policy-statement exp-to-frwd term 0 then install-nexthop lsp to-pe2 set policy-options policy-statement exp-to-frwd term 0 then accept set policy-options community vpls-com members target:100:100 set routing-instances l2vpn-inst instance-type l2vpn set routing-instances l2vpn-inst interface ge-0/0/0.300 set routing-instances l2vpn-inst route-distinguisher 10.255.255.1:200 set routing-instances l2vpn-inst vrf-target target:100:100 set routing-instances l2vpn-inst protocols l2vpn encapsulation-type ethernet-vlan set routing-instances l2vpn-inst protocols l2vpn site pe1 site-identifier 1 set routing-instances l2vpn-inst protocols l2vpn site pe1 interface ge-0/0/0.300 remote-site-id 2 set routing-instances l2vpn-inst protocols l2vpn flow-label-transmit set routing-instances l2vpn-inst protocols l2vpn flow-label-receive set routing-instances vpl1 instance-type vpls set routing-instances vpl1 interface ge-0/0/0.600 set routing-instances vpl1 route-distinguisher 10.255.255.1:100 set routing-instances vpl1 vrf-target target:100:100 set routing-instances vpl1 protocols vpls site-range 10 set routing-instances vpl1 protocols vpls no-tunnel-services set routing-instances vpl1 protocols vpls site vpl1PE1 site-identifier 1 set routing-instances vpl1 protocols vpls flow-label-transmit set routing-instances vpl1 protocols vpls flow-label-receive P set interfaces ge-0/0/0 unit 0 family inet address 1.0.0.2/24 set interfaces ge-0/0/0 unit 0 family mpls set interfaces ge-0/0/1 unit 0 family inet address 2.0.0.1/24 set interfaces ge-0/0/1 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.255.2/32 set routing-options router-id 10.255.255.2 set routing-options autonomous-system 100 set protocols rsvp interface ge-0/0/1.0 set protocols rsvp interface ge-0/0/0.0 set protocols rsvp interface lo0.0 set protocols mpls interface ge-0/0/0.0 set protocols mpls interface ge-0/0/1.0 set protocols bgp group vpls-pe type internal set protocols bgp group vpls-pe local-address 10.255.255.2 set protocols bgp group vpls-pe family l2vpn signaling set protocols bgp group vpls-pe neighbor 10.255.255.1 set protocols bgp group vpls-pe neighbor 10.255.255.4 deactivate protocols bgp set protocols ospf traffic-engineering set protocols ospf area 0.0.0.0 interface lo0.0 passive set protocols ospf area 0.0.0.0 interface ge-0/0/0.0 set protocols ospf area 0.0.0.0 interface ge-0/0/1.0 PE2 set interfaces ge-0/0/0 unit 0 family inet address 2.0.0.2/24 set interfaces ge-0/0/0 unit 0 family mpls set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 mtu 1600 set interfaces ge-0/0/1 encapsulation vlan-ccc set interfaces ge-0/0/1 unit 300 encapsulation vlan-ccc set interfaces ge-0/0/1 unit 300 vlan-id 600 set interfaces ge-0/0/1 unit 600 encapsulation vlan-vpls set interfaces ge-0/0/1 unit 600 vlan-id 600 set interfaces ge-0/0/1 unit 600 family vpls set interfaces lo0 unit 0 family inet address 10.255.255.4/32 set routing-options router-id 10.255.255.4 set routing-options autonomous-system 100 set routing-options forwarding-table export exp-to-frwd set protocols rsvp interface all set protocols rsvp interface ge-0/0/1.0 set protocols rsvp interface lo0.0 set protocols mpls label-switched-path to-pe1 to 10.255.255.1 set protocols mpls interface ge-0/0/0.0 set protocols bgp group vpls-pe type internal set protocols bgp group vpls-pe local-address 10.255.255.4 set protocols bgp group vpls-pe family l2vpn auto-discovery-only set protocols bgp group vpls-pe family l2vpn signaling set protocols bgp group vpls-pe neighbor 10.255.255.1 set protocols bgp group vpls-pe neighbor 10.255.255.2 set protocols ospf traffic-engineering set protocols ospf area 0.0.0.0 interface lo0.0 passive set protocols ospf area 0.0.0.0 interface ge-0/0/0.0 set policy-options policy-statement exp-to-frwd term 0 from community vpls-com set policy-options policy-statement exp-to-frwd term 0 then install-nexthop lsp to-pe1 set policy-options policy-statement exp-to-frwd term 0 then accept set policy-options community vpls-com members target:100:100 set routing-instances l2vpn-inst instance-type l2vpn set routing-instances l2vpn-inst interface ge-0/0/1.300 set routing-instances l2vpn-inst route-distinguisher 10.255.255.4:200 set routing-instances l2vpn-inst vrf-target target:100:100 set routing-instances l2vpn-inst protocols l2vpn encapsulation-type ethernet-vlan set routing-instances l2vpn-inst protocols l2vpn site pe2 site-identifier 2 set routing-instances l2vpn-inst protocols l2vpn site pe2 interface ge-0/0/1.300 remote-site-id 1 set routing-instances l2vpn-inst protocols l2vpn flow-label-transmit set routing-instances l2vpn-inst protocols l2vpn flow-label-receive set routing-instances vpl1 instance-type vpls set routing-instances vpl1 interface ge-0/0/1.600 set routing-instances vpl1 route-distinguisher 10.255.255.4:100 set routing-instances vpl1 vrf-target target:100:100 set routing-instances vpl1 protocols vpls site-range 10 set routing-instances vpl1 protocols vpls no-tunnel-services set routing-instances vpl1 protocols vpls site vpl1PE2 site-identifier 2 set routing-instances vpl1 protocols vpls flow-label-transmit set routing-instances vpl1 protocols vpls flow-label-receive deactivate routing-instances vpl1 CE2 set interfaces ge-0/0/0 vlan-tagging set interfaces ge-0/0/0 unit 600 vlan-id 600 set interfaces ge-0/0/0 unit 600 family inet address 10.1.1.2/24 set interfaces lo0 unit 0 family inet address 10.255.255.9/32 以下示例要求您在配置层次结构中导航各个级别。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 PE1： 配置接口。 [edit interfaces] user@PE1# set ge-0/0/0 vlan-tagging user@PE1# set ge-0/0/0 mtu 1600 user@PE1# set ge-0/0/0 encapsulation vlan-ccc user@PE1# set ge-0/0/0 unit 300 encapsulation vlan-ccc user@PE1# set ge-0/0/0 unit 300 vlan-id 600 user@PE1# set ge-0/0/0 unit 600 encapsulation vlan-vpls user@PE1# set ge-0/0/0 unit 600 vlan-id 600 user@PE1# set ge-0/0/0 unit 600 family vpls deactivate interfaces ge-0/0/0 unit 600 user@PE1# set ge-0/0/1 unit 0 family inet address 1.0.0.1/24 user@PE1# set ge-0/0/1 unit 0 family mpls user@PE1# set lo0 unit 0 family inet address 10.255.255.1/32 配置不间断路由，并配置路由器 ID。 [edit routing-options] user@PE1# set nonstop-routing user@PE1# set router-id 10.255.255.1 配置自治系统 (AS) 编号，并使用导出语句将策略应用到本地路由器的转发表。 [edit routing-options] user@PE1# set autonomous-system 100 user@PE1# set forwarding-table export exp-to-frwd 在接口上配置 RSVP 协议。 [edit protocols rsvp] user@PE1# set interface all user@PE1# set interface ge-0/0/1.0 user@PE1# set interface lo0.0 将标签交换路径属性应用于 MPLS 协议，并配置接口。 [edit protocols mpls] user@PE1# set label-switched-path to-pe2 to 10.255.255.4 user@PE1# set interface ge-0/0/1.0 定义对等组，并为对等组 vpls-pe 配置 BGP 会话的本地端地址地址。 [edit protocols bgp group vpls-pe] user@PE1# set type internal user@PE1# set local-address 10.255.255.1 在更新中为 NLRI 配置协议家族的属性。 [edit protocols bgp group vpls-pe] user@PE1# set family l2vpn auto-discovery-only user@PE1# set family l2vpn signaling 为对等组 vpls-pe 配置邻居。 [edit protocols bgp group vpls-pe] user@PE1# set neighbor 10.255.255.4 user@PE1# set neighbor 10.255.255.2 配置流量工程，并配置 OSPF 区域 0.0.0.0 的接口。 [edit protocols ospf] user@PE1# set traffic-engineering user@PE1# set area 0.0.0.0 interface lo0.0 passive user@PE1# set area 0.0.0.0 interface ge-0/0/1.0 配置路由策略和 BGP 社区信息。 [edit policy-options] user@PE1# set policy-statement exp-to-fwd term 0 from community vpls-com user@PE1# set policy-statement exp-to-fwd term 0 then install-nexthop lsp to-pe2 user@PE1# set policy-statement exp-to-fwd term 0 then accept user@PE1# set community vpls-com members target:100:100 配置路由实例的类型并配置接口。 [edit routing-instances l2vpn-inst] user@PE1# set instance-type l2vpn user@PE1# set interface ge-0/0/0.300 例如 l2vpn-inst ，配置路由识别符，并配置 VRF 目标社区。 [edit routing-instances l2vpn-inst] user@PE1# set route-distinguisher 10.255.255.1:200 user@PE1# set vrf-target target:100:100 配置 L2VPN 协议所需的封装类型。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE1# set encapsulation-type ethernet-vlan 配置连接到提供商设备的站点。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE1# set site pe1 site-identifier 1 user@PE1# set site pe1 interface ge-0/0/0.300 remote-site-id 2 为路由实例配置 L2VPN 协议，以提供播发功能以在接收方向上将流标签弹出到远程 PE，并提供播发功能以将流标签沿传输方向推送到远程 PE。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE1# set flow-label-transmit user@PE1# set flow-label-receive [edit routing-instances vpl1] user@PE1# set instance-type vpls user@PE1# set interface ge-0/0/0.600 例如 vp1 ，配置路由识别符，并配置 VRF 目标社区。 [edit routing-instances vpl1] user@PE1# set route-distinguisher 10.255.255.1:100 user@PE1# set vrf-target target:100:100 为 VPLS 域分配最大站点标识符。 [edit routing-instances vpl1 protocols vpls] user@PE1# set site-range 10 配置为不使用 VPLS 实例的隧道服务，并为连接到提供商设备的站点分配站点标识符。 [edit routing-instances vpl1 protocols vpls] user@PE1# set no-tunnel-services user@PE1# set site vpl1PE1 site-identifier 1 为路由实例配置 VPLS 协议，以提供播发功能以在接收方向上将流标签弹出到远程 PE，并提供播发功能以在传输方向上将流标签推送到远程 PE。 [edit routing-instances vpl1 protocols vpls] user@PE1# set flow-label-transmit user@PE1# set flow-label-receive 在配置模式下，输入 show interfaces 、 show protocols 、 show routing-instances show policy-options 和 show routing-options 命令来确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@PE1# show interfaces ge-0/0/0 { vlan-tagging; mtu 1600; encapsulation vlan-ccc; unit 300 { encapsulation vlan-ccc; vlan-id 600; } unit 600 { encapsulation vlan-vpls; vlan-id 600; family vpls; } } ge-0/0/1 { unit 0 { family inet { address 1.0.0.1/24; } family mpls; } } lo0 { unit 0 { family inet { address 10.255.255.1/32; } } } user@PE1# show protocols rsvp { interface all; interface ge-0/0/1.0; interface lo0.0; } mpls { label-switched-path to-pe2 { to 10.255.255.4; } interface ge-0/0/1.0; } bgp { group vpls-pe { type internal; local-address 10.255.255.1; family l2vpn { auto-discovery-only; signaling; } neighbor 10.255.255.4; neighbor 10.255.255.2; } } ospf { traffic-engineering; area 0.0.0.0 { interface lo0.0 { passive; } interface ge-0/0/1.0; } } user@PE1# show policy-options policy-statement exp-to-frwd { term 0 { from community vpls-com; then { install-nexthop lsp to-pe2; accept; } } } community vpls-com members target:100:100; user@PE1# show routing-instances l2vpn-inst { instance-type l2vpn; interface ge-0/0/0.300; route-distinguisher 10.255.255.1:200; vrf-target target:100:100; protocols { l2vpn { encapsulation-type ethernet-vlan; site pe1 { site-identifier 1; interface ge-0/0/0.300 { remote-site-id 2; } } flow-label-transmit; flow-label-receive; } } } vpl1 { instance-type vpls; interface ge-0/0/0.600; route-distinguisher 10.255.255.1:100; vrf-target target:100:100; protocols { vpls { site-range 10; no-tunnel-services; site vpl1PE1 { site-identifier 1; } flow-label-transmit; flow-label-receive; } } } user@PE1# show routing-options nonstop-routing; router-id 10.255.255.1; autonomous-system 100; forwarding-table { export exp-to-frwd; } 确认配置工作正常。 目的 验证 BGP 摘要信息。 验证 BGP 摘要信息。 在操作模式下，输入 show bgp summary 命令。 user@PE1> show bgp summary Groups: 1 Peers: 2 Down peers: 1 Table Tot Paths Act Paths Suppressed History Damp State Pending bgp.l2vpn.0 1 1 0 0 0 0 Peer AS InPkt OutPkt OutQ Flaps Last Up/Dwn State|#Active/Received/Accepted/Damped... 10.255.255.2 100 0 0 0 0 2d 12:54:28 Active 10.255.255.4 100 8121 8093 0 0 2d 12:53:56 Establ bgp.l2vpn.0: 1/1/1/0 l2vpn-inst.l2vpn.0: 1/1/1/0 意义 输出显示 BGP 摘要信息。 输出显示 BGP 摘要信息。 目的 验证第 2 层 VPN 连接信息。 验证第 2 层 VPN 连接信息。 在操作模式下，运行 show l2vpn connections 命令以显示第 2 层 VPN 连接信息。 user@PE1> show l2vpn connections Layer-2 VPN connections: Legend for connection status (St) EI -- encapsulation invalid NC -- interface encapsulation not CCC/TCC/VPLS EM -- encapsulation mismatch WE -- interface and instance encaps not same VC-Dn -- Virtual circuit down NP -- interface hardware not present CM -- control-word mismatch -> -- only outbound connection is up CN -- circuit not provisioned <- -- only inbound connection is up OR -- out of range Up -- operational OL -- no outgoing label Dn -- down LD -- local site signaled down CF -- call admission control failure RD -- remote site signaled down SC -- local and remote site ID collision LN -- local site not designated LM -- local site ID not minimum designated RN -- remote site not designated RM -- remote site ID not minimum designated XX -- unknown connection status IL -- no incoming label MM -- MTU mismatch MI -- Mesh-Group ID not available BK -- Backup connection ST -- Standby connection PF -- Profile parse failure PB -- Profile busy RS -- remote site standby SN -- Static Neighbor LB -- Local site not best-site RB -- Remote site not best-site VM -- VLAN ID mismatch Legend for interface status Up -- operational Dn -- down Instance: l2vpn-inst Edge protection: Not-Primary Local site: pe1 (1) connection-site Type St Time last up # Up trans 2 rmt Up Jun 22 14:46:50 2015 1 Remote PE: 10.255.255.4, Negotiated control-word: Yes (Null) Incoming label: 800003, Outgoing label: 800002 Local interface: ge-0/0/0.300, Status: Up, Encapsulation: VLAN Flow Label Transmit: Yes, Flow Label Receive: Yes 意义 输出显示第 2 层 VPN 连接信息以及流标签传输和流标签接收信息。 输出显示第 2 层 VPN 连接信息以及流标签传输和流标签接收信息。 目的 验证是否学习了预期的路由。 验证是否学习了预期的路由。 在操作模式下，运行 show route 命令以在路由表中显示路由。 user@PE1> show route inet.0: 51 destinations, 51 routes (51 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 1.0.0.0/24 *[Direct/0] 2d 12:48:34 > via ge-0/0/1.0 1.0.0.1/32 *[Local/0] 2d 12:48:34 Local via ge-0/0/1.0 2.0.0.0/24 *[OSPF/10] 2d 12:48:24, metric 2 > to 1.0.0.2 via ge-0/0/1.0 10.4.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.5.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.6.128.0/17 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.9.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.10.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.13.4.0/23 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.13.10.0/23 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.82.0.0/15 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.84.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.85.12.0/22 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.92.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.94.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.99.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.102.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.102.160.0/19 *[Direct/0] 2d 12:48:34 > via fxp0.0 10.102.169.99/32 *[Local/0] 2d 12:48:34 Local via fxp0.0 10.150.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.155.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.157.64.0/19 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.160.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.204.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.205.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.206.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.207.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.209.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.212.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.213.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.214.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.215.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.216.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.218.13.0/24 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.218.14.0/24 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.218.16.0/20 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.218.32.0/20 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.227.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 10.255.255.1/32 *[Direct/0] 2d 12:48:34 > via lo0.0 10.255.255.2/32 *[OSPF/10] 2d 12:48:24, metric 1 > to 1.0.0.2 via ge-0/0/1.0 10.255.255.4/32 *[OSPF/10] 2d 12:48:24, metric 2 > to 1.0.0.2 via ge-0/0/1.0 128.102.161.191/32 *[OSPF/10] 2d 12:48:24, metric 1 > to 1.0.0.2 via ge-0/0/1.0 128.102.169.99/32 *[Direct/0] 2d 12:48:34 > via lo0.0 128.102.171.41/32 *[OSPF/10] 2d 12:48:24, metric 2 > to 1.0.0.2 via ge-0/0/1.0 172.16.0.0/12 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 192.168.0.0/16 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 192.168.102.0/23 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 207.17.136.0/24 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 207.17.136.192/32 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 207.17.137.0/24 *[Static/5] 2d 12:48:34 > to 10.102.191.254 via fxp0.0 224.0.0.5/32 *[OSPF/10] 2d 12:48:34, metric 1 MultiRecv inet.3: 1 destinations, 1 routes (1 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 10.255.255.4/32 *[RSVP/7/1] 2d 12:48:04, metric 2 > to 1.0.0.2 via ge-0/0/1.0, label-switched-path to-pe2 iso.0: 1 destinations, 1 routes (1 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 47.0005.80ff.f800.0000.0108.0001.1281.0216.9099/152 *[Direct/0] 2d 12:48:34 > via lo0.0 mpls.0: 6 destinations, 6 routes (6 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 0 *[MPLS/0] 2d 12:48:34, metric 1 Receive 1 *[MPLS/0] 2d 12:48:34, metric 1 Receive 2 *[MPLS/0] 2d 12:48:34, metric 1 Receive 13 *[MPLS/0] 2d 12:48:34, metric 1 Receive 800003 *[L2VPN/7] 2d 12:41:29 > via ge-0/0/0.300, Pop Offset: 4 ge-0/0/0.300 *[L2VPN/7] 2d 12:41:29, metric2 2 > to 1.0.0.2 via ge-0/0/1.0, label-switched-path to-pe2 inet6.0: 2 destinations, 2 routes (2 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both abcd::128:102:169:99/128 *[Direct/0] 2d 12:48:34 > via lo0.0 fe80::5668:a60f:fc6b:eb97/128 *[Direct/0] 2d 12:48:34 > via lo0.0 bgp.l2vpn.0: 1 destinations, 1 routes (1 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 10.255.255.4:200:2:1/96 *[BGP/170] 2d 12:41:35, localpref 100, from 10.255.255.4 AS path: I, validation-state: unverified > to 1.0.0.2 via ge-0/0/1.0, label-switched-path to-pe2 l2vpn-inst.l2vpn.0: 2 destinations, 2 routes (2 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 10.255.255.1:200:1:1/96 *[L2VPN/170/-101] 2d 12:41:29, metric2 1 Indirect 10.255.255.4:200:2:1/96 *[BGP/170] 2d 12:41:35, localpref 100, from 10.255.255.4 AS path: I, validation-state: unverified > to 1.0.0.2 via ge-0/0/1.0, label-switched-path to-pe2 l2vpn-inst.l2id.0: 2 destinations, 3 routes (2 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 1 *[L2VPN/170/-101] 2d 12:41:29, metric2 1 Indirect [L2VPN/175] 2d 12:41:29 > via ge-0/0/0.300, Pop Offset: 4 2 *[BGP/170] 2d 12:41:35, localpref 100, from 10.255.255.4 AS path: I, validation-state: unverified > to 1.0.0.2 via ge-0/0/1.0, label-switched-path to-pe2 意义 输出显示路由表中的所有路由。 输出显示路由表中的所有路由。",
      "sections": [
        {
          "title": "CLI 快速配置",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改详细信息，以便与网络配置匹配，将命令复制并粘贴到 [edit] 层级的 CLI 中，然后从配置模式进入 commit 。 CE1 set interfaces ge-0/0/0 vlan-tagging set interfaces ge-0/0/0 unit 600 vlan-id 600 set interfaces ge-0/0/0 unit 600 family inet address 10.1.1.1/24 set interfaces lo0 unit 0 family inet address 10.255.255.8/32 PE1 set interfaces ge-0/0/0 vlan-tagging set interfaces ge-0/0/0 mtu 1600 set interfaces ge-0/0/0 encapsulation vlan-ccc set interfaces ge-0/0/0 unit 300 encapsulation vlan-ccc set interfaces ge-0/0/0 unit 300 vlan-id 600 set interfaces ge-0/0/0 unit 600 encapsulation vlan-vpls set interfaces ge-0/0/0 unit 600 vlan-id 600 set interfaces ge-0/0/0 unit 600 family vpls set interfaces ge-0/0/1 unit 0 family inet address 1.0.0.1/24 set interfaces ge-0/0/1 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.255.1/32 set routing-options nonstop-routing set routing-options router-id 10.255.255.1 set routing-options autonomous-system 100 set routing-options forwarding-table export exp-to-frwd set protocols rsvp interface all set protocols rsvp interface ge-0/0/1.0 set protocols rsvp interface lo0.0 set protocols mpls label-switched-path to-pe2 to 10.255.255.4 set protocols mpls interface ge-0/0/1.0 set protocols bgp group vpls-pe type internal set protocols bgp group vpls-pe local-address 10.255.255.1 set protocols bgp group vpls-pe family l2vpn auto-discovery-only set protocols bgp group vpls-pe family l2vpn signaling set protocols bgp group vpls-pe neighbor 10.255.255.4 set protocols bgp group vpls-pe neighbor 10.255.255.2 set protocols ospf traffic-engineering set protocols ospf area 0.0.0.0 interface lo0.0 passive set protocols ospf area 0.0.0.0 interface ge-0/0/1.0 set policy-options policy-statement exp-to-frwd term 0 from community vpls-com set policy-options policy-statement exp-to-frwd term 0 then install-nexthop lsp to-pe2 set policy-options policy-statement exp-to-frwd term 0 then accept set policy-options community vpls-com members target:100:100 set routing-instances l2vpn-inst instance-type l2vpn set routing-instances l2vpn-inst interface ge-0/0/0.300 set routing-instances l2vpn-inst route-distinguisher 10.255.255.1:200 set routing-instances l2vpn-inst vrf-target target:100:100 set routing-instances l2vpn-inst protocols l2vpn encapsulation-type ethernet-vlan set routing-instances l2vpn-inst protocols l2vpn site pe1 site-identifier 1 set routing-instances l2vpn-inst protocols l2vpn site pe1 interface ge-0/0/0.300 remote-site-id 2 set routing-instances l2vpn-inst protocols l2vpn flow-label-transmit set routing-instances l2vpn-inst protocols l2vpn flow-label-receive set routing-instances vpl1 instance-type vpls set routing-instances vpl1 interface ge-0/0/0.600 set routing-instances vpl1 route-distinguisher 10.255.255.1:100 set routing-instances vpl1 vrf-target target:100:100 set routing-instances vpl1 protocols vpls site-range 10 set routing-instances vpl1 protocols vpls no-tunnel-services set routing-instances vpl1 protocols vpls site vpl1PE1 site-identifier 1 set routing-instances vpl1 protocols vpls flow-label-transmit set routing-instances vpl1 protocols vpls flow-label-receive P set interfaces ge-0/0/0 unit 0 family inet address 1.0.0.2/24 set interfaces ge-0/0/0 unit 0 family mpls set interfaces ge-0/0/1 unit 0 family inet address 2.0.0.1/24 set interfaces ge-0/0/1 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.255.2/32 set routing-options router-id 10.255.255.2 set routing-options autonomous-system 100 set protocols rsvp interface ge-0/0/1.0 set protocols rsvp interface ge-0/0/0.0 set protocols rsvp interface lo0.0 set protocols mpls interface ge-0/0/0.0 set protocols mpls interface ge-0/0/1.0 set protocols bgp group vpls-pe type internal set protocols bgp group vpls-pe local-address 10.255.255.2 set protocols bgp group vpls-pe family l2vpn signaling set protocols bgp group vpls-pe neighbor 10.255.255.1 set protocols bgp group vpls-pe neighbor 10.255.255.4 deactivate protocols bgp set protocols ospf traffic-engineering set protocols ospf area 0.0.0.0 interface lo0.0 passive set protocols ospf area 0.0.0.0 interface ge-0/0/0.0 set protocols ospf area 0.0.0.0 interface ge-0/0/1.0 PE2 set interfaces ge-0/0/0 unit 0 family inet address 2.0.0.2/24 set interfaces ge-0/0/0 unit 0 family mpls set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 mtu 1600 set interfaces ge-0/0/1 encapsulation vlan-ccc set interfaces ge-0/0/1 unit 300 encapsulation vlan-ccc set interfaces ge-0/0/1 unit 300 vlan-id 600 set interfaces ge-0/0/1 unit 600 encapsulation vlan-vpls set interfaces ge-0/0/1 unit 600 vlan-id 600 set interfaces ge-0/0/1 unit 600 family vpls set interfaces lo0 unit 0 family inet address 10.255.255.4/32 set routing-options router-id 10.255.255.4 set routing-options autonomous-system 100 set routing-options forwarding-table export exp-to-frwd set protocols rsvp interface all set protocols rsvp interface ge-0/0/1.0 set protocols rsvp interface lo0.0 set protocols mpls label-switched-path to-pe1 to 10.255.255.1 set protocols mpls interface ge-0/0/0.0 set protocols bgp group vpls-pe type internal set protocols bgp group vpls-pe local-address 10.255.255.4 set protocols bgp group vpls-pe family l2vpn auto-discovery-only set protocols bgp group vpls-pe family l2vpn signaling set protocols bgp group vpls-pe neighbor 10.255.255.1 set protocols bgp group vpls-pe neighbor 10.255.255.2 set protocols ospf traffic-engineering set protocols ospf area 0.0.0.0 interface lo0.0 passive set protocols ospf area 0.0.0.0 interface ge-0/0/0.0 set policy-options policy-statement exp-to-frwd term 0 from community vpls-com set policy-options policy-statement exp-to-frwd term 0 then install-nexthop lsp to-pe1 set policy-options policy-statement exp-to-frwd term 0 then accept set policy-options community vpls-com members target:100:100 set routing-instances l2vpn-inst instance-type l2vpn set routing-instances l2vpn-inst interface ge-0/0/1.300 set routing-instances l2vpn-inst route-distinguisher 10.255.255.4:200 set routing-instances l2vpn-inst vrf-target target:100:100 set routing-instances l2vpn-inst protocols l2vpn encapsulation-type ethernet-vlan set routing-instances l2vpn-inst protocols l2vpn site pe2 site-identifier 2 set routing-instances l2vpn-inst protocols l2vpn site pe2 interface ge-0/0/1.300 remote-site-id 1 set routing-instances l2vpn-inst protocols l2vpn flow-label-transmit set routing-instances l2vpn-inst protocols l2vpn flow-label-receive set routing-instances vpl1 instance-type vpls set routing-instances vpl1 interface ge-0/0/1.600 set routing-instances vpl1 route-distinguisher 10.255.255.4:100 set routing-instances vpl1 vrf-target target:100:100 set routing-instances vpl1 protocols vpls site-range 10 set routing-instances vpl1 protocols vpls no-tunnel-services set routing-instances vpl1 protocols vpls site vpl1PE2 site-identifier 2 set routing-instances vpl1 protocols vpls flow-label-transmit set routing-instances vpl1 protocols vpls flow-label-receive deactivate routing-instances vpl1 CE2 set interfaces ge-0/0/0 vlan-tagging set interfaces ge-0/0/0 unit 600 vlan-id 600 set interfaces ge-0/0/0 unit 600 family inet address 10.1.1.2/24 set interfaces lo0 unit 0 family inet address 10.255.255.9/32",
          "commands_by_device": {
            "CE1": "set interfaces ge-0/0/0 vlan-tagging\nset interfaces ge-0/0/0 unit 600 vlan-id 600\nset interfaces ge-0/0/0 unit 600 family inet address 10.1.1.1/24\nset interfaces lo0 unit 0 family inet address 10.255.255.8/32",
            "PE1": "set interfaces ge-0/0/0 vlan-tagging\nset interfaces ge-0/0/0 mtu 1600\nset interfaces ge-0/0/0 encapsulation vlan-ccc\nset interfaces ge-0/0/0 unit 300 encapsulation vlan-ccc\nset interfaces ge-0/0/0 unit 300 vlan-id 600\nset interfaces ge-0/0/0 unit 600 encapsulation vlan-vpls\nset interfaces ge-0/0/0 unit 600 vlan-id 600\nset interfaces ge-0/0/0 unit 600 family vpls\nset interfaces ge-0/0/1 unit 0 family inet address 1.0.0.1/24\nset interfaces ge-0/0/1 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.255.255.1/32\nset routing-options nonstop-routing\nset routing-options router-id 10.255.255.1\nset routing-options autonomous-system 100\nset routing-options forwarding-table export exp-to-frwd\nset protocols rsvp interface all\nset protocols rsvp interface ge-0/0/1.0\nset protocols rsvp interface lo0.0\nset protocols mpls label-switched-path to-pe2 to 10.255.255.4\nset protocols mpls interface ge-0/0/1.0\nset protocols bgp group vpls-pe type internal\nset protocols bgp group vpls-pe local-address 10.255.255.1\nset protocols bgp group vpls-pe family l2vpn auto-discovery-only\nset protocols bgp group vpls-pe family l2vpn signaling\nset protocols bgp group vpls-pe neighbor 10.255.255.4\nset protocols bgp group vpls-pe neighbor 10.255.255.2\nset protocols ospf traffic-engineering\nset protocols ospf area 0.0.0.0 interface lo0.0 passive\nset protocols ospf area 0.0.0.0 interface ge-0/0/1.0\nset policy-options policy-statement exp-to-frwd term 0 from community vpls-com\nset policy-options policy-statement exp-to-frwd term 0 then install-nexthop lsp to-pe2\nset policy-options policy-statement exp-to-frwd term 0 then accept\nset policy-options community vpls-com members target:100:100\nset routing-instances l2vpn-inst instance-type l2vpn\nset routing-instances l2vpn-inst interface ge-0/0/0.300\nset routing-instances l2vpn-inst route-distinguisher 10.255.255.1:200\nset routing-instances l2vpn-inst vrf-target target:100:100\nset routing-instances l2vpn-inst protocols l2vpn encapsulation-type ethernet-vlan\nset routing-instances l2vpn-inst protocols l2vpn site pe1 site-identifier 1\nset routing-instances l2vpn-inst protocols l2vpn site pe1 interface ge-0/0/0.300 remote-site-id 2\nset routing-instances l2vpn-inst protocols l2vpn flow-label-transmit\nset routing-instances l2vpn-inst protocols l2vpn flow-label-receive\nset routing-instances vpl1 instance-type vpls\nset routing-instances vpl1 interface ge-0/0/0.600\nset routing-instances vpl1 route-distinguisher 10.255.255.1:100\nset routing-instances vpl1 vrf-target target:100:100\nset routing-instances vpl1 protocols vpls site-range 10\nset routing-instances vpl1 protocols vpls no-tunnel-services\nset routing-instances vpl1 protocols vpls site vpl1PE1 site-identifier 1\nset routing-instances vpl1 protocols vpls flow-label-transmit\nset routing-instances vpl1 protocols vpls flow-label-receive",
            "P": "set interfaces ge-0/0/0 unit 0 family inet address 1.0.0.2/24\nset interfaces ge-0/0/0 unit 0 family mpls\nset interfaces ge-0/0/1 unit 0 family inet address 2.0.0.1/24\nset interfaces ge-0/0/1 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.255.255.2/32\nset routing-options router-id 10.255.255.2\nset routing-options autonomous-system 100\nset protocols rsvp interface ge-0/0/1.0\nset protocols rsvp interface ge-0/0/0.0\nset protocols rsvp interface lo0.0\nset protocols mpls interface ge-0/0/0.0\nset protocols mpls interface ge-0/0/1.0\nset protocols bgp group vpls-pe type internal\nset protocols bgp group vpls-pe local-address 10.255.255.2\nset protocols bgp group vpls-pe family l2vpn signaling\nset protocols bgp group vpls-pe neighbor 10.255.255.1\nset protocols bgp group vpls-pe neighbor 10.255.255.4 deactivate protocols bgp\nset protocols ospf traffic-engineering\nset protocols ospf area 0.0.0.0 interface lo0.0 passive\nset protocols ospf area 0.0.0.0 interface ge-0/0/0.0\nset protocols ospf area 0.0.0.0 interface ge-0/0/1.0",
            "PE2": "set interfaces ge-0/0/0 unit 0 family inet address 2.0.0.2/24\nset interfaces ge-0/0/0 unit 0 family mpls\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 mtu 1600\nset interfaces ge-0/0/1 encapsulation vlan-ccc\nset interfaces ge-0/0/1 unit 300 encapsulation vlan-ccc\nset interfaces ge-0/0/1 unit 300 vlan-id 600\nset interfaces ge-0/0/1 unit 600 encapsulation vlan-vpls\nset interfaces ge-0/0/1 unit 600 vlan-id 600\nset interfaces ge-0/0/1 unit 600 family vpls\nset interfaces lo0 unit 0 family inet address 10.255.255.4/32\nset routing-options router-id 10.255.255.4\nset routing-options autonomous-system 100\nset routing-options forwarding-table export exp-to-frwd\nset protocols rsvp interface all\nset protocols rsvp interface ge-0/0/1.0\nset protocols rsvp interface lo0.0\nset protocols mpls label-switched-path to-pe1 to 10.255.255.1\nset protocols mpls interface ge-0/0/0.0\nset protocols bgp group vpls-pe type internal\nset protocols bgp group vpls-pe local-address 10.255.255.4\nset protocols bgp group vpls-pe family l2vpn auto-discovery-only\nset protocols bgp group vpls-pe family l2vpn signaling\nset protocols bgp group vpls-pe neighbor 10.255.255.1\nset protocols bgp group vpls-pe neighbor 10.255.255.2\nset protocols ospf traffic-engineering\nset protocols ospf area 0.0.0.0 interface lo0.0 passive\nset protocols ospf area 0.0.0.0 interface ge-0/0/0.0\nset policy-options policy-statement exp-to-frwd term 0 from community vpls-com\nset policy-options policy-statement exp-to-frwd term 0 then install-nexthop lsp to-pe1\nset policy-options policy-statement exp-to-frwd term 0 then accept\nset policy-options community vpls-com members target:100:100\nset routing-instances l2vpn-inst instance-type l2vpn\nset routing-instances l2vpn-inst interface ge-0/0/1.300\nset routing-instances l2vpn-inst route-distinguisher 10.255.255.4:200\nset routing-instances l2vpn-inst vrf-target target:100:100\nset routing-instances l2vpn-inst protocols l2vpn encapsulation-type ethernet-vlan\nset routing-instances l2vpn-inst protocols l2vpn site pe2 site-identifier 2\nset routing-instances l2vpn-inst protocols l2vpn site pe2 interface ge-0/0/1.300 remote-site-id 1\nset routing-instances l2vpn-inst protocols l2vpn flow-label-transmit\nset routing-instances l2vpn-inst protocols l2vpn flow-label-receive\nset routing-instances vpl1 instance-type vpls\nset routing-instances vpl1 interface ge-0/0/1.600\nset routing-instances vpl1 route-distinguisher 10.255.255.4:100\nset routing-instances vpl1 vrf-target target:100:100\nset routing-instances vpl1 protocols vpls site-range 10\nset routing-instances vpl1 protocols vpls no-tunnel-services\nset routing-instances vpl1 protocols vpls site vpl1PE2 site-identifier 2\nset routing-instances vpl1 protocols vpls flow-label-transmit\nset routing-instances vpl1 protocols vpls flow-label-receive\ndeactivate routing-instances vpl1",
            "CE2": "set interfaces ge-0/0/0 vlan-tagging\nset interfaces ge-0/0/0 unit 600 vlan-id 600\nset interfaces ge-0/0/0 unit 600 family inet address 10.1.1.2/24\nset interfaces lo0 unit 0 family inet address 10.255.255.9/32"
          }
        },
        {
          "title": "配置 PE1",
          "level": 4,
          "content": "以下示例要求您在配置层次结构中导航各个级别。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 PE1： 配置接口。 [edit interfaces] user@PE1# set ge-0/0/0 vlan-tagging user@PE1# set ge-0/0/0 mtu 1600 user@PE1# set ge-0/0/0 encapsulation vlan-ccc user@PE1# set ge-0/0/0 unit 300 encapsulation vlan-ccc user@PE1# set ge-0/0/0 unit 300 vlan-id 600 user@PE1# set ge-0/0/0 unit 600 encapsulation vlan-vpls user@PE1# set ge-0/0/0 unit 600 vlan-id 600 user@PE1# set ge-0/0/0 unit 600 family vpls deactivate interfaces ge-0/0/0 unit 600 user@PE1# set ge-0/0/1 unit 0 family inet address 1.0.0.1/24 user@PE1# set ge-0/0/1 unit 0 family mpls user@PE1# set lo0 unit 0 family inet address 10.255.255.1/32 配置不间断路由，并配置路由器 ID。 [edit routing-options] user@PE1# set nonstop-routing user@PE1# set router-id 10.255.255.1 配置自治系统 (AS) 编号，并使用导出语句将策略应用到本地路由器的转发表。 [edit routing-options] user@PE1# set autonomous-system 100 user@PE1# set forwarding-table export exp-to-frwd 在接口上配置 RSVP 协议。 [edit protocols rsvp] user@PE1# set interface all user@PE1# set interface ge-0/0/1.0 user@PE1# set interface lo0.0 将标签交换路径属性应用于 MPLS 协议，并配置接口。 [edit protocols mpls] user@PE1# set label-switched-path to-pe2 to 10.255.255.4 user@PE1# set interface ge-0/0/1.0 定义对等组，并为对等组 vpls-pe 配置 BGP 会话的本地端地址地址。 [edit protocols bgp group vpls-pe] user@PE1# set type internal user@PE1# set local-address 10.255.255.1 在更新中为 NLRI 配置协议家族的属性。 [edit protocols bgp group vpls-pe] user@PE1# set family l2vpn auto-discovery-only user@PE1# set family l2vpn signaling 为对等组 vpls-pe 配置邻居。 [edit protocols bgp group vpls-pe] user@PE1# set neighbor 10.255.255.4 user@PE1# set neighbor 10.255.255.2 配置流量工程，并配置 OSPF 区域 0.0.0.0 的接口。 [edit protocols ospf] user@PE1# set traffic-engineering user@PE1# set area 0.0.0.0 interface lo0.0 passive user@PE1# set area 0.0.0.0 interface ge-0/0/1.0 配置路由策略和 BGP 社区信息。 [edit policy-options] user@PE1# set policy-statement exp-to-fwd term 0 from community vpls-com user@PE1# set policy-statement exp-to-fwd term 0 then install-nexthop lsp to-pe2 user@PE1# set policy-statement exp-to-fwd term 0 then accept user@PE1# set community vpls-com members target:100:100 配置路由实例的类型并配置接口。 [edit routing-instances l2vpn-inst] user@PE1# set instance-type l2vpn user@PE1# set interface ge-0/0/0.300 例如 l2vpn-inst ，配置路由识别符，并配置 VRF 目标社区。 [edit routing-instances l2vpn-inst] user@PE1# set route-distinguisher 10.255.255.1:200 user@PE1# set vrf-target target:100:100 配置 L2VPN 协议所需的封装类型。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE1# set encapsulation-type ethernet-vlan 配置连接到提供商设备的站点。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE1# set site pe1 site-identifier 1 user@PE1# set site pe1 interface ge-0/0/0.300 remote-site-id 2 为路由实例配置 L2VPN 协议，以提供播发功能以在接收方向上将流标签弹出到远程 PE，并提供播发功能以将流标签沿传输方向推送到远程 PE。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE1# set flow-label-transmit user@PE1# set flow-label-receive [edit routing-instances vpl1] user@PE1# set instance-type vpls user@PE1# set interface ge-0/0/0.600 例如 vp1 ，配置路由识别符，并配置 VRF 目标社区。 [edit routing-instances vpl1] user@PE1# set route-distinguisher 10.255.255.1:100 user@PE1# set vrf-target target:100:100 为 VPLS 域分配最大站点标识符。 [edit routing-instances vpl1 protocols vpls] user@PE1# set site-range 10 配置为不使用 VPLS 实例的隧道服务，并为连接到提供商设备的站点分配站点标识符。 [edit routing-instances vpl1 protocols vpls] user@PE1# set no-tunnel-services user@PE1# set site vpl1PE1 site-identifier 1 为路由实例配置 VPLS 协议，以提供播发功能以在接收方向上将流标签弹出到远程 PE，并提供播发功能以在传输方向上将流标签推送到远程 PE。 [edit routing-instances vpl1 protocols vpls] user@PE1# set flow-label-transmit user@PE1# set flow-label-receive 在配置模式下，输入 show interfaces 、 show protocols 、 show routing-instances show policy-options 和 show routing-options 命令来确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@PE1# show interfaces ge-0/0/0 { vlan-tagging; mtu 1600; encapsulation vlan-ccc; unit 300 { encapsulation vlan-ccc; vlan-id 600; } unit 600 { encapsulation vlan-vpls; vlan-id 600; family vpls; } } ge-0/0/1 { unit 0 { family inet { address 1.0.0.1/24; } family mpls; } } lo0 { unit 0 { family inet { address 10.255.255.1/32; } } } user@PE1# show protocols rsvp { interface all; interface ge-0/0/1.0; interface lo0.0; } mpls { label-switched-path to-pe2 { to 10.255.255.4; } interface ge-0/0/1.0; } bgp { group vpls-pe { type internal; local-address 10.255.255.1; family l2vpn { auto-discovery-only; signaling; } neighbor 10.255.255.4; neighbor 10.255.255.2; } } ospf { traffic-engineering; area 0.0.0.0 { interface lo0.0 { passive; } interface ge-0/0/1.0; } } user@PE1# show policy-options policy-statement exp-to-frwd { term 0 { from community vpls-com; then { install-nexthop lsp to-pe2; accept; } } } community vpls-com members target:100:100; user@PE1# show routing-instances l2vpn-inst { instance-type l2vpn; interface ge-0/0/0.300; route-distinguisher 10.255.255.1:200; vrf-target target:100:100; protocols { l2vpn { encapsulation-type ethernet-vlan; site pe1 { site-identifier 1; interface ge-0/0/0.300 { remote-site-id 2; } } flow-label-transmit; flow-label-receive; } } } vpl1 { instance-type vpls; interface ge-0/0/0.600; route-distinguisher 10.255.255.1:100; vrf-target target:100:100; protocols { vpls { site-range 10; no-tunnel-services; site vpl1PE1 { site-identifier 1; } flow-label-transmit; flow-label-receive; } } } user@PE1# show routing-options nonstop-routing; router-id 10.255.255.1; autonomous-system 100; forwarding-table { export exp-to-frwd; }",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE1# set ge-0/0/0 vlan-tagging",
                    "user@PE1# set ge-0/0/0 mtu 1600",
                    "user@PE1# set ge-0/0/0 encapsulation vlan-ccc",
                    "user@PE1# set ge-0/0/0 unit 300 encapsulation vlan-ccc",
                    "user@PE1# set ge-0/0/0 unit 300 vlan-id 600",
                    "user@PE1# set ge-0/0/0 unit 600 encapsulation vlan-vpls",
                    "user@PE1# set ge-0/0/0 unit 600 vlan-id 600",
                    "user@PE1# set ge-0/0/0 unit 600 family vpls deactivate interfaces ge-0/0/0 unit 600",
                    "user@PE1# set ge-0/0/1 unit 0 family inet address 1.0.0.1/24",
                    "user@PE1# set ge-0/0/1 unit 0 family mpls",
                    "user@PE1# set lo0 unit 0 family inet address 10.255.255.1/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置不间断路由，并配置路由器 ID。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE1# set nonstop-routing",
                    "user@PE1# set router-id 10.255.255.1"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置自治系统 (AS) 编号，并使用导出语句将策略应用到本地路由器的转发表。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE1# set autonomous-system 100",
                    "user@PE1# set forwarding-table export exp-to-frwd"
                  ]
                },
                {
                  "step": 4,
                  "description": "在接口上配置 RSVP 协议。",
                  "code": [
                    "[edit protocols rsvp]",
                    "user@PE1# set interface all",
                    "user@PE1# set interface ge-0/0/1.0",
                    "user@PE1# set interface lo0.0"
                  ]
                },
                {
                  "step": 5,
                  "description": "将标签交换路径属性应用于 MPLS 协议，并配置接口。",
                  "code": [
                    "[edit protocols mpls]",
                    "user@PE1# set label-switched-path to-pe2 to 10.255.255.4",
                    "user@PE1# set interface ge-0/0/1.0"
                  ]
                },
                {
                  "step": 6,
                  "description": "定义对等组，并为对等组 vpls-pe 配置 BGP 会话的本地端地址地址。",
                  "code": [
                    "[edit protocols bgp group vpls-pe]",
                    "user@PE1# set type internal",
                    "user@PE1# set local-address 10.255.255.1"
                  ]
                },
                {
                  "step": 7,
                  "description": "在更新中为 NLRI 配置协议家族的属性。",
                  "code": [
                    "[edit protocols bgp group vpls-pe]",
                    "user@PE1# set family l2vpn auto-discovery-only",
                    "user@PE1# set family l2vpn signaling"
                  ]
                },
                {
                  "step": 8,
                  "description": "为对等组 vpls-pe 配置邻居。",
                  "code": [
                    "[edit protocols bgp group vpls-pe]",
                    "user@PE1# set neighbor 10.255.255.4",
                    "user@PE1# set neighbor 10.255.255.2"
                  ]
                },
                {
                  "step": 9,
                  "description": "配置流量工程，并配置 OSPF 区域 0.0.0.0 的接口。",
                  "code": [
                    "[edit protocols ospf]",
                    "user@PE1# set traffic-engineering",
                    "user@PE1# set area 0.0.0.0 interface lo0.0 passive",
                    "user@PE1# set area 0.0.0.0 interface ge-0/0/1.0"
                  ]
                },
                {
                  "step": 10,
                  "description": "配置路由策略和 BGP 社区信息。",
                  "code": [
                    "[edit policy-options]",
                    "user@PE1# set policy-statement exp-to-fwd term 0 from community vpls-com",
                    "user@PE1# set policy-statement exp-to-fwd term 0 then install-nexthop lsp to-pe2",
                    "user@PE1# set policy-statement exp-to-fwd term 0 then accept",
                    "user@PE1# set community vpls-com members target:100:100"
                  ]
                },
                {
                  "step": 11,
                  "description": "配置路由实例的类型并配置接口。",
                  "code": [
                    "[edit routing-instances l2vpn-inst]",
                    "user@PE1# set instance-type l2vpn",
                    "user@PE1# set interface ge-0/0/0.300"
                  ]
                },
                {
                  "step": 12,
                  "description": "例如 l2vpn-inst ，配置路由识别符，并配置 VRF 目标社区。",
                  "code": [
                    "[edit routing-instances l2vpn-inst]",
                    "user@PE1# set route-distinguisher 10.255.255.1:200",
                    "user@PE1# set vrf-target target:100:100"
                  ]
                },
                {
                  "step": 13,
                  "description": "配置 L2VPN 协议所需的封装类型。",
                  "code": [
                    "[edit routing-instances l2vpn-inst protocols l2vpn]",
                    "user@PE1# set encapsulation-type ethernet-vlan"
                  ]
                },
                {
                  "step": 14,
                  "description": "配置连接到提供商设备的站点。",
                  "code": [
                    "[edit routing-instances l2vpn-inst protocols l2vpn]",
                    "user@PE1# set site pe1 site-identifier 1",
                    "user@PE1# set site pe1 interface ge-0/0/0.300 remote-site-id 2"
                  ]
                },
                {
                  "step": 15,
                  "description": "为路由实例配置 L2VPN 协议，以提供播发功能以在接收方向上将流标签弹出到远程 PE，并提供播发功能以将流标签沿传输方向推送到远程 PE。",
                  "code": [
                    "[edit routing-instances l2vpn-inst protocols l2vpn]",
                    "user@PE1# set flow-label-transmit",
                    "user@PE1# set flow-label-receive"
                  ]
                },
                {
                  "step": 16,
                  "description": "配置路由实例的类型并配置接口。",
                  "code": [
                    "[edit routing-instances vpl1]",
                    "user@PE1# set instance-type vpls",
                    "user@PE1# set interface ge-0/0/0.600"
                  ]
                },
                {
                  "step": 17,
                  "description": "例如 vp1 ，配置路由识别符，并配置 VRF 目标社区。",
                  "code": [
                    "[edit routing-instances vpl1]",
                    "user@PE1# set route-distinguisher 10.255.255.1:100",
                    "user@PE1# set vrf-target target:100:100"
                  ]
                },
                {
                  "step": 18,
                  "description": "为 VPLS 域分配最大站点标识符。",
                  "code": [
                    "[edit routing-instances vpl1 protocols vpls]",
                    "user@PE1# set site-range 10"
                  ]
                },
                {
                  "step": 19,
                  "description": "配置为不使用 VPLS 实例的隧道服务，并为连接到提供商设备的站点分配站点标识符。",
                  "code": [
                    "[edit routing-instances vpl1 protocols vpls]",
                    "user@PE1# set no-tunnel-services",
                    "user@PE1# set site vpl1PE1 site-identifier 1"
                  ]
                },
                {
                  "step": 20,
                  "description": "为路由实例配置 VPLS 协议，以提供播发功能以在接收方向上将流标签弹出到远程 PE，并提供播发功能以在传输方向上将流标签推送到远程 PE。",
                  "code": [
                    "[edit routing-instances vpl1 protocols vpls]",
                    "user@PE1# set flow-label-transmit",
                    "user@PE1# set flow-label-receive "
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show protocols 、 show routing-instances show policy-options 和 show routing-options 命令来确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "user@PE1#show interfacesge-0/0/0 {\n    vlan-tagging;\n    mtu 1600;\n    encapsulation vlan-ccc;\n    unit 300 {\n        encapsulation vlan-ccc;\n        vlan-id 600;\n    }\n     unit 600 {\n        encapsulation vlan-vpls;\n        vlan-id 600;\n        family vpls;\n    }\n}\nge-0/0/1 {\n    unit 0 {\n        family inet {\n            address 1.0.0.1/24;\n        }\n        family mpls;\n    }\n}\nlo0 {\n    unit 0 {\n        family inet {\n            address 10.255.255.1/32;\n        }\n    }\n}",
                "user@PE1#show protocolsrsvp {\n    interface all;\n    interface ge-0/0/1.0;\n    interface lo0.0;\n}\nmpls {\n    label-switched-path to-pe2 {\n        to 10.255.255.4;\n    }\n    interface ge-0/0/1.0;\n}\nbgp {\n    group vpls-pe {\n        type internal;\n        local-address 10.255.255.1;\n        family l2vpn {\n            auto-discovery-only;\n            signaling;\n        }\n        neighbor 10.255.255.4;\n        neighbor 10.255.255.2;\n    }\n}\nospf {\n    traffic-engineering;\n    area 0.0.0.0 {\n        interface lo0.0 {\n            passive;\n        }\n        interface ge-0/0/1.0;\n    }\n}",
                "user@PE1#show policy-optionspolicy-statement exp-to-frwd {\n    term 0 {\n        from community vpls-com;\n        then {\n            install-nexthop lsp to-pe2;\n            accept;\n        }\n    }\n}\ncommunity vpls-com members target:100:100;",
                "user@PE1#show routing-instancesl2vpn-inst {\n    instance-type l2vpn;\n    interface ge-0/0/0.300;\n    route-distinguisher 10.255.255.1:200;\n    vrf-target target:100:100;\n    protocols {\n        l2vpn {\n            encapsulation-type ethernet-vlan;\n            site pe1 {\n                site-identifier 1;\n                interface ge-0/0/0.300 {\n                    remote-site-id 2;\n                }\n            }\n            flow-label-transmit;\n            flow-label-receive;\n        }\n    }\n}\n vpl1 {\n    instance-type vpls;\n    interface ge-0/0/0.600;\n    route-distinguisher 10.255.255.1:100;\n    vrf-target target:100:100;\n    protocols {\n        vpls {\n            site-range 10;\n            no-tunnel-services;\n            site vpl1PE1 {\n                site-identifier 1;\n            }\n            flow-label-transmit;\n            flow-label-receive;\n        }\n    }\n}",
                "user@PE1#show routing-optionsnonstop-routing;\nrouter-id 10.255.255.1;\nautonomous-system 100;\nforwarding-table {\n    export exp-to-frwd;\n}"
              ]
            }
          ]
        }
      ]
    },
    {
      "title": "配置 PE2",
      "level": 3,
      "content": "以下示例要求您在配置层次结构中导航各个级别。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 PE2： 配置接口。 [edit interfaces] user@PE2# set ge-0/0/0 unit 0 family inet address 2.0.0.2/24 user@PE2# set ge-0/0/0 unit 0 family mpls user@PE2# set ge-0/0/1 vlan-tagging user@PE2# set ge-0/0/1 mtu 1600 user@PE2# set ge-0/0/1 encapsulation vlan-ccc user@PE2# set ge-0/0/1 unit 300 encapsulation vlan-ccc user@PE2# set ge-0/0/1 unit 300 vlan-id 600 user@PE2# set ge-0/0/1 unit 600 encapsulation vlan-vpls user@PE2# set ge-0/0/1 unit 600 vlan-id 600 user@PE2# set ge-0/0/1 unit 600 family vpls deactivate interfaces ge-0/0/1 unit 600 user@PE2# set lo0 unit 0 family inet address 10.255.255.4/32 配置路由器 ID。 [edit routing-options] user@PE2# set router-id 10.255.255.4 配置自治系统 (AS) 编号，并使用导出语句将策略应用到本地路由器的转发表。 [edit routing-options] user@PE2# set autonomous-system 100 user@PE2# set forwarding-table export exp-to-frwd 在接口上配置 RSVP 协议。 [edit protocols rsvp] user@PE2# set interface all user@PE2# set interface ge-0/0/1.0 user@PE2# set interface lo0.0 将标签交换路径属性应用于 MPLS 协议，并配置接口。 [edit protocols mpls] user@PE2# set label-switched-path to-pe1 to 10.255.255.1 user@PE2# set interface ge-0/0/0.0 定义对等组，并为对等组 vpls-pe 配置 BGP 会话的本地端地址。 [edit protocols bgp group vpls-pe] user@PE2# set type internal user@PE2# set local-address 10.255.255.4 在更新中为 NLRI 配置协议家族的属性。 [edit protocols bgp group vpls-pe] user@PE2# set family l2vpn auto-discovery-only user@PE2# set family l2vpn signaling 为对等组 vpls-pe 配置邻接方。 [edit protocols bgp group vpls-pe] user@PE2# set neighbor 10.255.255.1 user@PE2# set neighbor 10.255.255.2 配置流量工程，并配置 OSPF 区域 0.0.0.0 的接口。 [edit protocols ospf] user@PE2# set traffic-engineering user@PE2# set area 0.0.0.0 interface lo0.0 passive user@PE2# set area 0.0.0.0 interface ge-0/0/0.0 配置路由策略和 BGP 社区信息。 [edit policy-options] user@PE2# set policy-statement exp-to-frwd term 0 from community vpls-com user@PE2# set policy-statement exp-to-frwd term 0 then install-nexthop lsp to-pe1 user@PE2# set policy-statement exp-to-frwd term 0 then accept user@PE2# set community vpls-com members target:100:100 配置路由实例的类型并配置接口。 [edit routing-instances l2vpn-inst] user@PE2# set instance-type l2vpn user@PE2# set interface ge-0/0/1.300 例如 l2vpn-inst ，配置路由识别符，并配置 VRF 目标社区。 [edit routing-instances l2vpn-inst] user@PE2# set route-distinguisher 10.255.255.4:200 user@PE2# set vrf-target target:100:100 配置 L2VPN 协议所需的封装类型。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE2# set encapsulation-type ethernet-vlan 配置连接到提供商设备的站点。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE2# set site pe2 site-identifier 2 user@PE2# set site pe2 interface ge-0/0/1.300 remote-site-id 1 为路由实例配置 L2VPN 协议，以提供播发功能以在接收方向上将流标签弹出到远程 PE，并提供播发功能以将流标签沿传输方向推送到远程 PE。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE2# set flow-label-transmit user@PE2# set flow-label-receive [edit routing-instances vpl1] user@PE2# set instance-type vpls user@PE2# set interface ge-0/0/1.600 例如 vpl1 ，配置路由识别符，并配置 VRF 目标社区。 [edit routing-instances vpl1] user@PE2# set route-distinguisher 10.255.255.4:100 user@PE2# set vrf-target target:100:100 为 VPLS 域分配最大站点标识符。 [edit routing-instances vpl1 protocols vpls] user@PE2# set site-range 10 配置为不使用 VPLS 实例的隧道服务，并为连接到提供商设备的站点分配站点标识符。 [edit routing-instances vpl1 protocols vpls] user@PE2# set no-tunnel-services user@PE2# set site vpl1PE2 site-identifier 2 为路由实例配置 VPLS 协议，以提供播发功能以在接收方向向远程 PE 弹出流标签，并在传输到远程 PE 的方向上向推送流标签提供播发功能。 [edit routing-instances vpl1 protocols vpls] user@PE2# set flow-label-transmit user@PE2# set flow-label-receive 在配置模式下，输入 show interfaces 、 show protocols 、 show routing-instances show policy-options 和 show routing-options 命令来确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@PE2# show interfaces ge-0/0/0 { unit 0 { family inet { address 2.0.0.2/24; } family mpls; } } ge-0/0/1 { vlan-tagging; mtu 1600; encapsulation vlan-ccc; unit 300 { encapsulation vlan-ccc; vlan-id 600; } unit 600 { encapsulation vlan-vpls; vlan-id 600; family vpls; } } lo0 { unit 0 { family inet { address 10.255.255.4/32; } } } user@PE2# show protocols rsvp { interface all; interface ge-0/0/1.0; interface lo0.0; } mpls { label-switched-path to-pe1 { to 10.255.255.1; } interface ge-0/0/0.0; } bgp { group vpls-pe { type internal; local-address 10.255.255.4; family l2vpn { auto-discovery-only; signaling; } neighbor 10.255.255.1; neighbor 10.255.255.2; } } ospf { traffic-engineering; area 0.0.0.0 { interface lo0.0 { passive; } interface ge-0/0/0.0; } } user@PE2# show policy-options policy-statement exp-to-frwd { term 0 { from community vpls-com; then { install-nexthop lsp to-pe1; accept; } } } community vpls-com members target:100:100; user@PE2# show routing-instances l2vpn-inst { instance-type l2vpn; interface ge-0/0/1.300; route-distinguisher 10.255.255.4:200; vrf-target target:100:100; protocols { l2vpn { encapsulation-type ethernet-vlan; site pe2 { site-identifier 2; interface ge-0/0/1.300 { remote-site-id 1; } } flow-label-transmit; flow-label-receive; } } } vpl1 { instance-type vpls; interface ge-0/0/1.600; route-distinguisher 10.255.255.4:100; vrf-target target:100:100; protocols { vpls { site-range 10; no-tunnel-services; site vpl1PE2 { site-identifier 2; } flow-label-transmit; flow-label-receive; } } } user@PE2# show routing-options router-id 10.255.255.4; autonomous-system 100; forwarding-table { export exp-to-frwd; }",
      "sections": [
        {
          "title": "程序",
          "level": 4,
          "content": "以下示例要求您在配置层次结构中导航各个级别。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 PE2： 配置接口。 [edit interfaces] user@PE2# set ge-0/0/0 unit 0 family inet address 2.0.0.2/24 user@PE2# set ge-0/0/0 unit 0 family mpls user@PE2# set ge-0/0/1 vlan-tagging user@PE2# set ge-0/0/1 mtu 1600 user@PE2# set ge-0/0/1 encapsulation vlan-ccc user@PE2# set ge-0/0/1 unit 300 encapsulation vlan-ccc user@PE2# set ge-0/0/1 unit 300 vlan-id 600 user@PE2# set ge-0/0/1 unit 600 encapsulation vlan-vpls user@PE2# set ge-0/0/1 unit 600 vlan-id 600 user@PE2# set ge-0/0/1 unit 600 family vpls deactivate interfaces ge-0/0/1 unit 600 user@PE2# set lo0 unit 0 family inet address 10.255.255.4/32 配置路由器 ID。 [edit routing-options] user@PE2# set router-id 10.255.255.4 配置自治系统 (AS) 编号，并使用导出语句将策略应用到本地路由器的转发表。 [edit routing-options] user@PE2# set autonomous-system 100 user@PE2# set forwarding-table export exp-to-frwd 在接口上配置 RSVP 协议。 [edit protocols rsvp] user@PE2# set interface all user@PE2# set interface ge-0/0/1.0 user@PE2# set interface lo0.0 将标签交换路径属性应用于 MPLS 协议，并配置接口。 [edit protocols mpls] user@PE2# set label-switched-path to-pe1 to 10.255.255.1 user@PE2# set interface ge-0/0/0.0 定义对等组，并为对等组 vpls-pe 配置 BGP 会话的本地端地址。 [edit protocols bgp group vpls-pe] user@PE2# set type internal user@PE2# set local-address 10.255.255.4 在更新中为 NLRI 配置协议家族的属性。 [edit protocols bgp group vpls-pe] user@PE2# set family l2vpn auto-discovery-only user@PE2# set family l2vpn signaling 为对等组 vpls-pe 配置邻接方。 [edit protocols bgp group vpls-pe] user@PE2# set neighbor 10.255.255.1 user@PE2# set neighbor 10.255.255.2 配置流量工程，并配置 OSPF 区域 0.0.0.0 的接口。 [edit protocols ospf] user@PE2# set traffic-engineering user@PE2# set area 0.0.0.0 interface lo0.0 passive user@PE2# set area 0.0.0.0 interface ge-0/0/0.0 配置路由策略和 BGP 社区信息。 [edit policy-options] user@PE2# set policy-statement exp-to-frwd term 0 from community vpls-com user@PE2# set policy-statement exp-to-frwd term 0 then install-nexthop lsp to-pe1 user@PE2# set policy-statement exp-to-frwd term 0 then accept user@PE2# set community vpls-com members target:100:100 配置路由实例的类型并配置接口。 [edit routing-instances l2vpn-inst] user@PE2# set instance-type l2vpn user@PE2# set interface ge-0/0/1.300 例如 l2vpn-inst ，配置路由识别符，并配置 VRF 目标社区。 [edit routing-instances l2vpn-inst] user@PE2# set route-distinguisher 10.255.255.4:200 user@PE2# set vrf-target target:100:100 配置 L2VPN 协议所需的封装类型。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE2# set encapsulation-type ethernet-vlan 配置连接到提供商设备的站点。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE2# set site pe2 site-identifier 2 user@PE2# set site pe2 interface ge-0/0/1.300 remote-site-id 1 为路由实例配置 L2VPN 协议，以提供播发功能以在接收方向上将流标签弹出到远程 PE，并提供播发功能以将流标签沿传输方向推送到远程 PE。 [edit routing-instances l2vpn-inst protocols l2vpn] user@PE2# set flow-label-transmit user@PE2# set flow-label-receive [edit routing-instances vpl1] user@PE2# set instance-type vpls user@PE2# set interface ge-0/0/1.600 例如 vpl1 ，配置路由识别符，并配置 VRF 目标社区。 [edit routing-instances vpl1] user@PE2# set route-distinguisher 10.255.255.4:100 user@PE2# set vrf-target target:100:100 为 VPLS 域分配最大站点标识符。 [edit routing-instances vpl1 protocols vpls] user@PE2# set site-range 10 配置为不使用 VPLS 实例的隧道服务，并为连接到提供商设备的站点分配站点标识符。 [edit routing-instances vpl1 protocols vpls] user@PE2# set no-tunnel-services user@PE2# set site vpl1PE2 site-identifier 2 为路由实例配置 VPLS 协议，以提供播发功能以在接收方向向远程 PE 弹出流标签，并在传输到远程 PE 的方向上向推送流标签提供播发功能。 [edit routing-instances vpl1 protocols vpls] user@PE2# set flow-label-transmit user@PE2# set flow-label-receive",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE2# set ge-0/0/0 unit 0 family inet address 2.0.0.2/24",
                    "user@PE2# set ge-0/0/0 unit 0 family mpls",
                    "user@PE2# set ge-0/0/1 vlan-tagging",
                    "user@PE2# set ge-0/0/1 mtu 1600",
                    "user@PE2# set ge-0/0/1 encapsulation vlan-ccc",
                    "user@PE2# set ge-0/0/1 unit 300 encapsulation vlan-ccc",
                    "user@PE2# set ge-0/0/1 unit 300 vlan-id 600",
                    "user@PE2# set ge-0/0/1 unit 600 encapsulation vlan-vpls",
                    "user@PE2# set ge-0/0/1 unit 600 vlan-id 600",
                    "user@PE2# set ge-0/0/1 unit 600 family vpls deactivate interfaces ge-0/0/1 unit 600",
                    "user@PE2# set lo0 unit 0 family inet address 10.255.255.4/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置路由器 ID。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE2# set router-id 10.255.255.4"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置自治系统 (AS) 编号，并使用导出语句将策略应用到本地路由器的转发表。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE2# set autonomous-system 100",
                    "user@PE2# set forwarding-table export exp-to-frwd"
                  ]
                },
                {
                  "step": 4,
                  "description": "在接口上配置 RSVP 协议。",
                  "code": [
                    "[edit protocols rsvp]",
                    "user@PE2# set interface all",
                    "user@PE2# set interface ge-0/0/1.0",
                    "user@PE2# set interface lo0.0"
                  ]
                },
                {
                  "step": 5,
                  "description": "将标签交换路径属性应用于 MPLS 协议，并配置接口。",
                  "code": [
                    "[edit protocols mpls]",
                    "user@PE2# set label-switched-path to-pe1 to 10.255.255.1",
                    "user@PE2# set interface ge-0/0/0.0"
                  ]
                },
                {
                  "step": 6,
                  "description": "定义对等组，并为对等组 vpls-pe 配置 BGP 会话的本地端地址。",
                  "code": [
                    "[edit protocols bgp group vpls-pe]",
                    "user@PE2# set type internal",
                    "user@PE2# set local-address 10.255.255.4"
                  ]
                },
                {
                  "step": 7,
                  "description": "在更新中为 NLRI 配置协议家族的属性。",
                  "code": [
                    "[edit protocols bgp group vpls-pe]",
                    "user@PE2# set family l2vpn auto-discovery-only",
                    "user@PE2# set family l2vpn signaling"
                  ]
                },
                {
                  "step": 8,
                  "description": "为对等组 vpls-pe 配置邻接方。",
                  "code": [
                    "[edit protocols bgp group vpls-pe]",
                    "user@PE2# set neighbor 10.255.255.1",
                    "user@PE2# set neighbor 10.255.255.2"
                  ]
                },
                {
                  "step": 9,
                  "description": "配置流量工程，并配置 OSPF 区域 0.0.0.0 的接口。",
                  "code": [
                    "[edit protocols ospf]",
                    "user@PE2# set traffic-engineering",
                    "user@PE2# set area 0.0.0.0 interface lo0.0 passive",
                    "user@PE2# set area 0.0.0.0 interface ge-0/0/0.0"
                  ]
                },
                {
                  "step": 10,
                  "description": "配置路由策略和 BGP 社区信息。",
                  "code": [
                    "[edit policy-options]",
                    "user@PE2# set policy-statement exp-to-frwd term 0 from community vpls-com",
                    "user@PE2# set policy-statement exp-to-frwd term 0 then install-nexthop lsp to-pe1",
                    "user@PE2# set policy-statement exp-to-frwd term 0 then accept",
                    "user@PE2# set community vpls-com members target:100:100"
                  ]
                },
                {
                  "step": 11,
                  "description": "配置路由实例的类型并配置接口。",
                  "code": [
                    "[edit routing-instances l2vpn-inst]",
                    "user@PE2# set instance-type l2vpn",
                    "user@PE2# set interface ge-0/0/1.300"
                  ]
                },
                {
                  "step": 12,
                  "description": "例如 l2vpn-inst ，配置路由识别符，并配置 VRF 目标社区。",
                  "code": [
                    "[edit routing-instances l2vpn-inst]",
                    "user@PE2# set route-distinguisher 10.255.255.4:200",
                    "user@PE2# set vrf-target target:100:100"
                  ]
                },
                {
                  "step": 13,
                  "description": "配置 L2VPN 协议所需的封装类型。",
                  "code": [
                    "[edit routing-instances l2vpn-inst protocols l2vpn]",
                    "user@PE2# set encapsulation-type ethernet-vlan"
                  ]
                },
                {
                  "step": 14,
                  "description": "配置连接到提供商设备的站点。",
                  "code": [
                    "[edit routing-instances l2vpn-inst protocols l2vpn]",
                    "user@PE2# set site pe2 site-identifier 2",
                    "user@PE2# set site pe2 interface ge-0/0/1.300 remote-site-id 1"
                  ]
                },
                {
                  "step": 15,
                  "description": "为路由实例配置 L2VPN 协议，以提供播发功能以在接收方向上将流标签弹出到远程 PE，并提供播发功能以将流标签沿传输方向推送到远程 PE。",
                  "code": [
                    "[edit routing-instances l2vpn-inst protocols l2vpn]",
                    "user@PE2# set flow-label-transmit",
                    "user@PE2# set flow-label-receive"
                  ]
                },
                {
                  "step": 16,
                  "description": "配置路由实例的类型并配置接口。",
                  "code": [
                    "[edit routing-instances vpl1]",
                    "user@PE2# set instance-type vpls",
                    "user@PE2# set interface ge-0/0/1.600"
                  ]
                },
                {
                  "step": 17,
                  "description": "例如 vpl1 ，配置路由识别符，并配置 VRF 目标社区。",
                  "code": [
                    "[edit routing-instances vpl1]",
                    "user@PE2# set route-distinguisher 10.255.255.4:100",
                    "user@PE2# set vrf-target target:100:100"
                  ]
                },
                {
                  "step": 18,
                  "description": "为 VPLS 域分配最大站点标识符。",
                  "code": [
                    "[edit routing-instances vpl1 protocols vpls]",
                    "user@PE2# set site-range 10"
                  ]
                },
                {
                  "step": 19,
                  "description": "配置为不使用 VPLS 实例的隧道服务，并为连接到提供商设备的站点分配站点标识符。",
                  "code": [
                    "[edit routing-instances vpl1 protocols vpls]",
                    "user@PE2# set no-tunnel-services",
                    "user@PE2# set site vpl1PE2 site-identifier 2"
                  ]
                },
                {
                  "step": 20,
                  "description": "为路由实例配置 VPLS 协议，以提供播发功能以在接收方向向远程 PE 弹出流标签，并在传输到远程 PE 的方向上向推送流标签提供播发功能。",
                  "code": [
                    "[edit routing-instances vpl1 protocols vpls]",
                    "user@PE2# set flow-label-transmit",
                    "user@PE2# set flow-label-receive "
                  ]
                }
              ]
            }
          ]
        },
        {
          "title": "结果",
          "level": 4,
          "content": "在配置模式下，输入 show interfaces 、 show protocols 、 show routing-instances show policy-options 和 show routing-options 命令来确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
          "code": [
            "user@PE2#show interfacesge-0/0/0 {\n    unit 0 {\n        family inet {\n            address 2.0.0.2/24;\n        }\n        family mpls;\n    }\n}\nge-0/0/1 {\n    vlan-tagging;\n    mtu 1600;\n    encapsulation vlan-ccc;\n    unit 300 {\n        encapsulation vlan-ccc;\n        vlan-id 600;\n    }\n    unit 600 {\n        encapsulation vlan-vpls;\n        vlan-id 600;\n        family vpls;\n    }\n}\nlo0 {\n    unit 0 {\n        family inet {\n            address 10.255.255.4/32;\n        }\n    }\n}",
            "user@PE2#show protocolsrsvp {\n    interface all;\n    interface ge-0/0/1.0;\n    interface lo0.0;\n}\nmpls {\n    label-switched-path to-pe1 {\n        to 10.255.255.1;\n    }\n    interface ge-0/0/0.0;\n}\nbgp {\n    group vpls-pe {\n        type internal;\n        local-address 10.255.255.4;\n        family l2vpn {\n            auto-discovery-only;\n            signaling;\n        }\n        neighbor 10.255.255.1;\n        neighbor 10.255.255.2;\n    }\n}\nospf {\n    traffic-engineering;\n    area 0.0.0.0 {\n        interface lo0.0 {\n            passive;\n        }\n        interface ge-0/0/0.0;\n    }\n}",
            "user@PE2#show policy-optionspolicy-statement exp-to-frwd {\n    term 0 {\n        from community vpls-com;\n        then {\n            install-nexthop lsp to-pe1;\n            accept;\n        }\n    }\n}\ncommunity vpls-com members target:100:100;",
            "user@PE2#show routing-instancesl2vpn-inst {\n    instance-type l2vpn;\n    interface ge-0/0/1.300;\n    route-distinguisher 10.255.255.4:200;\n    vrf-target target:100:100;\n    protocols {\n        l2vpn {\n            encapsulation-type ethernet-vlan;\n            site pe2 {\n                site-identifier 2;\n                interface ge-0/0/1.300 {\n                    remote-site-id 1;\n                }\n            }\n            flow-label-transmit;\n            flow-label-receive;\n        }\n    }\n}\n vpl1 {\n    instance-type vpls;\n    interface ge-0/0/1.600;\n    route-distinguisher 10.255.255.4:100;\n    vrf-target target:100:100;\n    protocols {\n        vpls {\n            site-range 10;\n            no-tunnel-services;\n            site vpl1PE2 {\n                site-identifier 2;\n            }\n            flow-label-transmit;\n            flow-label-receive;\n        }\n    }\n}",
            "user@PE2#show routing-optionsrouter-id 10.255.255.4;\nautonomous-system 100;\nforwarding-table {\n    export exp-to-frwd;\n}"
          ]
        }
      ]
    }
  ],
  "content": "此示例说明如何为 BGP L2VPN 实现 FAT 伪线支持，以帮助均衡 MPLS 流量的负载。 要求 此示例使用以下硬件和软件组件： 五个 MX 系列路由器 在所有设备上运行的 Junos OS 16.1 或更高版本 在为 BGP L2VPN 配置 FAT 伪线支持之前，请确保配置路由和信令协议"
}