{
  "title": "示例：通过运行标记为单播的 BGP 的第 3 层 VPN 保护 IPv4 流量",
  "sections": [
    {
      "title": "要求",
      "level": 3,
      "content": "此示例使用以下硬件和软件组件： MX 系列路由器。 在所有设备上运行的 Junos OS 19.4R1 或更高版本。 此示例使用以下硬件和软件组件： MX 系列路由器。 在所有设备上运行的 Junos OS 19.4R1 或更高版本。"
    },
    {
      "title": "概述",
      "level": 3,
      "content": "以下拓扑通过在主路径不可用时将流量切换到备份路径来提供 ABR 和 ASBR 保护。 图 14 说明了运行标记为单播作为域间传输协议的 BGP 的第 3 层 VPN。 图 14： 使用 LDP 传输协议的 BGP 标记单播第 3 层 VPN 下表描述了拓扑中使用的组件： 主要组件 设备类型 位置 CE1 MX 系列 已连接到客户网络。 PE1 MX 系列 配置了主路由路径和备份路由路径，以保护和重新路由从 CE1 到 CE2 的流量。 P1-P3 MX 系列 用于传输流量的核心路由器。 ABR1-ABR2 MX 系列 区域边界路由器 ABSR1-ABSR4 MX 系列 自治系统边界路由器 RR1-RR3 MX 系列 路由反射器 PE2-PE3 MX 系列 PE 路由器连接到客户边缘路由器 （CE2）。 CE2 MX 系列 已连接到客户网络。 主要组件 设备类型 位置 CE1 MX 系列 已连接到客户网络。 PE1 配置了主路由路径和备份路由路径，以保护和重新路由从 CE1 到 CE2 的流量。 P1-P3 用于传输流量的核心路由器。 ABR1-ABR2 区域边界路由器 ABSR1-ABSR4 自治系统边界路由器 RR1-RR3 路由反射器 PE2-PE3 PE 路由器连接到客户边缘路由器 （CE2）。 CE2 PE2 和 PE3 设备地址 作为标记为单播路由从 ABR1 和 ABR2 获知 。这些路由通过 IGP/LDP 协议解析。PE1 从 PE2 和 PE3 设备学习 CE2 路由。",
      "sections": [
        {
          "title": "拓扑学",
          "level": 4,
          "content": "图 14 说明了运行标记为单播作为域间传输协议的 BGP 的第 3 层 VPN。 图 14： 使用 LDP 传输协议的 BGP 标记单播第 3 层 VPN 下表描述了拓扑中使用的组件： 主要组件 设备类型 位置 CE1 MX 系列 已连接到客户网络。 PE1 MX 系列 配置了主路由路径和备份路由路径，以保护和重新路由从 CE1 到 CE2 的流量。 P1-P3 MX 系列 用于传输流量的核心路由器。 ABR1-ABR2 MX 系列 区域边界路由器 ABSR1-ABSR4 MX 系列 自治系统边界路由器 RR1-RR3 MX 系列 路由反射器 PE2-PE3 MX 系列 PE 路由器连接到客户边缘路由器 （CE2）。 CE2 MX 系列 已连接到客户网络。 主要组件 设备类型 位置 CE1 MX 系列 已连接到客户网络。 PE1 配置了主路由路径和备份路由路径，以保护和重新路由从 CE1 到 CE2 的流量。 P1-P3 用于传输流量的核心路由器。 ABR1-ABR2 区域边界路由器 ABSR1-ABSR4 自治系统边界路由器 RR1-RR3 路由反射器 PE2-PE3 PE 路由器连接到客户边缘路由器 （CE2）。 CE2 PE2 和 PE3 设备地址 作为标记为单播路由从 ABR1 和 ABR2 获知 。这些路由通过 IGP/LDP 协议解析。PE1 从 PE2 和 PE3 设备学习 CE2 路由。",
          "images": [
            "BGP 会话的负载平衡\\images\\26_示例：通过运行标记为单播的_BGP_的第_1.png"
          ]
        }
      ]
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要使用以 LDP 作为传输协议的 BGP 标签单播配置 BGP PIC 边缘，请执行以下操作： 要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改详细信息，以便与网络配置匹配，将命令复制并粘贴到 [edit] 层级的 CLI 中，然后从配置模式进入 commit 。 设备 CE1 set interfaces ge-0/0/1 description CE1-to-PE1-Link1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.0/31 set interfaces ge-0/0/2 description CE1-to-PE1-Link2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.2/31 set interfaces lo0 unit 0 family inet address 10.4.4.4/32 set policy-options policy-statement nhs term 1 from interface lo0.0 set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set routing-options router-id 10.4.4.4 set routing-options autonomous-system 65004 set protocols bgp path-selection external-router-id set protocols bgp group toAs2 export nhs set protocols bgp group toAs2 peer-as 65002 set protocols bgp group toAs2 neighbor 192.168.0.1 set protocols bgp group toAs2 neighbor 192.168.0.3 设备 PE1 set interfaces ge-0/0/1 description PE1-to-CE1-Link1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.1/31 set interfaces ge-0/0/2 description PE1-to-CE1-Link2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.3/31 set interfaces ge-0/0/3 description PE1-to-P1 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.4/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.2.2.5/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0005.00 set policy-options policy-statement add-noexport term 1 then community add noexport set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement mp-resolv term 1 from route-filter 10.1.1.0/24 orlonger set policy-options policy-statement mp-resolv term 1 then accept set policy-options policy-statement mp-resolv term 1 then multipath-resolve set policy-options policy-statement mp-resolv term 2 from route-filter 10.2.2.0/24 orlonger set policy-options policy-statement mp-resolv term 2 then accept set policy-options policy-statement mp-resolv term 2 then multipath-resolve set policy-options policy-statement mp-resolv term def then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then local-preference 65200 set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set policy-options policy-statement vrf-export-red term 1 then community add leak2red set policy-options policy-statement vrf-export-red term 1 then accept set policy-options policy-statement vrf-import-red term 1 from community leak2red set policy-options policy-statement vrf-import-red term 1 then accept set policy-options community leak2red members target:100:100 set policy-options community noexport members no-export set policy-options community noexport members no-advertise set routing-instances red routing-options multipath preserve-nexthop-hierarchy set routing-instances red routing-options protect core set routing-instances red protocols bgp group toCE1 peer-as 4 set routing-instances red protocols bgp group toCE1 neighbor 192.168.0.2 set routing-instances red instance-type vrf set routing-instances red interface ge-0/0/2.0 set routing-instances red vrf-import vrf-import-red set routing-instances red vrf-export vrf-export-red set routing-options rib inet.3 protect core set routing-options route-distinguisher-id 10.2.2.5 set routing-options forwarding-table export pplb set routing-options resolution preserve-nexthop-hierarchy set routing-options resolution rib inet.0 import mp-resolv set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.2.2.5 set routing-options autonomous-system 2 set routing-options protect core set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set routing-options rib-groups inet3to0 import-rib inet.3 set routing-options rib-groups inet3to0 import-rib inet.0 set routing-options rib-groups inet3to0 import-policy add-noexport set protocols isis level 1 disable set protocols isis interface ge-0/0/3.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/3.0 set protocols ldp interface ge-0/0/3.0 set protocols mpls label-switched-path toABR1-gold to 10.2.2.3 set protocols mpls label-switched-path toABR1-bronze to 10.2.2.3 set protocols mpls label-switched-path toABR2-gold to 10.2.2.4 set protocols bgp path-selection external-router-id set protocols bgp group toAs2RR type internal set protocols bgp group toAs2RR local-address 10.2.2.5 set protocols bgp group toAs2RR family inet labeled-unicast rib-group inet3to0 set protocols bgp group toAs2RR family inet labeled-unicast add-path receive set protocols bgp group toAs2RR family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs2RR family inet labeled-unicast nexthop-resolution preserve-nexthop-hierarchy set protocols bgp group toAs2RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs2RR export nhs set protocols bgp group toAs2RR export export-inet3 set protocols bgp group toAs2RR neighbor 10.2.2.6 set protocols bgp group toAs4 peer-as 65004 set protocols bgp group toAs4 neighbor 192.168.0.0 set protocols bgp group toAs1PEs multihop no-nexthop-change set protocols bgp group toAs1PEs local-address 10.2.2.5 set protocols bgp group toAs1PEs family inet unicast set protocols bgp group toAs1PEs family inet-vpn unicast set protocols bgp group toAs1PEs family inet6 unicast set protocols bgp group toAs1PEs family inet6-vpn unicast set protocols bgp group toAs1PEs export nhs set protocols bgp group toAs1PEs peer-as 65001 set protocols bgp group toAs1PEs neighbor 10.1.1.1 set protocols bgp group toAs1PEs neighbor 10.1.1.2 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy set protocols bgp multipath 设备 P1 set interfaces ge-0/0/1 description P1-to-RR1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.6/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description P1-to-ABR1 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.8/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/3 description P1-to-PE1 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.5/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces ge-0/0/4 description P1-to-ABR2 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.10/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.8/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0008.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set routing-options router-id 10.2.2.8 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all 设备 RR1 set interfaces ge-0/0/1 description RR1-to-P1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.7/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.2.2.6/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0006.00 set policy-options policy-statement add-noexport term 1 then community add noexport set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement pplb then load-balance per-packet set policy-options community noexport members no-export set policy-options community noexport members no-advertise set routing-options forwarding-table export pplb set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.2.2.6 set routing-options autonomous-system 2 set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set routing-options rib-groups inet3to0 import-rib inet.3 set routing-options rib-groups inet3to0 import-rib inet.0 set routing-options rib-groups inet3to0 import-rib inet6.3 set routing-options rib-groups inet3to0 import-policy add-noexport set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all set protocols bgp path-selection external-router-id set protocols bgp group toAs2Reg2BNs type internal set protocols bgp group toAs2Reg2BNs family inet labeled-unicast rib-group inet3to0 set protocols bgp group toAs2Reg2BNs family inet labeled-unicast add-path receive set protocols bgp group toAs2Reg2BNs family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs2Reg2BNs family inet labeled-unicast rib inet.3 set protocols bgp group toAs2Reg2BNs export export-inet3 set protocols bgp group toAs2Reg2BNs neighbor 10.2.2.3 set protocols bgp group toAs2Reg2BNs neighbor 10.2.2.4 set protocols bgp group toAs2Reg2BNs neighbor 10.2.2.5 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy set protocols bgp local-address 10.2.2.6 set protocols bgp cluster 10.2.2.6 设备 ABR1 set interfaces ge-0/0/1 description ABR1-to-P2 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.12/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description ABR1-to-P1 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.9/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.3/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0003.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.2.2.3 set routing-options autonomous-system 65002 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls label-switched-path toASBR2-gold to 10.2.2.2 set protocols mpls label-switched-path toASBR1-bronze to 10.2.2.1 set protocols mpls label-switched-path toASBR2-bronze to 10.2.2.2 set protocols mpls interface all set protocols bgp group toAs2RR type internal set protocols bgp group toAs2RR local-address 10.2.2.3 set protocols bgp group toAs2RR advertise-inactive set protocols bgp group toAs2RR family inet labeled-unicast add-path receive set protocols bgp group toAs2RR family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs2RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs2RR export nhs set protocols bgp group toAs2RR cluster 10.2.2.3 set protocols bgp group toAs2RR neighbor 10.2.2.6 set protocols bgp group toAs2RR neighbor 10.2.2.7 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 ABR2 set interfaces ge-0/0/2 description ABR2-to-P2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.14/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/4 description ABR2-to-P1 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.11/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.4/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0004.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.2.2.4 set routing-options autonomous-system 65002 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls label-switched-path toASBR1-bronze to 10.2.2.1 set protocols mpls interface all set protocols bgp group toAs2RR type internal set protocols bgp group toAs2RR local-address 10.2.2.4 set protocols bgp group toAs2RR advertise-inactive set protocols bgp group toAs2RR family inet labeled-unicast add-path receive set protocols bgp group toAs2RR family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs2RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs2RR export nhs set protocols bgp group toAs2RR cluster 10.2.2.4 set protocols bgp group toAs2RR neighbor 10.2.2.6 set protocols bgp group toAs2RR neighbor 10.2.2.7 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 P2 set interfaces ge-0/0/1 description P2-to-ABR1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.13/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description P2-to-ABR2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.15/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/3 description P2-to-RR2 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.16/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces ge-0/0/4 description P2-to-ASBR1 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.18/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces ge-0/0/5 description P2-to-ASBR2 set interfaces ge-0/0/5 vlan-tagging set interfaces ge-0/0/5 unit 0 vlan-id 100 set interfaces ge-0/0/5 unit 0 family inet address 192.168.0.20/31 set interfaces ge-0/0/5 unit 0 family iso set interfaces ge-0/0/5 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.9/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0009.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set routing-options router-id 10.2.2.9 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all 设备 RR2 set interfaces ge-0/0/3 description RR2-to-P2 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.17/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.2.2.7/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0007.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.2.2.7 set routing-options autonomous-system 65002 set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all set protocols bgp path-selection external-router-id set protocols bgp group toAs2Reg1BNs type internal set protocols bgp group toAs2Reg1BNs family inet labeled-unicast add-path receive set protocols bgp group toAs2Reg1BNs family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs2Reg1BNs family inet labeled-unicast rib inet.3 set protocols bgp group toAs2Reg1BNs neighbor 10.2.2.1 set protocols bgp group toAs2Reg1BNs neighbor 10.2.2.2 set protocols bgp group toAs2Reg1BNs neighbor 10.2.2.3 set protocols bgp group toAs2Reg1BNs neighbor 10.2.2.4 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy set protocols bgp local-address 10.2.2.7 set protocols bgp cluster 10.2.2.7 设备 ASBR1 set interfaces ge-0/0/2 description ASBR1-to-ASBR3 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.22/31 set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/3 description ASBR1-to-ASBR4 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.24/31 set interfaces ge-0/0/3 unit 0 family mpls set interfaces ge-0/0/4 description ASBR1-to-P2 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.19/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.1/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0001.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.2.2.1 set routing-options autonomous-system 65002 set protocols isis level 1 disable set protocols isis interface ge-0/0/4.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/4.0 set protocols ldp interface ge-0/0/4.0 set protocols mpls interface ge-0/0/4.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs1-T family inet labeled-unicast rib inet.3 set protocols bgp group toAs1-T peer-as 1 set protocols bgp group toAs1-T neighbor 192.168.0.23 set protocols bgp group toAs1-T neighbor 192.168.0.27 set protocols bgp group toAs2RR type internal set protocols bgp group toAs2RR local-address 10.2.2.1 set protocols bgp group toAs2RR advertise-external set protocols bgp group toAs2RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs2RR export nhs set protocols bgp group toAs2RR neighbor 10.2.2.7 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 ASBR2 set interfaces ge-0/0/1 description ASBR2-to-ASBR3 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.28/31 set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description ASBR2-to-ASBR4 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.26/31 set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/5 description ASBR2-to-P2 set interfaces ge-0/0/5 vlan-tagging set interfaces ge-0/0/5 unit 0 vlan-id 100 set interfaces ge-0/0/5 unit 0 family inet address 192.168.0.21/31 set interfaces ge-0/0/5 unit 0 family iso set interfaces ge-0/0/5 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.2/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0002.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.2.2.2 set routing-options autonomous-system 65002 set protocols isis level 1 disable set protocols isis interface ge-0/0/5.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/5.0 set protocols ldp interface ge-0/0/5.0 set protocols mpls interface ge-0/0/5.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs1-T family inet labeled-unicast rib inet.3 set protocols bgp group toAs1-T peer-as 1 set protocols bgp group toAs1-T neighbor 192.168.0.29 set protocols bgp group toAs1-T neighbor 192.168.0.25 set protocols bgp group toAs2RR type internal set protocols bgp group toAs2RR local-address 10.2.2.2 set protocols bgp group toAs2RR advertise-external set protocols bgp group toAs2RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs2RR export nhs set protocols bgp group toAs2RR neighbor 10.2.2.7 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 ASBR3 set interfaces ge-0/0/1 description ASBR3-to-ASBR2 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.29/31 set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description ASBR3-to-ASBR1 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.23/31 set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/4 description ASBR3-to-P3 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.30/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.1.1.3/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0003.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.1.1.3 set routing-options autonomous-system 65001 set protocols isis level 1 disable set protocols isis interface ge-0/0/4.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/4.0 set protocols ldp interface ge-0/0/4.0 set protocols mpls label-switched-path toPE2-gold to 10.1.1.1 set protocols mpls interface ge-0/0/4.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs2-T family inet labeled-unicast rib inet.3 set protocols bgp group toAs2-T peer-as 65002 set protocols bgp group toAs2-T neighbor 192.168.0.22 set protocols bgp group toAs2-T neighbor 192.168.0.28 set protocols bgp group toAs1RR type internal set protocols bgp group toAs1RR local-address 10.1.1.3 set protocols bgp group toAs1RR advertise-external set protocols bgp group toAs1RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs1RR export nhs set protocols bgp group toAs1RR neighbor 10.1.1.6 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 ASBR4 set interfaces ge-0/0/1 description ASBR4-to-P3 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.32/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description ASBR4-to-ASBR2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.27/31 set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/3 description ASBR4-to-ASBR1 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.25/31 set interfaces ge-0/0/3 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.1.1.4/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0004.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.1.1.4 set routing-options autonomous-system 65001 set protocols isis level 1 disable set protocols isis interface ge-0/0/1.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/1.0 set protocols ldp interface ge-0/0/1.0 set protocols mpls label-switched-path toPE2-bronze to 10.1.1.1 set protocols mpls label-switched-path toPE3-bronze to 10.1.1.2 set protocols mpls interface ge-0/0/1.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs2-T family inet labeled-unicast rib inet.3 set protocols bgp group toAs2-T peer-as 2 set protocols bgp group toAs2-T neighbor 192.168.0.26 set protocols bgp group toAs2-T neighbor 192.168.0.24 set protocols bgp group toAs1RR type internal set protocols bgp group toAs1RR local-address 10.1.1.4 set protocols bgp group toAs1RR advertise-external set protocols bgp group toAs1RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs1RR export nhs set protocols bgp group toAs1RR neighbor 10.1.1.6 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 RR3 set interfaces ge-0/0/2 description RR3-to-P3 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.35/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.1.1.6/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0006.00 set policy-options policy-statement add-noexport term 1 then community add noexport set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement pplb then load-balance per-packet set policy-options community noexport members no-export set policy-options community noexport members no-advertise set routing-options forwarding-table export pplb set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.1.1.6 set routing-options autonomous-system 1 set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set routing-options rib-groups inet3to0 import-rib inet.3 set routing-options rib-groups inet3to0 import-rib inet.0 set routing-options rib-groups inet3to0 import-policy add-noexport set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all set protocols bgp path-selection external-router-id set protocols bgp group toAs1BNs type internal set protocols bgp group toAs1BNs family inet labeled-unicast rib-group inet3to0 set protocols bgp group toAs1BNs family inet labeled-unicast add-path receive set protocols bgp group toAs1BNs family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs1BNs family inet labeled-unicast rib inet.3 set protocols bgp group toAs1BNs export export-inet3 set protocols bgp group toAs1BNs neighbor 10.1.1.3 set protocols bgp group toAs1BNs neighbor 10.1.1.4 set protocols bgp group toAs1BNs neighbor 10.1.1.2 set protocols bgp group toAs1BNs neighbor 10.1.1.1 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy set protocols bgp local-address 10.1.1.6 set protocols bgp cluster 10.1.1.6 设备 P3 set interfaces ge-0/0/1 description P3-to-ASBR4 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.33/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description P3-to-RR3 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.34/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/3 description P3-to-PE2 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.36/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces ge-0/0/4 description P3-to-ASBR3 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.31/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces ge-0/0/5 description P3-to-PE3 set interfaces ge-0/0/5 vlan-tagging set interfaces ge-0/0/5 unit 0 vlan-id 100 set interfaces ge-0/0/5 unit 0 family inet address 192.168.0.38/31 set interfaces ge-0/0/5 unit 0 family iso set interfaces ge-0/0/5 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.1.1.5/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0005.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set routing-options router-id 10.1.1.5 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all 设备 PE2 set interfaces ge-0/0/1 description PE2-to-CE2-Link1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.40/31 set interfaces ge-0/0/2 description PE2-to-CE2-Link2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.42/31 set interfaces ge-0/0/3 description PE2-to-P3 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.37/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.1.1.1/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0001.00 set policy-options policy-statement add-noexport term 1 then community add noexport set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then metric add 0 set policy-options policy-statement nhs term 1 then local-preference 200 set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set policy-options policy-statement vrf-export-red term 1 then community add leak2red set policy-options policy-statement vrf-export-red term 1 then accept set policy-options policy-statement vrf-import-red term 1 from community leak2red set policy-options policy-statement vrf-import-red term 1 then accept set policy-options community leak2red members target:100:100 set policy-options community noexport members no-export set policy-options community noexport members no-advertise set routing-instances red protocols bgp group toCE2 peer-as 65003 set routing-instances red protocols bgp group toCE2 neighbor 192.168.0.43 set routing-instances red instance-type vrf set routing-instances red interface ge-0/0/2.0 set routing-instances red vrf-import vrf-import-red set routing-instances red vrf-export vrf-export-red set routing-options route-distinguisher-id 10.1.1.1 set routing-options forwarding-table export pplb set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.1.1.1 set routing-options autonomous-system 1 set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set routing-options rib-groups inet3to0 import-rib inet.3 set routing-options rib-groups inet3to0 import-rib inet.0 set routing-options rib-groups inet3to0 import-policy add-noexport set protocols isis level 1 disable set protocols isis interface ge-0/0/3.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/3.0 set protocols ldp interface ge-0/0/3.0 set protocols mpls interface ge-0/0/3.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs3-1 peer-as 65003 set protocols bgp group toAs3-1 neighbor 192.168.0.41 set protocols bgp group toAs1RR type internal set protocols bgp group toAs1RR local-address 10.1.1.1 set protocols bgp group toAs1RR advertise-external set protocols bgp group toAs1RR family inet labeled-unicast rib-group inet3to0 set protocols bgp group toAs1RR family inet labeled-unicast add-path receive set protocols bgp group toAs1RR family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs1RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs1RR family inet6-vpn unicast set protocols bgp group toAs1RR export nhs set protocols bgp group toAs1RR export export-inet3 set protocols bgp group toAs1RR neighbor 10.1.1.6 set protocols bgp group toAs2PEs multihop no-nexthop-change set protocols bgp group toAs2PEs local-address 10.1.1.1 set protocols bgp group toAs2PEs family inet unicast set protocols bgp group toAs2PEs family inet-vpn unicast set protocols bgp group toAs2PEs family inet6 unicast set protocols bgp group toAs2PEs family inet6-vpn unicast set protocols bgp group toAs2PEs export nhs set protocols bgp group toAs2PEs peer-as 65002 set protocols bgp group toAs2PEs neighbor 10.2.2.5 set protocols bgp group toAs2PEs vpn-apply-export set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 PE3 set interfaces ge-0/0/3 description PE3-to-CE2-Link1 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.44/31 set interfaces ge-0/0/4 description PE3-to-CE2-Link2 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.46/31 set interfaces ge-0/0/5 description PE3-to-P3 set interfaces ge-0/0/5 vlan-tagging set interfaces ge-0/0/5 unit 0 vlan-id 100 set interfaces ge-0/0/5 unit 0 family inet address 192.168.0.39/31 set interfaces ge-0/0/5 unit 0 family iso set interfaces ge-0/0/5 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.1.1.2/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0002.00 set policy-options policy-statement add-noexport term 1 then community add noexport set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then metric add 0 set policy-options policy-statement nhs term 1 then local-preference 200 set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set policy-options policy-statement vrf-export-red term 1 then community add leak2red set policy-options policy-statement vrf-export-red term 1 then accept set policy-options policy-statement vrf-import-red term 1 from community leak2red set policy-options policy-statement vrf-import-red term 1 then accept set policy-options community leak2red members target:100:100 set policy-options community noexport members no-export set policy-options community noexport members no-advertise set routing-instances red protocols bgp group toCE2 peer-as 65003 set routing-instances red protocols bgp group toCE2 neighbor 192.168.0.47 set routing-instances red instance-type vrf set routing-instances red interface ge-0/0/4.0 set routing-instances red vrf-import vrf-import-red set routing-instances red vrf-export vrf-export-red set routing-options route-distinguisher-id 10.1.1.2 set routing-options forwarding-table export pplb set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.1.1.2 set routing-options autonomous-system 1 set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set routing-options rib-groups inet3to0 import-rib inet.3 set routing-options rib-groups inet3to0 import-rib inet.0 set routing-options rib-groups inet3to0 import-policy add-noexport set protocols isis level 1 disable set protocols isis interface ge-0/0/5.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/5.0 set protocols ldp interface ge-0/0/5.0 set protocols mpls interface ge-0/0/5.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs3 peer-as 65003 set protocols bgp group toAs3 neighbor 192.168.0.45 set protocols bgp group toAs1RR type internal set protocols bgp group toAs1RR local-address 10.1.1.2 set protocols bgp group toAs1RR advertise-external set protocols bgp group toAs1RR family inet labeled-unicast rib-group inet3to0 set protocols bgp group toAs1RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs1RR export nhs set protocols bgp group toAs1RR export export-inet3 set protocols bgp group toAs1RR neighbor 10.1.1.6 set protocols bgp group toAs2PEs multihop no-nexthop-change set protocols bgp group toAs2PEs local-address 10.1.1.2 set protocols bgp group toAs2PEs family inet unicast set protocols bgp group toAs2PEs family inet-vpn unicast set protocols bgp group toAs2PEs family inet6 unicast set protocols bgp group toAs2PEs family inet6-vpn unicast set protocols bgp group toAs2PEs export nhs set protocols bgp group toAs2PEs peer-as 65002 set protocols bgp group toAs2PEs neighbor 10.2.2.5 set protocols bgp group toAs2PEs vpn-apply-export set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 CE2 set interfaces ge-0/0/1 description CE2-to-PE2-Link1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.41/31 set interfaces ge-0/0/2 description CE2-to-PE2-Link2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.43/31 set interfaces ge-0/0/3 description CE2-to-PE3-Link1 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.45/31 set interfaces ge-0/0/4 description CE2-to-PE3-Link2 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.47/31 set interfaces lo0 unit 0 family inet address 10.3.3.3/32 set policy-options policy-statement nhs term 1 from interface lo0.0 set policy-options policy-statement nhs term 1 then metric 50 set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement nhsMED100 term 1 from interface lo0.0 set policy-options policy-statement nhsMED100 term 1 then metric 100 set policy-options policy-statement nhsMED100 term 1 then next-hop self set policy-options policy-statement nhsMED100 term 1 then accept set policy-options community map2bronze members 100:200 set policy-options community map2gold members 100:100 set policy-options community map2gold_bronze_plain members 300:400 set routing-options router-id 10.3.3.3 set routing-options autonomous-system 65003 set protocols bgp path-selection external-router-id set protocols bgp group toAs1Internet export nhs set protocols bgp group toAs1Internet peer-as 65001 set protocols bgp group toAs1Internet neighbor 192.168.0.40 set protocols bgp group toAs1Internet neighbor 192.168.0.44 export nhsMED100 set protocols bgp group toAs1L3VPN export nhs set protocols bgp group toAs1L3VPN peer-as 65001 set protocols bgp group toAs1L3VPN neighbor 192.168.0.46 set protocols bgp group toAs1L3VPN neighbor 192.168.0.42 export nhsMED100 下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南 中的在 配置模式下使用 CLI 编辑器 。 要配置设备 CE1： 配置接口以启用 IP 和 MPLS 传输。 [edit interfaces] user@CE1# set ge-0/0/1 description CE1-to-PE1-Link1 user@CE1# set ge-0/0/1 vlan-tagging user@CE1# set ge-0/0/1 unit 0 vlan-id 100 user@CE1# set ge-0/0/1 unit 0 family inet address 192.168.0.0/31 user@CE1# set ge-0/0/2 description CE1-to-PE1-Link2 user@CE1# set ge-0/0/2 vlan-tagging user@CE1# set ge-0/0/2 unit 0 vlan-id 100 user@CE1# set ge-0/0/2 unit 0 family inet address 192.168.0.2/31 配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。 [edit interfaces] user@CE1# set lo0 unit 0 family inet address 10.4.4.4/32 配置多路径解析策略以将分层多路径安装到 PFE 中。 [edit policy-options] user@CE1# set policy-statement nhs term 1 from interface lo0.0 user@CE1# set policy-statement nhs term 1 then next-hop self user@CE1# set policy-statement nhs term 1 then accept 配置路由选项。 [edit routing-options] user@CE1# set router-id 10.4.4.4 user@CE1# set autonomous-system 65004 将标记为单播的 BGP 配置为 ABR，以将环路 IP 地址交换为 BGP 标记的单播前缀。 [edit protocols bgp] user@CE1# set path-selection external-router-id user@CE1# set group toAs2 export nhs user@CE1# set group toAs2 peer-as 65002 user@CE1# set group toAs2 neighbor 192.168.0.1 user@CE1# set group toAs2 neighbor 192.168.0.3 在配置模式下，输入 show interfaces 、 show policy-options 、 show routing-options 和 show protocols 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/1 { description CE1-to-PE1-Link1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.0/31; } } } ge-0/0/2 { description CE1-to-PE1-Link2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.2/31; } } } lo0 { unit 0 { family inet { address 10.4.4.4/32; } } } } policy-options { policy-statement nhs { term 1 { from interface lo0.0; then { next-hop self; accept; } } } } routing-options { router-id 10.4.4.4; autonomous-system 65004; } protocols { bgp { path-selection external-router-id; group toAs2 { export nhs; peer-as 65002; neighbor 192.168.0.1; neighbor 192.168.0.3; } } } 要配置设备 PE1： [edit interfaces] user@PE1# set ge-0/0/1 description PE1-to-CE1-Link1 user@PE1# set ge-0/0/1 vlan-tagging user@PE1# set ge-0/0/1 unit 0 vlan-id 100 user@PE1# set ge-0/0/1 unit 0 family inet address 192.168.0.1/31 user@PE1# set ge-0/0/2 description PE1-to-CE1-Link2 user@PE1# set ge-0/0/2 vlan-tagging user@PE1# set ge-0/0/2 unit 0 vlan-id 100 user@PE1# set ge-0/0/2 unit 0 family inet address 192.168.0.3/31 user@PE1# set ge-0/0/3 description PE1-to-P1 user@PE1# set ge-0/0/3 vlan-tagging user@PE1# set ge-0/0/3 unit 0 vlan-id 100 user@PE1# set ge-0/0/3 unit 0 family inet address 192.168.0.4/31 user@PE1# set ge-0/0/3 unit 0 family iso user@PE1# set ge-0/0/3 unit 0 family mpls [edit interfaces] user@PE1# set lo0 unit 1 family inet address 10.2.2.5/32 user@PE1# set lo0 unit 1 family iso address 49.0000.0000.aaaa.0005.00 [edit policy-options] user@PE1# set policy-statement add-noexport term 1 then community add noexport user@PE1# set policy-statement allow-lo0 term 1 from interface lo0.1 user@PE1# set policy-statement allow-lo0 term 1 then accept user@PE1# set policy-statement allow-lo0 term 2 then reject user@PE1# set policy-statement export-inet3 term 1 from rib inet.3 user@PE1# set policy-statement export-inet3 term 1 then accept user@PE1# set policy-statement export-inet3 term 2 then reject user@PE1# set policy-statement mp-resolv term 1 from route-filter 10.1.1.0/24 orlonger user@PE1# set policy-statement mp-resolv term 1 then accept user@PE1# set policy-statement mp-resolv term 1 then multipath-resolve user@PE1# set policy-statement mp-resolv term 2 from route-filter 10.2.2.0/24 orlonger user@PE1# set policy-statement mp-resolv term 2 then accept user@PE1# set policy-statement mp-resolv term 2 then multipath-resolve user@PE1# set policy-statement mp-resolv term def then reject user@PE1# set policy-statement nhs term 1 from protocol bgp user@PE1# set policy-statement nhs term 1 then local-preference 200 user@PE1# set policy-statement nhs term 1 then next-hop self user@PE1# set policy-statement nhs term 1 then accept user@PE1# set policy-statement pplb then load-balance per-packet user@PE1# set policy-statement vrf-export-red term 1 then community add leak2red user@PE1# set policy-statement vrf-export-red term 1 then accept user@PE1# set policy-statement vrf-import-red term 1 from community leak2red user@PE1# set policy-statement vrf-import-red term 1 then accept user@PE1# set community leak2red members target:100:100 user@PE1# set community noexport members no-export user@PE1# set community noexport members no-advertise 配置第 3 层 VPN 路由实例以提供客户服务。 [edit routing-instances] user@PE1# set red routing-options multipath preserve-nexthop-hierarchy user@PE1# set red routing-options protect core user@PE1# set red protocols bgp group toCE1 peer-as 65004 user@PE1# set red protocols bgp group toCE1 neighbor 192.168.0.2 user@PE1# set red instance-type vrf user@PE1# set red interface ge-0/0/2.0 user@PE1# set red vrf-import vrf-import-red user@PE1# set red vrf-export vrf-export-red 配置解析器 RIB 导入策略和解析 RIB，以便为策略中指定的选定第 3 层 VPN 前缀启用扩展的分层下一跃点结构。 [edit routing-options] user@PE1# set rib inet.3 protect core user@PE1# set route-distinguisher-id 10.2.2.5 user@PE1# set forwarding-table export pplb user@PE1# set resolution preserve-nexthop-hierarchy user@PE1# set resolution rib inet.0 import mp-resolv user@PE1# set interface-routes rib-group inet inet0to3 user@PE1# set router-id 10.2.2.5 user@PE1# set autonomous-system 65002 user@PE1# set protect core user@PE1# set rib-groups inet0to3 import-rib inet.0 user@PE1# set rib-groups inet0to3 import-rib inet.3 user@PE1# set rib-groups inet0to3 import-policy allow-lo0 user@PE1# set rib-groups inet3to0 import-rib inet.3 user@PE1# set rib-groups inet3to0 import-rib inet.0 user@PE1# set rib-groups inet3to0 import-policy add-noexport 配置 OSPF 协议。 [edit protocols ospf] user@PE1# set protocols ospf area 0.0.0.0 interface all link-protection; user@PE1# set protocols ospf area 0.0.0.0 interface fxp0.0 disable; user@PE1# set protocols ospf area 0.0.0.0 interface lo0.0 passive; 配置路由协议以在整个域中建立 IP 和 MPLS 连接。 [edit protocols] user@PE1# set isis level 1 disable user@PE1# set isis interface ge-0/0/3.0 user@PE1# set isis export allow-lo0 user@PE1# set isis topologies ipv6-unicast user@PE1# set rsvp interface ge-0/0/3.0 user@PE1# set ldp interface ge-0/0/3.0 user@PE1# set mpls label-switched-path toABR1-gold to 10.2.2.3 user@PE1# set mpls label-switched-path toABR1-bronze to 10.2.2.3 user@PE1# set mpls label-switched-path toABR2-gold to 10.2.2.4 [edit protocols bgp] user@PE1# set path-selection external-router-id user@PE1# set group toAs2RR type internal user@PE1# set group toAs2RR local-address 10.2.2.5 user@PE1# set group toAs2RR family inet labeled-unicast rib-group inet3to0 user@PE1# set group toAs2RR family inet labeled-unicast add-path receive user@PE1# set group toAs2RR family inet labeled-unicast add-path send path-count 4 user@PE1# set group toAs2RR family inet labeled-unicast nexthop-resolution preserve-nexthop-hierarchy user@PE1# set group toAs2RR family inet labeled-unicast rib inet.3 user@PE1# set group toAs2RR export nhs user@PE1# set group toAs2RR export export-inet3 user@PE1# set group toAs2RR neighbor 10.2.2.6 user@PE1# set group toAs4 peer-as 65004 user@PE1# set group toAs4 neighbor 192.168.0.0 user@PE1# set group toAs1PEs multihop no-nexthop-change user@PE1# set group toAs1PEs local-address 10.2.2.5 user@PE1# set group toAs1PEs family inet unicast user@PE1# set group toAs1PEs family inet-vpn unicast user@PE1# set group toAs1PEs family inet6 unicast user@PE1# set group toAs1PEs family inet6-vpn unicast user@PE1# set group toAs1PEs export nhs user@PE1# set group toAs1PEs peer-as 65001 user@PE1# set group toAs1PEs neighbor 10.1.1.1 user@PE1# set group toAs1PEs neighbor 10 .1.1.2 user@PE1# set traceoptions file bgp.log user@PE1# set traceoptions file size 100m user@PE1# set traceoptions flag state detail user@PE1# set traceoptions flag policy user@PE1# set multipath 在配置模式下，输入 show chassis 、 show interfaces 、 show policy-options 、 show routing-instances 和 show routing-options show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/1 { description PE1-to-CE1-Link1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.1/31; } } } ge-0/0/2 { description PE1-to-CE1-Link2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.3/31; } } } ge-0/0/3 { description PE1-to-P1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.4/31; } family iso; family mpls; } } lo0 { unit 1 { family inet { address 10.2.2.5/32; } family iso { address 49.0000.0000.aaaa.0005.00; } } } } policy-options { policy-statement add-noexport { term 1 { then { community add noexport; } } } policy-statement allow-lo0 { term 1 { from interface lo0.1; then accept; } term 2 { then reject; } } policy-statement export-inet3 { term 1 { from rib inet.3; then accept; } term 2 { then reject; } } policy-statement mp-resolv { term 1 { from { route-filter 10.1.1.0/24 orlonger; } then { accept; multipath-resolve; } } term 2 { from { route-filter 10.2.2.0/24 orlonger; } then { accept; multipath-resolve; } } term def { then reject; } } policy-statement nhs { term 1 { from protocol bgp; then { local-preference 200; next-hop self; accept; } } } policy-statement pplb { then { load-balance per-packet; } } policy-statement vrf-export-red { term 1 { then { community add leak2red; accept; } } } policy-statement vrf-import-red { term 1 { from community leak2red; then accept; } } community leak2red members target:100:100; community noexport members [ no-export no-advertise ]; } routing-instances { red { routing-options { multipath preserve-nexthop-hierarchy; protect core; } protocols { bgp { group toCE1 { peer-as 65004; neighbor 192.168.0.2; } } } instance-type vrf; interface ge-0/0/2.0; vrf-import vrf-import-red; vrf-export vrf-export-red; } } routing-options { rib inet.3 { protect core; } route-distinguisher-id 10.2.2.5; forwarding-table { export pplb; } resolution { preserve-nexthop-hierarchy; rib inet.0 { import mp-resolv; } } interface-routes { rib-group inet inet0to3; } router-id 10.2.2.5; autonomous-system 65002; protect core; rib-groups { inet0to3 { import-rib [ inet.0 inet.3 ]; import-policy allow-lo0; } inet3to0 { import-rib [ inet.3 inet.0 ]; import-policy add-noexport; } } } protocols { isis { level 1 disable; interface ge-0/0/3.0; export allow-lo0; topologies ipv6-unicast; } rsvp { interface ge-0/0/3.0; } bgp { path-selection external-router-id; group toAs2RR { type internal; local-address 10.2.2.5; family inet { labeled-unicast { rib-group inet3to0; add-path { receive; send { path-count 4; } } nexthop-resolution { preserve-nexthop-hierarchy; } rib { inet.3; } } } export [ nhs export-inet3 ]; neighbor 10.2.2.6; } group toAs4 { peer-as 65004; neighbor 192.168.0.0; } group toAs1PEs { multihop { no-nexthop-change; } local-address 10.2.2.5; family inet { unicast; } family inet-vpn { unicast; } family inet6 { unicast; } family inet6-vpn { unicast; } export nhs; peer-as 65001; neighbor 10.1.1.1; neighbor 10.1.1.2; } traceoptions { file bgp.log size 100m; flag state detail; flag policy; } multipath; } ldp { interface ge-0/0/3.0; } mpls { label-switched-path toABR1-gold { to 10.2.2.3; } label-switched-path toABR1-bronze { to 10.2.2.3; } label-switched-path toABR2-gold { to 10.2.2.4; } } } 要配置设备 P1： 配置接口。 [edit interfaces] user@P1# set ge-0/0/1 description P1-to-RR1 user@P1# set ge-0/0/1 vlan-tagging user@P1# set ge-0/0/1 unit 0 vlan-id 100 user@P1# set ge-0/0/1 unit 0 family inet address 192.168.0.6/31 user@P1# set ge-0/0/1 unit 0 family iso user@P1# set ge-0/0/1 unit 0 family mpls user@P1# set ge-0/0/2 description P1-to-ABR1 user@P1# set ge-0/0/2 vlan-tagging user@P1# set ge-0/0/2 unit 0 vlan-id 100 user@P1# set ge-0/0/2 unit 0 family inet address 192.168.0.8/31 user@P1# set ge-0/0/2 unit 0 family iso user@P1# set ge-0/0/2 unit 0 family mpls user@P1# set ge-0/0/3 description P1-to-PE1 user@P1# set ge-0/0/3 vlan-tagging user@P1# set ge-0/0/3 unit 0 vlan-id 100 user@P1# set ge-0/0/3 unit 0 family inet address 192.168.0.5/31 user@P1# set ge-0/0/3 unit 0 family iso user@P1# set ge-0/0/3 unit 0 family mpls user@P1# set ge-0/0/4 description P1-to-ABR2 user@P1# set ge-0/0/4 vlan-tagging user@P1# set ge-0/0/4 unit 0 vlan-id 100 user@P1# set ge-0/0/4 unit 0 family inet address 192.168.0.10/31 user@P1# set ge-0/0/4 unit 0 family iso user@P1# set ge-0/0/4 unit 0 family mpls 配置环路接口。 [edit interfaces] user@P1# set lo0 unit 0 family inet address 10.2.2.8/32 user@P1# set lo0 unit 0 family iso address 49.0000.0000.aaaa.0008.00 [edit policy-options] user@P1# set policy-statement allow-lo0 term 1 from interface lo0.0 user@P1# set policy-statement allow-lo0 term 1 then accept user@P1# set policy-statement allow-lo0 term 2 then reject [edit routing-options] user@P1# set router-id 10.2.2.8 在接口上配置 ISIS、RSVP、LDP 和 MPLS 协议。 [edit protocols] user@P1# set isis level 1 disable user@P1# set isis interface all user@P1# set isis export allow-lo0 user@P1# set isis topologies ipv6-unicast user@P1# set rsvp interface all user@P1# set ldp interface all user@P1# set mpls interface all 在配置模式下，输入 show interfaces 、 show policy-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/1 { description P1-to-RR1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.6/31; } family iso; family mpls; } } ge-0/0/2 { description P1-to-ABR1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.8/31; } family iso; family mpls; } } ge-0/0/3 { description P1-to-PE1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.5/31; } family iso; family mpls; } } ge-0/0/4 { description P1-to-ABR2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.10/31; } family iso; family mpls; } } lo0 { unit 0 { family inet { address 10.2.2.8/32; } family iso { address 49.0000.0000.aaaa.0008.00; } } } } policy-options { policy-statement allow-lo0 { term 1 { from interface lo0.0; then accept; } term 2 { then reject; } } } routing-options { router-id 10.2.2.8; } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } ldp { interface all; } mpls { interface all; } } 要配置设备 RR1： [edit interfaces] user@RR1# set ge-0/0/1 description RR1-to-P1 user@RR1# set ge-0/0/1 vlan-tagging user@RR1# set ge-0/0/1 unit 0 vlan-id 100 user@RR1# set ge-0/0/1 unit 0 family inet address 192.168.0.7/31 user@RR1# set ge-0/0/1 unit 0 family iso user@RR1# set ge-0/0/1 unit 0 family mpls [edit interfaces] user@RR1# set lo0 unit 1 family inet address 10.2.2.6/32 user@RR1# set lo0 unit 1 family iso address 49.0000.0000.aaaa.0006.00 [edit policy-options] user@RR1# set policy-statement add-noexport term 1 then community add noexport user@RR1# set policy-statement allow-lo0 term 1 from interface lo0.1 user@RR1# set policy-statement allow-lo0 term 1 then accept user@RR1# set policy-statement allow-lo0 term 2 then reject user@RR1# set policy-statement export-inet3 term 1 from rib inet.3 user@RR1# set policy-statement export-inet3 term 1 then accept user@RR1# set policy-statement export-inet3 term 2 then reject user@RR1# set policy-statement pplb then load-balance per-packet user@RR1# set community noexport members no-export user@RR1# set community noexport members no-advertise [edit routing-options] user@RR1# set forwarding-table export pplb user@RR1# set interface-routes rib-group inet inet0to3 user@RR1# set router-id 10.2.2.6 user@RR1# set autonomous-system 2 user@RR1# set rib-groups inet0to3 import-rib inet.0 user@RR1# set rib-groups inet0to3 import-rib inet.3 user@RR1# set rib-groups inet0to3 import-policy allow-lo0 user@RR1# set rib-groups inet3to0 import-rib inet.3 user@RR1# set rib-groups inet3to0 import-rib inet.0 user@RR1# set rib-groups inet3to0 import-rib inet6.3 user@RR1# set rib-groups inet3to0 import-policy add-noexport [edit protocols] user@RR1# set isis level 1 disable user@RR1# set isis interface all user@RR1# set isis export allow-lo0 user@RR1# set isis topologies ipv6-unicast user@RR1# set rsvp interface all user@RR1# set ldp interface all user@RR1# set mpls interface all 配置 BGP 标记的单播，以将环路 IP 地址交换为 BGP 标记的单播前缀。 [edit protocols bgp] user@RR1# set path-selection external-router-id user@RR1# set group toAs2Reg2BNs type internal user@RR1# set group toAs2Reg2BNs family inet labeled-unicast rib-group inet3to0 user@RR1# set group toAs2Reg2BNs family inet labeled-unicast add-path receive user@RR1# set group toAs2Reg2BNs family inet labeled-unicast add-path send path-count 4 user@RR1# set group toAs2Reg2BNs family inet labeled-unicast rib inet.3 user@RR1# set group toAs2Reg2BNs export export-inet3 user@RR1# set group toAs2Reg2BNs neighbor 10.2.2.3 user@RR1# set group toAs2Reg2BNs neighbor 10.2.2.4 user@RR1# set group toAs2Reg2BNs neighbor 10.2.2.5 user@RR1# set traceoptions file bgp.log user@RR1# set traceoptions file size 100m user@RR1# set traceoptions flag state detail user@RR1# set traceoptions flag policy user@RR1# set local-address 10.2.2.6 user@RR1# set cluster 10.2.2.6 在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/1 { description RR1-to-P1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.7/31; } family iso; family mpls; } } lo0 { unit 1 { family inet { address 10.2.2.6/32; } family iso { address 49.0000.0000.aaaa.0006.00; } } } } policy-options { policy-statement add-noexport { term 1 { then { community add noexport; } } } policy-statement allow-lo0 { term 1 { from interface lo0.1; then accept; } term 2 { then reject; } } policy-statement export-inet3 { term 1 { from rib inet.3; then accept; } term 2 { then reject; } } policy-statement pplb { then { load-balance per-packet; } } community noexport members [ no-export no-advertise ]; } routing-options { forwarding-table { export pplb; } interface-routes { rib-group inet inet0to3; } router-id 10.2.2.6; autonomous-system 2; rib-groups { inet0to3 { import-rib [ inet.0 inet.3 ]; import-policy allow-lo0; } inet3to0 { import-rib [ inet.3 inet.0 inet6.3 ]; import-policy add-noexport; } } } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } bgp { path-selection external-router-id; group toAs2Reg2BNs { type internal; family inet { labeled-unicast { rib-group inet3to0; add-path { receive; send { path-count 4; } } rib { inet.3; } } } export export-inet3; neighbor 10.2.2.3; neighbor 10.2.2.4; neighbor 10.2.2.5; } traceoptions { file bgp.log size 100m; flag state detail; flag policy; } local-address 10.2.2.6; cluster 10.2.2.6; } ldp { interface all; } mpls { interface all; } } 要配置设备 ABR1： [edit interfaces] user@ABR1# set ge-0/0/1 description ABR1-to-P2 user@ABR1# set ge-0/0/1 vlan-tagging user@ABR1# set ge-0/0/1 unit 0 vlan-id 100 user@ABR1# set ge-0/0/1 unit 0 family inet address 192.168.0.12/31 user@ABR1# set ge-0/0/1 unit 0 family iso user@ABR1# set ge-0/0/1 unit 0 family mpls user@ABR1# set ge-0/0/2 description ABR1-to-P1 user@ABR1# set ge-0/0/2 vlan-tagging user@ABR1# set ge-0/0/2 unit 0 vlan-id 100 user@ABR1# set ge-0/0/2 unit 0 family inet address 192.168.0.9/31 user@ABR1# set ge-0/0/2 unit 0 family iso user@ABR1# set ge-0/0/2 unit 0 family mpls [edit interfaces] user@ABR1# set lo0 unit 0 family inet address 10.2.2.3/32 user@ABR1# set lo0 unit 0 family iso address 49.0000.0000.aaaa.0003.00 [edit policy-options] user@ABR1# set policy-statement allow-lo0 term 1 from interface lo0.0 user@ABR1# set policy-statement allow-lo0 term 1 then accept user@ABR1# set policy-statement allow-lo0 term 2 then reject user@ABR1# set policy-statement nhs term 1 from protocol bgp user@ABR1# set policy-statement nhs term 1 then next-hop self user@ABR1# set policy-statement nhs term 1 then accept user@ABR1# set policy-statement pplb then load-balance per-packet 应用按流负载均衡策略以启用流量保护。 [edit routing-options] user@ABR1# set forwarding-table export pplb user@ABR1# set router-id 10.2.2.3 user@ABR1# set autonomous-system 65002 在接口上配置 ISIS、RSVP、MPLS 和 LDP 协议。 [edit protocols] user@ABR1# set isis level 1 disable user@ABR1# set isis interface all user@ABR1# set isis export allow-lo0 user@ABR1# set isis topologies ipv6-unicast user@ABR1# set rsvp interface all user@ABR1# set ldp interface all user@ABR1# set mpls label-switched-path toASBR2-gold to 10.2.2.2 user@ABR1# set mpls label-switched-path toASBR1-bronze to 10.2.2.1 user@ABR1# set mpls label-switched-path toASBR2-bronze to 10.2.2.2 user@ABR1# set mpls interface all [edit protocols] user@ABR1# set bgp group toAs2RR type internal user@ABR1# set bgp group toAs2RR local-address 10.2.2.3 user@ABR1# set bgp group toAs2RR advertise-inactive user@ABR1# set bgp group toAs2RR family inet labeled-unicast add-path receive user@ABR1# set bgp group toAs2RR family inet labeled-unicast add-path send path-count 4 user@ABR1# set bgp group toAs2RR family inet labeled-unicast rib inet.3 user@ABR1# set bgp group toAs2RR export nhs user@ABR1# set bgp group toAs2RR cluster 10.2.2.3 user@ABR1# set bgp group toAs2RR neighbor 10.2.2.6 user@ABR1# set bgp group toAs2RR neighbor 10.2.2.7 user@ABR1# set bgp traceoptions file bgp.log user@ABR1# set bgp traceoptions file size 100m user@ABR1# set bgp traceoptions flag state detail user@ABR1# set bgp traceoptions flag policy interfaces { ge-0/0/1 { description ABR1-to-P2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.12/31; } family iso; family mpls; } } ge-0/0/2 { description ABR1-to-P1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.9/31; } family iso; family mpls; } } lo0 { unit 0 { family inet { address 10.2.2.3/32; } family iso { address 49.0000.0000.aaaa.0003.00; } } } } policy-options { policy-statement allow-lo0 { term 1 { from interface lo0.0; then accept; } term 2 { then reject; } } policy-statement nhs { term 1 { from protocol bgp; then { next-hop self; accept; } } } policy-statement pplb { then { load-balance per-packet; } } } routing-options { forwarding-table { export pplb; } router-id 10.2.2.3; autonomous-system 65002; } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } bgp { group toAs2RR { type internal; local-address 10.2.2.3; advertise-inactive; family inet { labeled-unicast { add-path { receive; send { path-count 4; } } rib { inet.3; } } } export nhs; cluster 10.2.2.3; neighbor 10.2.2.6; neighbor 10.2.2.7; } traceoptions { file bgp.log size 100m; flag state detail; flag policy; } } ldp { interface all; } mpls { label-switched-path toASBR2-gold { to 10.2.2.2; } label-switched-path toASBR1-bronze { to 10.2.2.1; } label-switched-path toASBR2-bronze { to 10.2.2.2; } interface all; } } 要配置设备 ABR2： [edit interfaces] user@ABR2# set ge-0/0/2 description ABR2-to-P2 user@ABR2# set ge-0/0/2 vlan-tagging user@ABR2# set ge-0/0/2 unit 0 vlan-id 100 user@ABR2# set ge-0/0/2 unit 0 family inet address 192.168.0.14/31 user@ABR2# set ge-0/0/2 unit 0 family iso user@ABR2# set ge-0/0/2 unit 0 family mpls user@ABR2# set ge-0/0/4 description ABR2-to-P1 user@ABR2# set ge-0/0/4 vlan-tagging user@ABR2# set ge-0/0/4 unit 0 vlan-id 100 user@ABR2# set ge-0/0/4 unit 0 family inet address 192.168.0.11/31 user@ABR2# set ge-0/0/4 unit 0 family iso user@ABR2# set ge-0/0/4 unit 0 family mpls [edit interfaces] user@ABR2# set lo0 unit 0 family inet address 2.2.2.4/32 user@ABR2# set lo0 unit 0 family iso address 49.0000.0000.aaaa.0004.00 [edit policy-options] user@ABR2# set policy-statement allow-lo0 term 1 from interface lo0.0 user@ABR2# set policy-statement allow-lo0 term 1 then accept user@ABR2# set policy-statement allow-lo0 term 2 then reject user@ABR2# set policy-statement nhs term 1 from protocol bgp user@ABR2# set policy-statement nhs term 1 then next-hop self user@ABR2# set policy-statement nhs term 1 then accept user@ABR2# set policy-statement pplb then load-balance per-packet [edit routing-options] user@ABR2# set forwarding-table export pplb user@ABR2# set router-id 2.2.2.4 user@ABR2# set autonomous-system 2 [edit protocols] user@ABR2# set isis level 1 disable user@ABR2# set isis interface all user@ABR2# set isis export allow-lo0 user@ABR2# set isis topologies ipv6-unicast user@ABR2# set rsvp interface all user@ABR2# set ldp interface all user@ABR2# set mpls label-switched-path toASBR1-bronze to 2.2.2.1 user@ABR2# set mpls interface all [edit protocols] user@ABR2# set bgp group toAs2RR type internal user@ABR2# set bgp group toAs2RR local-address 2.2.2.4 user@ABR2# set bgp group toAs2RR advertise-inactive user@ABR2# set bgp group toAs2RR family inet labeled-unicast add-path receive user@ABR2# set bgp group toAs2RR family inet labeled-unicast add-path send path-count 4 user@ABR2# set bgp group toAs2RR family inet labeled-unicast rib inet.3 user@ABR2# set bgp group toAs2RR export nhs user@ABR2# set bgp group toAs2RR cluster 2.2.2.4 user@ABR2# set bgp group toAs2RR neighbor 2.2.2.6 user@ABR2# set bgp group toAs2RR neighbor 2.2.2.7 user@ABR2# set bgp traceoptions file bgp.log user@ABR2# set bgp traceoptions file size 100m user@ABR2# set bgp traceoptions flag state detail user@ABR2# set bgp traceoptions flag policy interfaces { ge-0/0/2 { description ABR2-to-P2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.14/31; } family iso; family mpls; } } ge-0/0/4 { description ABR2-to-P1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.11/31; } family iso; family mpls; } } lo0 { unit 0 { family inet { address 2.2.2.4/32; } family iso { address 49.0000.0000.aaaa.0004.00; } } } } policy-options { policy-statement allow-lo0 { term 1 { from interface lo0.0; then accept; } term 2 { then reject; } } policy-statement nhs { term 1 { from protocol bgp; then { next-hop self; accept; } } } policy-statement pplb { then { load-balance per-packet; } } } routing-options { forwarding-table { export pplb; } router-id 2.2.2.4; autonomous-system 2; } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } bgp { group toAs2RR { type internal; local-address 2.2.2.4; advertise-inactive; family inet { labeled-unicast { add-path { receive; send { path-count 4; } } rib { inet.3; } } } export nhs; cluster 2.2.2.4; neighbor 2.2.2.6; neighbor 2.2.2.7; } traceoptions { file bgp.log size 100m; flag state detail; flag policy; } } ldp { interface all; } mpls { label-switched-path toASBR1-bronze { to 2.2.2.1; } interface all; } } 要配置设备 P2： [edit interfaces] user@P2# set ge-0/0/1 description P2-to-ABR1 user@P2# set ge-0/0/1 vlan-tagging user@P2# set ge-0/0/1 unit 0 vlan-id 100 user@P2# set ge-0/0/1 unit 0 family inet address 192.168.0.13/31 user@P2# set ge-0/0/1 unit 0 family iso user@P2# set ge-0/0/1 unit 0 family mpls user@P2# set ge-0/0/2 description P2-to-ABR2 user@P2# set ge-0/0/2 vlan-tagging user@P2# set ge-0/0/2 unit 0 vlan-id 100 user@P2# set ge-0/0/2 unit 0 family inet address 192.168.0.15/31 user@P2# set ge-0/0/2 unit 0 family iso user@P2# set ge-0/0/2 unit 0 family mpls user@P2# set ge-0/0/3 description P2-to-RR2 user@P2# set ge-0/0/3 vlan-tagging user@P2# set ge-0/0/3 unit 0 vlan-id 100 user@P2# set ge-0/0/3 unit 0 family inet address 192.168.0.16/31 user@P2# set ge-0/0/3 unit 0 family iso user@P2# set ge-0/0/3 unit 0 family mpls user@P2# set ge-0/0/4 description P2-to-ASBR1 user@P2# set ge-0/0/4 vlan-tagging user@P2# set ge-0/0/4 unit 0 vlan-id 100 user@P2# set ge-0/0/4 unit 0 family inet address 192.168.0.18/31 user@P2# set ge-0/0/4 unit 0 family iso user@P2# set ge-0/0/4 unit 0 family mpls user@P2# set ge-0/0/5 description P2-to-ASBR2 user@P2# set ge-0/0/5 vlan-tagging user@P2# set ge-0/0/5 unit 0 vlan-id 100 user@P2# set ge-0/0/5 unit 0 family inet address 192.168.0.20/31 user@P2# set ge-0/0/5 unit 0 family iso user@P2# set ge-0/0/5 unit 0 family mpls [edit interfaces] user@P2# set lo0 unit 0 family inet address 2.2.2.9/32 user@P2# set lo0 unit 0 family iso address 49.0000.0000.aaaa.0009.00 [edit policy-options] user@P2# set policy-statement allow-lo0 term 1 from interface lo0.0 user@P2# set policy-statement allow-lo0 term 1 then accept user@P2# set policy-statement allow-lo0 term 2 then reject [edit routing-options] user@P2# set router-id 2.2.2.9 [edit protocols] user@P2# set isis level 1 disable user@P2# set isis interface all user@P2# set isis export allow-lo0 user@P2# set isis topologies ipv6-unicast user@P2# set rsvp interface all user@P2# set ldp interface all user@P2# set mpls interface all interfaces { ge-0/0/1 { description P2-to-ABR1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.13/31; } family iso; family mpls; } } ge-0/0/2 { description P2-to-ABR2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.15/31; } family iso; family mpls; } } ge-0/0/3 { description P2-to-RR2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.16/31; } family iso; family mpls; } } ge-0/0/4 { description P2-to-ASBR1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.18/31; } family iso; family mpls; } } ge-0/0/5 { description P2-to-ASBR2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.20/31; } family iso; family mpls; } } lo0 { unit 0 { family inet { address 2.2.2.9/32; } family iso { address 49.0000.0000.aaaa.0009.00; } } } } policy-options { policy-statement allow-lo0 { term 1 { from interface lo0.0; then accept; } term 2 { then reject; } } } routing-options { router-id 2.2.2.9; } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } ldp { interface all; } mpls { interface all; } } 要配置设备 RR2： [edit interfaces] user@RR2# set ge-0/0/3 description RR2-to-P2 user@RR2# set ge-0/0/3 vlan-tagging user@RR2# set ge-0/0/3 unit 0 vlan-id 100 user@RR2# set ge-0/0/3 unit 0 family inet address 192.168.0.17/31 user@RR2# set ge-0/0/3 unit 0 family iso user@RR2# set ge-0/0/3 unit 0 family mpls [edit interfaces] user@RR2# set lo0 unit 1 family inet address 2.2.2.7/32 user@RR2# set lo0 unit 1 family iso address 49.0000.0000.aaaa.0007.00 [edit policy-options] user@RR2# set policy-statement allow-lo0 term 1 from interface lo0.1 user@RR2# set policy-statement allow-lo0 term 1 then accept user@RR2# set policy-statement allow-lo0 term 2 then reject user@RR2# set policy-statement export-inet3 term 1 from rib inet.3 user@RR2# set policy-statement export-inet3 term 1 then accept user@RR2# set policy-statement export-inet3 term 2 then reject user@RR2# set policy-statement pplb then load-balance per-packet [edit routing-options] user@RR2# set forwarding-table export pplb user@RR2# set interface-routes rib-group inet inet0to3 user@RR2# set router-id 2.2.2.7 user@RR2# set autonomous-system 2 user@RR2# set rib-groups inet0to3 import-rib inet.0 user@RR2# set rib-groups inet0to3 import-rib inet.3 user@RR2# set rib-groups inet0to3 import-policy allow-lo0 [edit protocols] user@RR2# set isis level 1 disable user@RR2# set isis interface all user@RR2# set isis export allow-lo0 user@RR2# set isis topologies ipv6-unicast user@RR2# set rsvp interface all user@RR2# set ldp interface all user@RR2# set mpls interface all [edit protocols] user@RR2# set bgp path-selection external-router-id user@RR2# set bgp group toAs2Reg1BNs type internal user@RR2# set bgp group toAs2Reg1BNs family inet labeled-unicast add-path receive user@RR2# set bgp group toAs2Reg1BNs family inet labeled-unicast add-path send path-count 4 user@RR2# set bgp group toAs2Reg1BNs family inet labeled-unicast rib inet.3 user@RR2# set bgp group toAs2Reg1BNs neighbor 2.2.2.1 user@RR2# set bgp group toAs2Reg1BNs neighbor 2.2.2.2 user@RR2# set bgp group toAs2Reg1BNs neighbor 2.2.2.3 user@RR2# set bgp group toAs2Reg1BNs neighbor 2.2.2.4 user@RR2# set bgp traceoptions file bgp.log user@RR2# set bgp traceoptions file size 100m user@RR2# set bgp traceoptions flag state detail user@RR2# set bgp traceoptions flag policy user@RR2# set bgp local-address 2.2.2.7 user@RR2# set bgp cluster 2.2.2.7 interfaces { ge-0/0/3 { description RR2-to-P2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.17/31; } family iso; family mpls; } } lo0 { unit 1 { family inet { address 2.2.2.7/32; } family iso { address 49.0000.0000.aaaa.0007.00; } } } } policy-options { policy-statement allow-lo0 { term 1 { from interface lo0.1; then accept; } term 2 { then reject; } } policy-statement export-inet3 { term 1 { from rib inet.3; then accept; } term 2 { then reject; } } policy-statement pplb { then { load-balance per-packet; } } } routing-options { forwarding-table { export pplb; } interface-routes { rib-group inet inet0to3; } router-id 2.2.2.7; autonomous-system 2; rib-groups { inet0to3 { import-rib [ inet.0 inet.3 ]; import-policy allow-lo0; } } } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } bgp { path-selection external-router-id; group toAs2Reg1BNs { type internal; family inet { labeled-unicast { add-path { receive; send { path-count 4; } } rib { inet.3; } } } neighbor 2.2.2.1; neighbor 2.2.2.2; neighbor 2.2.2.3; neighbor 2.2.2.4; } traceoptions { file bgp.log size 100m; flag state detail; flag policy; } local-address 2.2.2.7; cluster 2.2.2.7; } ldp { interface all; } mpls { interface all; } }",
      "sections": [
        {
          "title": "CLI 快速配置",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改详细信息，以便与网络配置匹配，将命令复制并粘贴到 [edit] 层级的 CLI 中，然后从配置模式进入 commit 。 设备 CE1 set interfaces ge-0/0/1 description CE1-to-PE1-Link1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.0/31 set interfaces ge-0/0/2 description CE1-to-PE1-Link2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.2/31 set interfaces lo0 unit 0 family inet address 10.4.4.4/32 set policy-options policy-statement nhs term 1 from interface lo0.0 set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set routing-options router-id 10.4.4.4 set routing-options autonomous-system 65004 set protocols bgp path-selection external-router-id set protocols bgp group toAs2 export nhs set protocols bgp group toAs2 peer-as 65002 set protocols bgp group toAs2 neighbor 192.168.0.1 set protocols bgp group toAs2 neighbor 192.168.0.3 设备 PE1 set interfaces ge-0/0/1 description PE1-to-CE1-Link1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.1/31 set interfaces ge-0/0/2 description PE1-to-CE1-Link2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.3/31 set interfaces ge-0/0/3 description PE1-to-P1 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.4/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.2.2.5/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0005.00 set policy-options policy-statement add-noexport term 1 then community add noexport set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement mp-resolv term 1 from route-filter 10.1.1.0/24 orlonger set policy-options policy-statement mp-resolv term 1 then accept set policy-options policy-statement mp-resolv term 1 then multipath-resolve set policy-options policy-statement mp-resolv term 2 from route-filter 10.2.2.0/24 orlonger set policy-options policy-statement mp-resolv term 2 then accept set policy-options policy-statement mp-resolv term 2 then multipath-resolve set policy-options policy-statement mp-resolv term def then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then local-preference 65200 set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set policy-options policy-statement vrf-export-red term 1 then community add leak2red set policy-options policy-statement vrf-export-red term 1 then accept set policy-options policy-statement vrf-import-red term 1 from community leak2red set policy-options policy-statement vrf-import-red term 1 then accept set policy-options community leak2red members target:100:100 set policy-options community noexport members no-export set policy-options community noexport members no-advertise set routing-instances red routing-options multipath preserve-nexthop-hierarchy set routing-instances red routing-options protect core set routing-instances red protocols bgp group toCE1 peer-as 4 set routing-instances red protocols bgp group toCE1 neighbor 192.168.0.2 set routing-instances red instance-type vrf set routing-instances red interface ge-0/0/2.0 set routing-instances red vrf-import vrf-import-red set routing-instances red vrf-export vrf-export-red set routing-options rib inet.3 protect core set routing-options route-distinguisher-id 10.2.2.5 set routing-options forwarding-table export pplb set routing-options resolution preserve-nexthop-hierarchy set routing-options resolution rib inet.0 import mp-resolv set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.2.2.5 set routing-options autonomous-system 2 set routing-options protect core set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set routing-options rib-groups inet3to0 import-rib inet.3 set routing-options rib-groups inet3to0 import-rib inet.0 set routing-options rib-groups inet3to0 import-policy add-noexport set protocols isis level 1 disable set protocols isis interface ge-0/0/3.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/3.0 set protocols ldp interface ge-0/0/3.0 set protocols mpls label-switched-path toABR1-gold to 10.2.2.3 set protocols mpls label-switched-path toABR1-bronze to 10.2.2.3 set protocols mpls label-switched-path toABR2-gold to 10.2.2.4 set protocols bgp path-selection external-router-id set protocols bgp group toAs2RR type internal set protocols bgp group toAs2RR local-address 10.2.2.5 set protocols bgp group toAs2RR family inet labeled-unicast rib-group inet3to0 set protocols bgp group toAs2RR family inet labeled-unicast add-path receive set protocols bgp group toAs2RR family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs2RR family inet labeled-unicast nexthop-resolution preserve-nexthop-hierarchy set protocols bgp group toAs2RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs2RR export nhs set protocols bgp group toAs2RR export export-inet3 set protocols bgp group toAs2RR neighbor 10.2.2.6 set protocols bgp group toAs4 peer-as 65004 set protocols bgp group toAs4 neighbor 192.168.0.0 set protocols bgp group toAs1PEs multihop no-nexthop-change set protocols bgp group toAs1PEs local-address 10.2.2.5 set protocols bgp group toAs1PEs family inet unicast set protocols bgp group toAs1PEs family inet-vpn unicast set protocols bgp group toAs1PEs family inet6 unicast set protocols bgp group toAs1PEs family inet6-vpn unicast set protocols bgp group toAs1PEs export nhs set protocols bgp group toAs1PEs peer-as 65001 set protocols bgp group toAs1PEs neighbor 10.1.1.1 set protocols bgp group toAs1PEs neighbor 10.1.1.2 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy set protocols bgp multipath 设备 P1 set interfaces ge-0/0/1 description P1-to-RR1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.6/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description P1-to-ABR1 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.8/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/3 description P1-to-PE1 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.5/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces ge-0/0/4 description P1-to-ABR2 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.10/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.8/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0008.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set routing-options router-id 10.2.2.8 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all 设备 RR1 set interfaces ge-0/0/1 description RR1-to-P1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.7/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.2.2.6/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0006.00 set policy-options policy-statement add-noexport term 1 then community add noexport set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement pplb then load-balance per-packet set policy-options community noexport members no-export set policy-options community noexport members no-advertise set routing-options forwarding-table export pplb set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.2.2.6 set routing-options autonomous-system 2 set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set routing-options rib-groups inet3to0 import-rib inet.3 set routing-options rib-groups inet3to0 import-rib inet.0 set routing-options rib-groups inet3to0 import-rib inet6.3 set routing-options rib-groups inet3to0 import-policy add-noexport set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all set protocols bgp path-selection external-router-id set protocols bgp group toAs2Reg2BNs type internal set protocols bgp group toAs2Reg2BNs family inet labeled-unicast rib-group inet3to0 set protocols bgp group toAs2Reg2BNs family inet labeled-unicast add-path receive set protocols bgp group toAs2Reg2BNs family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs2Reg2BNs family inet labeled-unicast rib inet.3 set protocols bgp group toAs2Reg2BNs export export-inet3 set protocols bgp group toAs2Reg2BNs neighbor 10.2.2.3 set protocols bgp group toAs2Reg2BNs neighbor 10.2.2.4 set protocols bgp group toAs2Reg2BNs neighbor 10.2.2.5 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy set protocols bgp local-address 10.2.2.6 set protocols bgp cluster 10.2.2.6 设备 ABR1 set interfaces ge-0/0/1 description ABR1-to-P2 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.12/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description ABR1-to-P1 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.9/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.3/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0003.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.2.2.3 set routing-options autonomous-system 65002 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls label-switched-path toASBR2-gold to 10.2.2.2 set protocols mpls label-switched-path toASBR1-bronze to 10.2.2.1 set protocols mpls label-switched-path toASBR2-bronze to 10.2.2.2 set protocols mpls interface all set protocols bgp group toAs2RR type internal set protocols bgp group toAs2RR local-address 10.2.2.3 set protocols bgp group toAs2RR advertise-inactive set protocols bgp group toAs2RR family inet labeled-unicast add-path receive set protocols bgp group toAs2RR family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs2RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs2RR export nhs set protocols bgp group toAs2RR cluster 10.2.2.3 set protocols bgp group toAs2RR neighbor 10.2.2.6 set protocols bgp group toAs2RR neighbor 10.2.2.7 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 ABR2 set interfaces ge-0/0/2 description ABR2-to-P2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.14/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/4 description ABR2-to-P1 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.11/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.4/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0004.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.2.2.4 set routing-options autonomous-system 65002 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls label-switched-path toASBR1-bronze to 10.2.2.1 set protocols mpls interface all set protocols bgp group toAs2RR type internal set protocols bgp group toAs2RR local-address 10.2.2.4 set protocols bgp group toAs2RR advertise-inactive set protocols bgp group toAs2RR family inet labeled-unicast add-path receive set protocols bgp group toAs2RR family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs2RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs2RR export nhs set protocols bgp group toAs2RR cluster 10.2.2.4 set protocols bgp group toAs2RR neighbor 10.2.2.6 set protocols bgp group toAs2RR neighbor 10.2.2.7 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 P2 set interfaces ge-0/0/1 description P2-to-ABR1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.13/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description P2-to-ABR2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.15/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/3 description P2-to-RR2 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.16/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces ge-0/0/4 description P2-to-ASBR1 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.18/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces ge-0/0/5 description P2-to-ASBR2 set interfaces ge-0/0/5 vlan-tagging set interfaces ge-0/0/5 unit 0 vlan-id 100 set interfaces ge-0/0/5 unit 0 family inet address 192.168.0.20/31 set interfaces ge-0/0/5 unit 0 family iso set interfaces ge-0/0/5 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.9/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0009.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set routing-options router-id 10.2.2.9 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all 设备 RR2 set interfaces ge-0/0/3 description RR2-to-P2 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.17/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.2.2.7/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0007.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.2.2.7 set routing-options autonomous-system 65002 set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all set protocols bgp path-selection external-router-id set protocols bgp group toAs2Reg1BNs type internal set protocols bgp group toAs2Reg1BNs family inet labeled-unicast add-path receive set protocols bgp group toAs2Reg1BNs family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs2Reg1BNs family inet labeled-unicast rib inet.3 set protocols bgp group toAs2Reg1BNs neighbor 10.2.2.1 set protocols bgp group toAs2Reg1BNs neighbor 10.2.2.2 set protocols bgp group toAs2Reg1BNs neighbor 10.2.2.3 set protocols bgp group toAs2Reg1BNs neighbor 10.2.2.4 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy set protocols bgp local-address 10.2.2.7 set protocols bgp cluster 10.2.2.7 设备 ASBR1 set interfaces ge-0/0/2 description ASBR1-to-ASBR3 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.22/31 set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/3 description ASBR1-to-ASBR4 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.24/31 set interfaces ge-0/0/3 unit 0 family mpls set interfaces ge-0/0/4 description ASBR1-to-P2 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.19/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.1/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0001.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.2.2.1 set routing-options autonomous-system 65002 set protocols isis level 1 disable set protocols isis interface ge-0/0/4.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/4.0 set protocols ldp interface ge-0/0/4.0 set protocols mpls interface ge-0/0/4.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs1-T family inet labeled-unicast rib inet.3 set protocols bgp group toAs1-T peer-as 1 set protocols bgp group toAs1-T neighbor 192.168.0.23 set protocols bgp group toAs1-T neighbor 192.168.0.27 set protocols bgp group toAs2RR type internal set protocols bgp group toAs2RR local-address 10.2.2.1 set protocols bgp group toAs2RR advertise-external set protocols bgp group toAs2RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs2RR export nhs set protocols bgp group toAs2RR neighbor 10.2.2.7 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 ASBR2 set interfaces ge-0/0/1 description ASBR2-to-ASBR3 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.28/31 set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description ASBR2-to-ASBR4 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.26/31 set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/5 description ASBR2-to-P2 set interfaces ge-0/0/5 vlan-tagging set interfaces ge-0/0/5 unit 0 vlan-id 100 set interfaces ge-0/0/5 unit 0 family inet address 192.168.0.21/31 set interfaces ge-0/0/5 unit 0 family iso set interfaces ge-0/0/5 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.2.2.2/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0002.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.2.2.2 set routing-options autonomous-system 65002 set protocols isis level 1 disable set protocols isis interface ge-0/0/5.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/5.0 set protocols ldp interface ge-0/0/5.0 set protocols mpls interface ge-0/0/5.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs1-T family inet labeled-unicast rib inet.3 set protocols bgp group toAs1-T peer-as 1 set protocols bgp group toAs1-T neighbor 192.168.0.29 set protocols bgp group toAs1-T neighbor 192.168.0.25 set protocols bgp group toAs2RR type internal set protocols bgp group toAs2RR local-address 10.2.2.2 set protocols bgp group toAs2RR advertise-external set protocols bgp group toAs2RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs2RR export nhs set protocols bgp group toAs2RR neighbor 10.2.2.7 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 ASBR3 set interfaces ge-0/0/1 description ASBR3-to-ASBR2 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.29/31 set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description ASBR3-to-ASBR1 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.23/31 set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/4 description ASBR3-to-P3 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.30/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.1.1.3/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0003.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.1.1.3 set routing-options autonomous-system 65001 set protocols isis level 1 disable set protocols isis interface ge-0/0/4.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/4.0 set protocols ldp interface ge-0/0/4.0 set protocols mpls label-switched-path toPE2-gold to 10.1.1.1 set protocols mpls interface ge-0/0/4.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs2-T family inet labeled-unicast rib inet.3 set protocols bgp group toAs2-T peer-as 65002 set protocols bgp group toAs2-T neighbor 192.168.0.22 set protocols bgp group toAs2-T neighbor 192.168.0.28 set protocols bgp group toAs1RR type internal set protocols bgp group toAs1RR local-address 10.1.1.3 set protocols bgp group toAs1RR advertise-external set protocols bgp group toAs1RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs1RR export nhs set protocols bgp group toAs1RR neighbor 10.1.1.6 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 ASBR4 set interfaces ge-0/0/1 description ASBR4-to-P3 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.32/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description ASBR4-to-ASBR2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.27/31 set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/3 description ASBR4-to-ASBR1 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.25/31 set interfaces ge-0/0/3 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.1.1.4/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0004.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set routing-options forwarding-table export pplb set routing-options router-id 10.1.1.4 set routing-options autonomous-system 65001 set protocols isis level 1 disable set protocols isis interface ge-0/0/1.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/1.0 set protocols ldp interface ge-0/0/1.0 set protocols mpls label-switched-path toPE2-bronze to 10.1.1.1 set protocols mpls label-switched-path toPE3-bronze to 10.1.1.2 set protocols mpls interface ge-0/0/1.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs2-T family inet labeled-unicast rib inet.3 set protocols bgp group toAs2-T peer-as 2 set protocols bgp group toAs2-T neighbor 192.168.0.26 set protocols bgp group toAs2-T neighbor 192.168.0.24 set protocols bgp group toAs1RR type internal set protocols bgp group toAs1RR local-address 10.1.1.4 set protocols bgp group toAs1RR advertise-external set protocols bgp group toAs1RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs1RR export nhs set protocols bgp group toAs1RR neighbor 10.1.1.6 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 RR3 set interfaces ge-0/0/2 description RR3-to-P3 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.35/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.1.1.6/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0006.00 set policy-options policy-statement add-noexport term 1 then community add noexport set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement pplb then load-balance per-packet set policy-options community noexport members no-export set policy-options community noexport members no-advertise set routing-options forwarding-table export pplb set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.1.1.6 set routing-options autonomous-system 1 set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set routing-options rib-groups inet3to0 import-rib inet.3 set routing-options rib-groups inet3to0 import-rib inet.0 set routing-options rib-groups inet3to0 import-policy add-noexport set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all set protocols bgp path-selection external-router-id set protocols bgp group toAs1BNs type internal set protocols bgp group toAs1BNs family inet labeled-unicast rib-group inet3to0 set protocols bgp group toAs1BNs family inet labeled-unicast add-path receive set protocols bgp group toAs1BNs family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs1BNs family inet labeled-unicast rib inet.3 set protocols bgp group toAs1BNs export export-inet3 set protocols bgp group toAs1BNs neighbor 10.1.1.3 set protocols bgp group toAs1BNs neighbor 10.1.1.4 set protocols bgp group toAs1BNs neighbor 10.1.1.2 set protocols bgp group toAs1BNs neighbor 10.1.1.1 set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy set protocols bgp local-address 10.1.1.6 set protocols bgp cluster 10.1.1.6 设备 P3 set interfaces ge-0/0/1 description P3-to-ASBR4 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.33/31 set interfaces ge-0/0/1 unit 0 family iso set interfaces ge-0/0/1 unit 0 family mpls set interfaces ge-0/0/2 description P3-to-RR3 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.34/31 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family mpls set interfaces ge-0/0/3 description P3-to-PE2 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.36/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces ge-0/0/4 description P3-to-ASBR3 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.31/31 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family mpls set interfaces ge-0/0/5 description P3-to-PE3 set interfaces ge-0/0/5 vlan-tagging set interfaces ge-0/0/5 unit 0 vlan-id 100 set interfaces ge-0/0/5 unit 0 family inet address 192.168.0.38/31 set interfaces ge-0/0/5 unit 0 family iso set interfaces ge-0/0/5 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.1.1.5/32 set interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0005.00 set policy-options policy-statement allow-lo0 term 1 from interface lo0.0 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set routing-options router-id 10.1.1.5 set protocols isis level 1 disable set protocols isis interface all set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface all set protocols ldp interface all set protocols mpls interface all 设备 PE2 set interfaces ge-0/0/1 description PE2-to-CE2-Link1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.40/31 set interfaces ge-0/0/2 description PE2-to-CE2-Link2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.42/31 set interfaces ge-0/0/3 description PE2-to-P3 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.37/31 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.1.1.1/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0001.00 set policy-options policy-statement add-noexport term 1 then community add noexport set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then metric add 0 set policy-options policy-statement nhs term 1 then local-preference 200 set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set policy-options policy-statement vrf-export-red term 1 then community add leak2red set policy-options policy-statement vrf-export-red term 1 then accept set policy-options policy-statement vrf-import-red term 1 from community leak2red set policy-options policy-statement vrf-import-red term 1 then accept set policy-options community leak2red members target:100:100 set policy-options community noexport members no-export set policy-options community noexport members no-advertise set routing-instances red protocols bgp group toCE2 peer-as 65003 set routing-instances red protocols bgp group toCE2 neighbor 192.168.0.43 set routing-instances red instance-type vrf set routing-instances red interface ge-0/0/2.0 set routing-instances red vrf-import vrf-import-red set routing-instances red vrf-export vrf-export-red set routing-options route-distinguisher-id 10.1.1.1 set routing-options forwarding-table export pplb set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.1.1.1 set routing-options autonomous-system 1 set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set routing-options rib-groups inet3to0 import-rib inet.3 set routing-options rib-groups inet3to0 import-rib inet.0 set routing-options rib-groups inet3to0 import-policy add-noexport set protocols isis level 1 disable set protocols isis interface ge-0/0/3.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/3.0 set protocols ldp interface ge-0/0/3.0 set protocols mpls interface ge-0/0/3.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs3-1 peer-as 65003 set protocols bgp group toAs3-1 neighbor 192.168.0.41 set protocols bgp group toAs1RR type internal set protocols bgp group toAs1RR local-address 10.1.1.1 set protocols bgp group toAs1RR advertise-external set protocols bgp group toAs1RR family inet labeled-unicast rib-group inet3to0 set protocols bgp group toAs1RR family inet labeled-unicast add-path receive set protocols bgp group toAs1RR family inet labeled-unicast add-path send path-count 4 set protocols bgp group toAs1RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs1RR family inet6-vpn unicast set protocols bgp group toAs1RR export nhs set protocols bgp group toAs1RR export export-inet3 set protocols bgp group toAs1RR neighbor 10.1.1.6 set protocols bgp group toAs2PEs multihop no-nexthop-change set protocols bgp group toAs2PEs local-address 10.1.1.1 set protocols bgp group toAs2PEs family inet unicast set protocols bgp group toAs2PEs family inet-vpn unicast set protocols bgp group toAs2PEs family inet6 unicast set protocols bgp group toAs2PEs family inet6-vpn unicast set protocols bgp group toAs2PEs export nhs set protocols bgp group toAs2PEs peer-as 65002 set protocols bgp group toAs2PEs neighbor 10.2.2.5 set protocols bgp group toAs2PEs vpn-apply-export set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 PE3 set interfaces ge-0/0/3 description PE3-to-CE2-Link1 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.44/31 set interfaces ge-0/0/4 description PE3-to-CE2-Link2 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.46/31 set interfaces ge-0/0/5 description PE3-to-P3 set interfaces ge-0/0/5 vlan-tagging set interfaces ge-0/0/5 unit 0 vlan-id 100 set interfaces ge-0/0/5 unit 0 family inet address 192.168.0.39/31 set interfaces ge-0/0/5 unit 0 family iso set interfaces ge-0/0/5 unit 0 family mpls set interfaces lo0 unit 1 family inet address 10.1.1.2/32 set interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0002.00 set policy-options policy-statement add-noexport term 1 then community add noexport set policy-options policy-statement allow-lo0 term 1 from interface lo0.1 set policy-options policy-statement allow-lo0 term 1 then accept set policy-options policy-statement allow-lo0 term 2 then reject set policy-options policy-statement export-inet3 term 1 from rib inet.3 set policy-options policy-statement export-inet3 term 1 then accept set policy-options policy-statement export-inet3 term 2 then reject set policy-options policy-statement nhs term 1 from protocol bgp set policy-options policy-statement nhs term 1 then metric add 0 set policy-options policy-statement nhs term 1 then local-preference 200 set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement pplb then load-balance per-packet set policy-options policy-statement vrf-export-red term 1 then community add leak2red set policy-options policy-statement vrf-export-red term 1 then accept set policy-options policy-statement vrf-import-red term 1 from community leak2red set policy-options policy-statement vrf-import-red term 1 then accept set policy-options community leak2red members target:100:100 set policy-options community noexport members no-export set policy-options community noexport members no-advertise set routing-instances red protocols bgp group toCE2 peer-as 65003 set routing-instances red protocols bgp group toCE2 neighbor 192.168.0.47 set routing-instances red instance-type vrf set routing-instances red interface ge-0/0/4.0 set routing-instances red vrf-import vrf-import-red set routing-instances red vrf-export vrf-export-red set routing-options route-distinguisher-id 10.1.1.2 set routing-options forwarding-table export pplb set routing-options interface-routes rib-group inet inet0to3 set routing-options router-id 10.1.1.2 set routing-options autonomous-system 1 set routing-options rib-groups inet0to3 import-rib inet.0 set routing-options rib-groups inet0to3 import-rib inet.3 set routing-options rib-groups inet0to3 import-policy allow-lo0 set routing-options rib-groups inet3to0 import-rib inet.3 set routing-options rib-groups inet3to0 import-rib inet.0 set routing-options rib-groups inet3to0 import-policy add-noexport set protocols isis level 1 disable set protocols isis interface ge-0/0/5.0 set protocols isis export allow-lo0 set protocols isis topologies ipv6-unicast set protocols rsvp interface ge-0/0/5.0 set protocols ldp interface ge-0/0/5.0 set protocols mpls interface ge-0/0/5.0 set protocols bgp path-selection external-router-id set protocols bgp group toAs3 peer-as 65003 set protocols bgp group toAs3 neighbor 192.168.0.45 set protocols bgp group toAs1RR type internal set protocols bgp group toAs1RR local-address 10.1.1.2 set protocols bgp group toAs1RR advertise-external set protocols bgp group toAs1RR family inet labeled-unicast rib-group inet3to0 set protocols bgp group toAs1RR family inet labeled-unicast rib inet.3 set protocols bgp group toAs1RR export nhs set protocols bgp group toAs1RR export export-inet3 set protocols bgp group toAs1RR neighbor 10.1.1.6 set protocols bgp group toAs2PEs multihop no-nexthop-change set protocols bgp group toAs2PEs local-address 10.1.1.2 set protocols bgp group toAs2PEs family inet unicast set protocols bgp group toAs2PEs family inet-vpn unicast set protocols bgp group toAs2PEs family inet6 unicast set protocols bgp group toAs2PEs family inet6-vpn unicast set protocols bgp group toAs2PEs export nhs set protocols bgp group toAs2PEs peer-as 65002 set protocols bgp group toAs2PEs neighbor 10.2.2.5 set protocols bgp group toAs2PEs vpn-apply-export set protocols bgp traceoptions file bgp.log set protocols bgp traceoptions file size 100m set protocols bgp traceoptions flag state detail set protocols bgp traceoptions flag policy 设备 CE2 set interfaces ge-0/0/1 description CE2-to-PE2-Link1 set interfaces ge-0/0/1 vlan-tagging set interfaces ge-0/0/1 unit 0 vlan-id 100 set interfaces ge-0/0/1 unit 0 family inet address 192.168.0.41/31 set interfaces ge-0/0/2 description CE2-to-PE2-Link2 set interfaces ge-0/0/2 vlan-tagging set interfaces ge-0/0/2 unit 0 vlan-id 100 set interfaces ge-0/0/2 unit 0 family inet address 192.168.0.43/31 set interfaces ge-0/0/3 description CE2-to-PE3-Link1 set interfaces ge-0/0/3 vlan-tagging set interfaces ge-0/0/3 unit 0 vlan-id 100 set interfaces ge-0/0/3 unit 0 family inet address 192.168.0.45/31 set interfaces ge-0/0/4 description CE2-to-PE3-Link2 set interfaces ge-0/0/4 vlan-tagging set interfaces ge-0/0/4 unit 0 vlan-id 100 set interfaces ge-0/0/4 unit 0 family inet address 192.168.0.47/31 set interfaces lo0 unit 0 family inet address 10.3.3.3/32 set policy-options policy-statement nhs term 1 from interface lo0.0 set policy-options policy-statement nhs term 1 then metric 50 set policy-options policy-statement nhs term 1 then next-hop self set policy-options policy-statement nhs term 1 then accept set policy-options policy-statement nhsMED100 term 1 from interface lo0.0 set policy-options policy-statement nhsMED100 term 1 then metric 100 set policy-options policy-statement nhsMED100 term 1 then next-hop self set policy-options policy-statement nhsMED100 term 1 then accept set policy-options community map2bronze members 100:200 set policy-options community map2gold members 100:100 set policy-options community map2gold_bronze_plain members 300:400 set routing-options router-id 10.3.3.3 set routing-options autonomous-system 65003 set protocols bgp path-selection external-router-id set protocols bgp group toAs1Internet export nhs set protocols bgp group toAs1Internet peer-as 65001 set protocols bgp group toAs1Internet neighbor 192.168.0.40 set protocols bgp group toAs1Internet neighbor 192.168.0.44 export nhsMED100 set protocols bgp group toAs1L3VPN export nhs set protocols bgp group toAs1L3VPN peer-as 65001 set protocols bgp group toAs1L3VPN neighbor 192.168.0.46 set protocols bgp group toAs1L3VPN neighbor 192.168.0.42 export nhsMED100",
          "commands_by_device": {
            "设备 CE1": "set interfaces ge-0/0/1 description CE1-to-PE1-Link1\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.0/31\nset interfaces ge-0/0/2 description CE1-to-PE1-Link2\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.2/31\nset interfaces lo0 unit 0 family inet address 10.4.4.4/32\nset policy-options policy-statement nhs term 1 from interface lo0.0\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset routing-options router-id 10.4.4.4\nset routing-options autonomous-system 65004\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs2 export nhs\nset protocols bgp group toAs2 peer-as 65002\nset protocols bgp group toAs2 neighbor 192.168.0.1\nset protocols bgp group toAs2 neighbor 192.168.0.3",
            "设备 PE1": "set interfaces ge-0/0/1 description PE1-to-CE1-Link1\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.1/31\nset interfaces ge-0/0/2 description PE1-to-CE1-Link2\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.3/31\nset interfaces ge-0/0/3 description PE1-to-P1\nset interfaces ge-0/0/3 vlan-tagging\nset interfaces ge-0/0/3 unit 0 vlan-id 100\nset interfaces ge-0/0/3 unit 0 family inet address 192.168.0.4/31\nset interfaces ge-0/0/3 unit 0 family iso\nset interfaces ge-0/0/3 unit 0 family mpls\nset interfaces lo0 unit 1 family inet address 10.2.2.5/32\nset interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0005.00\nset policy-options policy-statement add-noexport term 1 then community add noexport\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.1\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement export-inet3 term 1 from rib inet.3\nset policy-options policy-statement export-inet3 term 1 then accept\nset policy-options policy-statement export-inet3 term 2 then reject\nset policy-options policy-statement mp-resolv term 1 from route-filter 10.1.1.0/24 orlonger\nset policy-options policy-statement mp-resolv term 1 then accept\nset policy-options policy-statement mp-resolv term 1 then multipath-resolve\nset policy-options policy-statement mp-resolv term 2 from route-filter 10.2.2.0/24 orlonger\nset policy-options policy-statement mp-resolv term 2 then accept\nset policy-options policy-statement mp-resolv term 2 then multipath-resolve\nset policy-options policy-statement mp-resolv term def then reject\nset policy-options policy-statement nhs term 1 from protocol bgp\nset policy-options policy-statement nhs term 1 then local-preference 65200\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset policy-options policy-statement pplb then load-balance per-packet\nset policy-options policy-statement vrf-export-red term 1 then community add leak2red\nset policy-options policy-statement vrf-export-red term 1 then accept\nset policy-options policy-statement vrf-import-red term 1 from community leak2red\nset policy-options policy-statement vrf-import-red term 1 then accept\nset policy-options community leak2red members target:100:100\nset policy-options community noexport members no-export\nset policy-options community noexport members no-advertise\nset routing-instances red routing-options multipath preserve-nexthop-hierarchy\nset routing-instances red routing-options protect core\nset routing-instances red protocols bgp group toCE1 peer-as 4\nset routing-instances red protocols bgp group toCE1 neighbor 192.168.0.2\nset routing-instances red instance-type vrf\nset routing-instances red interface ge-0/0/2.0\nset routing-instances red vrf-import vrf-import-red\nset routing-instances red vrf-export vrf-export-red\nset routing-options rib inet.3 protect core\nset routing-options route-distinguisher-id 10.2.2.5\nset routing-options forwarding-table export pplb\nset routing-options resolution preserve-nexthop-hierarchy\nset routing-options resolution rib inet.0 import mp-resolv\nset routing-options interface-routes rib-group inet inet0to3\nset routing-options router-id 10.2.2.5\nset routing-options autonomous-system 2\nset routing-options protect core\nset routing-options rib-groups inet0to3 import-rib inet.0\nset routing-options rib-groups inet0to3 import-rib inet.3\nset routing-options rib-groups inet0to3 import-policy allow-lo0\nset routing-options rib-groups inet3to0 import-rib inet.3\nset routing-options rib-groups inet3to0 import-rib inet.0\nset routing-options rib-groups inet3to0 import-policy add-noexport\nset protocols isis level 1 disable\nset protocols isis interface ge-0/0/3.0\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface ge-0/0/3.0\nset protocols ldp interface ge-0/0/3.0\nset protocols mpls label-switched-path toABR1-gold to 10.2.2.3\nset protocols mpls label-switched-path toABR1-bronze to 10.2.2.3\nset protocols mpls label-switched-path toABR2-gold to 10.2.2.4\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs2RR type internal\nset protocols bgp group toAs2RR local-address 10.2.2.5\nset protocols bgp group toAs2RR family inet labeled-unicast rib-group inet3to0\nset protocols bgp group toAs2RR family inet labeled-unicast add-path receive\nset protocols bgp group toAs2RR family inet labeled-unicast add-path send path-count 4\nset protocols bgp group toAs2RR family inet labeled-unicast nexthop-resolution preserve-nexthop-hierarchy\nset protocols bgp group toAs2RR family inet labeled-unicast rib inet.3\nset protocols bgp group toAs2RR export nhs\nset protocols bgp group toAs2RR export export-inet3\nset protocols bgp group toAs2RR neighbor 10.2.2.6\nset protocols bgp group toAs4 peer-as 65004\nset protocols bgp group toAs4 neighbor 192.168.0.0\nset protocols bgp group toAs1PEs multihop no-nexthop-change\nset protocols bgp group toAs1PEs local-address 10.2.2.5\nset protocols bgp group toAs1PEs family inet unicast\nset protocols bgp group toAs1PEs family inet-vpn unicast\nset protocols bgp group toAs1PEs family inet6 unicast\nset protocols bgp group toAs1PEs family inet6-vpn unicast\nset protocols bgp group toAs1PEs export nhs\nset protocols bgp group toAs1PEs peer-as 65001\nset protocols bgp group toAs1PEs neighbor 10.1.1.1\nset protocols bgp group toAs1PEs neighbor 10.1.1.2\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy\nset protocols bgp multipath",
            "设备 P1": "set interfaces ge-0/0/1 description P1-to-RR1\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.6/31\nset interfaces ge-0/0/1 unit 0 family iso\nset interfaces ge-0/0/1 unit 0 family mpls\nset interfaces ge-0/0/2 description P1-to-ABR1\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.8/31\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family mpls\nset interfaces ge-0/0/3 description P1-to-PE1\nset interfaces ge-0/0/3 vlan-tagging\nset interfaces ge-0/0/3 unit 0 vlan-id 100\nset interfaces ge-0/0/3 unit 0 family inet address 192.168.0.5/31\nset interfaces ge-0/0/3 unit 0 family iso\nset interfaces ge-0/0/3 unit 0 family mpls\nset interfaces ge-0/0/4 description P1-to-ABR2\nset interfaces ge-0/0/4 vlan-tagging\nset interfaces ge-0/0/4 unit 0 vlan-id 100\nset interfaces ge-0/0/4 unit 0 family inet address 192.168.0.10/31\nset interfaces ge-0/0/4 unit 0 family iso\nset interfaces ge-0/0/4 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.2.2.8/32\nset interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0008.00\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.0\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset routing-options router-id 10.2.2.8\nset protocols isis level 1 disable\nset protocols isis interface all\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface all\nset protocols ldp interface all\nset protocols mpls interface all",
            "设备 RR1": "set interfaces ge-0/0/1 description RR1-to-P1\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.7/31\nset interfaces ge-0/0/1 unit 0 family iso\nset interfaces ge-0/0/1 unit 0 family mpls\nset interfaces lo0 unit 1 family inet address 10.2.2.6/32\nset interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0006.00\nset policy-options policy-statement add-noexport term 1 then community add noexport\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.1\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement export-inet3 term 1 from rib inet.3\nset policy-options policy-statement export-inet3 term 1 then accept\nset policy-options policy-statement export-inet3 term 2 then reject\nset policy-options policy-statement pplb then load-balance per-packet\nset policy-options community noexport members no-export\nset policy-options community noexport members no-advertise\nset routing-options forwarding-table export pplb\nset routing-options interface-routes rib-group inet inet0to3\nset routing-options router-id 10.2.2.6\nset routing-options autonomous-system 2\nset routing-options rib-groups inet0to3 import-rib inet.0\nset routing-options rib-groups inet0to3 import-rib inet.3\nset routing-options rib-groups inet0to3 import-policy allow-lo0\nset routing-options rib-groups inet3to0 import-rib inet.3\nset routing-options rib-groups inet3to0 import-rib inet.0\nset routing-options rib-groups inet3to0 import-rib inet6.3\nset routing-options rib-groups inet3to0 import-policy add-noexport\nset protocols isis level 1 disable\nset protocols isis interface all\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface all\nset protocols ldp interface all\nset protocols mpls interface all\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs2Reg2BNs type internal\nset protocols bgp group toAs2Reg2BNs family inet labeled-unicast rib-group inet3to0\nset protocols bgp group toAs2Reg2BNs family inet labeled-unicast add-path receive\nset protocols bgp group toAs2Reg2BNs family inet labeled-unicast add-path send path-count 4\nset protocols bgp group toAs2Reg2BNs family inet labeled-unicast rib inet.3\nset protocols bgp group toAs2Reg2BNs export export-inet3\nset protocols bgp group toAs2Reg2BNs neighbor 10.2.2.3\nset protocols bgp group toAs2Reg2BNs neighbor 10.2.2.4\nset protocols bgp group toAs2Reg2BNs neighbor 10.2.2.5\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy\nset protocols bgp local-address 10.2.2.6\nset protocols bgp cluster 10.2.2.6",
            "设备 ABR1": "set interfaces ge-0/0/1 description ABR1-to-P2\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.12/31\nset interfaces ge-0/0/1 unit 0 family iso\nset interfaces ge-0/0/1 unit 0 family mpls\nset interfaces ge-0/0/2 description ABR1-to-P1\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.9/31\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.2.2.3/32\nset interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0003.00\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.0\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement nhs term 1 from protocol bgp\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset policy-options policy-statement pplb then load-balance per-packet\nset routing-options forwarding-table export pplb\nset routing-options router-id 10.2.2.3\nset routing-options autonomous-system 65002\nset protocols isis level 1 disable\nset protocols isis interface all\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface all\nset protocols ldp interface all\nset protocols mpls label-switched-path toASBR2-gold to 10.2.2.2\nset protocols mpls label-switched-path toASBR1-bronze to 10.2.2.1\nset protocols mpls label-switched-path toASBR2-bronze to 10.2.2.2\nset protocols mpls interface all\nset protocols bgp group toAs2RR type internal\nset protocols bgp group toAs2RR local-address 10.2.2.3\nset protocols bgp group toAs2RR advertise-inactive\nset protocols bgp group toAs2RR family inet labeled-unicast add-path receive\nset protocols bgp group toAs2RR family inet labeled-unicast add-path send path-count 4\nset protocols bgp group toAs2RR family inet labeled-unicast rib inet.3\nset protocols bgp group toAs2RR export nhs\nset protocols bgp group toAs2RR cluster 10.2.2.3\nset protocols bgp group toAs2RR neighbor 10.2.2.6\nset protocols bgp group toAs2RR neighbor 10.2.2.7\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy",
            "设备 ABR2": "set interfaces ge-0/0/2 description ABR2-to-P2\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.14/31\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family mpls\nset interfaces ge-0/0/4 description ABR2-to-P1\nset interfaces ge-0/0/4 vlan-tagging\nset interfaces ge-0/0/4 unit 0 vlan-id 100\nset interfaces ge-0/0/4 unit 0 family inet address 192.168.0.11/31\nset interfaces ge-0/0/4 unit 0 family iso\nset interfaces ge-0/0/4 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.2.2.4/32\nset interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0004.00\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.0\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement nhs term 1 from protocol bgp\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset policy-options policy-statement pplb then load-balance per-packet\nset routing-options forwarding-table export pplb\nset routing-options router-id 10.2.2.4\nset routing-options autonomous-system 65002\nset protocols isis level 1 disable\nset protocols isis interface all\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface all\nset protocols ldp interface all\nset protocols mpls label-switched-path toASBR1-bronze to 10.2.2.1\nset protocols mpls interface all\nset protocols bgp group toAs2RR type internal\nset protocols bgp group toAs2RR local-address 10.2.2.4\nset protocols bgp group toAs2RR advertise-inactive\nset protocols bgp group toAs2RR family inet labeled-unicast add-path receive\nset protocols bgp group toAs2RR family inet labeled-unicast add-path send path-count 4\nset protocols bgp group toAs2RR family inet labeled-unicast rib inet.3\nset protocols bgp group toAs2RR export nhs\nset protocols bgp group toAs2RR cluster 10.2.2.4\nset protocols bgp group toAs2RR neighbor 10.2.2.6\nset protocols bgp group toAs2RR neighbor 10.2.2.7\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy",
            "设备 P2": "set interfaces ge-0/0/1 description P2-to-ABR1\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.13/31\nset interfaces ge-0/0/1 unit 0 family iso\nset interfaces ge-0/0/1 unit 0 family mpls\nset interfaces ge-0/0/2 description P2-to-ABR2\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.15/31\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family mpls\nset interfaces ge-0/0/3 description P2-to-RR2\nset interfaces ge-0/0/3 vlan-tagging\nset interfaces ge-0/0/3 unit 0 vlan-id 100\nset interfaces ge-0/0/3 unit 0 family inet address 192.168.0.16/31\nset interfaces ge-0/0/3 unit 0 family iso\nset interfaces ge-0/0/3 unit 0 family mpls\nset interfaces ge-0/0/4 description P2-to-ASBR1\nset interfaces ge-0/0/4 vlan-tagging\nset interfaces ge-0/0/4 unit 0 vlan-id 100\nset interfaces ge-0/0/4 unit 0 family inet address 192.168.0.18/31\nset interfaces ge-0/0/4 unit 0 family iso\nset interfaces ge-0/0/4 unit 0 family mpls\nset interfaces ge-0/0/5 description P2-to-ASBR2\nset interfaces ge-0/0/5 vlan-tagging\nset interfaces ge-0/0/5 unit 0 vlan-id 100\nset interfaces ge-0/0/5 unit 0 family inet address 192.168.0.20/31\nset interfaces ge-0/0/5 unit 0 family iso\nset interfaces ge-0/0/5 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.2.2.9/32\nset interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0009.00\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.0\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset routing-options router-id 10.2.2.9\nset protocols isis level 1 disable\nset protocols isis interface all\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface all\nset protocols ldp interface all\nset protocols mpls interface all",
            "设备 RR2": "set interfaces ge-0/0/3 description RR2-to-P2\nset interfaces ge-0/0/3 vlan-tagging\nset interfaces ge-0/0/3 unit 0 vlan-id 100\nset interfaces ge-0/0/3 unit 0 family inet address 192.168.0.17/31\nset interfaces ge-0/0/3 unit 0 family iso\nset interfaces ge-0/0/3 unit 0 family mpls\nset interfaces lo0 unit 1 family inet address 10.2.2.7/32\nset interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0007.00\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.1\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement export-inet3 term 1 from rib inet.3\nset policy-options policy-statement export-inet3 term 1 then accept\nset policy-options policy-statement export-inet3 term 2 then reject\nset policy-options policy-statement pplb then load-balance per-packet\nset routing-options forwarding-table export pplb\nset routing-options interface-routes rib-group inet inet0to3\nset routing-options router-id 10.2.2.7\nset routing-options autonomous-system 65002\nset routing-options rib-groups inet0to3 import-rib inet.0\nset routing-options rib-groups inet0to3 import-rib inet.3\nset routing-options rib-groups inet0to3 import-policy allow-lo0\nset protocols isis level 1 disable\nset protocols isis interface all\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface all\nset protocols ldp interface all\nset protocols mpls interface all\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs2Reg1BNs type internal\nset protocols bgp group toAs2Reg1BNs family inet labeled-unicast add-path receive\nset protocols bgp group toAs2Reg1BNs family inet labeled-unicast add-path send path-count 4\nset protocols bgp group toAs2Reg1BNs family inet labeled-unicast rib inet.3\nset protocols bgp group toAs2Reg1BNs neighbor 10.2.2.1\nset protocols bgp group toAs2Reg1BNs neighbor 10.2.2.2\nset protocols bgp group toAs2Reg1BNs neighbor 10.2.2.3\nset protocols bgp group toAs2Reg1BNs neighbor 10.2.2.4\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy\nset protocols bgp local-address 10.2.2.7\nset protocols bgp cluster 10.2.2.7",
            "设备 ASBR1": "set interfaces ge-0/0/2 description ASBR1-to-ASBR3\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.22/31\nset interfaces ge-0/0/2 unit 0 family mpls\nset interfaces ge-0/0/3 description ASBR1-to-ASBR4\nset interfaces ge-0/0/3 vlan-tagging\nset interfaces ge-0/0/3 unit 0 vlan-id 100\nset interfaces ge-0/0/3 unit 0 family inet address 192.168.0.24/31\nset interfaces ge-0/0/3 unit 0 family mpls\nset interfaces ge-0/0/4 description ASBR1-to-P2\nset interfaces ge-0/0/4 vlan-tagging\nset interfaces ge-0/0/4 unit 0 vlan-id 100\nset interfaces ge-0/0/4 unit 0 family inet address 192.168.0.19/31\nset interfaces ge-0/0/4 unit 0 family iso\nset interfaces ge-0/0/4 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.2.2.1/32\nset interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0001.00\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.0\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement nhs term 1 from protocol bgp\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset policy-options policy-statement pplb then load-balance per-packet\nset routing-options forwarding-table export pplb\nset routing-options router-id 10.2.2.1\nset routing-options autonomous-system 65002\nset protocols isis level 1 disable\nset protocols isis interface ge-0/0/4.0\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface ge-0/0/4.0\nset protocols ldp interface ge-0/0/4.0\nset protocols mpls interface ge-0/0/4.0\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs1-T family inet labeled-unicast rib inet.3\nset protocols bgp group toAs1-T peer-as 1\nset protocols bgp group toAs1-T neighbor 192.168.0.23\nset protocols bgp group toAs1-T neighbor 192.168.0.27\nset protocols bgp group toAs2RR type internal\nset protocols bgp group toAs2RR local-address 10.2.2.1\nset protocols bgp group toAs2RR advertise-external\nset protocols bgp group toAs2RR family inet labeled-unicast rib inet.3\nset protocols bgp group toAs2RR export nhs\nset protocols bgp group toAs2RR neighbor 10.2.2.7\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy",
            "设备 ASBR2": "set interfaces ge-0/0/1 description ASBR2-to-ASBR3\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.28/31\nset interfaces ge-0/0/1 unit 0 family mpls\nset interfaces ge-0/0/2 description ASBR2-to-ASBR4\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.26/31\nset interfaces ge-0/0/2 unit 0 family mpls\nset interfaces ge-0/0/5 description ASBR2-to-P2\nset interfaces ge-0/0/5 vlan-tagging\nset interfaces ge-0/0/5 unit 0 vlan-id 100\nset interfaces ge-0/0/5 unit 0 family inet address 192.168.0.21/31\nset interfaces ge-0/0/5 unit 0 family iso\nset interfaces ge-0/0/5 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.2.2.2/32\nset interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0002.00\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.0\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement nhs term 1 from protocol bgp\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset policy-options policy-statement pplb then load-balance per-packet\nset routing-options forwarding-table export pplb\nset routing-options router-id 10.2.2.2\nset routing-options autonomous-system 65002\nset protocols isis level 1 disable\nset protocols isis interface ge-0/0/5.0\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface ge-0/0/5.0\nset protocols ldp interface ge-0/0/5.0\nset protocols mpls interface ge-0/0/5.0\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs1-T family inet labeled-unicast rib inet.3\nset protocols bgp group toAs1-T peer-as 1\nset protocols bgp group toAs1-T neighbor 192.168.0.29\nset protocols bgp group toAs1-T neighbor 192.168.0.25\nset protocols bgp group toAs2RR type internal\nset protocols bgp group toAs2RR local-address 10.2.2.2\nset protocols bgp group toAs2RR advertise-external\nset protocols bgp group toAs2RR family inet labeled-unicast rib inet.3\nset protocols bgp group toAs2RR export nhs\nset protocols bgp group toAs2RR neighbor 10.2.2.7\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy",
            "设备 ASBR3": "set interfaces ge-0/0/1 description ASBR3-to-ASBR2\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.29/31\nset interfaces ge-0/0/1 unit 0 family mpls\nset interfaces ge-0/0/2 description ASBR3-to-ASBR1\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.23/31\nset interfaces ge-0/0/2 unit 0 family mpls\nset interfaces ge-0/0/4 description ASBR3-to-P3\nset interfaces ge-0/0/4 vlan-tagging\nset interfaces ge-0/0/4 unit 0 vlan-id 100\nset interfaces ge-0/0/4 unit 0 family inet address 192.168.0.30/31\nset interfaces ge-0/0/4 unit 0 family iso\nset interfaces ge-0/0/4 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.1.1.3/32\nset interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0003.00\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.0\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement nhs term 1 from protocol bgp\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset policy-options policy-statement pplb then load-balance per-packet\nset routing-options forwarding-table export pplb\nset routing-options router-id 10.1.1.3\nset routing-options autonomous-system 65001\nset protocols isis level 1 disable\nset protocols isis interface ge-0/0/4.0\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface ge-0/0/4.0\nset protocols ldp interface ge-0/0/4.0\nset protocols mpls label-switched-path toPE2-gold to 10.1.1.1\nset protocols mpls interface ge-0/0/4.0\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs2-T family inet labeled-unicast rib inet.3\nset protocols bgp group toAs2-T peer-as 65002\nset protocols bgp group toAs2-T neighbor 192.168.0.22\nset protocols bgp group toAs2-T neighbor 192.168.0.28\nset protocols bgp group toAs1RR type internal\nset protocols bgp group toAs1RR local-address 10.1.1.3\nset protocols bgp group toAs1RR advertise-external\nset protocols bgp group toAs1RR family inet labeled-unicast rib inet.3\nset protocols bgp group toAs1RR export nhs\nset protocols bgp group toAs1RR neighbor 10.1.1.6\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy",
            "设备 ASBR4": "set interfaces ge-0/0/1 description ASBR4-to-P3\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.32/31\nset interfaces ge-0/0/1 unit 0 family iso\nset interfaces ge-0/0/1 unit 0 family mpls\nset interfaces ge-0/0/2 description ASBR4-to-ASBR2\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.27/31\nset interfaces ge-0/0/2 unit 0 family mpls\nset interfaces ge-0/0/3 description ASBR4-to-ASBR1\nset interfaces ge-0/0/3 vlan-tagging\nset interfaces ge-0/0/3 unit 0 vlan-id 100\nset interfaces ge-0/0/3 unit 0 family inet address 192.168.0.25/31\nset interfaces ge-0/0/3 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.1.1.4/32\nset interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0004.00\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.0\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement nhs term 1 from protocol bgp\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset policy-options policy-statement pplb then load-balance per-packet\nset routing-options forwarding-table export pplb\nset routing-options router-id 10.1.1.4\nset routing-options autonomous-system 65001\nset protocols isis level 1 disable\nset protocols isis interface ge-0/0/1.0\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface ge-0/0/1.0\nset protocols ldp interface ge-0/0/1.0\nset protocols mpls label-switched-path toPE2-bronze to 10.1.1.1\nset protocols mpls label-switched-path toPE3-bronze to 10.1.1.2\nset protocols mpls interface ge-0/0/1.0\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs2-T family inet labeled-unicast rib inet.3\nset protocols bgp group toAs2-T peer-as 2\nset protocols bgp group toAs2-T neighbor 192.168.0.26\nset protocols bgp group toAs2-T neighbor 192.168.0.24\nset protocols bgp group toAs1RR type internal\nset protocols bgp group toAs1RR local-address 10.1.1.4\nset protocols bgp group toAs1RR advertise-external\nset protocols bgp group toAs1RR family inet labeled-unicast rib inet.3\nset protocols bgp group toAs1RR export nhs\nset protocols bgp group toAs1RR neighbor 10.1.1.6\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy",
            "设备 RR3": "set interfaces ge-0/0/2 description RR3-to-P3\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.35/31\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family mpls\nset interfaces lo0 unit 1 family inet address 10.1.1.6/32\nset interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0006.00\nset policy-options policy-statement add-noexport term 1 then community add noexport\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.1\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement export-inet3 term 1 from rib inet.3\nset policy-options policy-statement export-inet3 term 1 then accept\nset policy-options policy-statement export-inet3 term 2 then reject\nset policy-options policy-statement pplb then load-balance per-packet\nset policy-options community noexport members no-export\nset policy-options community noexport members no-advertise\nset routing-options forwarding-table export pplb\nset routing-options interface-routes rib-group inet inet0to3\nset routing-options router-id 10.1.1.6\nset routing-options autonomous-system 1\nset routing-options rib-groups inet0to3 import-rib inet.0\nset routing-options rib-groups inet0to3 import-rib inet.3\nset routing-options rib-groups inet0to3 import-policy allow-lo0\nset routing-options rib-groups inet3to0 import-rib inet.3\nset routing-options rib-groups inet3to0 import-rib inet.0\nset routing-options rib-groups inet3to0 import-policy add-noexport\nset protocols isis level 1 disable\nset protocols isis interface all\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface all\nset protocols ldp interface all\nset protocols mpls interface all\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs1BNs type internal\nset protocols bgp group toAs1BNs family inet labeled-unicast rib-group inet3to0\nset protocols bgp group toAs1BNs family inet labeled-unicast add-path receive\nset protocols bgp group toAs1BNs family inet labeled-unicast add-path send path-count 4\nset protocols bgp group toAs1BNs family inet labeled-unicast rib inet.3\nset protocols bgp group toAs1BNs export export-inet3\nset protocols bgp group toAs1BNs neighbor 10.1.1.3\nset protocols bgp group toAs1BNs neighbor 10.1.1.4\nset protocols bgp group toAs1BNs neighbor 10.1.1.2\nset protocols bgp group toAs1BNs neighbor 10.1.1.1\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy\nset protocols bgp local-address 10.1.1.6\nset protocols bgp cluster 10.1.1.6",
            "设备 P3": "set interfaces ge-0/0/1 description P3-to-ASBR4\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.33/31\nset interfaces ge-0/0/1 unit 0 family iso\nset interfaces ge-0/0/1 unit 0 family mpls\nset interfaces ge-0/0/2 description P3-to-RR3\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.34/31\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family mpls\nset interfaces ge-0/0/3 description P3-to-PE2\nset interfaces ge-0/0/3 vlan-tagging\nset interfaces ge-0/0/3 unit 0 vlan-id 100\nset interfaces ge-0/0/3 unit 0 family inet address 192.168.0.36/31\nset interfaces ge-0/0/3 unit 0 family iso\nset interfaces ge-0/0/3 unit 0 family mpls\nset interfaces ge-0/0/4 description P3-to-ASBR3\nset interfaces ge-0/0/4 vlan-tagging\nset interfaces ge-0/0/4 unit 0 vlan-id 100\nset interfaces ge-0/0/4 unit 0 family inet address 192.168.0.31/31\nset interfaces ge-0/0/4 unit 0 family iso\nset interfaces ge-0/0/4 unit 0 family mpls\nset interfaces ge-0/0/5 description P3-to-PE3\nset interfaces ge-0/0/5 vlan-tagging\nset interfaces ge-0/0/5 unit 0 vlan-id 100\nset interfaces ge-0/0/5 unit 0 family inet address 192.168.0.38/31\nset interfaces ge-0/0/5 unit 0 family iso\nset interfaces ge-0/0/5 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.1.1.5/32\nset interfaces lo0 unit 0 family iso address 49.0000.0000.aaaa.0005.00\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.0\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset routing-options router-id 10.1.1.5\nset protocols isis level 1 disable\nset protocols isis interface all\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface all\nset protocols ldp interface all\nset protocols mpls interface all",
            "设备 PE2": "set interfaces ge-0/0/1 description PE2-to-CE2-Link1\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.40/31\nset interfaces ge-0/0/2 description PE2-to-CE2-Link2\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.42/31\nset interfaces ge-0/0/3 description PE2-to-P3\nset interfaces ge-0/0/3 vlan-tagging\nset interfaces ge-0/0/3 unit 0 vlan-id 100\nset interfaces ge-0/0/3 unit 0 family inet address 192.168.0.37/31\nset interfaces ge-0/0/3 unit 0 family iso\nset interfaces ge-0/0/3 unit 0 family mpls\nset interfaces lo0 unit 1 family inet address 10.1.1.1/32\nset interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0001.00\nset policy-options policy-statement add-noexport term 1 then community add noexport\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.1\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement export-inet3 term 1 from rib inet.3\nset policy-options policy-statement export-inet3 term 1 then accept\nset policy-options policy-statement export-inet3 term 2 then reject\nset policy-options policy-statement nhs term 1 from protocol bgp\nset policy-options policy-statement nhs term 1 then metric add 0\nset policy-options policy-statement nhs term 1 then local-preference 200\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset policy-options policy-statement pplb then load-balance per-packet\nset policy-options policy-statement vrf-export-red term 1 then community add leak2red\nset policy-options policy-statement vrf-export-red term 1 then accept\nset policy-options policy-statement vrf-import-red term 1 from community leak2red\nset policy-options policy-statement vrf-import-red term 1 then accept\nset policy-options community leak2red members target:100:100\nset policy-options community noexport members no-export\nset policy-options community noexport members no-advertise\nset routing-instances red protocols bgp group toCE2 peer-as 65003\nset routing-instances red protocols bgp group toCE2 neighbor 192.168.0.43\nset routing-instances red instance-type vrf\nset routing-instances red interface ge-0/0/2.0\nset routing-instances red vrf-import vrf-import-red\nset routing-instances red vrf-export vrf-export-red\nset routing-options route-distinguisher-id 10.1.1.1\nset routing-options forwarding-table export pplb\nset routing-options interface-routes rib-group inet inet0to3\nset routing-options router-id 10.1.1.1\nset routing-options autonomous-system 1\nset routing-options rib-groups inet0to3 import-rib inet.0\nset routing-options rib-groups inet0to3 import-rib inet.3\nset routing-options rib-groups inet0to3 import-policy allow-lo0\nset routing-options rib-groups inet3to0 import-rib inet.3\nset routing-options rib-groups inet3to0 import-rib inet.0\nset routing-options rib-groups inet3to0 import-policy add-noexport\nset protocols isis level 1 disable\nset protocols isis interface ge-0/0/3.0\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface ge-0/0/3.0\nset protocols ldp interface ge-0/0/3.0\nset protocols mpls interface ge-0/0/3.0\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs3-1 peer-as 65003\nset protocols bgp group toAs3-1 neighbor 192.168.0.41\nset protocols bgp group toAs1RR type internal\nset protocols bgp group toAs1RR local-address 10.1.1.1\nset protocols bgp group toAs1RR advertise-external\nset protocols bgp group toAs1RR family inet labeled-unicast rib-group inet3to0\nset protocols bgp group toAs1RR family inet labeled-unicast add-path receive\nset protocols bgp group toAs1RR family inet labeled-unicast add-path send path-count 4\nset protocols bgp group toAs1RR family inet labeled-unicast rib inet.3\nset protocols bgp group toAs1RR family inet6-vpn unicast\nset protocols bgp group toAs1RR export nhs\nset protocols bgp group toAs1RR export export-inet3\nset protocols bgp group toAs1RR neighbor 10.1.1.6\nset protocols bgp group toAs2PEs multihop no-nexthop-change\nset protocols bgp group toAs2PEs local-address 10.1.1.1\nset protocols bgp group toAs2PEs family inet unicast\nset protocols bgp group toAs2PEs family inet-vpn unicast\nset protocols bgp group toAs2PEs family inet6 unicast\nset protocols bgp group toAs2PEs family inet6-vpn unicast\nset protocols bgp group toAs2PEs export nhs\nset protocols bgp group toAs2PEs peer-as 65002\nset protocols bgp group toAs2PEs neighbor 10.2.2.5\nset protocols bgp group toAs2PEs vpn-apply-export\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy",
            "设备 PE3": "set interfaces ge-0/0/3 description PE3-to-CE2-Link1\nset interfaces ge-0/0/3 vlan-tagging\nset interfaces ge-0/0/3 unit 0 vlan-id 100\nset interfaces ge-0/0/3 unit 0 family inet address 192.168.0.44/31\nset interfaces ge-0/0/4 description PE3-to-CE2-Link2\nset interfaces ge-0/0/4 vlan-tagging\nset interfaces ge-0/0/4 unit 0 vlan-id 100\nset interfaces ge-0/0/4 unit 0 family inet address 192.168.0.46/31\nset interfaces ge-0/0/5 description PE3-to-P3\nset interfaces ge-0/0/5 vlan-tagging\nset interfaces ge-0/0/5 unit 0 vlan-id 100\nset interfaces ge-0/0/5 unit 0 family inet address 192.168.0.39/31\nset interfaces ge-0/0/5 unit 0 family iso\nset interfaces ge-0/0/5 unit 0 family mpls\nset interfaces lo0 unit 1 family inet address 10.1.1.2/32\nset interfaces lo0 unit 1 family iso address 49.0000.0000.aaaa.0002.00\nset policy-options policy-statement add-noexport term 1 then community add noexport\nset policy-options policy-statement allow-lo0 term 1 from interface lo0.1\nset policy-options policy-statement allow-lo0 term 1 then accept\nset policy-options policy-statement allow-lo0 term 2 then reject\nset policy-options policy-statement export-inet3 term 1 from rib inet.3\nset policy-options policy-statement export-inet3 term 1 then accept\nset policy-options policy-statement export-inet3 term 2 then reject\nset policy-options policy-statement nhs term 1 from protocol bgp\nset policy-options policy-statement nhs term 1 then metric add 0\nset policy-options policy-statement nhs term 1 then local-preference 200\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset policy-options policy-statement pplb then load-balance per-packet\nset policy-options policy-statement vrf-export-red term 1 then community add leak2red\nset policy-options policy-statement vrf-export-red term 1 then accept\nset policy-options policy-statement vrf-import-red term 1 from community leak2red\nset policy-options policy-statement vrf-import-red term 1 then accept\nset policy-options community leak2red members target:100:100\nset policy-options community noexport members no-export\nset policy-options community noexport members no-advertise\nset routing-instances red protocols bgp group toCE2 peer-as 65003\nset routing-instances red protocols bgp group toCE2 neighbor 192.168.0.47\nset routing-instances red instance-type vrf\nset routing-instances red interface ge-0/0/4.0\nset routing-instances red vrf-import vrf-import-red\nset routing-instances red vrf-export vrf-export-red\nset routing-options route-distinguisher-id 10.1.1.2\nset routing-options forwarding-table export pplb\nset routing-options interface-routes rib-group inet inet0to3\nset routing-options router-id 10.1.1.2\nset routing-options autonomous-system 1\nset routing-options rib-groups inet0to3 import-rib inet.0\nset routing-options rib-groups inet0to3 import-rib inet.3\nset routing-options rib-groups inet0to3 import-policy allow-lo0\nset routing-options rib-groups inet3to0 import-rib inet.3\nset routing-options rib-groups inet3to0 import-rib inet.0\nset routing-options rib-groups inet3to0 import-policy add-noexport\nset protocols isis level 1 disable\nset protocols isis interface ge-0/0/5.0\nset protocols isis export allow-lo0\nset protocols isis topologies ipv6-unicast\nset protocols rsvp interface ge-0/0/5.0\nset protocols ldp interface ge-0/0/5.0\nset protocols mpls interface ge-0/0/5.0\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs3 peer-as 65003\nset protocols bgp group toAs3 neighbor 192.168.0.45\nset protocols bgp group toAs1RR type internal\nset protocols bgp group toAs1RR local-address 10.1.1.2\nset protocols bgp group toAs1RR advertise-external\nset protocols bgp group toAs1RR family inet labeled-unicast rib-group inet3to0\nset protocols bgp group toAs1RR family inet labeled-unicast rib inet.3\nset protocols bgp group toAs1RR export nhs\nset protocols bgp group toAs1RR export export-inet3\nset protocols bgp group toAs1RR neighbor 10.1.1.6\nset protocols bgp group toAs2PEs multihop no-nexthop-change\nset protocols bgp group toAs2PEs local-address 10.1.1.2\nset protocols bgp group toAs2PEs family inet unicast\nset protocols bgp group toAs2PEs family inet-vpn unicast\nset protocols bgp group toAs2PEs family inet6 unicast\nset protocols bgp group toAs2PEs family inet6-vpn unicast\nset protocols bgp group toAs2PEs export nhs\nset protocols bgp group toAs2PEs peer-as 65002\nset protocols bgp group toAs2PEs neighbor 10.2.2.5\nset protocols bgp group toAs2PEs vpn-apply-export\nset protocols bgp traceoptions file bgp.log\nset protocols bgp traceoptions file size 100m\nset protocols bgp traceoptions flag state detail\nset protocols bgp traceoptions flag policy",
            "设备 CE2": "set interfaces ge-0/0/1 description CE2-to-PE2-Link1\nset interfaces ge-0/0/1 vlan-tagging\nset interfaces ge-0/0/1 unit 0 vlan-id 100\nset interfaces ge-0/0/1 unit 0 family inet address 192.168.0.41/31\nset interfaces ge-0/0/2 description CE2-to-PE2-Link2\nset interfaces ge-0/0/2 vlan-tagging\nset interfaces ge-0/0/2 unit 0 vlan-id 100\nset interfaces ge-0/0/2 unit 0 family inet address 192.168.0.43/31\nset interfaces ge-0/0/3 description CE2-to-PE3-Link1\nset interfaces ge-0/0/3 vlan-tagging\nset interfaces ge-0/0/3 unit 0 vlan-id 100\nset interfaces ge-0/0/3 unit 0 family inet address 192.168.0.45/31\nset interfaces ge-0/0/4 description CE2-to-PE3-Link2\nset interfaces ge-0/0/4 vlan-tagging\nset interfaces ge-0/0/4 unit 0 vlan-id 100\nset interfaces ge-0/0/4 unit 0 family inet address 192.168.0.47/31\nset interfaces lo0 unit 0 family inet address 10.3.3.3/32\nset policy-options policy-statement nhs term 1 from interface lo0.0\nset policy-options policy-statement nhs term 1 then metric 50\nset policy-options policy-statement nhs term 1 then next-hop self\nset policy-options policy-statement nhs term 1 then accept\nset policy-options policy-statement nhsMED100 term 1 from interface lo0.0\nset policy-options policy-statement nhsMED100 term 1 then metric 100\nset policy-options policy-statement nhsMED100 term 1 then next-hop self\nset policy-options policy-statement nhsMED100 term 1 then accept\nset policy-options community map2bronze members 100:200\nset policy-options community map2gold members 100:100\nset policy-options community map2gold_bronze_plain members 300:400\nset routing-options router-id 10.3.3.3\nset routing-options autonomous-system 65003\nset protocols bgp path-selection external-router-id\nset protocols bgp group toAs1Internet export nhs\nset protocols bgp group toAs1Internet peer-as 65001\nset protocols bgp group toAs1Internet neighbor 192.168.0.40\nset protocols bgp group toAs1Internet neighbor 192.168.0.44 export nhsMED100\nset protocols bgp group toAs1L3VPN export nhs\nset protocols bgp group toAs1L3VPN peer-as 65001\nset protocols bgp group toAs1L3VPN neighbor 192.168.0.46\nset protocols bgp group toAs1L3VPN neighbor 192.168.0.42 export nhsMED100"
          }
        },
        {
          "title": "配置 CE1",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南 中的在 配置模式下使用 CLI 编辑器 。 要配置设备 CE1： 配置接口以启用 IP 和 MPLS 传输。 [edit interfaces] user@CE1# set ge-0/0/1 description CE1-to-PE1-Link1 user@CE1# set ge-0/0/1 vlan-tagging user@CE1# set ge-0/0/1 unit 0 vlan-id 100 user@CE1# set ge-0/0/1 unit 0 family inet address 192.168.0.0/31 user@CE1# set ge-0/0/2 description CE1-to-PE1-Link2 user@CE1# set ge-0/0/2 vlan-tagging user@CE1# set ge-0/0/2 unit 0 vlan-id 100 user@CE1# set ge-0/0/2 unit 0 family inet address 192.168.0.2/31 配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。 [edit interfaces] user@CE1# set lo0 unit 0 family inet address 10.4.4.4/32 配置多路径解析策略以将分层多路径安装到 PFE 中。 [edit policy-options] user@CE1# set policy-statement nhs term 1 from interface lo0.0 user@CE1# set policy-statement nhs term 1 then next-hop self user@CE1# set policy-statement nhs term 1 then accept 配置路由选项。 [edit routing-options] user@CE1# set router-id 10.4.4.4 user@CE1# set autonomous-system 65004 将标记为单播的 BGP 配置为 ABR，以将环路 IP 地址交换为 BGP 标记的单播前缀。 [edit protocols bgp] user@CE1# set path-selection external-router-id user@CE1# set group toAs2 export nhs user@CE1# set group toAs2 peer-as 65002 user@CE1# set group toAs2 neighbor 192.168.0.1 user@CE1# set group toAs2 neighbor 192.168.0.3 在配置模式下，输入 show interfaces 、 show policy-options 、 show routing-options 和 show protocols 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/1 { description CE1-to-PE1-Link1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.0/31; } } } ge-0/0/2 { description CE1-to-PE1-Link2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.2/31; } } } lo0 { unit 0 { family inet { address 10.4.4.4/32; } } } } policy-options { policy-statement nhs { term 1 { from interface lo0.0; then { next-hop self; accept; } } } } routing-options { router-id 10.4.4.4; autonomous-system 65004; } protocols { bgp { path-selection external-router-id; group toAs2 { export nhs; peer-as 65002; neighbor 192.168.0.1; neighbor 192.168.0.3; } } }",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口以启用 IP 和 MPLS 传输。",
                  "code": [
                    "[edit interfaces]",
                    "user@CE1#set ge-0/0/1 description CE1-to-PE1-Link1",
                    "user@CE1#set ge-0/0/1 vlan-tagging",
                    "user@CE1#set ge-0/0/1 unit 0 vlan-id 100",
                    "user@CE1#set ge-0/0/1 unit 0 family inet address 192.168.0.0/31",
                    "user@CE1#set ge-0/0/2 description CE1-to-PE1-Link2",
                    "user@CE1#set ge-0/0/2 vlan-tagging",
                    "user@CE1#set ge-0/0/2 unit 0 vlan-id 100",
                    "user@CE1#set ge-0/0/2 unit 0 family inet address 192.168.0.2/31"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@CE1#set lo0 unit 0 family inet address 10.4.4.4/32"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置多路径解析策略以将分层多路径安装到 PFE 中。",
                  "code": [
                    "[edit policy-options]",
                    "user@CE1#set policy-statement nhs term 1 from interface lo0.0",
                    "user@CE1#set policy-statement nhs term 1 then next-hop self",
                    "user@CE1#set policy-statement nhs term 1 then accept"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置路由选项。",
                  "code": [
                    "[edit routing-options]",
                    "user@CE1#set router-id 10.4.4.4",
                    "user@CE1#set autonomous-system 65004"
                  ]
                },
                {
                  "step": 5,
                  "description": "将标记为单播的 BGP 配置为 ABR，以将环路 IP 地址交换为 BGP 标记的单播前缀。",
                  "code": [
                    "[edit protocols bgp]",
                    "user@CE1#set path-selection external-router-id",
                    "user@CE1#set group toAs2 export nhs",
                    "user@CE1#set group toAs2 peer-as 65002",
                    "user@CE1#set group toAs2 neighbor 192.168.0.1",
                    "user@CE1#set group toAs2 neighbor 192.168.0.3"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show routing-options 和 show protocols 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "interfaces {\n    ge-0/0/1 {\n        description CE1-to-PE1-Link1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.0/31;\n            }\n        }\n    }\n    ge-0/0/2 {\n        description CE1-to-PE1-Link2;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.2/31;\n            }\n        }\n    }\n    lo0 {\n        unit 0 {\n            family inet {\n                address 10.4.4.4/32;\n            }\n        }\n    }\n}\npolicy-options {\n    policy-statement nhs {\n        term 1 {\n            from interface lo0.0;\n            then {\n                next-hop self;\n                accept;\n            }\n        }\n    }\n}\nrouting-options {\n    router-id 10.4.4.4;\n    autonomous-system 65004;\n}\nprotocols {\n    bgp {\n        path-selection external-router-id;\n        group toAs2 {\n            export nhs;\n            peer-as 65002;\n            neighbor 192.168.0.1;\n            neighbor 192.168.0.3;\n        }\n    }\n}"
              ]
            }
          ]
        },
        {
          "title": "配置 PE1",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南 中的在 配置模式下使用 CLI 编辑器 。 要配置设备 PE1： 配置接口以启用 IP 和 MPLS 传输。 [edit interfaces] user@PE1# set ge-0/0/1 description PE1-to-CE1-Link1 user@PE1# set ge-0/0/1 vlan-tagging user@PE1# set ge-0/0/1 unit 0 vlan-id 100 user@PE1# set ge-0/0/1 unit 0 family inet address 192.168.0.1/31 user@PE1# set ge-0/0/2 description PE1-to-CE1-Link2 user@PE1# set ge-0/0/2 vlan-tagging user@PE1# set ge-0/0/2 unit 0 vlan-id 100 user@PE1# set ge-0/0/2 unit 0 family inet address 192.168.0.3/31 user@PE1# set ge-0/0/3 description PE1-to-P1 user@PE1# set ge-0/0/3 vlan-tagging user@PE1# set ge-0/0/3 unit 0 vlan-id 100 user@PE1# set ge-0/0/3 unit 0 family inet address 192.168.0.4/31 user@PE1# set ge-0/0/3 unit 0 family iso user@PE1# set ge-0/0/3 unit 0 family mpls 配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。 [edit interfaces] user@PE1# set lo0 unit 1 family inet address 10.2.2.5/32 user@PE1# set lo0 unit 1 family iso address 49.0000.0000.aaaa.0005.00 配置多路径解析策略以将分层多路径安装到 PFE 中。 [edit policy-options] user@PE1# set policy-statement add-noexport term 1 then community add noexport user@PE1# set policy-statement allow-lo0 term 1 from interface lo0.1 user@PE1# set policy-statement allow-lo0 term 1 then accept user@PE1# set policy-statement allow-lo0 term 2 then reject user@PE1# set policy-statement export-inet3 term 1 from rib inet.3 user@PE1# set policy-statement export-inet3 term 1 then accept user@PE1# set policy-statement export-inet3 term 2 then reject user@PE1# set policy-statement mp-resolv term 1 from route-filter 10.1.1.0/24 orlonger user@PE1# set policy-statement mp-resolv term 1 then accept user@PE1# set policy-statement mp-resolv term 1 then multipath-resolve user@PE1# set policy-statement mp-resolv term 2 from route-filter 10.2.2.0/24 orlonger user@PE1# set policy-statement mp-resolv term 2 then accept user@PE1# set policy-statement mp-resolv term 2 then multipath-resolve user@PE1# set policy-statement mp-resolv term def then reject user@PE1# set policy-statement nhs term 1 from protocol bgp user@PE1# set policy-statement nhs term 1 then local-preference 200 user@PE1# set policy-statement nhs term 1 then next-hop self user@PE1# set policy-statement nhs term 1 then accept user@PE1# set policy-statement pplb then load-balance per-packet user@PE1# set policy-statement vrf-export-red term 1 then community add leak2red user@PE1# set policy-statement vrf-export-red term 1 then accept user@PE1# set policy-statement vrf-import-red term 1 from community leak2red user@PE1# set policy-statement vrf-import-red term 1 then accept user@PE1# set community leak2red members target:100:100 user@PE1# set community noexport members no-export user@PE1# set community noexport members no-advertise 配置第 3 层 VPN 路由实例以提供客户服务。 [edit routing-instances] user@PE1# set red routing-options multipath preserve-nexthop-hierarchy user@PE1# set red routing-options protect core user@PE1# set red protocols bgp group toCE1 peer-as 65004 user@PE1# set red protocols bgp group toCE1 neighbor 192.168.0.2 user@PE1# set red instance-type vrf user@PE1# set red interface ge-0/0/2.0 user@PE1# set red vrf-import vrf-import-red user@PE1# set red vrf-export vrf-export-red 配置解析器 RIB 导入策略和解析 RIB，以便为策略中指定的选定第 3 层 VPN 前缀启用扩展的分层下一跃点结构。 [edit routing-options] user@PE1# set rib inet.3 protect core user@PE1# set route-distinguisher-id 10.2.2.5 user@PE1# set forwarding-table export pplb user@PE1# set resolution preserve-nexthop-hierarchy user@PE1# set resolution rib inet.0 import mp-resolv user@PE1# set interface-routes rib-group inet inet0to3 user@PE1# set router-id 10.2.2.5 user@PE1# set autonomous-system 65002 user@PE1# set protect core user@PE1# set rib-groups inet0to3 import-rib inet.0 user@PE1# set rib-groups inet0to3 import-rib inet.3 user@PE1# set rib-groups inet0to3 import-policy allow-lo0 user@PE1# set rib-groups inet3to0 import-rib inet.3 user@PE1# set rib-groups inet3to0 import-rib inet.0 user@PE1# set rib-groups inet3to0 import-policy add-noexport 配置 OSPF 协议。 [edit protocols ospf] user@PE1# set protocols ospf area 0.0.0.0 interface all link-protection; user@PE1# set protocols ospf area 0.0.0.0 interface fxp0.0 disable; user@PE1# set protocols ospf area 0.0.0.0 interface lo0.0 passive; 配置路由协议以在整个域中建立 IP 和 MPLS 连接。 [edit protocols] user@PE1# set isis level 1 disable user@PE1# set isis interface ge-0/0/3.0 user@PE1# set isis export allow-lo0 user@PE1# set isis topologies ipv6-unicast user@PE1# set rsvp interface ge-0/0/3.0 user@PE1# set ldp interface ge-0/0/3.0 user@PE1# set mpls label-switched-path toABR1-gold to 10.2.2.3 user@PE1# set mpls label-switched-path toABR1-bronze to 10.2.2.3 user@PE1# set mpls label-switched-path toABR2-gold to 10.2.2.4 将标记为单播的 BGP 配置为 ABR，以将环路 IP 地址交换为 BGP 标记的单播前缀。 [edit protocols bgp] user@PE1# set path-selection external-router-id user@PE1# set group toAs2RR type internal user@PE1# set group toAs2RR local-address 10.2.2.5 user@PE1# set group toAs2RR family inet labeled-unicast rib-group inet3to0 user@PE1# set group toAs2RR family inet labeled-unicast add-path receive user@PE1# set group toAs2RR family inet labeled-unicast add-path send path-count 4 user@PE1# set group toAs2RR family inet labeled-unicast nexthop-resolution preserve-nexthop-hierarchy user@PE1# set group toAs2RR family inet labeled-unicast rib inet.3 user@PE1# set group toAs2RR export nhs user@PE1# set group toAs2RR export export-inet3 user@PE1# set group toAs2RR neighbor 10.2.2.6 user@PE1# set group toAs4 peer-as 65004 user@PE1# set group toAs4 neighbor 192.168.0.0 user@PE1# set group toAs1PEs multihop no-nexthop-change user@PE1# set group toAs1PEs local-address 10.2.2.5 user@PE1# set group toAs1PEs family inet unicast user@PE1# set group toAs1PEs family inet-vpn unicast user@PE1# set group toAs1PEs family inet6 unicast user@PE1# set group toAs1PEs family inet6-vpn unicast user@PE1# set group toAs1PEs export nhs user@PE1# set group toAs1PEs peer-as 65001 user@PE1# set group toAs1PEs neighbor 10.1.1.1 user@PE1# set group toAs1PEs neighbor 10 .1.1.2 user@PE1# set traceoptions file bgp.log user@PE1# set traceoptions file size 100m user@PE1# set traceoptions flag state detail user@PE1# set traceoptions flag policy user@PE1# set multipath 在配置模式下，输入 show chassis 、 show interfaces 、 show policy-options 、 show routing-instances 和 show routing-options show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/1 { description PE1-to-CE1-Link1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.1/31; } } } ge-0/0/2 { description PE1-to-CE1-Link2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.3/31; } } } ge-0/0/3 { description PE1-to-P1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.4/31; } family iso; family mpls; } } lo0 { unit 1 { family inet { address 10.2.2.5/32; } family iso { address 49.0000.0000.aaaa.0005.00; } } } } policy-options { policy-statement add-noexport { term 1 { then { community add noexport; } } } policy-statement allow-lo0 { term 1 { from interface lo0.1; then accept; } term 2 { then reject; } } policy-statement export-inet3 { term 1 { from rib inet.3; then accept; } term 2 { then reject; } } policy-statement mp-resolv { term 1 { from { route-filter 10.1.1.0/24 orlonger; } then { accept; multipath-resolve; } } term 2 { from { route-filter 10.2.2.0/24 orlonger; } then { accept; multipath-resolve; } } term def { then reject; } } policy-statement nhs { term 1 { from protocol bgp; then { local-preference 200; next-hop self; accept; } } } policy-statement pplb { then { load-balance per-packet; } } policy-statement vrf-export-red { term 1 { then { community add leak2red; accept; } } } policy-statement vrf-import-red { term 1 { from community leak2red; then accept; } } community leak2red members target:100:100; community noexport members [ no-export no-advertise ]; } routing-instances { red { routing-options { multipath preserve-nexthop-hierarchy; protect core; } protocols { bgp { group toCE1 { peer-as 65004; neighbor 192.168.0.2; } } } instance-type vrf; interface ge-0/0/2.0; vrf-import vrf-import-red; vrf-export vrf-export-red; } } routing-options { rib inet.3 { protect core; } route-distinguisher-id 10.2.2.5; forwarding-table { export pplb; } resolution { preserve-nexthop-hierarchy; rib inet.0 { import mp-resolv; } } interface-routes { rib-group inet inet0to3; } router-id 10.2.2.5; autonomous-system 65002; protect core; rib-groups { inet0to3 { import-rib [ inet.0 inet.3 ]; import-policy allow-lo0; } inet3to0 { import-rib [ inet.3 inet.0 ]; import-policy add-noexport; } } } protocols { isis { level 1 disable; interface ge-0/0/3.0; export allow-lo0; topologies ipv6-unicast; } rsvp { interface ge-0/0/3.0; } bgp { path-selection external-router-id; group toAs2RR { type internal; local-address 10.2.2.5; family inet { labeled-unicast { rib-group inet3to0; add-path { receive; send { path-count 4; } } nexthop-resolution { preserve-nexthop-hierarchy; } rib { inet.3; } } } export [ nhs export-inet3 ]; neighbor 10.2.2.6; } group toAs4 { peer-as 65004; neighbor 192.168.0.0; } group toAs1PEs { multihop { no-nexthop-change; } local-address 10.2.2.5; family inet { unicast; } family inet-vpn { unicast; } family inet6 { unicast; } family inet6-vpn { unicast; } export nhs; peer-as 65001; neighbor 10.1.1.1; neighbor 10.1.1.2; } traceoptions { file bgp.log size 100m; flag state detail; flag policy; } multipath; } ldp { interface ge-0/0/3.0; } mpls { label-switched-path toABR1-gold { to 10.2.2.3; } label-switched-path toABR1-bronze { to 10.2.2.3; } label-switched-path toABR2-gold { to 10.2.2.4; } } }",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口以启用 IP 和 MPLS 传输。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE1#set ge-0/0/1 description PE1-to-CE1-Link1",
                    "user@PE1#set ge-0/0/1 vlan-tagging",
                    "user@PE1#set ge-0/0/1 unit 0 vlan-id 100",
                    "user@PE1#set ge-0/0/1 unit 0 family inet address 192.168.0.1/31",
                    "user@PE1#set ge-0/0/2 description PE1-to-CE1-Link2",
                    "user@PE1#set ge-0/0/2 vlan-tagging",
                    "user@PE1#set ge-0/0/2 unit 0 vlan-id 100",
                    "user@PE1#set ge-0/0/2 unit 0 family inet address 192.168.0.3/31",
                    "user@PE1#set ge-0/0/3 description PE1-to-P1",
                    "user@PE1#set ge-0/0/3 vlan-tagging",
                    "user@PE1#set ge-0/0/3 unit 0 vlan-id 100",
                    "user@PE1#set ge-0/0/3 unit 0 family inet address 192.168.0.4/31",
                    "user@PE1#set ge-0/0/3 unit 0 family iso",
                    "user@PE1#set ge-0/0/3 unit 0 family mpls"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE1#set lo0 unit 1 family inet address 10.2.2.5/32",
                    "user@PE1#set lo0 unit 1 family iso address 49.0000.0000.aaaa.0005.00"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置多路径解析策略以将分层多路径安装到 PFE 中。",
                  "code": [
                    "[edit policy-options]",
                    "user@PE1#set policy-statement add-noexport term 1 then community add noexport",
                    "user@PE1#set policy-statement allow-lo0 term 1 from interface lo0.1",
                    "user@PE1#set policy-statement allow-lo0 term 1 then accept",
                    "user@PE1#set policy-statement allow-lo0 term 2 then reject",
                    "user@PE1#set policy-statement export-inet3 term 1 from rib inet.3",
                    "user@PE1#set policy-statement export-inet3 term 1 then accept",
                    "user@PE1#set policy-statement export-inet3 term 2 then reject",
                    "user@PE1#set policy-statement mp-resolv term 1 from route-filter 10.1.1.0/24 orlonger",
                    "user@PE1#set policy-statement mp-resolv term 1 then accept",
                    "user@PE1#set policy-statement mp-resolv term 1 then multipath-resolve",
                    "user@PE1#set policy-statement mp-resolv term 2 from route-filter 10.2.2.0/24 orlonger",
                    "user@PE1#set policy-statement mp-resolv term 2 then accept",
                    "user@PE1#set policy-statement mp-resolv term 2 then multipath-resolve",
                    "user@PE1#set policy-statement mp-resolv term def then reject",
                    "user@PE1#set policy-statement nhs term 1 from protocol bgp",
                    "user@PE1#set policy-statement nhs term 1 then local-preference 200",
                    "user@PE1#set policy-statement nhs term 1 then next-hop self",
                    "user@PE1#set policy-statement nhs term 1 then accept",
                    "user@PE1#set policy-statement pplb then load-balance per-packet",
                    "user@PE1#set policy-statement vrf-export-red term 1 then community add leak2red",
                    "user@PE1#set policy-statement vrf-export-red term 1 then accept",
                    "user@PE1#set policy-statement vrf-import-red term 1 from community leak2red",
                    "user@PE1#set policy-statement vrf-import-red term 1 then accept",
                    "user@PE1#set community leak2red members target:100:100",
                    "user@PE1#set community noexport members no-export",
                    "user@PE1#set community noexport members no-advertise"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置第 3 层 VPN 路由实例以提供客户服务。",
                  "code": [
                    "[edit routing-instances]",
                    "user@PE1#set red routing-options multipath preserve-nexthop-hierarchy",
                    "user@PE1#set red routing-options protect core",
                    "user@PE1#set red protocols bgp group toCE1 peer-as 65004",
                    "user@PE1#set red protocols bgp group toCE1 neighbor 192.168.0.2",
                    "user@PE1#set red instance-type vrf",
                    "user@PE1#set red interface ge-0/0/2.0",
                    "user@PE1#set red vrf-import vrf-import-red",
                    "user@PE1#set red vrf-export vrf-export-red"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置解析器 RIB 导入策略和解析 RIB，以便为策略中指定的选定第 3 层 VPN 前缀启用扩展的分层下一跃点结构。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE1#set rib inet.3 protect core",
                    "user@PE1#set route-distinguisher-id 10.2.2.5",
                    "user@PE1#set forwarding-table export pplb",
                    "user@PE1#set resolution preserve-nexthop-hierarchy",
                    "user@PE1#set resolution rib inet.0 import mp-resolv",
                    "user@PE1#set interface-routes rib-group inet inet0to3",
                    "user@PE1#set router-id 10.2.2.5",
                    "user@PE1#set autonomous-system 65002",
                    "user@PE1#set protect core",
                    "user@PE1#set rib-groups inet0to3 import-rib inet.0",
                    "user@PE1#set rib-groups inet0to3 import-rib inet.3",
                    "user@PE1#set rib-groups inet0to3 import-policy allow-lo0",
                    "user@PE1#set rib-groups inet3to0 import-rib inet.3",
                    "user@PE1#set rib-groups inet3to0 import-rib inet.0",
                    "user@PE1#set rib-groups inet3to0 import-policy add-noexport"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置 OSPF 协议。",
                  "code": [
                    "[edit protocols ospf]",
                    "user@PE1#set protocols ospf area 0.0.0.0 interface all link-protection;",
                    "user@PE1#set protocols ospf area 0.0.0.0 interface fxp0.0 disable;",
                    "user@PE1#set protocols ospf area 0.0.0.0 interface lo0.0 passive;"
                  ]
                },
                {
                  "step": 7,
                  "description": "配置路由协议以在整个域中建立 IP 和 MPLS 连接。",
                  "code": [
                    "[edit protocols]",
                    "user@PE1#set isis level 1 disable",
                    "user@PE1#set isis interface ge-0/0/3.0",
                    "user@PE1#set isis export allow-lo0",
                    "user@PE1#set isis topologies ipv6-unicast",
                    "user@PE1#set rsvp interface ge-0/0/3.0",
                    "user@PE1#set ldp interface ge-0/0/3.0",
                    "user@PE1#set mpls label-switched-path toABR1-gold to 10.2.2.3",
                    "user@PE1#set mpls label-switched-path toABR1-bronze to 10.2.2.3",
                    "user@PE1#set mpls label-switched-path toABR2-gold to 10.2.2.4"
                  ]
                },
                {
                  "step": 8,
                  "description": "将标记为单播的 BGP 配置为 ABR，以将环路 IP 地址交换为 BGP 标记的单播前缀。",
                  "code": [
                    "[edit protocols bgp]",
                    "user@PE1#set path-selection external-router-id",
                    "user@PE1#set group toAs2RR type internal",
                    "user@PE1#set group toAs2RR local-address 10.2.2.5",
                    "user@PE1#set group toAs2RR family inet labeled-unicast rib-group inet3to0",
                    "user@PE1#set group toAs2RR family inet labeled-unicast add-path receive",
                    "user@PE1#set group toAs2RR family inet labeled-unicast add-path send path-count 4",
                    "user@PE1#set group toAs2RR family inet labeled-unicast nexthop-resolution preserve-nexthop-hierarchy",
                    "user@PE1#set group toAs2RR family inet labeled-unicast rib inet.3",
                    "user@PE1#set group toAs2RR export nhs",
                    "user@PE1#set group toAs2RR export export-inet3",
                    "user@PE1#set group toAs2RR neighbor 10.2.2.6",
                    "user@PE1#set group toAs4 peer-as 65004",
                    "user@PE1#set group toAs4 neighbor 192.168.0.0",
                    "user@PE1#set group toAs1PEs multihop no-nexthop-change",
                    "user@PE1#set group toAs1PEs local-address 10.2.2.5",
                    "user@PE1#set group toAs1PEs family inet unicast",
                    "user@PE1#set group toAs1PEs family inet-vpn unicast",
                    "user@PE1#set group toAs1PEs family inet6 unicast",
                    "user@PE1#set group toAs1PEs family inet6-vpn unicast",
                    "user@PE1#set group toAs1PEs export nhs",
                    "user@PE1#set group toAs1PEs peer-as 65001",
                    "user@PE1#set group toAs1PEs neighbor 10.1.1.1",
                    "user@PE1#set group toAs1PEs neighbor 10 .1.1.2",
                    "user@PE1#set traceoptions file bgp.log",
                    "user@PE1#set traceoptions file size 100m",
                    "user@PE1#set traceoptions flag state detail",
                    "user@PE1#set traceoptions flag policy",
                    "user@PE1#set multipath"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show chassis 、 show interfaces 、 show policy-options 、 show routing-instances 和 show routing-options show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "interfaces {\n    ge-0/0/1 {\n        description PE1-to-CE1-Link1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.1/31;\n            }\n        }\n    }\n    ge-0/0/2 {\n        description PE1-to-CE1-Link2;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.3/31;\n            }\n        }\n    }\n    ge-0/0/3 {\n        description PE1-to-P1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.4/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    lo0 {\n        unit 1 {\n            family inet {\n                address 10.2.2.5/32;\n            }\n            family iso {\n                address 49.0000.0000.aaaa.0005.00;\n            }\n        }\n    }\n}\npolicy-options {\n    policy-statement add-noexport {\n        term 1 {\n            then {\n                community add noexport;\n            }\n        }\n    }\n    policy-statement allow-lo0 {\n        term 1 {\n            from interface lo0.1;\n            then accept;\n        }\n        term 2 {\n            then reject;\n        }\n    }\n    policy-statement export-inet3 {\n        term 1 {\n            from rib inet.3;\n            then accept;\n        }\n        term 2 {\n            then reject;\n        }\n    }\n    policy-statement mp-resolv {\n        term 1 {\n            from {\n                route-filter 10.1.1.0/24 orlonger;\n            }\n            then {\n                accept;\n                multipath-resolve;\n            }\n        }\n        term 2 {\n            from {\n                route-filter 10.2.2.0/24 orlonger;\n            }\n            then {\n                accept;\n                multipath-resolve;\n            }\n        }\n        term def {\n            then reject;\n        }\n    }\n    policy-statement nhs {\n        term 1 {\n            from protocol bgp;\n            then {\n                local-preference 200;\n                next-hop self;\n                accept;\n            }\n        }\n    }\n    policy-statement pplb {\n        then {\n            load-balance per-packet;\n        }\n    }\n    policy-statement vrf-export-red {\n        term 1 {\n            then {\n                community add leak2red;\n                accept;\n            }\n        }\n    }\n    policy-statement vrf-import-red {\n        term 1 {\n            from community leak2red;\n            then accept;\n        }\n    }\n    community leak2red members target:100:100;\n    community noexport members [ no-export no-advertise ];\n}\nrouting-instances {\n    red {\n        routing-options {\n            multipath preserve-nexthop-hierarchy;\n            protect core;\n        }\n        protocols {\n            bgp {\n                group toCE1 {\n                    peer-as 65004;\n                    neighbor 192.168.0.2;\n                }\n            }\n        }\n        instance-type vrf;\n        interface ge-0/0/2.0;\n        vrf-import vrf-import-red;\n        vrf-export vrf-export-red;\n    }\n}\nrouting-options {\n    rib inet.3 {\n        protect core;\n    }\n    route-distinguisher-id 10.2.2.5;\n    forwarding-table {\n        export pplb;\n    }\n    resolution {\n        preserve-nexthop-hierarchy;\n        rib inet.0 {\n            import mp-resolv;\n        }\n    }\n    interface-routes {\n        rib-group inet inet0to3;\n    }\n    router-id 10.2.2.5;\n    autonomous-system 65002;\n    protect core;\n    rib-groups {\n        inet0to3 {\n            import-rib [ inet.0 inet.3 ];\n            import-policy allow-lo0;\n        }\n        inet3to0 {\n            import-rib [ inet.3 inet.0 ];\n            import-policy add-noexport;\n        }\n    }\n}\nprotocols {\n    isis {\n        level 1 disable;\n        interface ge-0/0/3.0;\n        export allow-lo0;\n        topologies ipv6-unicast;\n    }\n    rsvp {\n        interface ge-0/0/3.0;\n    }\n    bgp {\n        path-selection external-router-id;\n        group toAs2RR {\n            type internal;\n            local-address 10.2.2.5;\n            family inet {\n                labeled-unicast {\n                    rib-group inet3to0;\n                    add-path {\n                        receive;\n                        send {\n                            path-count 4;\n                        }\n                    }\n                    nexthop-resolution {\n                        preserve-nexthop-hierarchy;\n                    }\n                    rib {\n                        inet.3;\n                    }\n                }\n            }\n            export [ nhs export-inet3 ];\n            neighbor 10.2.2.6;\n        }\n        group toAs4 {\n            peer-as 65004;\n            neighbor 192.168.0.0;\n        }\n        group toAs1PEs {\n            multihop {\n                no-nexthop-change;\n            }\n            local-address 10.2.2.5;\n            family inet {\n                unicast;\n            }\n            family inet-vpn {\n                unicast;\n            }\n            family inet6 {\n                unicast;\n            }\n            family inet6-vpn {\n                unicast;\n            }\n            export nhs;\n            peer-as 65001;\n            neighbor 10.1.1.1;\n            neighbor 10.1.1.2;\n        }\n        traceoptions {\n            file bgp.log size 100m;\n            flag state detail;\n            flag policy;\n        }\n        multipath;\n    }\n    ldp {\n        interface ge-0/0/3.0;\n    }\n    mpls {\n        label-switched-path toABR1-gold {\n            to 10.2.2.3;\n        }\n        label-switched-path toABR1-bronze {\n            to 10.2.2.3;\n        }\n        label-switched-path toABR2-gold {\n            to 10.2.2.4;\n        }\n    }\n}"
              ]
            }
          ]
        },
        {
          "title": "配置 P1 设备",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南 中的在 配置模式下使用 CLI 编辑器 。 要配置设备 P1： 配置接口。 [edit interfaces] user@P1# set ge-0/0/1 description P1-to-RR1 user@P1# set ge-0/0/1 vlan-tagging user@P1# set ge-0/0/1 unit 0 vlan-id 100 user@P1# set ge-0/0/1 unit 0 family inet address 192.168.0.6/31 user@P1# set ge-0/0/1 unit 0 family iso user@P1# set ge-0/0/1 unit 0 family mpls user@P1# set ge-0/0/2 description P1-to-ABR1 user@P1# set ge-0/0/2 vlan-tagging user@P1# set ge-0/0/2 unit 0 vlan-id 100 user@P1# set ge-0/0/2 unit 0 family inet address 192.168.0.8/31 user@P1# set ge-0/0/2 unit 0 family iso user@P1# set ge-0/0/2 unit 0 family mpls user@P1# set ge-0/0/3 description P1-to-PE1 user@P1# set ge-0/0/3 vlan-tagging user@P1# set ge-0/0/3 unit 0 vlan-id 100 user@P1# set ge-0/0/3 unit 0 family inet address 192.168.0.5/31 user@P1# set ge-0/0/3 unit 0 family iso user@P1# set ge-0/0/3 unit 0 family mpls user@P1# set ge-0/0/4 description P1-to-ABR2 user@P1# set ge-0/0/4 vlan-tagging user@P1# set ge-0/0/4 unit 0 vlan-id 100 user@P1# set ge-0/0/4 unit 0 family inet address 192.168.0.10/31 user@P1# set ge-0/0/4 unit 0 family iso user@P1# set ge-0/0/4 unit 0 family mpls 配置环路接口。 [edit interfaces] user@P1# set lo0 unit 0 family inet address 10.2.2.8/32 user@P1# set lo0 unit 0 family iso address 49.0000.0000.aaaa.0008.00 配置多路径解析策略以将分层多路径安装到 PFE 中。 [edit policy-options] user@P1# set policy-statement allow-lo0 term 1 from interface lo0.0 user@P1# set policy-statement allow-lo0 term 1 then accept user@P1# set policy-statement allow-lo0 term 2 then reject 配置路由选项。 [edit routing-options] user@P1# set router-id 10.2.2.8 在接口上配置 ISIS、RSVP、LDP 和 MPLS 协议。 [edit protocols] user@P1# set isis level 1 disable user@P1# set isis interface all user@P1# set isis export allow-lo0 user@P1# set isis topologies ipv6-unicast user@P1# set rsvp interface all user@P1# set ldp interface all user@P1# set mpls interface all 在配置模式下，输入 show interfaces 、 show policy-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/1 { description P1-to-RR1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.6/31; } family iso; family mpls; } } ge-0/0/2 { description P1-to-ABR1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.8/31; } family iso; family mpls; } } ge-0/0/3 { description P1-to-PE1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.5/31; } family iso; family mpls; } } ge-0/0/4 { description P1-to-ABR2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.10/31; } family iso; family mpls; } } lo0 { unit 0 { family inet { address 10.2.2.8/32; } family iso { address 49.0000.0000.aaaa.0008.00; } } } } policy-options { policy-statement allow-lo0 { term 1 { from interface lo0.0; then accept; } term 2 { then reject; } } } routing-options { router-id 10.2.2.8; } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } ldp { interface all; } mpls { interface all; } }",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@P1#set ge-0/0/1 description P1-to-RR1",
                    "user@P1#set ge-0/0/1 vlan-tagging",
                    "user@P1#set ge-0/0/1 unit 0 vlan-id 100",
                    "user@P1#set ge-0/0/1 unit 0 family inet address 192.168.0.6/31",
                    "user@P1#set ge-0/0/1 unit 0 family iso",
                    "user@P1#set ge-0/0/1 unit 0 family mpls",
                    "user@P1#set ge-0/0/2 description P1-to-ABR1",
                    "user@P1#set ge-0/0/2 vlan-tagging",
                    "user@P1#set ge-0/0/2 unit 0 vlan-id 100",
                    "user@P1#set ge-0/0/2 unit 0 family inet address 192.168.0.8/31",
                    "user@P1#set ge-0/0/2 unit 0 family iso",
                    "user@P1#set ge-0/0/2 unit 0 family mpls",
                    "user@P1#set ge-0/0/3 description P1-to-PE1",
                    "user@P1#set ge-0/0/3 vlan-tagging",
                    "user@P1#set ge-0/0/3 unit 0 vlan-id 100",
                    "user@P1#set ge-0/0/3 unit 0 family inet address 192.168.0.5/31",
                    "user@P1#set ge-0/0/3 unit 0 family iso",
                    "user@P1#set ge-0/0/3 unit 0 family mpls",
                    "user@P1#set ge-0/0/4 description P1-to-ABR2",
                    "user@P1#set ge-0/0/4 vlan-tagging",
                    "user@P1#set ge-0/0/4 unit 0 vlan-id 100",
                    "user@P1#set ge-0/0/4 unit 0 family inet address 192.168.0.10/31",
                    "user@P1#set ge-0/0/4 unit 0 family iso",
                    "user@P1#set ge-0/0/4 unit 0 family mpls"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置环路接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@P1#set lo0 unit 0 family inet address 10.2.2.8/32",
                    "user@P1#set lo0 unit 0 family iso address 49.0000.0000.aaaa.0008.00"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置多路径解析策略以将分层多路径安装到 PFE 中。",
                  "code": [
                    "[edit policy-options]",
                    "user@P1#set policy-statement allow-lo0 term 1 from interface lo0.0",
                    "user@P1#set policy-statement allow-lo0 term 1 then accept",
                    "user@P1#set policy-statement allow-lo0 term 2 then reject"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置路由选项。",
                  "code": [
                    "[edit routing-options]",
                    "user@P1#set router-id 10.2.2.8"
                  ]
                },
                {
                  "step": 5,
                  "description": "在接口上配置 ISIS、RSVP、LDP 和 MPLS 协议。",
                  "code": [
                    "[edit protocols]",
                    "user@P1#set isis level 1 disable",
                    "user@P1#set isis interface all",
                    "user@P1#set isis export allow-lo0",
                    "user@P1#set isis topologies ipv6-unicast",
                    "user@P1#set rsvp interface all",
                    "user@P1#set ldp interface all",
                    "user@P1#set mpls interface all"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "interfaces {\n    ge-0/0/1 {\n        description P1-to-RR1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.6/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    ge-0/0/2 {\n        description P1-to-ABR1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.8/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    ge-0/0/3 {\n        description P1-to-PE1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.5/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    ge-0/0/4 {\n        description P1-to-ABR2;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.10/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    lo0 {\n        unit 0 {\n            family inet {\n                address 10.2.2.8/32;\n            }\n            family iso {\n                address 49.0000.0000.aaaa.0008.00;\n            }\n        }\n    }\n}\npolicy-options {\n    policy-statement allow-lo0 {\n        term 1 {\n            from interface lo0.0;\n            then accept;\n        }\n        term 2 {\n            then reject;\n        }\n    }\n}\nrouting-options {\n    router-id 10.2.2.8;\n}\nprotocols {\n    isis {\n        level 1 disable;\n        interface all;\n        export allow-lo0;\n        topologies ipv6-unicast;\n    }\n    rsvp {\n        interface all;\n    }\n    ldp {\n        interface all;\n    }\n    mpls {\n        interface all;\n    }\n}"
              ]
            }
          ]
        },
        {
          "title": "配置 RR1 设备",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南 中的在 配置模式下使用 CLI 编辑器 。 要配置设备 RR1： 配置接口。 [edit interfaces] user@RR1# set ge-0/0/1 description RR1-to-P1 user@RR1# set ge-0/0/1 vlan-tagging user@RR1# set ge-0/0/1 unit 0 vlan-id 100 user@RR1# set ge-0/0/1 unit 0 family inet address 192.168.0.7/31 user@RR1# set ge-0/0/1 unit 0 family iso user@RR1# set ge-0/0/1 unit 0 family mpls 配置环路接口。 [edit interfaces] user@RR1# set lo0 unit 1 family inet address 10.2.2.6/32 user@RR1# set lo0 unit 1 family iso address 49.0000.0000.aaaa.0006.00 配置多路径解析策略以将分层多路径安装到 PFE 中。 [edit policy-options] user@RR1# set policy-statement add-noexport term 1 then community add noexport user@RR1# set policy-statement allow-lo0 term 1 from interface lo0.1 user@RR1# set policy-statement allow-lo0 term 1 then accept user@RR1# set policy-statement allow-lo0 term 2 then reject user@RR1# set policy-statement export-inet3 term 1 from rib inet.3 user@RR1# set policy-statement export-inet3 term 1 then accept user@RR1# set policy-statement export-inet3 term 2 then reject user@RR1# set policy-statement pplb then load-balance per-packet user@RR1# set community noexport members no-export user@RR1# set community noexport members no-advertise 配置路由选项。 [edit routing-options] user@RR1# set forwarding-table export pplb user@RR1# set interface-routes rib-group inet inet0to3 user@RR1# set router-id 10.2.2.6 user@RR1# set autonomous-system 2 user@RR1# set rib-groups inet0to3 import-rib inet.0 user@RR1# set rib-groups inet0to3 import-rib inet.3 user@RR1# set rib-groups inet0to3 import-policy allow-lo0 user@RR1# set rib-groups inet3to0 import-rib inet.3 user@RR1# set rib-groups inet3to0 import-rib inet.0 user@RR1# set rib-groups inet3to0 import-rib inet6.3 user@RR1# set rib-groups inet3to0 import-policy add-noexport 在接口上配置 ISIS、RSVP、LDP 和 MPLS 协议。 [edit protocols] user@RR1# set isis level 1 disable user@RR1# set isis interface all user@RR1# set isis export allow-lo0 user@RR1# set isis topologies ipv6-unicast user@RR1# set rsvp interface all user@RR1# set ldp interface all user@RR1# set mpls interface all 配置 BGP 标记的单播，以将环路 IP 地址交换为 BGP 标记的单播前缀。 [edit protocols bgp] user@RR1# set path-selection external-router-id user@RR1# set group toAs2Reg2BNs type internal user@RR1# set group toAs2Reg2BNs family inet labeled-unicast rib-group inet3to0 user@RR1# set group toAs2Reg2BNs family inet labeled-unicast add-path receive user@RR1# set group toAs2Reg2BNs family inet labeled-unicast add-path send path-count 4 user@RR1# set group toAs2Reg2BNs family inet labeled-unicast rib inet.3 user@RR1# set group toAs2Reg2BNs export export-inet3 user@RR1# set group toAs2Reg2BNs neighbor 10.2.2.3 user@RR1# set group toAs2Reg2BNs neighbor 10.2.2.4 user@RR1# set group toAs2Reg2BNs neighbor 10.2.2.5 user@RR1# set traceoptions file bgp.log user@RR1# set traceoptions file size 100m user@RR1# set traceoptions flag state detail user@RR1# set traceoptions flag policy user@RR1# set local-address 10.2.2.6 user@RR1# set cluster 10.2.2.6 在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/1 { description RR1-to-P1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.7/31; } family iso; family mpls; } } lo0 { unit 1 { family inet { address 10.2.2.6/32; } family iso { address 49.0000.0000.aaaa.0006.00; } } } } policy-options { policy-statement add-noexport { term 1 { then { community add noexport; } } } policy-statement allow-lo0 { term 1 { from interface lo0.1; then accept; } term 2 { then reject; } } policy-statement export-inet3 { term 1 { from rib inet.3; then accept; } term 2 { then reject; } } policy-statement pplb { then { load-balance per-packet; } } community noexport members [ no-export no-advertise ]; } routing-options { forwarding-table { export pplb; } interface-routes { rib-group inet inet0to3; } router-id 10.2.2.6; autonomous-system 2; rib-groups { inet0to3 { import-rib [ inet.0 inet.3 ]; import-policy allow-lo0; } inet3to0 { import-rib [ inet.3 inet.0 inet6.3 ]; import-policy add-noexport; } } } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } bgp { path-selection external-router-id; group toAs2Reg2BNs { type internal; family inet { labeled-unicast { rib-group inet3to0; add-path { receive; send { path-count 4; } } rib { inet.3; } } } export export-inet3; neighbor 10.2.2.3; neighbor 10.2.2.4; neighbor 10.2.2.5; } traceoptions { file bgp.log size 100m; flag state detail; flag policy; } local-address 10.2.2.6; cluster 10.2.2.6; } ldp { interface all; } mpls { interface all; } }",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@RR1#set ge-0/0/1 description RR1-to-P1",
                    "user@RR1#set ge-0/0/1 vlan-tagging",
                    "user@RR1#set ge-0/0/1 unit 0 vlan-id 100",
                    "user@RR1#set ge-0/0/1 unit 0 family inet address 192.168.0.7/31",
                    "user@RR1#set ge-0/0/1 unit 0 family iso",
                    "user@RR1#set ge-0/0/1 unit 0 family mpls"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置环路接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@RR1#set lo0 unit 1 family inet address 10.2.2.6/32",
                    "user@RR1#set lo0 unit 1 family iso address 49.0000.0000.aaaa.0006.00"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置多路径解析策略以将分层多路径安装到 PFE 中。",
                  "code": [
                    "[edit policy-options]",
                    "user@RR1#set policy-statement add-noexport term 1 then community add noexport",
                    "user@RR1#set policy-statement allow-lo0 term 1 from interface lo0.1",
                    "user@RR1#set policy-statement allow-lo0 term 1 then accept",
                    "user@RR1#set policy-statement allow-lo0 term 2 then reject",
                    "user@RR1#set policy-statement export-inet3 term 1 from rib inet.3",
                    "user@RR1#set policy-statement export-inet3 term 1 then accept",
                    "user@RR1#set policy-statement export-inet3 term 2 then reject",
                    "user@RR1#set policy-statement pplb then load-balance per-packet",
                    "user@RR1#set community noexport members no-export",
                    "user@RR1#set community noexport members no-advertise"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置路由选项。",
                  "code": [
                    "[edit routing-options]",
                    "user@RR1#set forwarding-table export pplb",
                    "user@RR1#set interface-routes rib-group inet inet0to3",
                    "user@RR1#set router-id 10.2.2.6",
                    "user@RR1#set autonomous-system 2",
                    "user@RR1#set rib-groups inet0to3 import-rib inet.0",
                    "user@RR1#set rib-groups inet0to3 import-rib inet.3",
                    "user@RR1#set rib-groups inet0to3 import-policy allow-lo0",
                    "user@RR1#set rib-groups inet3to0 import-rib inet.3",
                    "user@RR1#set rib-groups inet3to0 import-rib inet.0",
                    "user@RR1#set rib-groups inet3to0 import-rib inet6.3",
                    "user@RR1#set rib-groups inet3to0 import-policy add-noexport"
                  ]
                },
                {
                  "step": 5,
                  "description": "在接口上配置 ISIS、RSVP、LDP 和 MPLS 协议。",
                  "code": [
                    "[edit protocols]",
                    "user@RR1#set isis level 1 disable",
                    "user@RR1#set isis interface all",
                    "user@RR1#set isis export allow-lo0",
                    "user@RR1#set isis topologies ipv6-unicast",
                    "user@RR1#set rsvp interface all",
                    "user@RR1#set ldp interface all",
                    "user@RR1#set mpls interface all"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置 BGP 标记的单播，以将环路 IP 地址交换为 BGP 标记的单播前缀。",
                  "code": [
                    "[edit protocols bgp]",
                    "user@RR1#set path-selection external-router-id",
                    "user@RR1#set group toAs2Reg2BNs type internal",
                    "user@RR1#set group toAs2Reg2BNs family inet labeled-unicast rib-group inet3to0",
                    "user@RR1#set group toAs2Reg2BNs family inet labeled-unicast add-path receive",
                    "user@RR1#set group toAs2Reg2BNs family inet labeled-unicast add-path send path-count 4",
                    "user@RR1#set group toAs2Reg2BNs family inet labeled-unicast rib inet.3",
                    "user@RR1#set group toAs2Reg2BNs export export-inet3",
                    "user@RR1#set group toAs2Reg2BNs neighbor 10.2.2.3",
                    "user@RR1#set group toAs2Reg2BNs neighbor 10.2.2.4",
                    "user@RR1#set group toAs2Reg2BNs neighbor 10.2.2.5",
                    "user@RR1#set traceoptions file bgp.log",
                    "user@RR1#set traceoptions file size 100m",
                    "user@RR1#set traceoptions flag state detail",
                    "user@RR1#set traceoptions flag policy",
                    "user@RR1#set local-address 10.2.2.6",
                    "user@RR1#set cluster 10.2.2.6"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "interfaces {\n    ge-0/0/1 {\n        description RR1-to-P1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.7/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    lo0 {\n        unit 1 {\n            family inet {\n                address 10.2.2.6/32;\n            }\n            family iso {\n                address 49.0000.0000.aaaa.0006.00;\n            }\n        }\n    }\n}\npolicy-options {\n    policy-statement add-noexport {\n        term 1 {\n            then {\n                community add noexport;\n            }\n        }\n    }\n    policy-statement allow-lo0 {\n        term 1 {\n            from interface lo0.1;\n            then accept;\n        }\n        term 2 {\n            then reject;\n        }\n    }\n    policy-statement export-inet3 {\n        term 1 {\n            from rib inet.3;\n            then accept;\n        }\n        term 2 {\n            then reject;\n        }\n    }\n    policy-statement pplb {\n        then {\n            load-balance per-packet;\n        }\n    }\n    community noexport members [ no-export no-advertise ];\n}\nrouting-options {\n    forwarding-table {\n        export pplb;\n    }\n    interface-routes {\n        rib-group inet inet0to3;\n    }\n    router-id 10.2.2.6;\n    autonomous-system 2;\n    rib-groups {\n        inet0to3 {\n            import-rib [ inet.0 inet.3 ];\n            import-policy allow-lo0;\n        }\n        inet3to0 {\n            import-rib [ inet.3 inet.0 inet6.3 ];\n            import-policy add-noexport;\n        }\n    }\n}\nprotocols {\n    isis {\n        level 1 disable;\n        interface all;\n        export allow-lo0;\n        topologies ipv6-unicast;\n    }\n    rsvp {\n        interface all;\n    }\n    bgp {\n        path-selection external-router-id;\n        group toAs2Reg2BNs {\n            type internal;\n            family inet {\n                labeled-unicast {\n                    rib-group inet3to0;\n                    add-path {\n                        receive;\n                        send {\n                            path-count 4;\n                        }\n                    }\n                    rib {\n                        inet.3;\n                    }\n                }\n            }\n            export export-inet3;\n            neighbor 10.2.2.3;\n            neighbor 10.2.2.4;\n            neighbor 10.2.2.5;\n        }\n        traceoptions {\n            file bgp.log size 100m;\n            flag state detail;\n            flag policy;\n        }\n        local-address 10.2.2.6;\n        cluster 10.2.2.6;\n    }\n    ldp {\n        interface all;\n    }\n    mpls {\n        interface all;\n    }\n}"
              ]
            }
          ]
        },
        {
          "title": "配置 ABR1 设备",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南 中的在 配置模式下使用 CLI 编辑器 。 要配置设备 ABR1： 配置接口以启用 IP 和 MPLS 传输。 [edit interfaces] user@ABR1# set ge-0/0/1 description ABR1-to-P2 user@ABR1# set ge-0/0/1 vlan-tagging user@ABR1# set ge-0/0/1 unit 0 vlan-id 100 user@ABR1# set ge-0/0/1 unit 0 family inet address 192.168.0.12/31 user@ABR1# set ge-0/0/1 unit 0 family iso user@ABR1# set ge-0/0/1 unit 0 family mpls user@ABR1# set ge-0/0/2 description ABR1-to-P1 user@ABR1# set ge-0/0/2 vlan-tagging user@ABR1# set ge-0/0/2 unit 0 vlan-id 100 user@ABR1# set ge-0/0/2 unit 0 family inet address 192.168.0.9/31 user@ABR1# set ge-0/0/2 unit 0 family iso user@ABR1# set ge-0/0/2 unit 0 family mpls 配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。 [edit interfaces] user@ABR1# set lo0 unit 0 family inet address 10.2.2.3/32 user@ABR1# set lo0 unit 0 family iso address 49.0000.0000.aaaa.0003.00 配置多路径解析策略以将分层多路径安装到 PFE 中。 [edit policy-options] user@ABR1# set policy-statement allow-lo0 term 1 from interface lo0.0 user@ABR1# set policy-statement allow-lo0 term 1 then accept user@ABR1# set policy-statement allow-lo0 term 2 then reject user@ABR1# set policy-statement nhs term 1 from protocol bgp user@ABR1# set policy-statement nhs term 1 then next-hop self user@ABR1# set policy-statement nhs term 1 then accept user@ABR1# set policy-statement pplb then load-balance per-packet 应用按流负载均衡策略以启用流量保护。 [edit routing-options] user@ABR1# set forwarding-table export pplb user@ABR1# set router-id 10.2.2.3 user@ABR1# set autonomous-system 65002 在接口上配置 ISIS、RSVP、MPLS 和 LDP 协议。 [edit protocols] user@ABR1# set isis level 1 disable user@ABR1# set isis interface all user@ABR1# set isis export allow-lo0 user@ABR1# set isis topologies ipv6-unicast user@ABR1# set rsvp interface all user@ABR1# set ldp interface all user@ABR1# set mpls label-switched-path toASBR2-gold to 10.2.2.2 user@ABR1# set mpls label-switched-path toASBR1-bronze to 10.2.2.1 user@ABR1# set mpls label-switched-path toASBR2-bronze to 10.2.2.2 user@ABR1# set mpls interface all 配置 BGP 标记的单播，以将环路 IP 地址交换为 BGP 标记的单播前缀。 [edit protocols] user@ABR1# set bgp group toAs2RR type internal user@ABR1# set bgp group toAs2RR local-address 10.2.2.3 user@ABR1# set bgp group toAs2RR advertise-inactive user@ABR1# set bgp group toAs2RR family inet labeled-unicast add-path receive user@ABR1# set bgp group toAs2RR family inet labeled-unicast add-path send path-count 4 user@ABR1# set bgp group toAs2RR family inet labeled-unicast rib inet.3 user@ABR1# set bgp group toAs2RR export nhs user@ABR1# set bgp group toAs2RR cluster 10.2.2.3 user@ABR1# set bgp group toAs2RR neighbor 10.2.2.6 user@ABR1# set bgp group toAs2RR neighbor 10.2.2.7 user@ABR1# set bgp traceoptions file bgp.log user@ABR1# set bgp traceoptions file size 100m user@ABR1# set bgp traceoptions flag state detail user@ABR1# set bgp traceoptions flag policy 在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/1 { description ABR1-to-P2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.12/31; } family iso; family mpls; } } ge-0/0/2 { description ABR1-to-P1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.9/31; } family iso; family mpls; } } lo0 { unit 0 { family inet { address 10.2.2.3/32; } family iso { address 49.0000.0000.aaaa.0003.00; } } } } policy-options { policy-statement allow-lo0 { term 1 { from interface lo0.0; then accept; } term 2 { then reject; } } policy-statement nhs { term 1 { from protocol bgp; then { next-hop self; accept; } } } policy-statement pplb { then { load-balance per-packet; } } } routing-options { forwarding-table { export pplb; } router-id 10.2.2.3; autonomous-system 65002; } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } bgp { group toAs2RR { type internal; local-address 10.2.2.3; advertise-inactive; family inet { labeled-unicast { add-path { receive; send { path-count 4; } } rib { inet.3; } } } export nhs; cluster 10.2.2.3; neighbor 10.2.2.6; neighbor 10.2.2.7; } traceoptions { file bgp.log size 100m; flag state detail; flag policy; } } ldp { interface all; } mpls { label-switched-path toASBR2-gold { to 10.2.2.2; } label-switched-path toASBR1-bronze { to 10.2.2.1; } label-switched-path toASBR2-bronze { to 10.2.2.2; } interface all; } }",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口以启用 IP 和 MPLS 传输。",
                  "code": [
                    "[edit interfaces]",
                    "user@ABR1#set ge-0/0/1 description ABR1-to-P2",
                    "user@ABR1#set ge-0/0/1 vlan-tagging",
                    "user@ABR1#set ge-0/0/1 unit 0 vlan-id 100",
                    "user@ABR1#set ge-0/0/1 unit 0 family inet address 192.168.0.12/31",
                    "user@ABR1#set ge-0/0/1 unit 0 family iso",
                    "user@ABR1#set ge-0/0/1 unit 0 family mpls",
                    "user@ABR1#set ge-0/0/2 description ABR1-to-P1",
                    "user@ABR1#set ge-0/0/2 vlan-tagging",
                    "user@ABR1#set ge-0/0/2 unit 0 vlan-id 100",
                    "user@ABR1#set ge-0/0/2 unit 0 family inet address 192.168.0.9/31",
                    "user@ABR1#set ge-0/0/2 unit 0 family iso",
                    "user@ABR1#set ge-0/0/2 unit 0 family mpls"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@ABR1#set lo0 unit 0 family inet address 10.2.2.3/32",
                    "user@ABR1#set lo0 unit 0 family iso address 49.0000.0000.aaaa.0003.00"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置多路径解析策略以将分层多路径安装到 PFE 中。",
                  "code": [
                    "[edit policy-options]",
                    "user@ABR1#set policy-statement allow-lo0 term 1 from interface lo0.0",
                    "user@ABR1#set policy-statement allow-lo0 term 1 then accept",
                    "user@ABR1#set policy-statement allow-lo0 term 2 then reject",
                    "user@ABR1#set policy-statement nhs term 1 from protocol bgp",
                    "user@ABR1#set policy-statement nhs term 1 then next-hop self",
                    "user@ABR1#set policy-statement nhs term 1 then accept",
                    "user@ABR1#set policy-statement pplb then load-balance per-packet"
                  ]
                },
                {
                  "step": 4,
                  "description": "应用按流负载均衡策略以启用流量保护。",
                  "code": [
                    "[edit routing-options]",
                    "user@ABR1#set forwarding-table export pplb",
                    "user@ABR1#set router-id 10.2.2.3",
                    "user@ABR1#set autonomous-system 65002"
                  ]
                },
                {
                  "step": 5,
                  "description": "在接口上配置 ISIS、RSVP、MPLS 和 LDP 协议。",
                  "code": [
                    "[edit protocols]",
                    "user@ABR1#set isis level 1 disable",
                    "user@ABR1#set isis interface all",
                    "user@ABR1#set isis export allow-lo0",
                    "user@ABR1#set isis topologies ipv6-unicast",
                    "user@ABR1#set rsvp interface all",
                    "user@ABR1#set ldp interface all",
                    "user@ABR1#set mpls label-switched-path toASBR2-gold to 10.2.2.2",
                    "user@ABR1#set mpls label-switched-path toASBR1-bronze to 10.2.2.1",
                    "user@ABR1#set mpls label-switched-path toASBR2-bronze to 10.2.2.2",
                    "user@ABR1#set mpls interface all"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置 BGP 标记的单播，以将环路 IP 地址交换为 BGP 标记的单播前缀。",
                  "code": [
                    "[edit protocols]",
                    "user@ABR1#set bgp group toAs2RR type internal",
                    "user@ABR1#set bgp group toAs2RR local-address 10.2.2.3",
                    "user@ABR1#set bgp group toAs2RR advertise-inactive",
                    "user@ABR1#set bgp group toAs2RR family inet labeled-unicast add-path receive",
                    "user@ABR1#set bgp group toAs2RR family inet labeled-unicast add-path send path-count 4",
                    "user@ABR1#set bgp group toAs2RR family inet labeled-unicast rib inet.3",
                    "user@ABR1#set bgp group toAs2RR export nhs",
                    "user@ABR1#set bgp group toAs2RR cluster 10.2.2.3",
                    "user@ABR1#set bgp group toAs2RR neighbor 10.2.2.6",
                    "user@ABR1#set bgp group toAs2RR neighbor 10.2.2.7",
                    "user@ABR1#set bgp traceoptions file bgp.log",
                    "user@ABR1#set bgp traceoptions file size 100m",
                    "user@ABR1#set bgp traceoptions flag state detail",
                    "user@ABR1#set bgp traceoptions flag policy"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "interfaces {\n    ge-0/0/1 {\n        description ABR1-to-P2;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.12/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    ge-0/0/2 {\n        description ABR1-to-P1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.9/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    lo0 {\n        unit 0 {\n            family inet {\n                address 10.2.2.3/32;\n            }\n            family iso {\n                address 49.0000.0000.aaaa.0003.00;\n            }\n        }\n    }\n}\npolicy-options {\n    policy-statement allow-lo0 {\n        term 1 {\n            from interface lo0.0;\n            then accept;\n        }\n        term 2 {\n            then reject;\n        }\n    }\n    policy-statement nhs {\n        term 1 {\n            from protocol bgp;\n            then {\n                next-hop self;\n                accept;\n            }\n        }\n    }\n    policy-statement pplb {\n        then {\n            load-balance per-packet;\n        }\n    }\n}\nrouting-options {\n    forwarding-table {\n        export pplb;\n    }\n    router-id 10.2.2.3;\n    autonomous-system 65002;\n}\nprotocols {\n    isis {\n        level 1 disable;\n        interface all;\n        export allow-lo0;\n        topologies ipv6-unicast;\n    }\n    rsvp {\n        interface all;\n    }\n    bgp {\n        group toAs2RR {\n            type internal;\n            local-address 10.2.2.3;\n            advertise-inactive;\n            family inet {\n                labeled-unicast {\n                    add-path {\n                        receive;\n                        send {\n                            path-count 4;\n                        }\n                    }\n                    rib {\n                        inet.3;\n                    }\n                }\n            }\n            export nhs;\n            cluster 10.2.2.3;\n            neighbor 10.2.2.6;\n            neighbor 10.2.2.7;\n        }\n        traceoptions {\n            file bgp.log size 100m;\n            flag state detail;\n            flag policy;\n        }\n    }\n    ldp {\n        interface all;\n    }\n    mpls {\n        label-switched-path toASBR2-gold {\n            to 10.2.2.2;\n        }\n        label-switched-path toASBR1-bronze {\n            to 10.2.2.1;\n        }\n        label-switched-path toASBR2-bronze {\n            to 10.2.2.2;\n        }\n        interface all;\n    }\n}"
              ]
            }
          ]
        },
        {
          "title": "配置 ABR2 设备",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南 中的在 配置模式下使用 CLI 编辑器 。 要配置设备 ABR2： 配置接口以启用 IP 和 MPLS 传输。 [edit interfaces] user@ABR2# set ge-0/0/2 description ABR2-to-P2 user@ABR2# set ge-0/0/2 vlan-tagging user@ABR2# set ge-0/0/2 unit 0 vlan-id 100 user@ABR2# set ge-0/0/2 unit 0 family inet address 192.168.0.14/31 user@ABR2# set ge-0/0/2 unit 0 family iso user@ABR2# set ge-0/0/2 unit 0 family mpls user@ABR2# set ge-0/0/4 description ABR2-to-P1 user@ABR2# set ge-0/0/4 vlan-tagging user@ABR2# set ge-0/0/4 unit 0 vlan-id 100 user@ABR2# set ge-0/0/4 unit 0 family inet address 192.168.0.11/31 user@ABR2# set ge-0/0/4 unit 0 family iso user@ABR2# set ge-0/0/4 unit 0 family mpls 配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。 [edit interfaces] user@ABR2# set lo0 unit 0 family inet address 2.2.2.4/32 user@ABR2# set lo0 unit 0 family iso address 49.0000.0000.aaaa.0004.00 配置多路径解析策略以将分层多路径安装到 PFE 中。 [edit policy-options] user@ABR2# set policy-statement allow-lo0 term 1 from interface lo0.0 user@ABR2# set policy-statement allow-lo0 term 1 then accept user@ABR2# set policy-statement allow-lo0 term 2 then reject user@ABR2# set policy-statement nhs term 1 from protocol bgp user@ABR2# set policy-statement nhs term 1 then next-hop self user@ABR2# set policy-statement nhs term 1 then accept user@ABR2# set policy-statement pplb then load-balance per-packet 应用按流负载均衡策略以启用流量保护。 [edit routing-options] user@ABR2# set forwarding-table export pplb user@ABR2# set router-id 2.2.2.4 user@ABR2# set autonomous-system 2 在接口上配置 ISIS、RSVP、MPLS 和 LDP 协议。 [edit protocols] user@ABR2# set isis level 1 disable user@ABR2# set isis interface all user@ABR2# set isis export allow-lo0 user@ABR2# set isis topologies ipv6-unicast user@ABR2# set rsvp interface all user@ABR2# set ldp interface all user@ABR2# set mpls label-switched-path toASBR1-bronze to 2.2.2.1 user@ABR2# set mpls interface all 配置 BGP 标记的单播，以将环路 IP 地址交换为 BGP 标记的单播前缀。 [edit protocols] user@ABR2# set bgp group toAs2RR type internal user@ABR2# set bgp group toAs2RR local-address 2.2.2.4 user@ABR2# set bgp group toAs2RR advertise-inactive user@ABR2# set bgp group toAs2RR family inet labeled-unicast add-path receive user@ABR2# set bgp group toAs2RR family inet labeled-unicast add-path send path-count 4 user@ABR2# set bgp group toAs2RR family inet labeled-unicast rib inet.3 user@ABR2# set bgp group toAs2RR export nhs user@ABR2# set bgp group toAs2RR cluster 2.2.2.4 user@ABR2# set bgp group toAs2RR neighbor 2.2.2.6 user@ABR2# set bgp group toAs2RR neighbor 2.2.2.7 user@ABR2# set bgp traceoptions file bgp.log user@ABR2# set bgp traceoptions file size 100m user@ABR2# set bgp traceoptions flag state detail user@ABR2# set bgp traceoptions flag policy 在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/2 { description ABR2-to-P2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.14/31; } family iso; family mpls; } } ge-0/0/4 { description ABR2-to-P1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.11/31; } family iso; family mpls; } } lo0 { unit 0 { family inet { address 2.2.2.4/32; } family iso { address 49.0000.0000.aaaa.0004.00; } } } } policy-options { policy-statement allow-lo0 { term 1 { from interface lo0.0; then accept; } term 2 { then reject; } } policy-statement nhs { term 1 { from protocol bgp; then { next-hop self; accept; } } } policy-statement pplb { then { load-balance per-packet; } } } routing-options { forwarding-table { export pplb; } router-id 2.2.2.4; autonomous-system 2; } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } bgp { group toAs2RR { type internal; local-address 2.2.2.4; advertise-inactive; family inet { labeled-unicast { add-path { receive; send { path-count 4; } } rib { inet.3; } } } export nhs; cluster 2.2.2.4; neighbor 2.2.2.6; neighbor 2.2.2.7; } traceoptions { file bgp.log size 100m; flag state detail; flag policy; } } ldp { interface all; } mpls { label-switched-path toASBR1-bronze { to 2.2.2.1; } interface all; } }",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口以启用 IP 和 MPLS 传输。",
                  "code": [
                    "[edit interfaces]",
                    "user@ABR2#set ge-0/0/2 description ABR2-to-P2",
                    "user@ABR2#set ge-0/0/2 vlan-tagging",
                    "user@ABR2#set ge-0/0/2 unit 0 vlan-id 100",
                    "user@ABR2#set ge-0/0/2 unit 0 family inet address 192.168.0.14/31",
                    "user@ABR2#set ge-0/0/2 unit 0 family iso",
                    "user@ABR2#set ge-0/0/2 unit 0 family mpls",
                    "user@ABR2#set ge-0/0/4 description ABR2-to-P1",
                    "user@ABR2#set ge-0/0/4 vlan-tagging",
                    "user@ABR2#set ge-0/0/4 unit 0 vlan-id 100",
                    "user@ABR2#set ge-0/0/4 unit 0 family inet address 192.168.0.11/31",
                    "user@ABR2#set ge-0/0/4 unit 0 family iso",
                    "user@ABR2#set ge-0/0/4 unit 0 family mpls"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@ABR2#set lo0 unit 0 family inet address 2.2.2.4/32",
                    "user@ABR2#set lo0 unit 0 family iso address 49.0000.0000.aaaa.0004.00"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置多路径解析策略以将分层多路径安装到 PFE 中。",
                  "code": [
                    "[edit policy-options]",
                    "user@ABR2#set policy-statement allow-lo0 term 1 from interface lo0.0",
                    "user@ABR2#set policy-statement allow-lo0 term 1 then accept",
                    "user@ABR2#set policy-statement allow-lo0 term 2 then reject",
                    "user@ABR2#set policy-statement nhs term 1 from protocol bgp",
                    "user@ABR2#set policy-statement nhs term 1 then next-hop self",
                    "user@ABR2#set policy-statement nhs term 1 then accept",
                    "user@ABR2#set policy-statement pplb then load-balance per-packet"
                  ]
                },
                {
                  "step": 4,
                  "description": "应用按流负载均衡策略以启用流量保护。",
                  "code": [
                    "[edit routing-options]",
                    "user@ABR2#set forwarding-table export pplb",
                    "user@ABR2#set router-id 2.2.2.4",
                    "user@ABR2#set autonomous-system 2"
                  ]
                },
                {
                  "step": 5,
                  "description": "在接口上配置 ISIS、RSVP、MPLS 和 LDP 协议。",
                  "code": [
                    "[edit protocols]",
                    "user@ABR2#set isis level 1 disable",
                    "user@ABR2#set isis interface all",
                    "user@ABR2#set isis export allow-lo0",
                    "user@ABR2#set isis topologies ipv6-unicast",
                    "user@ABR2#set rsvp interface all",
                    "user@ABR2#set ldp interface all",
                    "user@ABR2#set mpls label-switched-path toASBR1-bronze to 2.2.2.1",
                    "user@ABR2#set mpls interface all"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置 BGP 标记的单播，以将环路 IP 地址交换为 BGP 标记的单播前缀。",
                  "code": [
                    "[edit protocols]",
                    "user@ABR2#set bgp group toAs2RR type internal",
                    "user@ABR2#set bgp group toAs2RR local-address 2.2.2.4",
                    "user@ABR2#set bgp group toAs2RR advertise-inactive",
                    "user@ABR2#set bgp group toAs2RR family inet labeled-unicast add-path receive",
                    "user@ABR2#set bgp group toAs2RR family inet labeled-unicast add-path send path-count 4",
                    "user@ABR2#set bgp group toAs2RR family inet labeled-unicast rib inet.3",
                    "user@ABR2#set bgp group toAs2RR export nhs",
                    "user@ABR2#set bgp group toAs2RR cluster 2.2.2.4",
                    "user@ABR2#set bgp group toAs2RR neighbor 2.2.2.6",
                    "user@ABR2#set bgp group toAs2RR neighbor 2.2.2.7",
                    "user@ABR2#set bgp traceoptions file bgp.log",
                    "user@ABR2#set bgp traceoptions file size 100m",
                    "user@ABR2#set bgp traceoptions flag state detail",
                    "user@ABR2#set bgp traceoptions flag policy"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "interfaces {\n    ge-0/0/2 {\n        description ABR2-to-P2;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.14/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    ge-0/0/4 {\n        description ABR2-to-P1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.11/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    lo0 {\n        unit 0 {\n            family inet {\n                address 2.2.2.4/32;\n            }\n            family iso {\n                address 49.0000.0000.aaaa.0004.00;\n            }\n        }\n    }\n}\npolicy-options {\n    policy-statement allow-lo0 {\n        term 1 {\n            from interface lo0.0;\n            then accept;\n        }\n        term 2 {\n            then reject;\n        }\n    }\n    policy-statement nhs {\n        term 1 {\n            from protocol bgp;\n            then {\n                next-hop self;\n                accept;\n            }\n        }\n    }\n    policy-statement pplb {\n        then {\n            load-balance per-packet;\n        }\n    }\n}\nrouting-options {\n    forwarding-table {\n        export pplb;\n    }\n    router-id 2.2.2.4;\n    autonomous-system 2;\n}\nprotocols {\n    isis {\n        level 1 disable;\n        interface all;\n        export allow-lo0;\n        topologies ipv6-unicast;\n    }\n    rsvp {\n        interface all;\n    }\n    bgp {\n        group toAs2RR {\n            type internal;\n            local-address 2.2.2.4;\n            advertise-inactive;\n            family inet {\n                labeled-unicast {\n                    add-path {\n                        receive;\n                        send {\n                            path-count 4;\n                        }\n                    }\n                    rib {\n                        inet.3;\n                    }\n                }\n            }\n            export nhs;\n            cluster 2.2.2.4;\n            neighbor 2.2.2.6;\n            neighbor 2.2.2.7;\n        }\n        traceoptions {\n            file bgp.log size 100m;\n            flag state detail;\n            flag policy;\n        }\n    }\n    ldp {\n        interface all;\n    }\n    mpls {\n        label-switched-path toASBR1-bronze {\n            to 2.2.2.1;\n        }\n        interface all;\n    }\n}"
              ]
            }
          ]
        },
        {
          "title": "配置 P2 设备",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南 中的在 配置模式下使用 CLI 编辑器 。 要配置设备 P2： 配置接口以启用 IP 和 MPLS 传输。 [edit interfaces] user@P2# set ge-0/0/1 description P2-to-ABR1 user@P2# set ge-0/0/1 vlan-tagging user@P2# set ge-0/0/1 unit 0 vlan-id 100 user@P2# set ge-0/0/1 unit 0 family inet address 192.168.0.13/31 user@P2# set ge-0/0/1 unit 0 family iso user@P2# set ge-0/0/1 unit 0 family mpls user@P2# set ge-0/0/2 description P2-to-ABR2 user@P2# set ge-0/0/2 vlan-tagging user@P2# set ge-0/0/2 unit 0 vlan-id 100 user@P2# set ge-0/0/2 unit 0 family inet address 192.168.0.15/31 user@P2# set ge-0/0/2 unit 0 family iso user@P2# set ge-0/0/2 unit 0 family mpls user@P2# set ge-0/0/3 description P2-to-RR2 user@P2# set ge-0/0/3 vlan-tagging user@P2# set ge-0/0/3 unit 0 vlan-id 100 user@P2# set ge-0/0/3 unit 0 family inet address 192.168.0.16/31 user@P2# set ge-0/0/3 unit 0 family iso user@P2# set ge-0/0/3 unit 0 family mpls user@P2# set ge-0/0/4 description P2-to-ASBR1 user@P2# set ge-0/0/4 vlan-tagging user@P2# set ge-0/0/4 unit 0 vlan-id 100 user@P2# set ge-0/0/4 unit 0 family inet address 192.168.0.18/31 user@P2# set ge-0/0/4 unit 0 family iso user@P2# set ge-0/0/4 unit 0 family mpls user@P2# set ge-0/0/5 description P2-to-ASBR2 user@P2# set ge-0/0/5 vlan-tagging user@P2# set ge-0/0/5 unit 0 vlan-id 100 user@P2# set ge-0/0/5 unit 0 family inet address 192.168.0.20/31 user@P2# set ge-0/0/5 unit 0 family iso user@P2# set ge-0/0/5 unit 0 family mpls 配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。 [edit interfaces] user@P2# set lo0 unit 0 family inet address 2.2.2.9/32 user@P2# set lo0 unit 0 family iso address 49.0000.0000.aaaa.0009.00 配置多路径解析策略以将分层多路径安装到 PFE 中。 [edit policy-options] user@P2# set policy-statement allow-lo0 term 1 from interface lo0.0 user@P2# set policy-statement allow-lo0 term 1 then accept user@P2# set policy-statement allow-lo0 term 2 then reject 配置路由选项。 [edit routing-options] user@P2# set router-id 2.2.2.9 在接口上配置 ISIS、RSVP、MPLS 和 LDP 协议。 [edit protocols] user@P2# set isis level 1 disable user@P2# set isis interface all user@P2# set isis export allow-lo0 user@P2# set isis topologies ipv6-unicast user@P2# set rsvp interface all user@P2# set ldp interface all user@P2# set mpls interface all 在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/1 { description P2-to-ABR1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.13/31; } family iso; family mpls; } } ge-0/0/2 { description P2-to-ABR2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.15/31; } family iso; family mpls; } } ge-0/0/3 { description P2-to-RR2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.16/31; } family iso; family mpls; } } ge-0/0/4 { description P2-to-ASBR1; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.18/31; } family iso; family mpls; } } ge-0/0/5 { description P2-to-ASBR2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.20/31; } family iso; family mpls; } } lo0 { unit 0 { family inet { address 2.2.2.9/32; } family iso { address 49.0000.0000.aaaa.0009.00; } } } } policy-options { policy-statement allow-lo0 { term 1 { from interface lo0.0; then accept; } term 2 { then reject; } } } routing-options { router-id 2.2.2.9; } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } ldp { interface all; } mpls { interface all; } }",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口以启用 IP 和 MPLS 传输。",
                  "code": [
                    "[edit interfaces]",
                    "user@P2#set ge-0/0/1 description P2-to-ABR1",
                    "user@P2#set ge-0/0/1 vlan-tagging",
                    "user@P2#set ge-0/0/1 unit 0 vlan-id 100",
                    "user@P2#set ge-0/0/1 unit 0 family inet address 192.168.0.13/31",
                    "user@P2#set ge-0/0/1 unit 0 family iso",
                    "user@P2#set ge-0/0/1 unit 0 family mpls",
                    "user@P2#set ge-0/0/2 description P2-to-ABR2",
                    "user@P2#set ge-0/0/2 vlan-tagging",
                    "user@P2#set ge-0/0/2 unit 0 vlan-id 100",
                    "user@P2#set ge-0/0/2 unit 0 family inet address 192.168.0.15/31",
                    "user@P2#set ge-0/0/2 unit 0 family iso",
                    "user@P2#set ge-0/0/2 unit 0 family mpls",
                    "user@P2#set ge-0/0/3 description P2-to-RR2",
                    "user@P2#set ge-0/0/3 vlan-tagging",
                    "user@P2#set ge-0/0/3 unit 0 vlan-id 100",
                    "user@P2#set ge-0/0/3 unit 0 family inet address 192.168.0.16/31",
                    "user@P2#set ge-0/0/3 unit 0 family iso",
                    "user@P2#set ge-0/0/3 unit 0 family mpls",
                    "user@P2#set ge-0/0/4 description P2-to-ASBR1",
                    "user@P2#set ge-0/0/4 vlan-tagging",
                    "user@P2#set ge-0/0/4 unit 0 vlan-id 100",
                    "user@P2#set ge-0/0/4 unit 0 family inet address 192.168.0.18/31",
                    "user@P2#set ge-0/0/4 unit 0 family iso",
                    "user@P2#set ge-0/0/4 unit 0 family mpls",
                    "user@P2#set ge-0/0/5 description P2-to-ASBR2",
                    "user@P2#set ge-0/0/5 vlan-tagging",
                    "user@P2#set ge-0/0/5 unit 0 vlan-id 100",
                    "user@P2#set ge-0/0/5 unit 0 family inet address 192.168.0.20/31",
                    "user@P2#set ge-0/0/5 unit 0 family iso",
                    "user@P2#set ge-0/0/5 unit 0 family mpls"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@P2#set lo0 unit 0 family inet address 2.2.2.9/32",
                    "user@P2#set lo0 unit 0 family iso address 49.0000.0000.aaaa.0009.00"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置多路径解析策略以将分层多路径安装到 PFE 中。",
                  "code": [
                    "[edit policy-options]",
                    "user@P2#set policy-statement allow-lo0 term 1 from interface lo0.0",
                    "user@P2#set policy-statement allow-lo0 term 1 then accept",
                    "user@P2#set policy-statement allow-lo0 term 2 then reject"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置路由选项。",
                  "code": [
                    "[edit routing-options]",
                    "user@P2#set router-id 2.2.2.9"
                  ]
                },
                {
                  "step": 5,
                  "description": "在接口上配置 ISIS、RSVP、MPLS 和 LDP 协议。",
                  "code": [
                    "[edit protocols]",
                    "user@P2#set isis level 1 disable",
                    "user@P2#set isis interface all",
                    "user@P2#set isis export allow-lo0",
                    "user@P2#set isis topologies ipv6-unicast",
                    "user@P2#set rsvp interface all",
                    "user@P2#set ldp interface all",
                    "user@P2#set mpls interface all"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "interfaces {\n    ge-0/0/1 {\n        description P2-to-ABR1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.13/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    ge-0/0/2 {\n        description P2-to-ABR2;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.15/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    ge-0/0/3 {\n        description P2-to-RR2;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.16/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    ge-0/0/4 {\n        description P2-to-ASBR1;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.18/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    ge-0/0/5 {\n        description P2-to-ASBR2;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.20/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    lo0 {\n        unit 0 {\n            family inet {\n                address 2.2.2.9/32;\n            }\n            family iso {\n                address 49.0000.0000.aaaa.0009.00;\n            }\n        }\n    }\n}\npolicy-options {\n    policy-statement allow-lo0 {\n        term 1 {\n            from interface lo0.0;\n            then accept;\n        }\n        term 2 {\n            then reject;\n        }\n    }\n}\nrouting-options {\n    router-id 2.2.2.9;\n}\nprotocols {\n    isis {\n        level 1 disable;\n        interface all;\n        export allow-lo0;\n        topologies ipv6-unicast;\n    }\n    rsvp {\n        interface all;\n    }\n    ldp {\n        interface all;\n    }\n    mpls {\n        interface all;\n    }\n}"
              ]
            }
          ]
        },
        {
          "title": "配置 RR2 设备",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南 中的在 配置模式下使用 CLI 编辑器 。 要配置设备 RR2： 配置接口以启用 IP 和 MPLS 传输。 [edit interfaces] user@RR2# set ge-0/0/3 description RR2-to-P2 user@RR2# set ge-0/0/3 vlan-tagging user@RR2# set ge-0/0/3 unit 0 vlan-id 100 user@RR2# set ge-0/0/3 unit 0 family inet address 192.168.0.17/31 user@RR2# set ge-0/0/3 unit 0 family iso user@RR2# set ge-0/0/3 unit 0 family mpls 配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。 [edit interfaces] user@RR2# set lo0 unit 1 family inet address 2.2.2.7/32 user@RR2# set lo0 unit 1 family iso address 49.0000.0000.aaaa.0007.00 配置多路径解析策略以将分层多路径安装到 PFE 中。 [edit policy-options] user@RR2# set policy-statement allow-lo0 term 1 from interface lo0.1 user@RR2# set policy-statement allow-lo0 term 1 then accept user@RR2# set policy-statement allow-lo0 term 2 then reject user@RR2# set policy-statement export-inet3 term 1 from rib inet.3 user@RR2# set policy-statement export-inet3 term 1 then accept user@RR2# set policy-statement export-inet3 term 2 then reject user@RR2# set policy-statement pplb then load-balance per-packet 应用按流负载均衡策略以启用流量保护。 [edit routing-options] user@RR2# set forwarding-table export pplb user@RR2# set interface-routes rib-group inet inet0to3 user@RR2# set router-id 2.2.2.7 user@RR2# set autonomous-system 2 user@RR2# set rib-groups inet0to3 import-rib inet.0 user@RR2# set rib-groups inet0to3 import-rib inet.3 user@RR2# set rib-groups inet0to3 import-policy allow-lo0 在接口上配置 ISIS、RSVP、MPLS 和 LDP 协议。 [edit protocols] user@RR2# set isis level 1 disable user@RR2# set isis interface all user@RR2# set isis export allow-lo0 user@RR2# set isis topologies ipv6-unicast user@RR2# set rsvp interface all user@RR2# set ldp interface all user@RR2# set mpls interface all 配置 BGP 标记的单播，以将环路 IP 地址交换为 BGP 标记的单播前缀。 [edit protocols] user@RR2# set bgp path-selection external-router-id user@RR2# set bgp group toAs2Reg1BNs type internal user@RR2# set bgp group toAs2Reg1BNs family inet labeled-unicast add-path receive user@RR2# set bgp group toAs2Reg1BNs family inet labeled-unicast add-path send path-count 4 user@RR2# set bgp group toAs2Reg1BNs family inet labeled-unicast rib inet.3 user@RR2# set bgp group toAs2Reg1BNs neighbor 2.2.2.1 user@RR2# set bgp group toAs2Reg1BNs neighbor 2.2.2.2 user@RR2# set bgp group toAs2Reg1BNs neighbor 2.2.2.3 user@RR2# set bgp group toAs2Reg1BNs neighbor 2.2.2.4 user@RR2# set bgp traceoptions file bgp.log user@RR2# set bgp traceoptions file size 100m user@RR2# set bgp traceoptions flag state detail user@RR2# set bgp traceoptions flag policy user@RR2# set bgp local-address 2.2.2.7 user@RR2# set bgp cluster 2.2.2.7 在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 interfaces { ge-0/0/3 { description RR2-to-P2; vlan-tagging; unit 0 { vlan-id 100; family inet { address 192.168.0.17/31; } family iso; family mpls; } } lo0 { unit 1 { family inet { address 2.2.2.7/32; } family iso { address 49.0000.0000.aaaa.0007.00; } } } } policy-options { policy-statement allow-lo0 { term 1 { from interface lo0.1; then accept; } term 2 { then reject; } } policy-statement export-inet3 { term 1 { from rib inet.3; then accept; } term 2 { then reject; } } policy-statement pplb { then { load-balance per-packet; } } } routing-options { forwarding-table { export pplb; } interface-routes { rib-group inet inet0to3; } router-id 2.2.2.7; autonomous-system 2; rib-groups { inet0to3 { import-rib [ inet.0 inet.3 ]; import-policy allow-lo0; } } } protocols { isis { level 1 disable; interface all; export allow-lo0; topologies ipv6-unicast; } rsvp { interface all; } bgp { path-selection external-router-id; group toAs2Reg1BNs { type internal; family inet { labeled-unicast { add-path { receive; send { path-count 4; } } rib { inet.3; } } } neighbor 2.2.2.1; neighbor 2.2.2.2; neighbor 2.2.2.3; neighbor 2.2.2.4; } traceoptions { file bgp.log size 100m; flag state detail; flag policy; } local-address 2.2.2.7; cluster 2.2.2.7; } ldp { interface all; } mpls { interface all; } }",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口以启用 IP 和 MPLS 传输。",
                  "code": [
                    "[edit interfaces]",
                    "user@RR2#set ge-0/0/3 description RR2-to-P2",
                    "user@RR2#set ge-0/0/3 vlan-tagging",
                    "user@RR2#set ge-0/0/3 unit 0 vlan-id 100",
                    "user@RR2#set ge-0/0/3 unit 0 family inet address 192.168.0.17/31",
                    "user@RR2#set ge-0/0/3 unit 0 family iso",
                    "user@RR2#set ge-0/0/3 unit 0 family mpls"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置要用作 LDP 和 BGP 会话的路由器 ID 和终止接口的环路接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@RR2#set lo0 unit 1 family inet address 2.2.2.7/32",
                    "user@RR2#set lo0 unit 1 family iso address 49.0000.0000.aaaa.0007.00"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置多路径解析策略以将分层多路径安装到 PFE 中。",
                  "code": [
                    "[edit policy-options]",
                    "user@RR2#set policy-statement allow-lo0 term 1 from interface lo0.1",
                    "user@RR2#set policy-statement allow-lo0 term 1 then accept",
                    "user@RR2#set policy-statement allow-lo0 term 2 then reject",
                    "user@RR2#set policy-statement export-inet3 term 1 from rib inet.3",
                    "user@RR2#set policy-statement export-inet3 term 1 then accept",
                    "user@RR2#set policy-statement export-inet3 term 2 then reject",
                    "user@RR2#set policy-statement pplb then load-balance per-packet"
                  ]
                },
                {
                  "step": 4,
                  "description": "应用按流负载均衡策略以启用流量保护。",
                  "code": [
                    "[edit routing-options]",
                    "user@RR2#set forwarding-table export pplb",
                    "user@RR2#set interface-routes rib-group inet inet0to3",
                    "user@RR2#set router-id 2.2.2.7",
                    "user@RR2#set autonomous-system 2",
                    "user@RR2#set rib-groups inet0to3 import-rib inet.0",
                    "user@RR2#set rib-groups inet0to3 import-rib inet.3",
                    "user@RR2#set rib-groups inet0to3 import-policy allow-lo0"
                  ]
                },
                {
                  "step": 5,
                  "description": "在接口上配置 ISIS、RSVP、MPLS 和 LDP 协议。",
                  "code": [
                    "[edit protocols]",
                    "user@RR2#set isis level 1 disable",
                    "user@RR2#set isis interface all",
                    "user@RR2#set isis export allow-lo0",
                    "user@RR2#set isis topologies ipv6-unicast",
                    "user@RR2#set rsvp interface all",
                    "user@RR2#set ldp interface all",
                    "user@RR2#set mpls interface all"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置 BGP 标记的单播，以将环路 IP 地址交换为 BGP 标记的单播前缀。",
                  "code": [
                    "[edit protocols]",
                    "user@RR2#set bgp path-selection external-router-id",
                    "user@RR2#set bgp group toAs2Reg1BNs type internal",
                    "user@RR2#set bgp group toAs2Reg1BNs family inet labeled-unicast add-path receive",
                    "user@RR2#set bgp group toAs2Reg1BNs family inet labeled-unicast add-path send path-count 4",
                    "user@RR2#set bgp group toAs2Reg1BNs family inet labeled-unicast rib inet.3",
                    "user@RR2#set bgp group toAs2Reg1BNs neighbor 2.2.2.1",
                    "user@RR2#set bgp group toAs2Reg1BNs neighbor 2.2.2.2",
                    "user@RR2#set bgp group toAs2Reg1BNs neighbor 2.2.2.3",
                    "user@RR2#set bgp group toAs2Reg1BNs neighbor 2.2.2.4",
                    "user@RR2#set bgp traceoptions file bgp.log",
                    "user@RR2#set bgp traceoptions file size 100m",
                    "user@RR2#set bgp traceoptions flag state detail",
                    "user@RR2#set bgp traceoptions flag policy",
                    "user@RR2#set bgp local-address 2.2.2.7",
                    "user@RR2#set bgp cluster 2.2.2.7"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options show routing-options 和 show protocols 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "interfaces {\n    ge-0/0/3 {\n        description RR2-to-P2;\n        vlan-tagging;\n        unit 0 {\n            vlan-id 100;\n            family inet {\n                address 192.168.0.17/31;\n            }\n            family iso;\n            family mpls;\n        }\n    }\n    lo0 {\n        unit 1 {\n            family inet {\n                address 2.2.2.7/32;\n            }\n            family iso {\n                address 49.0000.0000.aaaa.0007.00;\n            }\n        }\n    }\n}\npolicy-options {\n    policy-statement allow-lo0 {\n        term 1 {\n            from interface lo0.1;\n            then accept;\n        }\n        term 2 {\n            then reject;\n        }\n    }\n    policy-statement export-inet3 {\n        term 1 {\n            from rib inet.3;\n            then accept;\n        }\n        term 2 {\n            then reject;\n        }\n    }\n    policy-statement pplb {\n        then {\n            load-balance per-packet;\n        }\n    }\n}\nrouting-options {\n    forwarding-table {\n        export pplb;\n    }\n    interface-routes {\n        rib-group inet inet0to3;\n    }\n    router-id 2.2.2.7;\n    autonomous-system 2;\n    rib-groups {\n        inet0to3 {\n            import-rib [ inet.0 inet.3 ];\n            import-policy allow-lo0;\n        }\n    }\n}\nprotocols {\n    isis {\n        level 1 disable;\n        interface all;\n        export allow-lo0;\n        topologies ipv6-unicast;\n    }\n    rsvp {\n        interface all;\n    }\n    bgp {\n        path-selection external-router-id;\n        group toAs2Reg1BNs {\n            type internal;\n            family inet {\n                labeled-unicast {\n                    add-path {\n                        receive;\n                        send {\n                            path-count 4;\n                        }\n                    }\n                    rib {\n                        inet.3;\n                    }\n                }\n            }\n            neighbor 2.2.2.1;\n            neighbor 2.2.2.2;\n            neighbor 2.2.2.3;\n            neighbor 2.2.2.4;\n        }\n        traceoptions {\n            file bgp.log size 100m;\n            flag state detail;\n            flag policy;\n        }\n        local-address 2.2.2.7;\n        cluster 2.2.2.7;\n    }\n    ldp {\n        interface all;\n    }\n    mpls {\n        interface all;\n    }\n}"
              ]
            }
          ]
        }
      ]
    }
  ],
  "content": "此示例说明如何配置 BGP 前缀无关融合 （PIC） 边缘标记为单播，以及如何保护第 3 层 VPN 上的 IPv4 流量。当来自客户边缘路由器的 IPv4 流量发送到 PE 路由器时，IPv4 流量将通过第 3 层 VPN 进行路由，其中标记为单播的 BGP 配置为传输协议。 要求 此示例使用以下硬件和软件组件： MX 系列路由器。 在所有设备上运行的 Junos OS 19.4R1 或更高版本"
}