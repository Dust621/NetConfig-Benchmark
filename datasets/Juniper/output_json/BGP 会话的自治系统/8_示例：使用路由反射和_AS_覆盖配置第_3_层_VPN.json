{
  "title": "示例：使用路由反射和 AS 覆盖配置第 3 层 VPN",
  "sections": [
    {
      "title": "要求",
      "level": 3,
      "content": "配置此示例之前，不需要除设备初始化之外的特殊配置。"
    },
    {
      "title": "概述",
      "level": 3,
      "content": "此示例包含两个 CE 设备、两个提供商边缘 （PE） 设备和多个提供商核心设备。提供商网络还使用 IS-IS 来支持 LDP 和 BGP 环路可达性 设备 P2 充当路由反射器 （RR）。两台 CE 设备均位于自治系统 （AS） 64512 中。提供商网络位于 AS 65534 中。 该 as-override 语句将应用于 PE 设备，从而将 CE 设备的 AS 编号替换为 PE 设备的 AS 编号。这可以防止客户 AS 编号在 AS 路径属性中多次出现。 图 5 显示了此示例中使用的拓扑。 图 5： AS 覆盖拓扑 CLI 快速配置 显示了 中 图 5所有设备的配置。分步过程本节介绍设备 PE1 上的步骤。 拓扑学 此示例包含两个 CE 设备、两个提供商边缘 （PE） 设备和多个提供商核心设备。提供商网络还使用 IS-IS 来支持 LDP 和 BGP 环路可达性 设备 P2 充当路由反射器 （RR）。两台 CE 设备均位于自治系统 （AS） 64512 中。提供商网络位于 AS 65534 中。 该 as-override 语句将应用于 PE 设备，从而将 CE 设备的 AS 编号替换为 PE 设备的 AS 编号。这可以防止客户 AS 编号在 AS 路径属性中多次出现。 图 5 显示了此示例中使用的拓扑。 图 5： AS 覆盖拓扑 CLI 快速配置 显示了 中 图 5所有设备的配置。分步过程本节介绍设备 PE1 上的步骤。 拓扑学",
      "sections": [
        {
          "title": "拓扑学",
          "level": 4
        }
      ]
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 CE1 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.1/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 10.255.1.1/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0101.00 set protocols bgp group PE type external set protocols bgp group PE family inet unicast set protocols bgp group PE export ToBGP set protocols bgp group PE peer-as 65534 set protocols bgp group PE neighbor 10.0.0.2 set policy-options policy-statement ToBGP term Direct from protocol direct set policy-options policy-statement ToBGP term Direct then accept set routing-options router-id 10.255.1.1 set routing-options autonomous-system 64512 设备 P1 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.6/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.9/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.25/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.3.3/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0303.00 set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.3.3 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface all level 2 metric 10 set protocols isis interface all level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface all set protocols ldp interface fxp0.0 disable set routing-options router-id 10.255.3.3 设备 P2 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.10/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.13/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.4.4/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0404.00 set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols bgp group Core-RRClients type internal set protocols bgp group Core-RRClients local-address 10.255.4.4 set protocols bgp group Core-RRClients family inet-vpn unicast set protocols bgp group Core-RRClients cluster 10.255.4.4 set protocols bgp group Core-RRClients peer-as 65534 set protocols bgp group Core-RRClients neighbor 10.255.3.3 set protocols bgp group Core-RRClients neighbor 10.255.7.7 set protocols bgp group Core-RRClients neighbor 10.255.2.2 set protocols bgp group Core-RRClients neighbor 10.255.5.5 set protocols isis interface all level 2 metric 10 set protocols isis interface all level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface all set protocols ldp interface fxp0.0 disable set routing-options router-id 10.255.4.4 set routing-options autonomous-system 65534 设备 P3 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.22/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.26/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.30/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.7.7/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0707.00 set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.7.7 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface all level 2 metric 10 set protocols isis interface all level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface all set protocols ldp interface fxp0.0 disable set routing-options router-id 10.255.7.7 设备 PE1 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.2/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.5/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.21/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.2.2/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0202.00 set protocols mpls interface ge-1/2/2.0 set protocols mpls interface ge-1/2/1.0 set protocols mpls interface lo0.0 set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.2.2 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface ge-1/2/1.0 level 2 metric 10 set protocols isis interface ge-1/2/1.0 level 1 disable set protocols isis interface ge-1/2/2.0 level 2 metric 10 set protocols isis interface ge-1/2/2.0 level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface ge-1/2/1.0 set protocols ldp interface ge-1/2/2.0 set protocols ldp interface fxp0.0 disable set protocols ldp interface lo0.0 set routing-instances VPN-A instance-type vrf set routing-instances VPN-A interface ge-1/2/0.0 set routing-instances VPN-A route-distinguisher 65534:1234 set routing-instances VPN-A vrf-target target:65534:1234 set routing-instances VPN-A protocols bgp group CE type external set routing-instances VPN-A protocols bgp group CE family inet unicast set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.1 peer-as 64512 set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.1 as-override set routing-options router-id 10.255.2.2 set routing-options autonomous-system 65534 设备 PE2 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.14/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.17/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.29/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.5.5/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0505.00 set protocols mpls interface ge-1/2/0.0 set protocols mpls interface ge-1/2/2.0 set protocols mpls interface lo0.0 set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.5.5 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface ge-1/2/0.0 level 2 metric 10 set protocols isis interface ge-1/2/0.0 level 1 disable set protocols isis interface ge-1/2/2.0 level 2 metric 10 set protocols isis interface ge-1/2/2.0 level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface ge-1/2/0.0 set protocols ldp interface ge-1/2/2.0 set protocols ldp interface fxp0.0 disable set protocols ldp interface lo0.0 set routing-instances VPN-A instance-type vrf set routing-instances VPN-A interface ge-1/2/1.0 set routing-instances VPN-A route-distinguisher 65534:1234 set routing-instances VPN-A vrf-target target:65534:1234 set routing-instances VPN-A protocols bgp group CE type external set routing-instances VPN-A protocols bgp group CE family inet unicast set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.18 peer-as 64512 set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.18 as-override set routing-options router-id 10.255.5.5 set routing-options autonomous-system 65534 设备 CE2 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.18/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 10.255.6.6/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0606.00 set protocols bgp group PE type external set protocols bgp group PE family inet unicast set protocols bgp group PE export ToBGP set protocols bgp group PE peer-as 65534 set protocols bgp group PE neighbor 10.0.0.17 set policy-options policy-statement ToBGP term Direct from protocol direct set policy-options policy-statement ToBGP term Direct then accept set routing-options router-id 10.255.6.6 set routing-options autonomous-system 64512 下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南中的在配置模式下使用 CLI 编辑器。 要配置 AS 覆盖： 配置接口。 要启用 MPLS，请在接口上包含协议家族，以便接口不会丢弃传入的 MPLS 流量。 [edit interfaces] user@PE1# set ge-1/2/0 unit 0 family inet address 10.0.0.2/30 user@PE1# set ge-1/2/0 unit 0 family iso user@PE1# set ge-1/2/0 unit 0 family mpls user@PE1# set ge-1/2/1 unit 0 family inet address 10.0.0.5/30 user@PE1# set ge-1/2/1 unit 0 family iso user@PE1# set ge-1/2/1 unit 0 family mpls user@PE1# set ge-1/2/2 unit 0 family inet address 10.0.0.21/30 user@PE1# set ge-1/2/2 unit 0 family iso user@PE1# set ge-1/2/2 unit 0 family mpls user@PE1# set lo0 unit 0 family inet address 10.255.2.2/32 user@PE1# set lo0 unit 0 family iso address 49.0001.0010.0000.0202.00 将接口添加到 MPLS 协议以建立控制平面级别的连接。 设置 IGP，以便提供商设备可以相互通信。 要建立分发 MPLS 标签的机制，请启用 LDP。（可选）对于 LDP，启用转发等效类 （FEC） 分解，这样可以加快全局收敛速度。 [edit protocols] user@PE1# set mpls interface ge-1/2/2.0 user@PE1# set mpls interface ge-1/2/1.0 user@PE1# set mpls interface lo0.0 user@PE1# set mpls interface fxp0.0 disable user@PE1# set isis interface ge-1/2/1.0 level 2 metric 10 user@PE1# set isis interface ge-1/2/1.0 level 1 disable user@PE1# set isis interface ge-1/2/2.0 level 2 metric 10 user@PE1# set isis interface ge-1/2/2.0 level 1 disable user@PE1# set isis interface fxp0.0 disable user@PE1# set isis interface lo0.0 level 2 metric 0 user@PE1# set ldp deaggregate user@PE1# set ldp interface ge-1/2/1.0 user@PE1# set ldp interface ge-1/2/2.0 user@PE1# set ldp interface fxp0.0 disable user@PE1# set ldp interface lo0.0 使用 IPv4 VPN 单播地址族，启用内部 BGP （IBGP） 连接，以便仅与 RR 对等。 [edit protocols bgp group l3vpn] user@PE1# set type internal user@PE1# set local-address 10.255.2.2 user@PE1# set family inet-vpn unicast user@PE1# set peer-as 65534 user@PE1# set local-as 65534 user@PE1# set neighbor 10.255.4.4 配置路由实例，包括 as-override 语句。 在 PE 设备上创建路由实例 （VRF），并将 BGP 配置设置为与设备 CE1 对等。 [edit routing-instances VPN-A] user@PE1# set instance-type vrf user@PE1# set interface ge-1/2/0.0 user@PE1# set route-distinguisher 65534:1234 user@PE1# set vrf-target target:65534:1234 user@PE1# set protocols bgp group CE type external user@PE1# set protocols bgp group CE family inet unicast user@PE1# set protocols bgp group CE neighbor 10.0.0.1 peer-as 64512 user@PE1# set protocols bgp group CE neighbor 10.0.0.1 as-override 配置路由器 ID 和 AS 编号。 [edit routing-options] user@PE1# set router-id 10.255.2.2 user@PE1# set autonomous-system 65534 在配置模式下，输入 show interfaces 、 show protocols 、 show routing-instances 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的配置说明，以便进行更正。 user@PE1# show interfaces ge-1/2/0 { unit 2 { family inet { address 10.0.0.2/30; } family iso; family mpls; } } ge-1/2/1 { unit 5 { family inet { address 10.0.0.5/30; } family iso; family mpls; } } ge-1/2/2 { unit 21 { family inet { address 10.0.0.21/30; } family iso; family mpls; } } lo0 { unit 0 { family inet { address 10.255.2.2/32; } family iso { address 49.0001.0010.0000.0202.00; } } } user@PE1# show protocols mpls { interface ge-1/2/2.0; interface ge-1/2/1.0; interface lo0.0; interface fxp0.0 { disable; } } bgp { group l3vpn { type internal; local-address 10.255.2.2; family inet-vpn { unicast; } peer-as 65534; local-as 65534; neighbor 10.255.4.4; } } isis { interface ge-1/2/1.0 { level 2 metric 10; level 1 disable; } interface ge-1/2/2.0 { level 2 metric 10; level 1 disable; } interface fxp0.0 { disable; } interface lo0.0 { level 2 metric 0; } } ldp { deaggregate; interface ge-1/2/1.0; interface ge-1/2/2.0; interface fxp0.0 { disable; } interface lo0.0; } user@PE1# show routing-instances VPN-A { instance-type vrf; interface ge-1/2/0.0; route-distinguisher 65534:1234; vrf-target target:65534:1234; protocols { bgp { group CE { type external; family inet { unicast; } neighbor 10.0.0.1 { peer-as 64512; as-override; } } } } } user@PE1# show routing-options router-id 10.255.2.2; autonomous-system 65534; 如果完成设备配置，请从配置模式输入 commit 。",
      "sections": [
        {
          "title": "程序",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 CE1 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.1/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 10.255.1.1/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0101.00 set protocols bgp group PE type external set protocols bgp group PE family inet unicast set protocols bgp group PE export ToBGP set protocols bgp group PE peer-as 65534 set protocols bgp group PE neighbor 10.0.0.2 set policy-options policy-statement ToBGP term Direct from protocol direct set policy-options policy-statement ToBGP term Direct then accept set routing-options router-id 10.255.1.1 set routing-options autonomous-system 64512 设备 P1 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.6/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.9/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.25/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.3.3/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0303.00 set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.3.3 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface all level 2 metric 10 set protocols isis interface all level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface all set protocols ldp interface fxp0.0 disable set routing-options router-id 10.255.3.3 设备 P2 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.10/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.13/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.4.4/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0404.00 set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols bgp group Core-RRClients type internal set protocols bgp group Core-RRClients local-address 10.255.4.4 set protocols bgp group Core-RRClients family inet-vpn unicast set protocols bgp group Core-RRClients cluster 10.255.4.4 set protocols bgp group Core-RRClients peer-as 65534 set protocols bgp group Core-RRClients neighbor 10.255.3.3 set protocols bgp group Core-RRClients neighbor 10.255.7.7 set protocols bgp group Core-RRClients neighbor 10.255.2.2 set protocols bgp group Core-RRClients neighbor 10.255.5.5 set protocols isis interface all level 2 metric 10 set protocols isis interface all level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface all set protocols ldp interface fxp0.0 disable set routing-options router-id 10.255.4.4 set routing-options autonomous-system 65534 设备 P3 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.22/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.26/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.30/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.7.7/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0707.00 set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.7.7 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface all level 2 metric 10 set protocols isis interface all level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface all set protocols ldp interface fxp0.0 disable set routing-options router-id 10.255.7.7 设备 PE1 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.2/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.5/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.21/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.2.2/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0202.00 set protocols mpls interface ge-1/2/2.0 set protocols mpls interface ge-1/2/1.0 set protocols mpls interface lo0.0 set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.2.2 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface ge-1/2/1.0 level 2 metric 10 set protocols isis interface ge-1/2/1.0 level 1 disable set protocols isis interface ge-1/2/2.0 level 2 metric 10 set protocols isis interface ge-1/2/2.0 level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface ge-1/2/1.0 set protocols ldp interface ge-1/2/2.0 set protocols ldp interface fxp0.0 disable set protocols ldp interface lo0.0 set routing-instances VPN-A instance-type vrf set routing-instances VPN-A interface ge-1/2/0.0 set routing-instances VPN-A route-distinguisher 65534:1234 set routing-instances VPN-A vrf-target target:65534:1234 set routing-instances VPN-A protocols bgp group CE type external set routing-instances VPN-A protocols bgp group CE family inet unicast set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.1 peer-as 64512 set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.1 as-override set routing-options router-id 10.255.2.2 set routing-options autonomous-system 65534 设备 PE2 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.14/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.17/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.29/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.5.5/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0505.00 set protocols mpls interface ge-1/2/0.0 set protocols mpls interface ge-1/2/2.0 set protocols mpls interface lo0.0 set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.5.5 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface ge-1/2/0.0 level 2 metric 10 set protocols isis interface ge-1/2/0.0 level 1 disable set protocols isis interface ge-1/2/2.0 level 2 metric 10 set protocols isis interface ge-1/2/2.0 level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface ge-1/2/0.0 set protocols ldp interface ge-1/2/2.0 set protocols ldp interface fxp0.0 disable set protocols ldp interface lo0.0 set routing-instances VPN-A instance-type vrf set routing-instances VPN-A interface ge-1/2/1.0 set routing-instances VPN-A route-distinguisher 65534:1234 set routing-instances VPN-A vrf-target target:65534:1234 set routing-instances VPN-A protocols bgp group CE type external set routing-instances VPN-A protocols bgp group CE family inet unicast set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.18 peer-as 64512 set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.18 as-override set routing-options router-id 10.255.5.5 set routing-options autonomous-system 65534 设备 CE2 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.18/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 10.255.6.6/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0606.00 set protocols bgp group PE type external set protocols bgp group PE family inet unicast set protocols bgp group PE export ToBGP set protocols bgp group PE peer-as 65534 set protocols bgp group PE neighbor 10.0.0.17 set policy-options policy-statement ToBGP term Direct from protocol direct set policy-options policy-statement ToBGP term Direct then accept set routing-options router-id 10.255.6.6 set routing-options autonomous-system 64512 下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅 CLI 用户指南中的在配置模式下使用 CLI 编辑器。 要配置 AS 覆盖： 配置接口。 要启用 MPLS，请在接口上包含协议家族，以便接口不会丢弃传入的 MPLS 流量。 [edit interfaces] user@PE1# set ge-1/2/0 unit 0 family inet address 10.0.0.2/30 user@PE1# set ge-1/2/0 unit 0 family iso user@PE1# set ge-1/2/0 unit 0 family mpls user@PE1# set ge-1/2/1 unit 0 family inet address 10.0.0.5/30 user@PE1# set ge-1/2/1 unit 0 family iso user@PE1# set ge-1/2/1 unit 0 family mpls user@PE1# set ge-1/2/2 unit 0 family inet address 10.0.0.21/30 user@PE1# set ge-1/2/2 unit 0 family iso user@PE1# set ge-1/2/2 unit 0 family mpls user@PE1# set lo0 unit 0 family inet address 10.255.2.2/32 user@PE1# set lo0 unit 0 family iso address 49.0001.0010.0000.0202.00 将接口添加到 MPLS 协议以建立控制平面级别的连接。 设置 IGP，以便提供商设备可以相互通信。 要建立分发 MPLS 标签的机制，请启用 LDP。（可选）对于 LDP，启用转发等效类 （FEC） 分解，这样可以加快全局收敛速度。 [edit protocols] user@PE1# set mpls interface ge-1/2/2.0 user@PE1# set mpls interface ge-1/2/1.0 user@PE1# set mpls interface lo0.0 user@PE1# set mpls interface fxp0.0 disable user@PE1# set isis interface ge-1/2/1.0 level 2 metric 10 user@PE1# set isis interface ge-1/2/1.0 level 1 disable user@PE1# set isis interface ge-1/2/2.0 level 2 metric 10 user@PE1# set isis interface ge-1/2/2.0 level 1 disable user@PE1# set isis interface fxp0.0 disable user@PE1# set isis interface lo0.0 level 2 metric 0 user@PE1# set ldp deaggregate user@PE1# set ldp interface ge-1/2/1.0 user@PE1# set ldp interface ge-1/2/2.0 user@PE1# set ldp interface fxp0.0 disable user@PE1# set ldp interface lo0.0 使用 IPv4 VPN 单播地址族，启用内部 BGP （IBGP） 连接，以便仅与 RR 对等。 [edit protocols bgp group l3vpn] user@PE1# set type internal user@PE1# set local-address 10.255.2.2 user@PE1# set family inet-vpn unicast user@PE1# set peer-as 65534 user@PE1# set local-as 65534 user@PE1# set neighbor 10.255.4.4 配置路由实例，包括 as-override 语句。 在 PE 设备上创建路由实例 （VRF），并将 BGP 配置设置为与设备 CE1 对等。 [edit routing-instances VPN-A] user@PE1# set instance-type vrf user@PE1# set interface ge-1/2/0.0 user@PE1# set route-distinguisher 65534:1234 user@PE1# set vrf-target target:65534:1234 user@PE1# set protocols bgp group CE type external user@PE1# set protocols bgp group CE family inet unicast user@PE1# set protocols bgp group CE neighbor 10.0.0.1 peer-as 64512 user@PE1# set protocols bgp group CE neighbor 10.0.0.1 as-override 配置路由器 ID 和 AS 编号。 [edit routing-options] user@PE1# set router-id 10.255.2.2 user@PE1# set autonomous-system 65534 在配置模式下，输入 show interfaces 、 show protocols 、 show routing-instances 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的配置说明，以便进行更正。 user@PE1# show interfaces ge-1/2/0 { unit 2 { family inet { address 10.0.0.2/30; } family iso; family mpls; } } ge-1/2/1 { unit 5 { family inet { address 10.0.0.5/30; } family iso; family mpls; } } ge-1/2/2 { unit 21 { family inet { address 10.0.0.21/30; } family iso; family mpls; } } lo0 { unit 0 { family inet { address 10.255.2.2/32; } family iso { address 49.0001.0010.0000.0202.00; } } } user@PE1# show protocols mpls { interface ge-1/2/2.0; interface ge-1/2/1.0; interface lo0.0; interface fxp0.0 { disable; } } bgp { group l3vpn { type internal; local-address 10.255.2.2; family inet-vpn { unicast; } peer-as 65534; local-as 65534; neighbor 10.255.4.4; } } isis { interface ge-1/2/1.0 { level 2 metric 10; level 1 disable; } interface ge-1/2/2.0 { level 2 metric 10; level 1 disable; } interface fxp0.0 { disable; } interface lo0.0 { level 2 metric 0; } } ldp { deaggregate; interface ge-1/2/1.0; interface ge-1/2/2.0; interface fxp0.0 { disable; } interface lo0.0; } user@PE1# show routing-instances VPN-A { instance-type vrf; interface ge-1/2/0.0; route-distinguisher 65534:1234; vrf-target target:65534:1234; protocols { bgp { group CE { type external; family inet { unicast; } neighbor 10.0.0.1 { peer-as 64512; as-override; } } } } } user@PE1# show routing-options router-id 10.255.2.2; autonomous-system 65534; 如果完成设备配置，请从配置模式输入 commit 。",
          "sections": [
            {
              "title": "CLI 快速配置",
              "level": 5,
              "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 CE1 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.1/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 10.255.1.1/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0101.00 set protocols bgp group PE type external set protocols bgp group PE family inet unicast set protocols bgp group PE export ToBGP set protocols bgp group PE peer-as 65534 set protocols bgp group PE neighbor 10.0.0.2 set policy-options policy-statement ToBGP term Direct from protocol direct set policy-options policy-statement ToBGP term Direct then accept set routing-options router-id 10.255.1.1 set routing-options autonomous-system 64512 设备 P1 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.6/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.9/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.25/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.3.3/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0303.00 set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.3.3 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface all level 2 metric 10 set protocols isis interface all level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface all set protocols ldp interface fxp0.0 disable set routing-options router-id 10.255.3.3 设备 P2 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.10/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.13/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.4.4/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0404.00 set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols bgp group Core-RRClients type internal set protocols bgp group Core-RRClients local-address 10.255.4.4 set protocols bgp group Core-RRClients family inet-vpn unicast set protocols bgp group Core-RRClients cluster 10.255.4.4 set protocols bgp group Core-RRClients peer-as 65534 set protocols bgp group Core-RRClients neighbor 10.255.3.3 set protocols bgp group Core-RRClients neighbor 10.255.7.7 set protocols bgp group Core-RRClients neighbor 10.255.2.2 set protocols bgp group Core-RRClients neighbor 10.255.5.5 set protocols isis interface all level 2 metric 10 set protocols isis interface all level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface all set protocols ldp interface fxp0.0 disable set routing-options router-id 10.255.4.4 set routing-options autonomous-system 65534 设备 P3 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.22/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.26/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.30/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.7.7/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0707.00 set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.7.7 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface all level 2 metric 10 set protocols isis interface all level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface all set protocols ldp interface fxp0.0 disable set routing-options router-id 10.255.7.7 设备 PE1 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.2/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.5/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/1 unit 0 family mpls set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.21/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.2.2/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0202.00 set protocols mpls interface ge-1/2/2.0 set protocols mpls interface ge-1/2/1.0 set protocols mpls interface lo0.0 set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.2.2 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface ge-1/2/1.0 level 2 metric 10 set protocols isis interface ge-1/2/1.0 level 1 disable set protocols isis interface ge-1/2/2.0 level 2 metric 10 set protocols isis interface ge-1/2/2.0 level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface ge-1/2/1.0 set protocols ldp interface ge-1/2/2.0 set protocols ldp interface fxp0.0 disable set protocols ldp interface lo0.0 set routing-instances VPN-A instance-type vrf set routing-instances VPN-A interface ge-1/2/0.0 set routing-instances VPN-A route-distinguisher 65534:1234 set routing-instances VPN-A vrf-target target:65534:1234 set routing-instances VPN-A protocols bgp group CE type external set routing-instances VPN-A protocols bgp group CE family inet unicast set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.1 peer-as 64512 set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.1 as-override set routing-options router-id 10.255.2.2 set routing-options autonomous-system 65534 设备 PE2 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.14/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces ge-1/2/0 unit 0 family mpls set interfaces ge-1/2/1 unit 0 family inet address 10.0.0.17/30 set interfaces ge-1/2/1 unit 0 family iso set interfaces ge-1/2/2 unit 0 family inet address 10.0.0.29/30 set interfaces ge-1/2/2 unit 0 family iso set interfaces ge-1/2/2 unit 0 family mpls set interfaces lo0 unit 0 family inet address 10.255.5.5/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0505.00 set protocols mpls interface ge-1/2/0.0 set protocols mpls interface ge-1/2/2.0 set protocols mpls interface lo0.0 set protocols mpls interface fxp0.0 disable set protocols bgp group l3vpn type internal set protocols bgp group l3vpn local-address 10.255.5.5 set protocols bgp group l3vpn family inet-vpn unicast set protocols bgp group l3vpn peer-as 65534 set protocols bgp group l3vpn local-as 65534 set protocols bgp group l3vpn neighbor 10.255.4.4 set protocols isis interface ge-1/2/0.0 level 2 metric 10 set protocols isis interface ge-1/2/0.0 level 1 disable set protocols isis interface ge-1/2/2.0 level 2 metric 10 set protocols isis interface ge-1/2/2.0 level 1 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 level 2 metric 0 set protocols ldp deaggregate set protocols ldp interface ge-1/2/0.0 set protocols ldp interface ge-1/2/2.0 set protocols ldp interface fxp0.0 disable set protocols ldp interface lo0.0 set routing-instances VPN-A instance-type vrf set routing-instances VPN-A interface ge-1/2/1.0 set routing-instances VPN-A route-distinguisher 65534:1234 set routing-instances VPN-A vrf-target target:65534:1234 set routing-instances VPN-A protocols bgp group CE type external set routing-instances VPN-A protocols bgp group CE family inet unicast set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.18 peer-as 64512 set routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.18 as-override set routing-options router-id 10.255.5.5 set routing-options autonomous-system 65534 设备 CE2 set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.18/30 set interfaces ge-1/2/0 unit 0 family iso set interfaces lo0 unit 0 family inet address 10.255.6.6/32 set interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0606.00 set protocols bgp group PE type external set protocols bgp group PE family inet unicast set protocols bgp group PE export ToBGP set protocols bgp group PE peer-as 65534 set protocols bgp group PE neighbor 10.0.0.17 set policy-options policy-statement ToBGP term Direct from protocol direct set policy-options policy-statement ToBGP term Direct then accept set routing-options router-id 10.255.6.6 set routing-options autonomous-system 64512",
              "commands_by_device": {
                "设备 CE1": "set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.1/30\nset interfaces ge-1/2/0 unit 0 family iso\nset interfaces lo0 unit 0 family inet address 10.255.1.1/32\nset interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0101.00\nset protocols bgp group PE type external\nset protocols bgp group PE family inet unicast\nset protocols bgp group PE export ToBGP\nset protocols bgp group PE peer-as 65534\nset protocols bgp group PE neighbor 10.0.0.2\nset policy-options policy-statement ToBGP term Direct from protocol direct\nset policy-options policy-statement ToBGP term Direct then accept\nset routing-options router-id 10.255.1.1\nset routing-options autonomous-system 64512",
                "设备 P1": "set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.6/30\nset interfaces ge-1/2/0 unit 0 family iso\nset interfaces ge-1/2/0 unit 0 family mpls\nset interfaces ge-1/2/1 unit 0 family inet address 10.0.0.9/30\nset interfaces ge-1/2/1 unit 0 family iso\nset interfaces ge-1/2/1 unit 0 family mpls\nset interfaces ge-1/2/2 unit 0 family inet address 10.0.0.25/30\nset interfaces ge-1/2/2 unit 0 family iso\nset interfaces ge-1/2/2 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.255.3.3/32\nset interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0303.00\nset protocols mpls interface all\nset protocols mpls interface fxp0.0 disable\nset protocols bgp group l3vpn type internal\nset protocols bgp group l3vpn local-address 10.255.3.3\nset protocols bgp group l3vpn family inet-vpn unicast\nset protocols bgp group l3vpn peer-as 65534\nset protocols bgp group l3vpn local-as 65534\nset protocols bgp group l3vpn neighbor 10.255.4.4\nset protocols isis interface all level 2 metric 10\nset protocols isis interface all level 1 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0 level 2 metric 0\nset protocols ldp deaggregate\nset protocols ldp interface all\nset protocols ldp interface fxp0.0 disable\nset routing-options router-id 10.255.3.3",
                "设备 P2": "set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.10/30\nset interfaces ge-1/2/0 unit 0 family iso\nset interfaces ge-1/2/0 unit 0 family mpls\nset interfaces ge-1/2/1 unit 0 family inet address 10.0.0.13/30\nset interfaces ge-1/2/1 unit 0 family iso\nset interfaces ge-1/2/1 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.255.4.4/32\nset interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0404.00\nset protocols mpls interface all\nset protocols mpls interface fxp0.0 disable\nset protocols bgp group Core-RRClients type internal\nset protocols bgp group Core-RRClients local-address 10.255.4.4\nset protocols bgp group Core-RRClients family inet-vpn unicast\nset protocols bgp group Core-RRClients cluster 10.255.4.4\nset protocols bgp group Core-RRClients peer-as 65534\nset protocols bgp group Core-RRClients neighbor 10.255.3.3\nset protocols bgp group Core-RRClients neighbor 10.255.7.7\nset protocols bgp group Core-RRClients neighbor 10.255.2.2\nset protocols bgp group Core-RRClients neighbor 10.255.5.5\nset protocols isis interface all level 2 metric 10\nset protocols isis interface all level 1 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0 level 2 metric 0\nset protocols ldp deaggregate\nset protocols ldp interface all\nset protocols ldp interface fxp0.0 disable\nset routing-options router-id 10.255.4.4\nset routing-options autonomous-system 65534",
                "设备 P3": "set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.22/30\nset interfaces ge-1/2/0 unit 0 family iso\nset interfaces ge-1/2/0 unit 0 family mpls\nset interfaces ge-1/2/1 unit 0 family inet address 10.0.0.26/30\nset interfaces ge-1/2/1 unit 0 family iso\nset interfaces ge-1/2/1 unit 0 family mpls\nset interfaces ge-1/2/2 unit 0 family inet address 10.0.0.30/30\nset interfaces ge-1/2/2 unit 0 family iso\nset interfaces ge-1/2/2 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.255.7.7/32\nset interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0707.00\nset protocols mpls interface all\nset protocols mpls interface fxp0.0 disable\nset protocols bgp group l3vpn type internal\nset protocols bgp group l3vpn local-address 10.255.7.7\nset protocols bgp group l3vpn family inet-vpn unicast\nset protocols bgp group l3vpn peer-as 65534\nset protocols bgp group l3vpn local-as 65534\nset protocols bgp group l3vpn neighbor 10.255.4.4\nset protocols isis interface all level 2 metric 10\nset protocols isis interface all level 1 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0 level 2 metric 0\nset protocols ldp deaggregate\nset protocols ldp interface all\nset protocols ldp interface fxp0.0 disable\nset routing-options router-id 10.255.7.7",
                "设备 PE1": "set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.2/30\nset interfaces ge-1/2/0 unit 0 family iso\nset interfaces ge-1/2/0 unit 0 family mpls\nset interfaces ge-1/2/1 unit 0 family inet address 10.0.0.5/30\nset interfaces ge-1/2/1 unit 0 family iso\nset interfaces ge-1/2/1 unit 0 family mpls\nset interfaces ge-1/2/2 unit 0 family inet address 10.0.0.21/30\nset interfaces ge-1/2/2 unit 0 family iso\nset interfaces ge-1/2/2 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.255.2.2/32\nset interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0202.00\nset protocols mpls interface ge-1/2/2.0\nset protocols mpls interface ge-1/2/1.0\nset protocols mpls interface lo0.0\nset protocols mpls interface fxp0.0 disable\nset protocols bgp group l3vpn type internal\nset protocols bgp group l3vpn local-address 10.255.2.2\nset protocols bgp group l3vpn family inet-vpn unicast\nset protocols bgp group l3vpn peer-as 65534\nset protocols bgp group l3vpn local-as 65534\nset protocols bgp group l3vpn neighbor 10.255.4.4\nset protocols isis interface ge-1/2/1.0 level 2 metric 10\nset protocols isis interface ge-1/2/1.0 level 1 disable\nset protocols isis interface ge-1/2/2.0 level 2 metric 10\nset protocols isis interface ge-1/2/2.0 level 1 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0 level 2 metric 0\nset protocols ldp deaggregate\nset protocols ldp interface ge-1/2/1.0\nset protocols ldp interface ge-1/2/2.0\nset protocols ldp interface fxp0.0 disable\nset protocols ldp interface lo0.0\nset routing-instances VPN-A instance-type vrf\nset routing-instances VPN-A interface ge-1/2/0.0\nset routing-instances VPN-A route-distinguisher 65534:1234\nset routing-instances VPN-A vrf-target target:65534:1234\nset routing-instances VPN-A protocols bgp group CE type external\nset routing-instances VPN-A protocols bgp group CE family inet unicast\nset routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.1 peer-as 64512\nset routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.1 as-override\nset routing-options router-id 10.255.2.2\nset routing-options autonomous-system 65534",
                "设备 PE2": "set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.14/30\nset interfaces ge-1/2/0 unit 0 family iso\nset interfaces ge-1/2/0 unit 0 family mpls\nset interfaces ge-1/2/1 unit 0 family inet address 10.0.0.17/30\nset interfaces ge-1/2/1 unit 0 family iso\nset interfaces ge-1/2/2 unit 0 family inet address 10.0.0.29/30\nset interfaces ge-1/2/2 unit 0 family iso\nset interfaces ge-1/2/2 unit 0 family mpls\nset interfaces lo0 unit 0 family inet address 10.255.5.5/32\nset interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0505.00\nset protocols mpls interface ge-1/2/0.0\nset protocols mpls interface ge-1/2/2.0\nset protocols mpls interface lo0.0\nset protocols mpls interface fxp0.0 disable\nset protocols bgp group l3vpn type internal\nset protocols bgp group l3vpn local-address 10.255.5.5\nset protocols bgp group l3vpn family inet-vpn unicast\nset protocols bgp group l3vpn peer-as 65534\nset protocols bgp group l3vpn local-as 65534\nset protocols bgp group l3vpn neighbor 10.255.4.4\nset protocols isis interface ge-1/2/0.0 level 2 metric 10\nset protocols isis interface ge-1/2/0.0 level 1 disable\nset protocols isis interface ge-1/2/2.0 level 2 metric 10\nset protocols isis interface ge-1/2/2.0 level 1 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0 level 2 metric 0\nset protocols ldp deaggregate\nset protocols ldp interface ge-1/2/0.0\nset protocols ldp interface ge-1/2/2.0\nset protocols ldp interface fxp0.0 disable\nset protocols ldp interface lo0.0\nset routing-instances VPN-A instance-type vrf\nset routing-instances VPN-A interface ge-1/2/1.0\nset routing-instances VPN-A route-distinguisher 65534:1234\nset routing-instances VPN-A vrf-target target:65534:1234\nset routing-instances VPN-A protocols bgp group CE type external\nset routing-instances VPN-A protocols bgp group CE family inet unicast\nset routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.18 peer-as 64512\nset routing-instances VPN-A protocols bgp group CE neighbor 10.0.0.18 as-override\nset routing-options router-id 10.255.5.5\nset routing-options autonomous-system 65534",
                "设备 CE2": "set interfaces ge-1/2/0 unit 0 family inet address 10.0.0.18/30\nset interfaces ge-1/2/0 unit 0 family iso\nset interfaces lo0 unit 0 family inet address 10.255.6.6/32\nset interfaces lo0 unit 0 family iso address 49.0001.0010.0000.0606.00\nset protocols bgp group PE type external\nset protocols bgp group PE family inet unicast\nset protocols bgp group PE export ToBGP\nset protocols bgp group PE peer-as 65534\nset protocols bgp group PE neighbor 10.0.0.17\nset policy-options policy-statement ToBGP term Direct from protocol direct\nset policy-options policy-statement ToBGP term Direct then accept\nset routing-options router-id 10.255.6.6\nset routing-options autonomous-system 64512"
              }
            },
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE1# set ge-1/2/0 unit 0 family inet address 10.0.0.2/30",
                    "user@PE1# set ge-1/2/0 unit 0 family iso",
                    "user@PE1# set ge-1/2/0 unit 0 family mpls",
                    "user@PE1# set ge-1/2/1 unit 0 family inet address 10.0.0.5/30",
                    "user@PE1# set ge-1/2/1 unit 0 family iso",
                    "user@PE1# set ge-1/2/1 unit 0 family mpls",
                    "user@PE1# set ge-1/2/2 unit 0 family inet address 10.0.0.21/30",
                    "user@PE1# set ge-1/2/2 unit 0 family iso",
                    "user@PE1# set ge-1/2/2 unit 0 family mpls",
                    "user@PE1# set lo0 unit 0 family inet address 10.255.2.2/32",
                    "user@PE1# set lo0 unit 0 family iso address 49.0001.0010.0000.0202.00"
                  ]
                },
                {
                  "step": 2,
                  "description": "将接口添加到 MPLS 协议以建立控制平面级别的连接。",
                  "code": [
                    "[edit protocols]",
                    "user@PE1# set mpls interface ge-1/2/2.0",
                    "user@PE1# set mpls interface ge-1/2/1.0",
                    "user@PE1# set mpls interface lo0.0",
                    "user@PE1# set mpls interface fxp0.0 disable",
                    "user@PE1# set isis interface ge-1/2/1.0 level 2 metric 10",
                    "user@PE1# set isis interface ge-1/2/1.0 level 1 disable",
                    "user@PE1# set isis interface ge-1/2/2.0 level 2 metric 10",
                    "user@PE1# set isis interface ge-1/2/2.0 level 1 disable",
                    "user@PE1# set isis interface fxp0.0 disable",
                    "user@PE1# set isis interface lo0.0 level 2 metric 0",
                    "user@PE1# set ldp deaggregate",
                    "user@PE1# set ldp interface ge-1/2/1.0",
                    "user@PE1# set ldp interface ge-1/2/2.0",
                    "user@PE1# set ldp interface fxp0.0 disable",
                    "user@PE1# set ldp interface lo0.0"
                  ]
                },
                {
                  "step": 3,
                  "description": "使用 IPv4 VPN 单播地址族，启用内部 BGP （IBGP） 连接，以便仅与 RR 对等。",
                  "code": [
                    "[edit protocols bgp group l3vpn]",
                    "user@PE1# set type internal",
                    "user@PE1# set local-address 10.255.2.2",
                    "user@PE1# set family inet-vpn unicast",
                    "user@PE1# set peer-as 65534",
                    "user@PE1# set local-as 65534",
                    "user@PE1# set neighbor 10.255.4.4"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置路由实例，包括 as-override 语句。",
                  "code": [
                    "[edit routing-instances VPN-A]",
                    "user@PE1# set instance-type vrf",
                    "user@PE1# set interface ge-1/2/0.0",
                    "user@PE1# set route-distinguisher 65534:1234",
                    "user@PE1# set vrf-target target:65534:1234",
                    "user@PE1# set protocols bgp group CE type external",
                    "user@PE1# set protocols bgp group CE family inet unicast",
                    "user@PE1# set protocols bgp group CE neighbor 10.0.0.1 peer-as 64512",
                    "user@PE1# set protocols bgp group CE neighbor 10.0.0.1 as-override"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置路由器 ID 和 AS 编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE1# set router-id 10.255.2.2",
                    "user@PE1# set autonomous-system 65534"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show protocols 、 show routing-instances 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的配置说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。",
              "code": [
                "user@PE1#show interfacesge-1/2/0 {\n    unit 2 {\n        family inet {\n            address 10.0.0.2/30;\n        }\n        family iso;\n        family mpls;\n    }\n}\nge-1/2/1 {\n    unit 5 {\n        family inet {\n            address 10.0.0.5/30;\n        }\n        family iso;\n        family mpls;\n    }\n}\nge-1/2/2 {\n    unit 21 {\n        family inet {\n            address 10.0.0.21/30;\n        }\n        family iso;\n        family mpls;\n    }\n}\nlo0 {\n    unit 0 {\n        family inet {\n            address 10.255.2.2/32;\n        }\n        family iso {\n            address 49.0001.0010.0000.0202.00;\n        }\n    }\n}",
                "user@PE1#show protocolsmpls {\n    interface ge-1/2/2.0;\n    interface ge-1/2/1.0;\n    interface lo0.0;\n    interface fxp0.0 {\n        disable;\n    }\n}\nbgp {\n    group l3vpn {\n        type internal;\n        local-address 10.255.2.2;\n        family inet-vpn {\n            unicast;\n        }\n        peer-as 65534;\n        local-as 65534;\n        neighbor 10.255.4.4;\n    }\n}\nisis {\n    interface ge-1/2/1.0 {\n        level 2 metric 10;\n        level 1 disable;\n    }\n    interface ge-1/2/2.0 {\n        level 2 metric 10;\n        level 1 disable;\n    }\n    interface fxp0.0 {\n        disable;\n    }\n    interface lo0.0 {\n        level 2 metric 0;\n    }\n}\nldp {\n    deaggregate;\n    interface ge-1/2/1.0;\n    interface ge-1/2/2.0;\n    interface fxp0.0 {\n        disable;\n    }\n    interface lo0.0;\n}",
                "user@PE1#show routing-instancesVPN-A {\n    instance-type vrf;\n    interface ge-1/2/0.0;\n    route-distinguisher 65534:1234;\n    vrf-target target:65534:1234;\n    protocols {\n        bgp {\n            group CE {\n                type external;\n                family inet {\n                    unicast;\n                }\n                neighbor 10.0.0.1 {\n                    peer-as 64512;\n                    as-override;\n                }\n            }\n        }\n    }\n}",
                "user@PE1#show routing-optionsrouter-id 10.255.2.2;\nautonomous-system 65534;"
              ]
            }
          ]
        }
      ]
    }
  ],
  "content": "假设您是提供基于 MPLS 的托管第 3 层 VPN 服务的服务提供商。您的客户有多个站点，并且需要将 BGP 路由到每个站点上的客户边缘 （CE） 设备。 要求 配置此示例之前，不需要除设备初始化之外的特殊配置。 概述 此示例包含两个 CE 设备、两个提供商边缘 （PE） 设备和多个提供商核心设备。提供商网络还使用 IS-IS 来支持 LDP 和 BGP 环路可达性 设备 P2 充当路由反射器 （RR）。两台 CE 设备均位于自治系统 （AS） 64512 中。提供商网络位于 AS 65534 中。 该 as-override 语句将应用于 PE 设备，从而将 CE 设备的 AS 编号替换为 PE 设备的 AS 编号。这可以防止客户 AS 编号在 AS 路径属性中多次出现。 图 5 显示了此示例中使用的拓扑。 图 5： AS 覆盖拓扑 CLI 快速配置 显示了 中 图 5所有设备的配置。分步过程本节介绍设备 PE1 上的步骤"
}