{
  "title": "示例：选择最佳路径时忽略 AS 路径属性",
  "sections": [
    {
      "title": "要求",
      "level": 3,
      "content": "在配置此示例之前，不需要除设备初始化之外的特殊配置。"
    },
    {
      "title": "概述",
      "level": 3,
      "content": "在外部连接的路由设备上，跳过 AS 路径比较的目的可能是强制外部 BGP （EBGP） 与内部 BGP （IBGP） 决策尽快从网络中删除流量。在内部连接的路由设备上，您可能希望仅 IBGP 路由器默认为本地外部连接的网关。本地仅支持 IBGP（内部）路由器会跳过 AS 路径比较，并在决策树中向下移动，以使用最近的内部网关协议 （IGP） 网关（最低 IGP 指标）。这样做可能是强制这些路由器使用 LAN 连接而不是其 WAN 连接的有效方法。 警告： 在网络中的路由设备上包含语句 as-path-ignore 时，可能需要将其包含在网络中所有其他启用了 BGP 的设备上，以防止出现路由环路和收敛问题。对于 IBGP 路径比较尤其如此。 警告： 在网络中的路由设备上包含语句 as-path-ignore 时，可能需要将其包含在网络中所有其他启用了 BGP 的设备上，以防止出现路由环路和收敛问题。对于 IBGP 路径比较尤其如此。 在此示例中，设备 R2 从设备 R1 和设备 R3 了解设备 R4 （10.4.4.4/32） 上的环路接口地址。设备 R1 播发 10.4.4.4/32，AS 路径为 65001 65005 65004，设备 R3 播发 10.4.4.4/32，AS 路径为 65003 65004。设备 R2 从设备 R3 中选择 10.4.4.4/32 的路径作为最佳路径，因为 AS 路径比设备 R1 中的 AS 路径短。 此示例修改设备 R2 上的 BGP 配置，以便最佳路径选择中不使用 AS 路径长度。 设备 R1 的路由器 ID （10.1.1.1） 低于设备 R3 （10.3.3.3）。如果所有其他路径选择标准相等（或在本例中被忽略），则使用从设备 R1 获知的路由。由于 AS 路径属性会被忽略，因此最佳路径是指向设备 R1，因为它的路由器 ID 值较低。 图 7 显示了示例拓扑。"
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 R1 set interfaces fe-1/2/0 unit 1 family inet address 192.168.10.1/24 set interfaces fe-1/2/1 unit 10 family inet address 192.168.50.2/24 set interfaces lo0 unit 1 family inet address 10.1.1.1/32 set protocols bgp group ext type external set protocols bgp group ext export send-direct set protocols bgp group ext export send-static set protocols bgp group ext export send-local set protocols bgp group ext neighbor 192.168.10.2 peer-as 65002 set protocols bgp group ext neighbor 192.168.50.1 peer-as 65005 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set policy-options policy-statement send-local term 1 from protocol local set policy-options policy-statement send-local term 1 then accept set policy-options policy-statement send-static term 1 from protocol static set policy-options policy-statement send-static term 1 then accept set routing-options static route 192.168.20.0/24 next-hop 192.168.10.2 set routing-options static route 192.168.30.0/24 next-hop 192.168.10.2 set routing-options static route 192.168.40.0/24 next-hop 192.168.50.1 set routing-options router-id 10.1.1.1 set routing-options autonomous-system 65001 设备 R2 set interfaces fe-1/2/0 unit 2 family inet address 192.168.10.2/24 set interfaces fe-1/2/1 unit 3 family inet address 192.168.20.2/24 set interfaces lo0 unit 2 family inet address 10.2.2.2/32 set protocols bgp path-selection as-path-ignore set protocols bgp group ext type external set protocols bgp group ext export send-direct set protocols bgp group ext export send-static set protocols bgp group ext export send-local set protocols bgp group ext neighbor 192.168.10.1 peer-as 65001 set protocols bgp group ext neighbor 192.168.20.1 peer-as 65003 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set policy-options policy-statement send-local term 1 from protocol local set policy-options policy-statement send-local term 1 then accept set policy-options policy-statement send-static term 1 from protocol static set policy-options policy-statement send-static term 1 then accept set routing-options static route 192.168.50.0/24 next-hop 192.168.10.1 set routing-options static route 192.168.40.0/24 next-hop 192.168.10.1 set routing-options static route 192.168.30.0/24 next-hop 192.168.20.1 set routing-options router-id 10.2.2.2 set routing-options autonomous-system 65002 设备 R3 set interfaces fe-1/2/0 unit 4 family inet address 192.168.20.1/24 set interfaces fe-1/2/1 unit 5 family inet address 192.168.30.1/24 set interfaces lo0 unit 3 family inet address 10.3.3.3/32 set protocols bgp group ext type external set protocols bgp group ext export send-direct set protocols bgp group ext export send-static set protocols bgp group ext export send-local set protocols bgp group ext neighbor 192.168.20.2 peer-as 65002 set protocols bgp group ext neighbor 192.168.30.2 peer-as 65004 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set policy-options policy-statement send-local term 1 from protocol local set policy-options policy-statement send-local term 1 then accept set policy-options policy-statement send-static term 1 from protocol static set policy-options policy-statement send-static term 1 then accept set routing-options static route 192.168.10.0/24 next-hop 192.168.20.2 set routing-options static route 192.168.50.0/24 next-hop 192.168.20.2 set routing-options static route 192.168.40.0/24 next-hop 192.168.30.2 set routing-options router-id 10.3.3.3 set routing-options autonomous-system 65003 设备 R4 set interfaces fe-1/2/0 unit 6 family inet address 192.168.30.2/24 set interfaces fe-1/2/1 unit 7 family inet address 192.168.40.1/24 set interfaces lo0 unit 4 family inet address 10.4.4.4/32 set protocols bgp group ext type external set protocols bgp group ext export send-direct set protocols bgp group ext export send-static set protocols bgp group ext export send-local set protocols bgp group ext neighbor 192.168.30.1 peer-as 65003 set protocols bgp group ext neighbor 192.168.40.2 peer-as 65005 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set policy-options policy-statement send-local term 1 from protocol local set policy-options policy-statement send-local term 1 then accept set policy-options policy-statement send-static term 1 from protocol static set policy-options policy-statement send-static term 1 then accept set routing-options static route 192.168.10.0/24 next-hop 192.168.40.2 set routing-options static route 192.168.50.0/24 next-hop 192.168.40.2 set routing-options static route 192.168.40.0/24 next-hop 192.168.30.1 set routing-options router-id 10.4.4.4 set routing-options autonomous-system 65004 设备 R5 set interfaces fe-1/2/0 unit 8 family inet address 192.168.40.2/24 set interfaces fe-1/2/1 unit 9 family inet address 192.168.50.1/24 set interfaces lo0 unit 5 family inet address 10.5.5.5/32 set protocols bgp group ext type external set protocols bgp group ext export send-direct set protocols bgp group ext export send-static set protocols bgp group ext export send-local set protocols bgp group ext neighbor 192.168.40.1 peer-as 65004 set protocols bgp group ext neighbor 192.168.50.2 peer-as 65001 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set policy-options policy-statement send-local term 1 from protocol local set policy-options policy-statement send-local term 1 then accept set policy-options policy-statement send-static term 1 from protocol static set policy-options policy-statement send-static term 1 then accept set routing-options static route 192.168.10.0/24 next-hop 192.168.50.2 set routing-options static route 192.168.20.0/24 next-hop 192.168.50.2 set routing-options static route 192.168.30.0/24 next-hop 192.168.40.1 set routing-options router-id 10.5.5.5 set routing-options autonomous-system 65005 下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R2： 配置接口。 [edit interfaces] user@R2# set fe-1/2/0 unit 2 family inet address 192.168.10.2/24 user@R2# set fe-1/2/1 unit 3 family inet address 192.168.20.2/24 user@R2# set lo0 unit 2 family inet address 10.2.2.2/32 配置 EBGP。 [edit protocols bgp group ext] user@R2# set type external user@R2# set export send-direct user@R2# set export send-static user@R2# set export send-local user@R2# set neighbor 192.168.10.1 peer-as 65001 user@R2# set neighbor 192.168.20.1 peer-as 65003 配置在 Junos OS 路径选择算法中要忽略的自治系统 (AS) 路径属性。 [edit protocols bgp] user@R2# set path-selection as-path-ignore 配置路由策略。 [edit policy-options] user@R2# set policy-statement send-direct term 1 from protocol direct user@R2# set policy-statement send-direct term 1 then accept user@R2# set policy-statement send-local term 1 from protocol local user@R2# set policy-statement send-local term 1 then accept user@R2# set policy-statement send-static term 1 from protocol static user@R2# set policy-statement send-static term 1 then accept 配置一些静态路由。 [edit routing-options static] user@R2# set route 192.168.50.0/24 next-hop 192.168.10.1 user@R2# set route 192.168.40.0/24 next-hop 192.168.10.1 user@R2# set route 192.168.30.0/24 next-hop 192.168.20.1 配置自治系统 (AS) 编号和路由器 ID。 [edit routing-options] user@R2# set router-id 10.2.2.2 user@R2# set autonomous-system 65002 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R2# show interfaces fe-1/2/0 { unit 2 { family inet { address 192.168.10.2/24; } } } fe-1/2/1 { unit 3 { family inet { address 192.168.20.2/24; } } } lo0 { unit 2 { family inet { address 10.2.2.2/32; } } } user@R2# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } policy-statement send-local { term 1 { from protocol local; then accept; } } policy-statement send-static { term 1 { from protocol static; then accept; } } user@R2# show protocols bgp { path-selection as-path-ignore; group ext { type external; export [ send-direct send-static send-local ]; neighbor 192.168.10.1 { peer-as 65001; } neighbor 192.168.20.1 { peer-as 65003; } } } user@R2# show routing-options static { route 192.168.50.0/24 next-hop 192.168.10.1; route 192.168.40.0/24 next-hop 192.168.10.1; route 192.168.30.0/24 next-hop 192.168.20.1; } router-id 10.2.2.2; autonomous-system 65002; 如果完成设备配置，请从配置模式输入 commit 。在网络中的其他设备上重复配置，根据需要更改接口名称和 IP 地址。",
      "sections": [
        {
          "title": "CLI 快速配置",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 R1 set interfaces fe-1/2/0 unit 1 family inet address 192.168.10.1/24 set interfaces fe-1/2/1 unit 10 family inet address 192.168.50.2/24 set interfaces lo0 unit 1 family inet address 10.1.1.1/32 set protocols bgp group ext type external set protocols bgp group ext export send-direct set protocols bgp group ext export send-static set protocols bgp group ext export send-local set protocols bgp group ext neighbor 192.168.10.2 peer-as 65002 set protocols bgp group ext neighbor 192.168.50.1 peer-as 65005 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set policy-options policy-statement send-local term 1 from protocol local set policy-options policy-statement send-local term 1 then accept set policy-options policy-statement send-static term 1 from protocol static set policy-options policy-statement send-static term 1 then accept set routing-options static route 192.168.20.0/24 next-hop 192.168.10.2 set routing-options static route 192.168.30.0/24 next-hop 192.168.10.2 set routing-options static route 192.168.40.0/24 next-hop 192.168.50.1 set routing-options router-id 10.1.1.1 set routing-options autonomous-system 65001 设备 R2 set interfaces fe-1/2/0 unit 2 family inet address 192.168.10.2/24 set interfaces fe-1/2/1 unit 3 family inet address 192.168.20.2/24 set interfaces lo0 unit 2 family inet address 10.2.2.2/32 set protocols bgp path-selection as-path-ignore set protocols bgp group ext type external set protocols bgp group ext export send-direct set protocols bgp group ext export send-static set protocols bgp group ext export send-local set protocols bgp group ext neighbor 192.168.10.1 peer-as 65001 set protocols bgp group ext neighbor 192.168.20.1 peer-as 65003 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set policy-options policy-statement send-local term 1 from protocol local set policy-options policy-statement send-local term 1 then accept set policy-options policy-statement send-static term 1 from protocol static set policy-options policy-statement send-static term 1 then accept set routing-options static route 192.168.50.0/24 next-hop 192.168.10.1 set routing-options static route 192.168.40.0/24 next-hop 192.168.10.1 set routing-options static route 192.168.30.0/24 next-hop 192.168.20.1 set routing-options router-id 10.2.2.2 set routing-options autonomous-system 65002 设备 R3 set interfaces fe-1/2/0 unit 4 family inet address 192.168.20.1/24 set interfaces fe-1/2/1 unit 5 family inet address 192.168.30.1/24 set interfaces lo0 unit 3 family inet address 10.3.3.3/32 set protocols bgp group ext type external set protocols bgp group ext export send-direct set protocols bgp group ext export send-static set protocols bgp group ext export send-local set protocols bgp group ext neighbor 192.168.20.2 peer-as 65002 set protocols bgp group ext neighbor 192.168.30.2 peer-as 65004 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set policy-options policy-statement send-local term 1 from protocol local set policy-options policy-statement send-local term 1 then accept set policy-options policy-statement send-static term 1 from protocol static set policy-options policy-statement send-static term 1 then accept set routing-options static route 192.168.10.0/24 next-hop 192.168.20.2 set routing-options static route 192.168.50.0/24 next-hop 192.168.20.2 set routing-options static route 192.168.40.0/24 next-hop 192.168.30.2 set routing-options router-id 10.3.3.3 set routing-options autonomous-system 65003 设备 R4 set interfaces fe-1/2/0 unit 6 family inet address 192.168.30.2/24 set interfaces fe-1/2/1 unit 7 family inet address 192.168.40.1/24 set interfaces lo0 unit 4 family inet address 10.4.4.4/32 set protocols bgp group ext type external set protocols bgp group ext export send-direct set protocols bgp group ext export send-static set protocols bgp group ext export send-local set protocols bgp group ext neighbor 192.168.30.1 peer-as 65003 set protocols bgp group ext neighbor 192.168.40.2 peer-as 65005 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set policy-options policy-statement send-local term 1 from protocol local set policy-options policy-statement send-local term 1 then accept set policy-options policy-statement send-static term 1 from protocol static set policy-options policy-statement send-static term 1 then accept set routing-options static route 192.168.10.0/24 next-hop 192.168.40.2 set routing-options static route 192.168.50.0/24 next-hop 192.168.40.2 set routing-options static route 192.168.40.0/24 next-hop 192.168.30.1 set routing-options router-id 10.4.4.4 set routing-options autonomous-system 65004 设备 R5 set interfaces fe-1/2/0 unit 8 family inet address 192.168.40.2/24 set interfaces fe-1/2/1 unit 9 family inet address 192.168.50.1/24 set interfaces lo0 unit 5 family inet address 10.5.5.5/32 set protocols bgp group ext type external set protocols bgp group ext export send-direct set protocols bgp group ext export send-static set protocols bgp group ext export send-local set protocols bgp group ext neighbor 192.168.40.1 peer-as 65004 set protocols bgp group ext neighbor 192.168.50.2 peer-as 65001 set policy-options policy-statement send-direct term 1 from protocol direct set policy-options policy-statement send-direct term 1 then accept set policy-options policy-statement send-local term 1 from protocol local set policy-options policy-statement send-local term 1 then accept set policy-options policy-statement send-static term 1 from protocol static set policy-options policy-statement send-static term 1 then accept set routing-options static route 192.168.10.0/24 next-hop 192.168.50.2 set routing-options static route 192.168.20.0/24 next-hop 192.168.50.2 set routing-options static route 192.168.30.0/24 next-hop 192.168.40.1 set routing-options router-id 10.5.5.5 set routing-options autonomous-system 65005",
          "commands_by_device": {
            "设备 R1": "set interfaces fe-1/2/0 unit 1 family inet address 192.168.10.1/24\nset interfaces fe-1/2/1 unit 10 family inet address 192.168.50.2/24\nset interfaces lo0 unit 1 family inet address 10.1.1.1/32\nset protocols bgp group ext type external\nset protocols bgp group ext export send-direct\nset protocols bgp group ext export send-static\nset protocols bgp group ext export send-local\nset protocols bgp group ext neighbor 192.168.10.2 peer-as 65002\nset protocols bgp group ext neighbor 192.168.50.1 peer-as 65005\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset policy-options policy-statement send-local term 1 from protocol local\nset policy-options policy-statement send-local term 1 then accept\nset policy-options policy-statement send-static term 1 from protocol static\nset policy-options policy-statement send-static term 1 then accept\nset routing-options static route 192.168.20.0/24 next-hop 192.168.10.2\nset routing-options static route 192.168.30.0/24 next-hop 192.168.10.2\nset routing-options static route 192.168.40.0/24 next-hop 192.168.50.1\nset routing-options router-id 10.1.1.1\nset routing-options autonomous-system 65001",
            "设备 R2": "set interfaces fe-1/2/0 unit 2 family inet address 192.168.10.2/24\nset interfaces fe-1/2/1 unit 3 family inet address 192.168.20.2/24\nset interfaces lo0 unit 2 family inet address 10.2.2.2/32\nset protocols bgp path-selection as-path-ignore\nset protocols bgp group ext type external\nset protocols bgp group ext export send-direct\nset protocols bgp group ext export send-static\nset protocols bgp group ext export send-local\nset protocols bgp group ext neighbor 192.168.10.1 peer-as 65001\nset protocols bgp group ext neighbor 192.168.20.1 peer-as 65003\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset policy-options policy-statement send-local term 1 from protocol local\nset policy-options policy-statement send-local term 1 then accept\nset policy-options policy-statement send-static term 1 from protocol static\nset policy-options policy-statement send-static term 1 then accept\nset routing-options static route 192.168.50.0/24 next-hop 192.168.10.1\nset routing-options static route 192.168.40.0/24 next-hop 192.168.10.1\nset routing-options static route 192.168.30.0/24 next-hop 192.168.20.1\nset routing-options router-id 10.2.2.2\nset routing-options autonomous-system 65002",
            "设备 R3": "set interfaces fe-1/2/0 unit 4 family inet address 192.168.20.1/24\nset interfaces fe-1/2/1 unit 5 family inet address 192.168.30.1/24\nset interfaces lo0 unit 3 family inet address 10.3.3.3/32\nset protocols bgp group ext type external\nset protocols bgp group ext export send-direct\nset protocols bgp group ext export send-static\nset protocols bgp group ext export send-local\nset protocols bgp group ext neighbor 192.168.20.2 peer-as 65002\nset protocols bgp group ext neighbor 192.168.30.2 peer-as 65004\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset policy-options policy-statement send-local term 1 from protocol local\nset policy-options policy-statement send-local term 1 then accept\nset policy-options policy-statement send-static term 1 from protocol static\nset policy-options policy-statement send-static term 1 then accept\nset routing-options static route 192.168.10.0/24 next-hop 192.168.20.2\nset routing-options static route 192.168.50.0/24 next-hop 192.168.20.2\nset routing-options static route 192.168.40.0/24 next-hop 192.168.30.2\nset routing-options router-id 10.3.3.3\nset routing-options autonomous-system 65003",
            "设备 R4": "set interfaces fe-1/2/0 unit 6 family inet address 192.168.30.2/24\nset interfaces fe-1/2/1 unit 7 family inet address 192.168.40.1/24\nset interfaces lo0 unit 4 family inet address 10.4.4.4/32\nset protocols bgp group ext type external\nset protocols bgp group ext export send-direct\nset protocols bgp group ext export send-static\nset protocols bgp group ext export send-local\nset protocols bgp group ext neighbor 192.168.30.1 peer-as 65003\nset protocols bgp group ext neighbor 192.168.40.2 peer-as 65005\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset policy-options policy-statement send-local term 1 from protocol local\nset policy-options policy-statement send-local term 1 then accept\nset policy-options policy-statement send-static term 1 from protocol static\nset policy-options policy-statement send-static term 1 then accept\nset routing-options static route 192.168.10.0/24 next-hop 192.168.40.2\nset routing-options static route 192.168.50.0/24 next-hop 192.168.40.2\nset routing-options static route 192.168.40.0/24 next-hop 192.168.30.1\nset routing-options router-id 10.4.4.4\nset routing-options autonomous-system 65004",
            "设备 R5": "set interfaces fe-1/2/0 unit 8 family inet address 192.168.40.2/24\nset interfaces fe-1/2/1 unit 9 family inet address 192.168.50.1/24\nset interfaces lo0 unit 5 family inet address 10.5.5.5/32\nset protocols bgp group ext type external\nset protocols bgp group ext export send-direct\nset protocols bgp group ext export send-static\nset protocols bgp group ext export send-local\nset protocols bgp group ext neighbor 192.168.40.1 peer-as 65004\nset protocols bgp group ext neighbor 192.168.50.2 peer-as 65001\nset policy-options policy-statement send-direct term 1 from protocol direct\nset policy-options policy-statement send-direct term 1 then accept\nset policy-options policy-statement send-local term 1 from protocol local\nset policy-options policy-statement send-local term 1 then accept\nset policy-options policy-statement send-static term 1 from protocol static\nset policy-options policy-statement send-static term 1 then accept\nset routing-options static route 192.168.10.0/24 next-hop 192.168.50.2\nset routing-options static route 192.168.20.0/24 next-hop 192.168.50.2\nset routing-options static route 192.168.30.0/24 next-hop 192.168.40.1\nset routing-options router-id 10.5.5.5\nset routing-options autonomous-system 65005"
          }
        },
        {
          "title": "配置设备 R2",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 R2： 配置接口。 [edit interfaces] user@R2# set fe-1/2/0 unit 2 family inet address 192.168.10.2/24 user@R2# set fe-1/2/1 unit 3 family inet address 192.168.20.2/24 user@R2# set lo0 unit 2 family inet address 10.2.2.2/32 配置 EBGP。 [edit protocols bgp group ext] user@R2# set type external user@R2# set export send-direct user@R2# set export send-static user@R2# set export send-local user@R2# set neighbor 192.168.10.1 peer-as 65001 user@R2# set neighbor 192.168.20.1 peer-as 65003 配置在 Junos OS 路径选择算法中要忽略的自治系统 (AS) 路径属性。 [edit protocols bgp] user@R2# set path-selection as-path-ignore 配置路由策略。 [edit policy-options] user@R2# set policy-statement send-direct term 1 from protocol direct user@R2# set policy-statement send-direct term 1 then accept user@R2# set policy-statement send-local term 1 from protocol local user@R2# set policy-statement send-local term 1 then accept user@R2# set policy-statement send-static term 1 from protocol static user@R2# set policy-statement send-static term 1 then accept 配置一些静态路由。 [edit routing-options static] user@R2# set route 192.168.50.0/24 next-hop 192.168.10.1 user@R2# set route 192.168.40.0/24 next-hop 192.168.10.1 user@R2# set route 192.168.30.0/24 next-hop 192.168.20.1 配置自治系统 (AS) 编号和路由器 ID。 [edit routing-options] user@R2# set router-id 10.2.2.2 user@R2# set autonomous-system 65002 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@R2# show interfaces fe-1/2/0 { unit 2 { family inet { address 192.168.10.2/24; } } } fe-1/2/1 { unit 3 { family inet { address 192.168.20.2/24; } } } lo0 { unit 2 { family inet { address 10.2.2.2/32; } } } user@R2# show policy-options policy-statement send-direct { term 1 { from protocol direct; then accept; } } policy-statement send-local { term 1 { from protocol local; then accept; } } policy-statement send-static { term 1 { from protocol static; then accept; } } user@R2# show protocols bgp { path-selection as-path-ignore; group ext { type external; export [ send-direct send-static send-local ]; neighbor 192.168.10.1 { peer-as 65001; } neighbor 192.168.20.1 { peer-as 65003; } } } user@R2# show routing-options static { route 192.168.50.0/24 next-hop 192.168.10.1; route 192.168.40.0/24 next-hop 192.168.10.1; route 192.168.30.0/24 next-hop 192.168.20.1; } router-id 10.2.2.2; autonomous-system 65002; 如果完成设备配置，请从配置模式输入 commit 。在网络中的其他设备上重复配置，根据需要更改接口名称和 IP 地址。",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@R2# set fe-1/2/0 unit 2 family inet address 192.168.10.2/24",
                    "user@R2# set fe-1/2/1 unit 3 family inet address 192.168.20.2/24",
                    "user@R2# set lo0 unit 2 family inet address 10.2.2.2/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 EBGP。",
                  "code": [
                    "[edit protocols bgp group ext]",
                    "user@R2# set type external",
                    "user@R2# set export send-direct",
                    "user@R2# set export send-static",
                    "user@R2# set export send-local",
                    "user@R2# set neighbor 192.168.10.1 peer-as 65001",
                    "user@R2# set neighbor 192.168.20.1 peer-as 65003"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置在 Junos OS 路径选择算法中要忽略的自治系统 (AS) 路径属性。",
                  "code": [
                    "[edit protocols bgp]",
                    "user@R2# set path-selection as-path-ignore"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置路由策略。",
                  "code": [
                    "[edit policy-options]",
                    "user@R2# set policy-statement send-direct term 1 from protocol direct",
                    "user@R2# set policy-statement send-direct term 1 then accept",
                    "user@R2# set policy-statement send-local term 1 from protocol local",
                    "user@R2# set policy-statement send-local term 1 then accept",
                    "user@R2# set policy-statement send-static term 1 from protocol static",
                    "user@R2# set policy-statement send-static term 1 then accept"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置一些静态路由。",
                  "code": [
                    "[edit routing-options static]",
                    "user@R2# set route 192.168.50.0/24 next-hop 192.168.10.1",
                    "user@R2# set route 192.168.40.0/24 next-hop 192.168.10.1",
                    "user@R2# set route 192.168.30.0/24 next-hop 192.168.20.1"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置自治系统 (AS) 编号和路由器 ID。",
                  "code": [
                    "[edit routing-options]",
                    "user@R2# set router-id 10.2.2.2",
                    "user@R2# set autonomous-system 65002"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 如果完成设备配置，请从配置模式输入 commit 。在网络中的其他设备上重复配置，根据需要更改接口名称和 IP 地址。",
              "code": [
                "user@R2#show interfacesfe-1/2/0 {\n    unit 2 {\n        family inet {\n            address 192.168.10.2/24;\n        }\n    }\n}\nfe-1/2/1 {\n    unit 3 {\n        family inet {\n            address 192.168.20.2/24;\n        }\n    }\n}\nlo0 {\n    unit 2 {\n        family inet {\n            address 10.2.2.2/32;\n        }\n    }\n}",
                "user@R2#show policy-optionspolicy-statement send-direct {\n    term 1 {\n        from protocol direct;\n        then accept;\n    }\n}\npolicy-statement send-local {\n    term 1 {\n        from protocol local;\n        then accept;\n    }\n}\npolicy-statement send-static {\n    term 1 {\n        from protocol static;\n        then accept;\n    }\n}",
                "user@R2#show protocolsbgp {\n    path-selection as-path-ignore;\n    group ext {\n        type external;\n        export [ send-direct send-static send-local ];\n        neighbor 192.168.10.1 {\n            peer-as 65001;\n        }\n        neighbor 192.168.20.1 {\n            peer-as 65003;\n        }\n    }\n}",
                "user@R2#show routing-optionsstatic {\n    route 192.168.50.0/24 next-hop 192.168.10.1;\n    route 192.168.40.0/24 next-hop 192.168.10.1;\n    route 192.168.30.0/24 next-hop 192.168.20.1;\n}\nrouter-id 10.2.2.2;\nautonomous-system 65002;"
              ]
            }
          ]
        }
      ]
    }
  ],
  "content": "如果存在到同一目标的多个 BGP 路由，BGP 将根据路径的路由属性选择最佳路径。影响最佳路径决策的路由属性之一是每个路由的 AS 路径长度。AS 路径更短的路由优先于 AS 路径更长的路由。尽管通常不实用，某些情景可能要求在路由选择过程中忽略 AS 路径长度。此示例说明了如何配置路由设备以忽略 AS 路径属性。 要求 在配置此示例之前，不需要除设备初始化之外的特殊配置"
}