{
  "title": "示例：为 BGP 配置累积的 IGP 属性",
  "sections": [
    {
      "title": "要求",
      "level": 3,
      "content": "此示例使用以下硬件和软件组件： 七个 BGP 接口设备。 Junos OS 12.1 或更高版本。 此示例使用以下硬件和软件组件： 七个 BGP 接口设备。 Junos OS 12.1 或更高版本。"
    },
    {
      "title": "概述",
      "level": 3,
      "content": "AIGP 属性支持单个管理部门可以运行多个连续的 BGP 自治系统 （AS） 的部署。此类部署允许 BGP 根据 IGP 指标做出路由决策。启用 AIGP 后，BGP 可以根据 IGP 指标选择路径。这使 BGP 能够选择两个节点之间的最短路径，即使这些节点可能位于不同的 AS 中。AIGP 属性在使用隧道将数据包传送到其 BGP 下一跃点的网络中特别有用。此示例显示了配置了 MPLS 标签交换路径的 AIGP。 要启用 AIGP，您需要在 aigp 协议家族的 BGP 配置中包含该语句。在特定家族上配置 AIGP 可以在该家族上发送和接收 AIGP 属性。默认情况下，AIGP 处于禁用状态。禁用 AIGP 的邻居不会发送 AIGP 属性，而是以静默方式丢弃收到的 AIGP 属性。 Junos OS 支持 AIGP 和 family inet labeled-unicast family inet6 labeled-unicast 。可以在全局 BGP、组或邻居级别为给定系列配置语句 aigp 。 默认情况下，本地前缀的 AIGP 属性值为零。启用了 AIGP 的邻居可以使用策略 aigp-originate 操作，通过导出策略为给定前缀发起 AIGP 属性。AIGP 属性的值反映到前缀的 IGP 距离。或者，您可以使用策略操作指定 aigp-originate distance distance 一个值。可配置范围为 0 到 4,294,967,295。只需一个节点即可发起 AIGP 属性。如果使用 BGP 配置中的语句启用了 aigp 邻接方 AIGP，则会保留并重新通告 AIGP 属性。 发起 AIGP 属性的策略操作具有以下要求： 邻居必须启用 AIGP。 策略必须作为导出策略应用。 前缀必须没有当前 AIGP 属性。 前缀必须使用下一跃点自导出。 前缀必须位于 AIGP 域中。通常，环路 IP 地址是要发起的前缀。 如果不满足这些要求，则忽略该策略。 拓扑图 图 4 显示了此示例中使用的拓扑。OSPF 用作内部网关协议 （IGP）。在设备 PE1 和设备 PE4 之间配置内部 BGP。外部 BGP （EBGP） 在设备 PE7 和设备 PE1 之间、设备 PE4 和设备 PE3 之间以及设备 PE4 和设备 PE2 之间配置。设备 PE4、PE2 和 PE3 配置为多跳。设备 PE4 根据 AIGP 值选择路径，然后根据 AIGP 和策略配置重新播发 AIGP 值。设备 PE1 将 AIGP 值重新播发到另一个管理域中的设备 PE7。每个设备都有两个环路接口地址：10.9.9.x 用于 BGP 对等互连和路由器 ID，10.100.1.x 用于 BGP 下一跃点。 设备 PE1 和 PE3 之间的网络具有 IBGP 对等和多个 OSPF 区域。指向设备 PE7 的外部链接配置为显示 AIGP 属性已重新播发到管理域之外的邻接方（如果该邻接方已启用 AIGP）。 图 4： BGP 中多路径通告 对于 AIGP 属性的发起，BGP 下一跃点必须是自身。如果 BGP 下一跃点保持不变，则收到的 AIGP 属性将按原样重新播发到另一个 AIGP 邻接方。如果下一跃点发生变化，则收到的 AIGP 属性将以增加的值重新播发到另一个 AIGP 邻接方。值的增加反映了到上一个 BGP 下一跃点的 IGP 距离。为了进行演示，此示例将环路接口地址用于设备 PE4 与设备 PE2 和设备 PE3 的 EBGP 对等会话。在这些会话上启用多跳，以便执行递归查找以确定点对点接口。由于下一跃点会更改，因此 IGP 距离将添加到 AIGP 距离中。 AIGP 属性支持单个管理部门可以运行多个连续的 BGP 自治系统 （AS） 的部署。此类部署允许 BGP 根据 IGP 指标做出路由决策。启用 AIGP 后，BGP 可以根据 IGP 指标选择路径。这使 BGP 能够选择两个节点之间的最短路径，即使这些节点可能位于不同的 AS 中。AIGP 属性在使用隧道将数据包传送到其 BGP 下一跃点的网络中特别有用。此示例显示了配置了 MPLS 标签交换路径的 AIGP。 要启用 AIGP，您需要在 aigp 协议家族的 BGP 配置中包含该语句。在特定家族上配置 AIGP 可以在该家族上发送和接收 AIGP 属性。默认情况下，AIGP 处于禁用状态。禁用 AIGP 的邻居不会发送 AIGP 属性，而是以静默方式丢弃收到的 AIGP 属性。 Junos OS 支持 AIGP 和 family inet labeled-unicast family inet6 labeled-unicast 。可以在全局 BGP、组或邻居级别为给定系列配置语句 aigp 。 默认情况下，本地前缀的 AIGP 属性值为零。启用了 AIGP 的邻居可以使用策略 aigp-originate 操作，通过导出策略为给定前缀发起 AIGP 属性。AIGP 属性的值反映到前缀的 IGP 距离。或者，您可以使用策略操作指定 aigp-originate distance distance 一个值。可配置范围为 0 到 4,294,967,295。只需一个节点即可发起 AIGP 属性。如果使用 BGP 配置中的语句启用了 aigp 邻接方 AIGP，则会保留并重新通告 AIGP 属性。 发起 AIGP 属性的策略操作具有以下要求： 邻居必须启用 AIGP。 策略必须作为导出策略应用。 前缀必须没有当前 AIGP 属性。 前缀必须使用下一跃点自导出。 前缀必须位于 AIGP 域中。通常，环路 IP 地址是要发起的前缀。 如果不满足这些要求，则忽略该策略。 拓扑图 图 4 显示了此示例中使用的拓扑。OSPF 用作内部网关协议 （IGP）。在设备 PE1 和设备 PE4 之间配置内部 BGP。外部 BGP （EBGP） 在设备 PE7 和设备 PE1 之间、设备 PE4 和设备 PE3 之间以及设备 PE4 和设备 PE2 之间配置。设备 PE4、PE2 和 PE3 配置为多跳。设备 PE4 根据 AIGP 值选择路径，然后根据 AIGP 和策略配置重新播发 AIGP 值。设备 PE1 将 AIGP 值重新播发到另一个管理域中的设备 PE7。每个设备都有两个环路接口地址：10.9.9.x 用于 BGP 对等互连和路由器 ID，10.100.1.x 用于 BGP 下一跃点。 设备 PE1 和 PE3 之间的网络具有 IBGP 对等和多个 OSPF 区域。指向设备 PE7 的外部链接配置为显示 AIGP 属性已重新播发到管理域之外的邻接方（如果该邻接方已启用 AIGP）。 图 4： BGP 中多路径通告 对于 AIGP 属性的发起，BGP 下一跃点必须是自身。如果 BGP 下一跃点保持不变，则收到的 AIGP 属性将按原样重新播发到另一个 AIGP 邻接方。如果下一跃点发生变化，则收到的 AIGP 属性将以增加的值重新播发到另一个 AIGP 邻接方。值的增加反映了到上一个 BGP 下一跃点的 IGP 距离。为了进行演示，此示例将环路接口地址用于设备 PE4 与设备 PE2 和设备 PE3 的 EBGP 对等会话。在这些会话上启用多跳，以便执行递归查找以确定点对点接口。由于下一跃点会更改，因此 IGP 距离将添加到 AIGP 距离中。 图 4 显示了此示例中使用的拓扑。OSPF 用作内部网关协议 （IGP）。在设备 PE1 和设备 PE4 之间配置内部 BGP。外部 BGP （EBGP） 在设备 PE7 和设备 PE1 之间、设备 PE4 和设备 PE3 之间以及设备 PE4 和设备 PE2 之间配置。设备 PE4、PE2 和 PE3 配置为多跳。设备 PE4 根据 AIGP 值选择路径，然后根据 AIGP 和策略配置重新播发 AIGP 值。设备 PE1 将 AIGP 值重新播发到另一个管理域中的设备 PE7。每个设备都有两个环路接口地址：10.9.9.x 用于 BGP 对等互连和路由器 ID，10.100.1.x 用于 BGP 下一跃点。 设备 PE1 和 PE3 之间的网络具有 IBGP 对等和多个 OSPF 区域。指向设备 PE7 的外部链接配置为显示 AIGP 属性已重新播发到管理域之外的邻接方（如果该邻接方已启用 AIGP）。 图 4： BGP 中多路径通告 对于 AIGP 属性的发起，BGP 下一跃点必须是自身。如果 BGP 下一跃点保持不变，则收到的 AIGP 属性将按原样重新播发到另一个 AIGP 邻接方。如果下一跃点发生变化，则收到的 AIGP 属性将以增加的值重新播发到另一个 AIGP 邻接方。值的增加反映了到上一个 BGP 下一跃点的 IGP 距离。为了进行演示，此示例将环路接口地址用于设备 PE4 与设备 PE2 和设备 PE3 的 EBGP 对等会话。在这些会话上启用多跳，以便执行递归查找以确定点对点接口。由于下一跃点会更改，因此 IGP 距离将添加到 AIGP 距离中。"
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 P1 set interfaces fe-1/2/0 unit 1 description P1-to-PE1 set interfaces fe-1/2/0 unit 1 family inet address 10.0.0.2/30 set interfaces fe-1/2/0 unit 1 family mpls set interfaces fe-1/2/1 unit 4 description P1-to-P2 set interfaces fe-1/2/1 unit 4 family inet address 10.0.0.29/30 set interfaces fe-1/2/1 unit 4 family mpls set interfaces fe-1/2/2 unit 8 description P1-to-PE4 set interfaces fe-1/2/2 unit 8 family inet address 10.0.0.17/30 set interfaces fe-1/2/2 unit 8 family mpls set interfaces lo0 unit 3 family inet address 10.9.9.2/32 set interfaces lo0 unit 3 family inet address 10.100.1.2/32 set protocols rsvp interface fe-1/2/0.1 set protocols rsvp interface fe-1/2/2.8 set protocols rsvp interface fe-1/2/1.4 set protocols mpls label-switched-path P1-to-P2 to 10.9.9.3 set protocols mpls label-switched-path P1-to-PE1 to 10.9.9.1 set protocols mpls label-switched-path P1-to-PE4 to 10.9.9.4 set protocols mpls interface fe-1/2/0.1 set protocols mpls interface fe-1/2/2.8 set protocols mpls interface fe-1/2/1.4 set protocols bgp group internal type internal set protocols bgp group internal local-address 10.9.9.2 set protocols bgp group internal family inet labeled-unicast aigp set protocols bgp group internal neighbor 10.9.9.1 set protocols bgp group internal neighbor 10.9.9.3 set protocols bgp group internal neighbor 10.9.9.4 set protocols ospf area 0.0.0.1 interface fe-1/2/0.1 metric 1 set protocols ospf area 0.0.0.1 interface fe-1/2/1.4 metric 1 set protocols ospf area 0.0.0.0 interface fe-1/2/2.8 metric 1 set protocols ospf area 0.0.0.0 interface 10.9.9.2 passive set protocols ospf area 0.0.0.0 interface 10.9.9.2 metric 1 set protocols ospf area 0.0.0.0 interface 10.100.1.2 passive set protocols ospf area 0.0.0.0 interface 10.100.1.2 metric 1 set routing-options router-id 10.9.9.2 set routing-options autonomous-system 13979 设备 P2 set interfaces fe-1/2/0 unit 3 description P2-to-PE1 set interfaces fe-1/2/0 unit 3 family inet address 10.0.0.6/30 set interfaces fe-1/2/0 unit 3 family mpls set interfaces fe-1/2/1 unit 5 description P2-to-P1 set interfaces fe-1/2/1 unit 5 family inet address 10.0.0.30/30 set interfaces fe-1/2/1 unit 5 family mpls set interfaces fe-1/2/2 unit 6 description P2-to-PE4 set interfaces fe-1/2/2 unit 6 family inet address 10.0.0.13/30 set interfaces fe-1/2/2 unit 6 family mpls set interfaces lo0 unit 5 family inet address 10.9.9.3/32 set interfaces lo0 unit 5 family inet address 10.100.1.3/32 set protocols rsvp interface fe-1/2/1.5 set protocols rsvp interface fe-1/2/2.6 set protocols rsvp interface fe-1/2/0.3 set protocols mpls label-switched-path P2-to-PE1 to 10.9.9.1 set protocols mpls label-switched-path P2-to-P1 to 10.9.9.2 set protocols mpls label-switched-path P2-to-PE4 to 10.9.9.4 set protocols mpls interface fe-1/2/1.5 set protocols mpls interface fe-1/2/2.6 set protocols mpls interface fe-1/2/0.3 set protocols bgp group internal type internal set protocols bgp group internal local-address 10.9.9.3 set protocols bgp group internal family inet labeled-unicast aigp set protocols bgp group internal neighbor 10.9.9.1 set protocols bgp group internal neighbor 10.9.9.2 set protocols bgp group internal neighbor 10.9.9.4 set protocols ospf area 0.0.0.0 interface fe-1/2/2.6 metric 1 set protocols ospf area 0.0.0.0 interface 10.9.9.3 passive set protocols ospf area 0.0.0.0 interface 10.9.9.3 metric 1 set protocols ospf area 0.0.0.0 interface 10.100.1.3 passive set protocols ospf area 0.0.0.0 interface 10.100.1.3 metric 1 set routing-options router-id 10.9.9.3 set routing-options autonomous-system 13979 设备 PE4 set interfaces fe-1/2/0 unit 7 description PE4-to-P2 set interfaces fe-1/2/0 unit 7 family inet address 10.0.0.14/30 set interfaces fe-1/2/0 unit 7 family mpls set interfaces fe-1/2/1 unit 9 description PE4-to-P1 set interfaces fe-1/2/1 unit 9 family inet address 10.0.0.18/30 set interfaces fe-1/2/1 unit 9 family mpls set interfaces fe-1/2/2 unit 10 description PE4-to-PE2 set interfaces fe-1/2/2 unit 10 family inet address 10.0.0.21/30 set interfaces fe-1/2/2 unit 10 family mpls set interfaces fe-1/0/2 unit 12 description PE4-to-PE3 set interfaces fe-1/0/2 unit 12 family inet address 10.0.0.25/30 set interfaces fe-1/0/2 unit 12 family mpls set interfaces lo0 unit 7 family inet address 10.9.9.4/32 set interfaces lo0 unit 7 family inet address 10.100.1.4/32 set protocols rsvp interface fe-1/2/0.7 set protocols rsvp interface fe-1/2/1.9 set protocols rsvp interface fe-1/2/2.10 set protocols rsvp interface fe-1/0/2.12 set protocols mpls label-switched-path PE4-to-PE2 to 10.9.9.5 set protocols mpls label-switched-path PE4-to-PE3 to 10.9.9.6 set protocols mpls label-switched-path PE4-to-P1 to 10.9.9.2 set protocols mpls label-switched-path PE4-to-P2 to 10.9.9.3 set protocols mpls interface fe-1/2/0.7 set protocols mpls interface fe-1/2/1.9 set protocols mpls interface fe-1/2/2.10 set protocols mpls interface fe-1/0/2.12 set protocols bgp export next-hop set protocols bgp export aigp set protocols bgp group internal type internal set protocols bgp group internal local-address 10.9.9.4 set protocols bgp group internal family inet labeled-unicast aigp set protocols bgp group internal neighbor 10.9.9.1 set protocols bgp group internal neighbor 10.9.9.3 set protocols bgp group internal neighbor 10.9.9.2 set protocols bgp group external type external set protocols bgp group external multihop ttl 2 set protocols bgp group external local-address 10.9.9.4 set protocols bgp group external family inet labeled-unicast aigp set protocols bgp group external peer-as 7018 set protocols bgp group external neighbor 10.9.9.5 set protocols bgp group external neighbor 10.9.9.6 set protocols ospf area 0.0.0.0 interface fe-1/2/1.9 metric 1 set protocols ospf area 0.0.0.0 interface fe-1/2/0.7 metric 1 set protocols ospf area 0.0.0.0 interface 10.9.9.4 passive set protocols ospf area 0.0.0.0 interface 10.9.9.4 metric 1 set protocols ospf area 0.0.0.0 interface 10.100.1.4 passive set protocols ospf area 0.0.0.0 interface 10.100.1.4 metric 1 set protocols ospf area 0.0.0.2 interface fe-1/2/2.10 metric 1 set protocols ospf area 0.0.0.3 interface fe-1/0/2.12 metric 1 set policy-options policy-statement aigp term 10 from protocol static set policy-options policy-statement aigp term 10 from route-filter 44.0.0.0/24 exact set policy-options policy-statement aigp term 10 then aigp-originate distance 200 set policy-options policy-statement aigp term 10 then next-hop 10.100.1.4 set policy-options policy-statement aigp term 10 then accept set policy-options policy-statement next-hop term 10 from protocol bgp set policy-options policy-statement next-hop term 10 then next-hop 10.100.1.4 set policy-options policy-statement next-hop term 10 then accept set policy-options policy-statement next-hop term 20 from protocol direct set policy-options policy-statement next-hop term 20 from route-filter 10.9.9.4/32 exact set policy-options policy-statement next-hop term 20 from route-filter 10.100.1.4/32 exact set policy-options policy-statement next-hop term 20 then next-hop 10.100.1.4 set policy-options policy-statement next-hop term 20 then accept set routing-options static route 44.0.0.0/24 discard set routing-options router-id 10.9.9.4 set routing-options autonomous-system 13979 设备 PE1 set interfaces fe-1/2/0 unit 0 description PE1-to-P1 set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.1/30 set interfaces fe-1/2/0 unit 0 family mpls set interfaces fe-1/2/1 unit 2 description PE1-to-P2 set interfaces fe-1/2/1 unit 2 family inet address 10.0.0.5/30 set interfaces fe-1/2/1 unit 2 family mpls set interfaces fe-1/2/2 unit 14 description PE1-to-PE7 set interfaces fe-1/2/2 unit 14 family inet address 10.0.0.9/30 set interfaces lo0 unit 1 family inet address 10.9.9.1/32 set interfaces lo0 unit 1 family inet address 10.100.1.1/32 set protocols rsvp interface fe-1/2/0.0 set protocols rsvp interface fe-1/2/1.2 set protocols rsvp interface fe-1/2/2.14 set protocols mpls label-switched-path PE1-to-P1 to 10.9.9.2 set protocols mpls label-switched-path PE1-to-P2 to 10.9.9.3 set protocols mpls interface fe-1/2/0.0 set protocols mpls interface fe-1/2/1.2 set protocols mpls interface fe-1/2/2.14 set protocols bgp group internal type internal set protocols bgp group internal local-address 10.9.9.1 set protocols bgp group internal family inet labeled-unicast aigp set protocols bgp group internal export SET_EXPORT_ROUTES set protocols bgp group internal vpn-apply-export set protocols bgp group internal neighbor 10.9.9.4 set protocols bgp group internal neighbor 10.9.9.2 set protocols bgp group internal neighbor 10.9.9.3 set protocols bgp group external type external set protocols bgp group external family inet labeled-unicast aigp set protocols bgp group external export SET_EXPORT_ROUTES set protocols bgp group external peer-as 7019 set protocols bgp group external neighbor 10.0.0.10 set protocols ospf area 0.0.0.1 interface fe-1/2/0.0 metric 1 set protocols ospf area 0.0.0.1 interface fe-1/2/1.2 metric 1 set protocols ospf area 0.0.0.1 interface 10.9.9.1 passive set protocols ospf area 0.0.0.1 interface 10.9.9.1 metric 1 set protocols ospf area 0.0.0.1 interface 10.100.1.1 passive set protocols ospf area 0.0.0.1 interface 10.100.1.1 metric 1 set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp set policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.1 set policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept set routing-options router-id 10.9.9.1 set routing-options autonomous-system 13979 设备 PE2 set interfaces fe-1/2/0 unit 11 description PE2-to-PE4 set interfaces fe-1/2/0 unit 11 family inet address 10.0.0.22/30 set interfaces fe-1/2/0 unit 11 family mpls set interfaces lo0 unit 9 family inet address 10.9.9.5/32 primary set interfaces lo0 unit 9 family inet address 10.100.1.5/32 set protocols rsvp interface fe-1/2/0.11 set protocols mpls label-switched-path PE2-to-PE4 to 10.9.9.4 set protocols mpls interface fe-1/2/0.11 set protocols bgp group external type external set protocols bgp group external multihop ttl 2 set protocols bgp group external local-address 10.9.9.5 set protocols bgp group external family inet labeled-unicast aigp set protocols bgp group external export next-hop set protocols bgp group external export aigp set protocols bgp group external export SET_EXPORT_ROUTES set protocols bgp group external vpn-apply-export set protocols bgp group external peer-as 13979 set protocols bgp group external neighbor 10.9.9.4 set protocols ospf area 0.0.0.2 interface 10.9.9.5 passive set protocols ospf area 0.0.0.2 interface 10.9.9.5 metric 1 set protocols ospf area 0.0.0.2 interface 10.100.1.5 passive set protocols ospf area 0.0.0.2 interface 10.100.1.5 metric 1 set protocols ospf area 0.0.0.2 interface fe-1/2/0.11 metric 1 set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol static set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp set policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.5 set policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept set policy-options policy-statement aigp term 10 from route-filter 55.0.0.0/24 exact set policy-options policy-statement aigp term 10 then aigp-originate distance 20 set policy-options policy-statement aigp term 10 then next-hop 10.100.1.5 set policy-options policy-statement aigp term 10 then accept set policy-options policy-statement aigp term 20 from route-filter 99.0.0.0/24 exact set policy-options policy-statement aigp term 20 then aigp-originate distance 30 set policy-options policy-statement aigp term 20 then next-hop 10.100.1.5 set policy-options policy-statement aigp term 20 then accept set policy-options policy-statement next-hop term 10 from protocol bgp set policy-options policy-statement next-hop term 10 then next-hop 10.100.1.5 set policy-options policy-statement next-hop term 10 then accept set policy-options policy-statement next-hop term 20 from protocol direct set policy-options policy-statement next-hop term 20 from route-filter 10.9.9.5/32 exact set policy-options policy-statement next-hop term 20 from route-filter 10.100.1.5/32 exact set policy-options policy-statement next-hop term 20 then next-hop 10.100.1.5 set policy-options policy-statement next-hop term 20 then accept set routing-options static route 99.0.0.0/24 discard set routing-options static route 55.0.0.0/24 discard set routing-options router-id 10.9.9.5 set routing-options autonomous-system 7018 设备 PE3 set interfaces fe-1/2/0 unit 13 description PE3-to-PE4 set interfaces fe-1/2/0 unit 13 family inet address 10.0.0.26/30 set interfaces fe-1/2/0 unit 13 family mpls set interfaces lo0 unit 11 family inet address 10.9.9.6/32 set interfaces lo0 unit 11 family inet address 10.100.1.6/32 set protocols rsvp interface fe-1/2/0.13 set protocols mpls label-switched-path PE3-to-PE4 to 10.9.9.4 set protocols mpls interface fe-1/2/0.13 set protocols bgp group external type external set protocols bgp group external multihop ttl 2 set protocols bgp group external local-address 10.9.9.6 set protocols bgp group external family inet labeled-unicast aigp set protocols bgp group external export next-hop set protocols bgp group external export SET_EXPORT_ROUTES set protocols bgp group external vpn-apply-export set protocols bgp group external peer-as 13979 set protocols bgp group external neighbor 10.9.9.4 set protocols ospf area 0.0.0.3 interface 10.9.9.6 passive set protocols ospf area 0.0.0.3 interface 10.9.9.6 metric 1 set protocols ospf area 0.0.0.3 interface 10.100.1.6 passive set protocols ospf area 0.0.0.3 interface 10.100.1.6 metric 1 set protocols ospf area 0.0.0.3 interface fe-1/2/0.13 metric 1 set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol static set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp set policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.6 set policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept set policy-options policy-statement next-hop term 10 from protocol bgp set policy-options policy-statement next-hop term 10 then next-hop 10.100.1.6 set policy-options policy-statement next-hop term 10 then accept set policy-options policy-statement next-hop term 20 from protocol direct set policy-options policy-statement next-hop term 20 from route-filter 10.9.9.6/32 exact set policy-options policy-statement next-hop term 20 from route-filter 10.100.1.6/32 exact set policy-options policy-statement next-hop term 20 then next-hop 10.100.1.6 set policy-options policy-statement next-hop term 20 then accept set routing-options router-id 10.9.9.6 set routing-options autonomous-system 7018 设备 PE7 set interfaces fe-1/2/0 unit 15 description PE7-to-PE1 set interfaces fe-1/2/0 unit 15 family inet address 10.0.0.10/30 set interfaces lo0 unit 13 family inet address 10.9.9.7/32 set interfaces lo0 unit 13 family inet address 10.100.1.7/32 set protocols bgp group external type external set protocols bgp group external family inet labeled-unicast aigp set protocols bgp group external export SET_EXPORT_ROUTES set protocols bgp group external peer-as 13979 set protocols bgp group external neighbor 10.0.0.9 set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp set policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.7 set policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept set routing-options router-id 10.9.9.7 set routing-options autonomous-system 7019 下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 P1： 配置接口。 [edit interfaces] user@P1# set fe-1/2/0 unit 1 description P1-to-PE1 user@P1# set fe-1/2/0 unit 1 family inet address 10.0.0.2/30 user@P1# set fe-1/2/0 unit 1 family mpls user@P1# set fe-1/2/1 unit 4 description P1-to-P2 user@P1# set fe-1/2/1 unit 4 family inet address 10.0.0.29/30 user@P1# set fe-1/2/1 unit 4 family mpls user@P1# set fe-1/2/2 unit 8 description P1-to-PE4 user@P1# set fe-1/2/2 unit 8 family inet address 10.0.0.17/30 user@P1# set fe-1/2/2 unit 8 family mpls user@P1# set lo0 unit 3 family inet address 10.9.9.2/32 user@P1# set lo0 unit 3 family inet address 10.100.1.2/32 配置 MPLS 和信令协议，例如 RSVP 或 LDP。 [edit protocols] user@P1# set rsvp interface fe-1/2/0.1 user@P1# set rsvp interface fe-1/2/2.8 user@P1# set rsvp interface fe-1/2/1.4 user@P1# set mpls label-switched-path P1-to-P2 to 10.9.9.3 user@P1# set mpls label-switched-path P1-to-PE1 to 10.9.9.1 user@P1# set mpls label-switched-path P1-to-PE4 to 10.9.9.4 user@P1# set mpls interface fe-1/2/0.1 user@P1# set mpls interface fe-1/2/2.8 user@P1# set mpls interface fe-1/2/1.4 配置 BGP。 [edit protocols bgp group internal] user@P1# set type internal user@P1# set local-address 10.9.9.2 user@P1# set neighbor 10.9.9.1 user@P1# set neighbor 10.9.9.3 user@P1# set neighbor 10.9.9.4 启用 AIGP。 [edit protocols bgp group internal] user@P1# set family inet labeled-unicast aigp 配置 IGP，例如 OSPF、RIP 或 IS-IS。 [edit protocols ospf] user@P1# set area 0.0.0.1 interface fe-1/2/0.1 metric 1 user@P1# set area 0.0.0.1 interface fe-1/2/1.4 metric 1 user@P1# set area 0.0.0.0 interface fe-1/2/2.8 metric 1 user@P1# set area 0.0.0.0 interface 10.9.9.2 passive user@P1# set area 0.0.0.0 interface 10.9.9.2 metric 1 user@P1# set area 0.0.0.0 interface 10.100.1.2 passive user@P1# set area 0.0.0.0 interface 10.100.1.2 metric 1 配置路由器 ID 和自治系统编号。 [edit routing-options] user@P1# set router-id 10.9.9.2 user@P1# set autonomous-system 13979 如果完成设备配置，请提交配置。 user@P1# commit 在配置模式下，输入 show interfaces 、 show protocols 和 show routing-options 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@P1# show interfaces fe-1/2/0 { unit 1 { description P1-to-PE1; family inet { address 10.0.0.2/30; } family mpls; } } fe-1/2/1 { unit 4 { description P1-to-P2; family inet { address 10.0.0.29/30; } family mpls; } } fe-1/2/2 { unit 8 { description P1-to-PE4; family inet { address 10.0.0.17/30; } family mpls; } } lo0 { unit 3 { family inet { address 10.9.9.2/32; address 10.100.1.2/32; } } } user@P1# show protocols rsvp { interface fe-1/2/0.1; interface fe-1/2/2.8; interface fe-1/2/1.4; } mpls { label-switched-path P1-to-P2 { to 10.9.9.3; } label-switched-path P1-to-PE1 { to 10.9.9.1; } label-switched-path P1-to-PE4 { to 10.9.9.4; } interface fe-1/2/0.1; interface fe-1/2/2.8; interface fe-1/2/1.4; } bgp { group internal { type internal; local-address 10.9.9.2; family inet { labeled-unicast { aigp; } } neighbor 10.9.9.1; neighbor 10.9.9.3; neighbor 10.9.9.4; } } ospf { area 0.0.0.1 { interface fe-1/2/0.1 { metric 1; } interface fe-1/2/1.4 { metric 1; } } area 0.0.0.0 { interface fe-1/2/2.8 { metric 1; } interface 10.9.9.2 { passive; metric 1; } interface 10.100.1.2 { passive; metric 1; } } } user@P1# show routing-options router-id 10.9.9.2; autonomous-system 13979; 要配置设备 P2： [edit interfaces] user@P2# set fe-1/2/0 unit 3 description P2-to-PE1 user@P2# set fe-1/2/0 unit 3 family inet address 10.0.0.6/30 user@P2# set fe-1/2/0 unit 3 family mpls user@P2# set fe-1/2/1 unit 5 description P2-to-P1 user@P2# set fe-1/2/1 unit 5 family inet address 10.0.0.30/30 user@P2# set fe-1/2/1 unit 5 family mpls user@P2# set fe-1/2/2 unit 6 description P2-to-PE4 user@P2# set fe-1/2/2 unit 6 family inet address 10.0.0.13/30 user@P2# set fe-1/2/2 unit 6 family mpls user@P2# set lo0 unit 5 family inet address 10.9.9.3/32 user@P2# set lo0 unit 5 family inet address 10.100.1.3/32 [edit protocols] user@P2# set rsvp interface fe-1/2/1.5 user@P2# set rsvp interface fe-1/2/2.6 user@P2# set rsvp interface fe-1/2/0.3 user@P2# set mpls label-switched-path P2-to-PE1 to 10.9.9.1 user@P2# set mpls label-switched-path P2-to-P1 to 10.9.9.2 user@P2# set mpls label-switched-path P2-to-PE4 to 10.9.9.4 user@P2# set mpls interface fe-1/2/1.5 user@P2# set mpls interface fe-1/2/2.6 user@P2# set mpls interface fe-1/2/0.3 [edit protocols bgp group internal] user@P2# set type internal user@P2# set local-address 10.9.9.3 user@P2# set neighbor 10.9.9.1 user@P2# set neighbor 10.9.9.2 user@P2# set neighbor 10.9.9.4 [edit protocols bgp group internal] user@P2# set family inet labeled-unicast aigp [edit protocols ospf] user@P2# set area 0.0.0.0 interface fe-1/2/2.6 metric 1 user@P2# set area 0.0.0.0 interface 10.9.9.3 passive user@P2# set area 0.0.0.0 interface 10.9.9.3 metric 1 user@P2# set area 0.0.0.0 interface 10.100.1.3 passive user@P2# set area 0.0.0.0 interface 10.100.1.3 metric 1 [edit routing-options] user@P2# set router-id 10.9.9.3 user@P2# set autonomous-system 13979 user@P2# commit user@P2# show interfaces fe-1/2/0 { unit 3 { description P2-to-PE1; family inet { address 10.0.0.6/30; } family mpls; } } fe-1/2/1 { unit 5 { description P2-to-P1; family inet { address 10.0.0.30/30; } family mpls; } } fe-1/2/2 { unit 6 { description P2-to-PE4; family inet { address 10.0.0.13/30; } family mpls; } } lo0 { unit 5 { family inet { address 10.9.9.3/32; address 10.100.1.3/32; } } } user@P2# show protocols rsvp { interface fe-1/2/1.5; interface fe-1/2/2.6; interface fe-1/2/0.3; } mpls { label-switched-path P2-to-PE1 { to 10.9.9.1; } label-switched-path P2-to-P1 { to 10.9.9.2; } label-switched-path P2-to-PE4 { to 10.9.9.4; } interface fe-1/2/1.5; interface fe-1/2/2.6; interface fe-1/2/0.3; } bgp { group internal { type internal; local-address 10.9.9.3; family inet { labeled-unicast { aigp; } } neighbor 10.9.9.1; neighbor 10.9.9.2; neighbor 10.9.9.4; } } ospf { area 0.0.0.0 { interface fe-1/2/2.6 { metric 1; } interface 10.9.9.3 { passive; metric 1; } interface 10.100.1.3 { passive; metric 1; } } } user@P2# show routing-options router-id 10.9.9.3; autonomous-system 13979; 要配置设备 PE4： [edit interfaces] user@PE4# set fe-1/2/0 unit 7 description PE4-to-P2 user@PE4# set fe-1/2/0 unit 7 family inet address 10.0.0.14/30 user@PE4# set fe-1/2/0 unit 7 family mpls user@PE4# set fe-1/2/1 unit 9 description PE4-to-P1 user@PE4# set fe-1/2/1 unit 9 family inet address 10.0.0.18/30 user@PE4# set fe-1/2/1 unit 9 family mpls user@PE4# set fe-1/2/2 unit 10 description PE4-to-PE2 user@PE4# set fe-1/2/2 unit 10 family inet address 10.0.0.21/30 user@PE4# set fe-1/2/2 unit 10 family mpls user@PE4# set fe-1/0/2 unit 12 description PE4-to-PE3 user@PE4# set fe-1/0/2 unit 12 family inet address 10.0.0.25/30 user@PE4# set fe-1/0/2 unit 12 family mpls user@PE4# set lo0 unit 7 family inet address 10.9.9.4/32 user@PE4# set lo0 unit 7 family inet address 10.100.1.4/32 [edit protocols] user@PE4# set rsvp interface fe-1/2/0.7 user@PE4# set rsvp interface fe-1/2/1.9 user@PE4# set rsvp interface fe-1/2/2.10 user@PE4# set rsvp interface fe-1/0/2.12 user@PE4# set mpls label-switched-path PE4-to-PE2 to 10.9.9.5 user@PE4# set mpls label-switched-path PE4-to-PE3 to 10.9.9.6 user@PE4# set mpls label-switched-path PE4-to-P1 to 10.9.9.2 user@PE4# set mpls label-switched-path PE4-to-P2 to 10.9.9.3 user@PE4# set mpls interface fe-1/2/0.7 user@PE4# set mpls interface fe-1/2/1.9 user@PE4# set mpls interface fe-1/2/2.10 user@PE4# set mpls interface fe-1/0/2.12 [edit protocols bgp] user@PE4# set export next-hop user@PE4# set export aigp user@PE4# set group internal type internal user@PE4# set group internal local-address 10.9.9.4 user@PE4# set group internal neighbor 10.9.9.1 user@PE4# set group internal neighbor 10.9.9.3 user@PE4# set group internal neighbor 10.9.9.2 user@PE4# set group external type external user@PE4# set group external multihop ttl 2 user@PE4# set group external local-address 10.9.9.4 user@PE4# set group external peer-as 7018 user@PE4# set group external neighbor 10.9.9.5 user@PE4# set group external neighbor 10.9.9.6 [edit protocols bgp] user@PE4# set group external family inet labeled-unicast aigp user@PE4# set group internal family inet labeled-unicast aigp 发起前缀，并配置 AIGP 距离。 默认情况下，前缀是使用当前 IGP 距离发起的。或者，您可以使用选项 distance 为 AIGP 属性配置距离，如下所示。 [edit policy-options policy-statement aigp term 10] user@PE4# set from protocol static user@PE4# set from route-filter 44.0.0.0/24 exact user@PE4# set then aigp-originate distance 200 user@PE4# set then next-hop 10.100.1.4 user@PE4# set then accept 启用策略。 [edit policy-options policy-statement next-hop] user@PE4# set term 10 from protocol bgp user@PE4# set term 10 then next-hop 10.100.1.4 user@PE4# set term 10 then accept user@PE4# set term 20 from protocol direct user@PE4# set term 20 from route-filter 10.9.9.4/32 exact user@PE4# set term 20 from route-filter 10.100.1.4/32 exact user@PE4# set term 20 then next-hop 10.100.1.4 user@PE4# set term 20 then accept 配置静态路由。 [edit routing-options] user@PE4# set static route 44.0.0.0/24 discard [edit protocols ospf] user@PE4# set area 0.0.0.0 interface fe-1/2/1.9 metric 1 user@PE4# set area 0.0.0.0 interface fe-1/2/0.7 metric 1 user@PE4# set area 0.0.0.0 interface 10.9.9.4 passive user@PE4# set area 0.0.0.0 interface 10.9.9.4 metric 1 user@PE4# set area 0.0.0.0 interface 10.100.1.4 passive user@PE4# set area 0.0.0.0 interface 10.100.1.4 metric 1 user@PE4# set area 0.0.0.2 interface fe-1/2/2.10 metric 1 user@PE4# set area 0.0.0.3 interface fe-1/0/2.12 metric 1 [edit routing-options] user@PE4# set router-id 10.9.9.4 user@PE4# set autonomous-system 13979 user@PE4# commit 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@PE4# show interfaces fe-1/0/2 { unit 12 { description PE4-to-PE3; family inet { address 10.0.0.25/30; } family mpls; } } fe-1/2/0 { unit 7 { description PE4-to-P2; family inet { address 10.0.0.14/30; } family mpls; } } fe-1/2/1 { unit 9 { description PE4-to-P1; family inet { address 10.0.0.18/30; } family mpls; } } fe-1/2/2 { unit 10 { description PE4-to-PE2; family inet { address 10.0.0.21/30; } family mpls; } } lo0 { unit 7 { family inet { address 10.9.9.4/32; address 10.100.1.4/32; } } } user@PE4# show policy-options policy-statement aigp { term 10 { from { protocol static; route-filter 44.0.0.0/24 exact; } then { aigp-originate distance 200; next-hop 10.100.1.4; accept; } } } policy-statement next-hop { term 10 { from protocol bgp; then { next-hop 10.100.1.4; accept; } } term 20 { from { protocol direct; route-filter 10.9.9.4/32 exact; route-filter 10.100.1.4/32 exact; } then { next-hop 10.100.1.4; accept; } } } user@PE4# show protocols rsvp { interface fe-1/2/0.7; interface fe-1/2/1.9; interface fe-1/2/2.10; interface fe-1/0/2.12; } mpls { label-switched-path PE4-to-PE2 { to 10.9.9.5; } label-switched-path PE4-to-PE3 { to 10.9.9.6; } label-switched-path PE4-to-P1 { to 10.9.9.2; } label-switched-path PE4-to-P2 { to 10.9.9.3; } interface fe-1/2/0.7; interface fe-1/2/1.9; interface fe-1/2/2.10; interface fe-1/0/2.12; } bgp { export [ next-hop aigp ]; group internal { type internal; local-address 10.9.9.4; family inet { labeled-unicast { aigp; } } neighbor 10.9.9.1; neighbor 10.9.9.3; neighbor 10.9.9.2; } group external { type external; multihop { ttl 2; } local-address 10.9.9.4; family inet { labeled-unicast { aigp; } } peer-as 7018; neighbor 10.9.9.5; neighbor 10.9.9.6; } } ospf { area 0.0.0.0 { interface fe-1/2/1.9 { metric 1; } interface fe-1/2/0.7 { metric 1; } interface 10.9.9.4 { passive; metric 1; } interface 10.100.1.4 { passive; metric 1; } } area 0.0.0.2 { interface fe-1/2/2.10 { metric 1; } } area 0.0.0.3 { interface fe-1/0/2.12 { metric 1; } } } user@PE4# show routing-options static { route 44.0.0.0/24 discard; } router-id 10.9.9.4; autonomous-system 13979; 要配置设备 PE1： [edit interfaces] user@PE1# set fe-1/2/0 unit 0 description PE1-to-P1 user@PE1# set fe-1/2/0 unit 0 family inet address 10.0.0.1/30 user@PE1# set fe-1/2/0 unit 0 family mpls user@PE1# set fe-1/2/1 unit 2 description PE1-to-P2 user@PE1# set fe-1/2/1 unit 2 family inet address 10.0.0.5/30 user@PE1# set fe-1/2/1 unit 2 family mpls user@PE1# set fe-1/2/2 unit 14 description PE1-to-PE7 user@PE1# set fe-1/2/2 unit 14 family inet address 10.0.0.9/30 user@PE1# set lo0 unit 1 family inet address 10.9.9.1/32 user@PE1# set lo0 unit 1 family inet address 10.100.1.1/32 [edit protocols] user@PE1# set rsvp interface fe-1/2/0.0 user@PE1# set rsvp interface fe-1/2/1.2 user@PE1# set rsvp interface fe-1/2/2.14 user@PE1# set mpls label-switched-path PE1-to-P1 to 10.9.9.2 user@PE1# set mpls label-switched-path PE1-to-P2 to 10.9.9.3 user@PE1# set mpls interface fe-1/2/0.0 user@PE1# set mpls interface fe-1/2/1.2 user@PE1# set mpls interface fe-1/2/2.14 [edit protocols bgp] user@PE1# set group internal type internal user@PE1# set group internal local-address 10.9.9.1 user@PE1# set group internal export SET_EXPORT_ROUTES user@PE1# set group internal vpn-apply-export user@PE1# set group internal neighbor 10.9.9.4 user@PE1# set group internal neighbor 10.9.9.2 user@PE1# set group internal neighbor 10.9.9.3 user@PE1# set group external type external user@PE1# set group external export SET_EXPORT_ROUTES user@PE1# set group external peer-as 7019 user@PE1# set group external neighbor 10.0.0.10 [edit protocols bgp] user@PE1# set group internal family inet labeled-unicast aigp user@PE1# set group external family inet labeled-unicast aigp [edit policy-options policy-statement SET_EXPORT_ROUTES term 10] user@PE1# set from protocol direct user@PE1# set from protocol bgp user@PE1# set then next-hop 10.100.1.1 user@PE1# set then accept [edit protocols ospf area 0.0.0.1] user@PE1# set interface fe-1/2/0.0 metric 1 user@PE1# set interface fe-1/2/1.2 metric 1 user@PE1# set interface 10.9.9.1 passive user@PE1# set interface 10.9.9.1 metric 1 user@PE1# set interface 10.100.1.1 passive user@PE1# set interface 10.100.1.1 metric 1 [edit routing-options] user@PE1# set router-id 10.9.9.1 user@PE1# set autonomous-system 13979 user@PE1# commit user@PE1# show interfaces fe-1/2/0 { unit 0 { description PE1-to-P1; family inet { address 10.0.0.1/30; } family mpls; } } fe-1/2/1 { unit 2 { description PE1-to-P2; family inet { address 10.0.0.5/30; } family mpls; } } fe-1/2/2 { unit 14 { description PE1-to-PE7; family inet { address 10.0.0.9/30; } } } lo0 { unit 1 { family inet { address 10.9.9.1/32; address 10.100.1.1/32; } } } user@PE1# show policy-options policy-statement SET_EXPORT_ROUTES { term 10 { from protocol [ direct bgp ]; then { next-hop 10.100.1.1; accept; } } } user@PE1# show protocols rsvp { interface fe-1/2/0.0; interface fe-1/2/1.2; interface fe-1/2/2.14; } mpls { label-switched-path PE1-to-P1 { to 10.9.9.2; } label-switched-path PE1-to-P2 { to 10.9.9.3; } interface fe-1/2/0.0; interface fe-1/2/1.2; interface fe-1/2/2.14; } bgp { group internal { type internal; local-address 10.9.9.1; family inet { labeled-unicast { aigp; } } export SET_EXPORT_ROUTES; vpn-apply-export; neighbor 10.9.9.4; neighbor 10.9.9.2; neighbor 10.9.9.3; } group external { type external; family inet { labeled-unicast { aigp; } } export SET_EXPORT_ROUTES; peer-as 7019; neighbor 10.0.0.10; } } ospf { area 0.0.0.1 { interface fe-1/2/0.0 { metric 1; } interface fe-1/2/1.2 { metric 1; } interface 10.9.9.1 { passive; metric 1; } interface 10.100.1.1 { passive; metric 1; } } } user@PE1# show routing-options router-id 10.9.9.1; autonomous-system 13979; 要配置设备 PE2： [edit interfaces] user@PE2# set fe-1/2/0 unit 11 description PE2-to-PE4 user@PE2# set fe-1/2/0 unit 11 family inet address 10.0.0.22/30 user@PE2# set fe-1/2/0 unit 11 family mpls user@PE2# set lo0 unit 9 family inet address 10.9.9.5/32 primary user@PE2# set lo0 unit 9 family inet address 10.100.1.5/32 [edit protocols] user@PE2# set rsvp interface fe-1/2/0.11 user@PE2# set mpls label-switched-path PE2-to-PE4 to 10.9.9.4 user@PE2# set mpls interface fe-1/2/0.11 [edit protocols bgp] user@PE2# set group external type external user@PE2# set group external multihop ttl 2 user@PE2# set group external local-address 10.9.9.5 user@PE2# set group external export next-hop user@PE2# set group external export aigp user@PE2# set group external export SET_EXPORT_ROUTES user@PE2# set group external vpn-apply-export user@PE2# set group external peer-as 13979 user@PE2# set group external neighbor 10.9.9.4 [edit protocols bgp] user@PE2# set group external family inet labeled-unicast aigp [edit policy-options policy-statement aigp] user@PE2# set term 10 from route-filter 55.0.0.0/24 exact user@PE2# set term 10 then aigp-originate distance 20 user@PE2# set term 10 then next-hop 10.100.1.5 user@PE2# set term 10 then accept user@PE2# set term 20 from route-filter 99.0.0.0/24 exact user@PE2# set term 20 then aigp-originate distance 30 user@PE2# set term 20 then next-hop 10.100.1.5 user@PE2# set term 20 then accept [edit policy-options] user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 from protocol direct user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 from protocol static user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.5 user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 then accept user@PE2# set policy-statement next-hop term 10 from protocol bgp user@PE2# set policy-statement next-hop term 10 then next-hop 10.100.1.5 user@PE2# set policy-statement next-hop term 10 then accept user@PE2# set policy-statement next-hop term 20 from protocol direct user@PE2# set policy-statement next-hop term 20 from route-filter 10.9.9.5/32 exact user@PE2# set policy-statement next-hop term 20 from route-filter 10.100.1.5/32 exact user@PE2# set policy-statement next-hop term 20 then next-hop 10.100.1.5 user@PE2# set policy-statement next-hop term 20 then accept 启用一些静态路由。 [edit routing-options] user@PE2# set static route 99.0.0.0/24 discard user@PE2# set static route 55.0.0.0/24 discard [edit protocols ospf area 0.0.0.2] user@PE2# set interface 10.9.9.5 passive user@PE2# set interface 10.9.9.5 metric 1 user@PE2# set interface 10.100.1.5 passive user@PE2# set interface 10.100.1.5 metric 1 user@PE2# set interface fe-1/2/0.11 metric 1 [edit routing-options] user@PE2# set router-id 10.9.9.5 user@PE2# set autonomous-system 7018 user@PE2# commit user@PE2# show interfaces fe-1/2/0 { unit 11 { description PE2-to-PE4; family inet { address 10.0.0.22/30; } family mpls; } } lo0 { unit 9 { family inet { address 10.9.9.5/32 { primary; } address 10.100.1.5/32; } } } user@PE2# show policy-options policy-statement SET_EXPORT_ROUTES { term 10 { from protocol [ direct static bgp ]; then { next-hop 10.100.1.5; accept; } } } policy-statement aigp { term 10 { from { route-filter 55.0.0.0/24 exact; } then { aigp-originate distance 20; next-hop 10.100.1.5; accept; } } term 20 { from { route-filter 99.0.0.0/24 exact; } then { aigp-originate distance 30; next-hop 10.100.1.5; accept; } } } policy-statement next-hop { term 10 { from protocol bgp; then { next-hop 10.100.1.5; accept; } } term 20 { from { protocol direct; route-filter 10.9.9.5/32 exact; route-filter 10.100.1.5/32 exact; } then { next-hop 10.100.1.5; accept; } } } user@PE2# show protocols rsvp { interface fe-1/2/0.11; } mpls { label-switched-path PE2-to-PE4 { to 10.9.9.4; } interface fe-1/2/0.11; } bgp { group external { type external; multihop { ttl 2; } local-address 10.9.9.5; family inet { labeled-unicast { aigp; } } export [ next-hop aigp SET_EXPORT_ROUTES ]; vpn-apply-export; peer-as 13979; neighbor 10.9.9.4; } } ospf { area 0.0.0.2 { interface 10.9.9.5 { passive; metric 1; } interface 10.100.1.5 { passive; metric 1; } interface fe-1/2/0.11 { metric 1; } } } user@PE2# show routing-options static { route 99.0.0.0/24 discard; route 55.0.0.0/24 discard; } router-id 10.9.9.5; autonomous-system 7018; 要配置设备 PE3： [edit interfaces] user@PE3# set fe-1/2/0 unit 13 description PE3-to-PE4 user@PE3# set fe-1/2/0 unit 13 family inet address 10.0.0.26/30 user@PE3# set fe-1/2/0 unit 13 family mpls user@PE3# set lo0 unit 11 family inet address 10.9.9.6/32 user@PE3# set lo0 unit 11 family inet address 10.100.1.6/32 [edit protocols] user@PE3# set rsvp interface fe-1/2/0.13 user@PE3# set mpls label-switched-path PE3-to-PE4 to 10.9.9.4 user@PE3# set mpls interface fe-1/2/0.13 [edit protocols bgp group external] user@PE3# set type external user@PE3# set multihop ttl 2 user@PE3# set local-address 10.9.9.6 user@PE3# set export next-hop user@PE3# set export SET_EXPORT_ROUTES user@PE3# set vpn-apply-export user@PE3# set peer-as 13979 user@PE3# set neighbor 10.9.9.4 [edit protocols bgp group external] user@PE3# set family inet labeled-unicast aigp [edit policy-options] user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 from protocol direct user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 from protocol static user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.6 user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 then accept user@PE3# set policy-statement next-hop term 10 from protocol bgp user@PE3# set policy-statement next-hop term 10 then next-hop 10.100.1.6 user@PE3# set policy-statement next-hop term 10 then accept user@PE3# set policy-statement next-hop term 20 from protocol direct user@PE3# set policy-statement next-hop term 20 from route-filter 10.9.9.6/32 exact user@PE3# set policy-statement next-hop term 20 from route-filter 10.100.1.6/32 exact user@PE3# set policy-statement next-hop term 20 then next-hop 10.100.1.6 user@PE3# set policy-statement next-hop term 20 then accept [edit protocols ospf area 0.0.0.3] user@PE3# set interface 10.9.9.6 passive user@PE3# set interface 10.9.9.6 metric 1 user@PE3# set interface 10.100.1.6 passive user@PE3# set interface 10.100.1.6 metric 1 user@PE3# set interface fe-1/2/0.13 metric 1 [edit routing-options] user@PE3# set router-id 10.9.9.6 user@PE3# set autonomous-system 7018 user@PE3# commit user@PE3# show interfaces fe-1/2/0 { unit 13 { description PE3-to-PE4; family inet { address 10.0.0.26/30; } family mpls; } } lo0 { unit 11 { family inet { address 10.9.9.6/32; address 10.100.1.6/32; } } } user@PE3# show policy-options policy-statement SET_EXPORT_ROUTES { term 10 { from protocol [ direct static bgp ]; then { next-hop 10.100.1.6; accept; } } } policy-statement next-hop { term 10 { from protocol bgp; then { next-hop 10.100.1.6; accept; } } term 20 { from { protocol direct; route-filter 10.9.9.6/32 exact; route-filter 10.100.1.6/32 exact; } then { next-hop 10.100.1.6; accept; } } } user@PE3# show protocols rsvp { interface fe-1/2/0.13; } mpls { label-switched-path PE3-to-PE4 { to 10.9.9.4; } interface fe-1/2/0.13; } bgp { group external { type external; multihop { ttl 2; } local-address 10.9.9.6; family inet { labeled-unicast { aigp; } } export [ next-hop SET_EXPORT_ROUTES ]; vpn-apply-export; peer-as 13979; neighbor 10.9.9.4; } } ospf { area 0.0.0.3 { interface 10.9.9.6 { passive; metric 1; } interface 10.100.1.6 { passive; metric 1; } interface fe-1/2/0.13 { metric 1; } } } user@PE3# show routing-options router-id 10.9.9.6; autonomous-system 7018; 要配置设备 PE7： [edit interfaces] user@PE7# set fe-1/2/0 unit 15 description PE7-to-PE1 user@PE7# set fe-1/2/0 unit 15 family inet address 10.0.0.10/30 user@PE7# set lo0 unit 13 family inet address 10.9.9.7/32 user@PE7# set lo0 unit 13 family inet address 10.100.1.7/32 [edit protocols bgp group external] user@PE7# set type external user@PE7# set export SET_EXPORT_ROUTES user@PE7# set peer-as 13979 user@PE7# set neighbor 10.0.0.9 [edit protocols bgp group external] user@PE7# set family inet labeled-unicast aigp 配置路由策略。 [edit policy-options policy-statement SET_EXPORT_ROUTES term 10] user@PE7# set from protocol direct user@PE7# set from protocol bgp user@PE7# set then next-hop 10.100.1.7 user@PE7# set then accept [edit routing-options] user@PE7# set router-id 10.9.9.7 user@PE7# set autonomous-system 7019 user@PE7# commit user@PE7# show interfaces interfaces { fe-1/2/0 { unit 15 { description PE7-to-PE1; family inet { address 10.0.0.10/30; } } } lo0 { unit 13 { family inet { address 10.9.9.7/32; address 10.100.1.7/32; } } } } user@PE7# show policy-options policy-statement SET_EXPORT_ROUTES { term 10 { from protocol [ direct bgp ]; then { next-hop 10.100.1.7; accept; } } } user@PE7# show protocols bgp { group external { type external; family inet { labeled-unicast { aigp; } } export SET_EXPORT_ROUTES; peer-as 13979; neighbor 10.0.0.9; } } user@PE7# show routing-options router-id 10.9.9.7; autonomous-system 7019;",
      "sections": [
        {
          "title": "CLI 快速配置",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改与您的网络配置匹配所需的任何详细信息，然后将命令复制并粘贴到层次结构级别的 CLI [edit] 中。 设备 P1 set interfaces fe-1/2/0 unit 1 description P1-to-PE1 set interfaces fe-1/2/0 unit 1 family inet address 10.0.0.2/30 set interfaces fe-1/2/0 unit 1 family mpls set interfaces fe-1/2/1 unit 4 description P1-to-P2 set interfaces fe-1/2/1 unit 4 family inet address 10.0.0.29/30 set interfaces fe-1/2/1 unit 4 family mpls set interfaces fe-1/2/2 unit 8 description P1-to-PE4 set interfaces fe-1/2/2 unit 8 family inet address 10.0.0.17/30 set interfaces fe-1/2/2 unit 8 family mpls set interfaces lo0 unit 3 family inet address 10.9.9.2/32 set interfaces lo0 unit 3 family inet address 10.100.1.2/32 set protocols rsvp interface fe-1/2/0.1 set protocols rsvp interface fe-1/2/2.8 set protocols rsvp interface fe-1/2/1.4 set protocols mpls label-switched-path P1-to-P2 to 10.9.9.3 set protocols mpls label-switched-path P1-to-PE1 to 10.9.9.1 set protocols mpls label-switched-path P1-to-PE4 to 10.9.9.4 set protocols mpls interface fe-1/2/0.1 set protocols mpls interface fe-1/2/2.8 set protocols mpls interface fe-1/2/1.4 set protocols bgp group internal type internal set protocols bgp group internal local-address 10.9.9.2 set protocols bgp group internal family inet labeled-unicast aigp set protocols bgp group internal neighbor 10.9.9.1 set protocols bgp group internal neighbor 10.9.9.3 set protocols bgp group internal neighbor 10.9.9.4 set protocols ospf area 0.0.0.1 interface fe-1/2/0.1 metric 1 set protocols ospf area 0.0.0.1 interface fe-1/2/1.4 metric 1 set protocols ospf area 0.0.0.0 interface fe-1/2/2.8 metric 1 set protocols ospf area 0.0.0.0 interface 10.9.9.2 passive set protocols ospf area 0.0.0.0 interface 10.9.9.2 metric 1 set protocols ospf area 0.0.0.0 interface 10.100.1.2 passive set protocols ospf area 0.0.0.0 interface 10.100.1.2 metric 1 set routing-options router-id 10.9.9.2 set routing-options autonomous-system 13979 设备 P2 set interfaces fe-1/2/0 unit 3 description P2-to-PE1 set interfaces fe-1/2/0 unit 3 family inet address 10.0.0.6/30 set interfaces fe-1/2/0 unit 3 family mpls set interfaces fe-1/2/1 unit 5 description P2-to-P1 set interfaces fe-1/2/1 unit 5 family inet address 10.0.0.30/30 set interfaces fe-1/2/1 unit 5 family mpls set interfaces fe-1/2/2 unit 6 description P2-to-PE4 set interfaces fe-1/2/2 unit 6 family inet address 10.0.0.13/30 set interfaces fe-1/2/2 unit 6 family mpls set interfaces lo0 unit 5 family inet address 10.9.9.3/32 set interfaces lo0 unit 5 family inet address 10.100.1.3/32 set protocols rsvp interface fe-1/2/1.5 set protocols rsvp interface fe-1/2/2.6 set protocols rsvp interface fe-1/2/0.3 set protocols mpls label-switched-path P2-to-PE1 to 10.9.9.1 set protocols mpls label-switched-path P2-to-P1 to 10.9.9.2 set protocols mpls label-switched-path P2-to-PE4 to 10.9.9.4 set protocols mpls interface fe-1/2/1.5 set protocols mpls interface fe-1/2/2.6 set protocols mpls interface fe-1/2/0.3 set protocols bgp group internal type internal set protocols bgp group internal local-address 10.9.9.3 set protocols bgp group internal family inet labeled-unicast aigp set protocols bgp group internal neighbor 10.9.9.1 set protocols bgp group internal neighbor 10.9.9.2 set protocols bgp group internal neighbor 10.9.9.4 set protocols ospf area 0.0.0.0 interface fe-1/2/2.6 metric 1 set protocols ospf area 0.0.0.0 interface 10.9.9.3 passive set protocols ospf area 0.0.0.0 interface 10.9.9.3 metric 1 set protocols ospf area 0.0.0.0 interface 10.100.1.3 passive set protocols ospf area 0.0.0.0 interface 10.100.1.3 metric 1 set routing-options router-id 10.9.9.3 set routing-options autonomous-system 13979 设备 PE4 set interfaces fe-1/2/0 unit 7 description PE4-to-P2 set interfaces fe-1/2/0 unit 7 family inet address 10.0.0.14/30 set interfaces fe-1/2/0 unit 7 family mpls set interfaces fe-1/2/1 unit 9 description PE4-to-P1 set interfaces fe-1/2/1 unit 9 family inet address 10.0.0.18/30 set interfaces fe-1/2/1 unit 9 family mpls set interfaces fe-1/2/2 unit 10 description PE4-to-PE2 set interfaces fe-1/2/2 unit 10 family inet address 10.0.0.21/30 set interfaces fe-1/2/2 unit 10 family mpls set interfaces fe-1/0/2 unit 12 description PE4-to-PE3 set interfaces fe-1/0/2 unit 12 family inet address 10.0.0.25/30 set interfaces fe-1/0/2 unit 12 family mpls set interfaces lo0 unit 7 family inet address 10.9.9.4/32 set interfaces lo0 unit 7 family inet address 10.100.1.4/32 set protocols rsvp interface fe-1/2/0.7 set protocols rsvp interface fe-1/2/1.9 set protocols rsvp interface fe-1/2/2.10 set protocols rsvp interface fe-1/0/2.12 set protocols mpls label-switched-path PE4-to-PE2 to 10.9.9.5 set protocols mpls label-switched-path PE4-to-PE3 to 10.9.9.6 set protocols mpls label-switched-path PE4-to-P1 to 10.9.9.2 set protocols mpls label-switched-path PE4-to-P2 to 10.9.9.3 set protocols mpls interface fe-1/2/0.7 set protocols mpls interface fe-1/2/1.9 set protocols mpls interface fe-1/2/2.10 set protocols mpls interface fe-1/0/2.12 set protocols bgp export next-hop set protocols bgp export aigp set protocols bgp group internal type internal set protocols bgp group internal local-address 10.9.9.4 set protocols bgp group internal family inet labeled-unicast aigp set protocols bgp group internal neighbor 10.9.9.1 set protocols bgp group internal neighbor 10.9.9.3 set protocols bgp group internal neighbor 10.9.9.2 set protocols bgp group external type external set protocols bgp group external multihop ttl 2 set protocols bgp group external local-address 10.9.9.4 set protocols bgp group external family inet labeled-unicast aigp set protocols bgp group external peer-as 7018 set protocols bgp group external neighbor 10.9.9.5 set protocols bgp group external neighbor 10.9.9.6 set protocols ospf area 0.0.0.0 interface fe-1/2/1.9 metric 1 set protocols ospf area 0.0.0.0 interface fe-1/2/0.7 metric 1 set protocols ospf area 0.0.0.0 interface 10.9.9.4 passive set protocols ospf area 0.0.0.0 interface 10.9.9.4 metric 1 set protocols ospf area 0.0.0.0 interface 10.100.1.4 passive set protocols ospf area 0.0.0.0 interface 10.100.1.4 metric 1 set protocols ospf area 0.0.0.2 interface fe-1/2/2.10 metric 1 set protocols ospf area 0.0.0.3 interface fe-1/0/2.12 metric 1 set policy-options policy-statement aigp term 10 from protocol static set policy-options policy-statement aigp term 10 from route-filter 44.0.0.0/24 exact set policy-options policy-statement aigp term 10 then aigp-originate distance 200 set policy-options policy-statement aigp term 10 then next-hop 10.100.1.4 set policy-options policy-statement aigp term 10 then accept set policy-options policy-statement next-hop term 10 from protocol bgp set policy-options policy-statement next-hop term 10 then next-hop 10.100.1.4 set policy-options policy-statement next-hop term 10 then accept set policy-options policy-statement next-hop term 20 from protocol direct set policy-options policy-statement next-hop term 20 from route-filter 10.9.9.4/32 exact set policy-options policy-statement next-hop term 20 from route-filter 10.100.1.4/32 exact set policy-options policy-statement next-hop term 20 then next-hop 10.100.1.4 set policy-options policy-statement next-hop term 20 then accept set routing-options static route 44.0.0.0/24 discard set routing-options router-id 10.9.9.4 set routing-options autonomous-system 13979 设备 PE1 set interfaces fe-1/2/0 unit 0 description PE1-to-P1 set interfaces fe-1/2/0 unit 0 family inet address 10.0.0.1/30 set interfaces fe-1/2/0 unit 0 family mpls set interfaces fe-1/2/1 unit 2 description PE1-to-P2 set interfaces fe-1/2/1 unit 2 family inet address 10.0.0.5/30 set interfaces fe-1/2/1 unit 2 family mpls set interfaces fe-1/2/2 unit 14 description PE1-to-PE7 set interfaces fe-1/2/2 unit 14 family inet address 10.0.0.9/30 set interfaces lo0 unit 1 family inet address 10.9.9.1/32 set interfaces lo0 unit 1 family inet address 10.100.1.1/32 set protocols rsvp interface fe-1/2/0.0 set protocols rsvp interface fe-1/2/1.2 set protocols rsvp interface fe-1/2/2.14 set protocols mpls label-switched-path PE1-to-P1 to 10.9.9.2 set protocols mpls label-switched-path PE1-to-P2 to 10.9.9.3 set protocols mpls interface fe-1/2/0.0 set protocols mpls interface fe-1/2/1.2 set protocols mpls interface fe-1/2/2.14 set protocols bgp group internal type internal set protocols bgp group internal local-address 10.9.9.1 set protocols bgp group internal family inet labeled-unicast aigp set protocols bgp group internal export SET_EXPORT_ROUTES set protocols bgp group internal vpn-apply-export set protocols bgp group internal neighbor 10.9.9.4 set protocols bgp group internal neighbor 10.9.9.2 set protocols bgp group internal neighbor 10.9.9.3 set protocols bgp group external type external set protocols bgp group external family inet labeled-unicast aigp set protocols bgp group external export SET_EXPORT_ROUTES set protocols bgp group external peer-as 7019 set protocols bgp group external neighbor 10.0.0.10 set protocols ospf area 0.0.0.1 interface fe-1/2/0.0 metric 1 set protocols ospf area 0.0.0.1 interface fe-1/2/1.2 metric 1 set protocols ospf area 0.0.0.1 interface 10.9.9.1 passive set protocols ospf area 0.0.0.1 interface 10.9.9.1 metric 1 set protocols ospf area 0.0.0.1 interface 10.100.1.1 passive set protocols ospf area 0.0.0.1 interface 10.100.1.1 metric 1 set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp set policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.1 set policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept set routing-options router-id 10.9.9.1 set routing-options autonomous-system 13979 设备 PE2 set interfaces fe-1/2/0 unit 11 description PE2-to-PE4 set interfaces fe-1/2/0 unit 11 family inet address 10.0.0.22/30 set interfaces fe-1/2/0 unit 11 family mpls set interfaces lo0 unit 9 family inet address 10.9.9.5/32 primary set interfaces lo0 unit 9 family inet address 10.100.1.5/32 set protocols rsvp interface fe-1/2/0.11 set protocols mpls label-switched-path PE2-to-PE4 to 10.9.9.4 set protocols mpls interface fe-1/2/0.11 set protocols bgp group external type external set protocols bgp group external multihop ttl 2 set protocols bgp group external local-address 10.9.9.5 set protocols bgp group external family inet labeled-unicast aigp set protocols bgp group external export next-hop set protocols bgp group external export aigp set protocols bgp group external export SET_EXPORT_ROUTES set protocols bgp group external vpn-apply-export set protocols bgp group external peer-as 13979 set protocols bgp group external neighbor 10.9.9.4 set protocols ospf area 0.0.0.2 interface 10.9.9.5 passive set protocols ospf area 0.0.0.2 interface 10.9.9.5 metric 1 set protocols ospf area 0.0.0.2 interface 10.100.1.5 passive set protocols ospf area 0.0.0.2 interface 10.100.1.5 metric 1 set protocols ospf area 0.0.0.2 interface fe-1/2/0.11 metric 1 set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol static set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp set policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.5 set policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept set policy-options policy-statement aigp term 10 from route-filter 55.0.0.0/24 exact set policy-options policy-statement aigp term 10 then aigp-originate distance 20 set policy-options policy-statement aigp term 10 then next-hop 10.100.1.5 set policy-options policy-statement aigp term 10 then accept set policy-options policy-statement aigp term 20 from route-filter 99.0.0.0/24 exact set policy-options policy-statement aigp term 20 then aigp-originate distance 30 set policy-options policy-statement aigp term 20 then next-hop 10.100.1.5 set policy-options policy-statement aigp term 20 then accept set policy-options policy-statement next-hop term 10 from protocol bgp set policy-options policy-statement next-hop term 10 then next-hop 10.100.1.5 set policy-options policy-statement next-hop term 10 then accept set policy-options policy-statement next-hop term 20 from protocol direct set policy-options policy-statement next-hop term 20 from route-filter 10.9.9.5/32 exact set policy-options policy-statement next-hop term 20 from route-filter 10.100.1.5/32 exact set policy-options policy-statement next-hop term 20 then next-hop 10.100.1.5 set policy-options policy-statement next-hop term 20 then accept set routing-options static route 99.0.0.0/24 discard set routing-options static route 55.0.0.0/24 discard set routing-options router-id 10.9.9.5 set routing-options autonomous-system 7018 设备 PE3 set interfaces fe-1/2/0 unit 13 description PE3-to-PE4 set interfaces fe-1/2/0 unit 13 family inet address 10.0.0.26/30 set interfaces fe-1/2/0 unit 13 family mpls set interfaces lo0 unit 11 family inet address 10.9.9.6/32 set interfaces lo0 unit 11 family inet address 10.100.1.6/32 set protocols rsvp interface fe-1/2/0.13 set protocols mpls label-switched-path PE3-to-PE4 to 10.9.9.4 set protocols mpls interface fe-1/2/0.13 set protocols bgp group external type external set protocols bgp group external multihop ttl 2 set protocols bgp group external local-address 10.9.9.6 set protocols bgp group external family inet labeled-unicast aigp set protocols bgp group external export next-hop set protocols bgp group external export SET_EXPORT_ROUTES set protocols bgp group external vpn-apply-export set protocols bgp group external peer-as 13979 set protocols bgp group external neighbor 10.9.9.4 set protocols ospf area 0.0.0.3 interface 10.9.9.6 passive set protocols ospf area 0.0.0.3 interface 10.9.9.6 metric 1 set protocols ospf area 0.0.0.3 interface 10.100.1.6 passive set protocols ospf area 0.0.0.3 interface 10.100.1.6 metric 1 set protocols ospf area 0.0.0.3 interface fe-1/2/0.13 metric 1 set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol static set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp set policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.6 set policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept set policy-options policy-statement next-hop term 10 from protocol bgp set policy-options policy-statement next-hop term 10 then next-hop 10.100.1.6 set policy-options policy-statement next-hop term 10 then accept set policy-options policy-statement next-hop term 20 from protocol direct set policy-options policy-statement next-hop term 20 from route-filter 10.9.9.6/32 exact set policy-options policy-statement next-hop term 20 from route-filter 10.100.1.6/32 exact set policy-options policy-statement next-hop term 20 then next-hop 10.100.1.6 set policy-options policy-statement next-hop term 20 then accept set routing-options router-id 10.9.9.6 set routing-options autonomous-system 7018 设备 PE7 set interfaces fe-1/2/0 unit 15 description PE7-to-PE1 set interfaces fe-1/2/0 unit 15 family inet address 10.0.0.10/30 set interfaces lo0 unit 13 family inet address 10.9.9.7/32 set interfaces lo0 unit 13 family inet address 10.100.1.7/32 set protocols bgp group external type external set protocols bgp group external family inet labeled-unicast aigp set protocols bgp group external export SET_EXPORT_ROUTES set protocols bgp group external peer-as 13979 set protocols bgp group external neighbor 10.0.0.9 set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct set policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp set policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.7 set policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept set routing-options router-id 10.9.9.7 set routing-options autonomous-system 7019",
          "commands_by_device": {
            "设备 P1": "set interfaces fe-1/2/0 unit 1 description P1-to-PE1\nset interfaces fe-1/2/0 unit 1 family inet address 10.0.0.2/30\nset interfaces fe-1/2/0 unit 1 family mpls\nset interfaces fe-1/2/1 unit 4 description P1-to-P2\nset interfaces fe-1/2/1 unit 4 family inet address 10.0.0.29/30\nset interfaces fe-1/2/1 unit 4 family mpls\nset interfaces fe-1/2/2 unit 8 description P1-to-PE4\nset interfaces fe-1/2/2 unit 8 family inet address 10.0.0.17/30\nset interfaces fe-1/2/2 unit 8 family mpls\nset interfaces lo0 unit 3 family inet address 10.9.9.2/32\nset interfaces lo0 unit 3 family inet address 10.100.1.2/32\nset protocols rsvp interface fe-1/2/0.1\nset protocols rsvp interface fe-1/2/2.8\nset protocols rsvp interface fe-1/2/1.4\nset protocols mpls label-switched-path P1-to-P2 to 10.9.9.3\nset protocols mpls label-switched-path P1-to-PE1 to 10.9.9.1\nset protocols mpls label-switched-path P1-to-PE4 to 10.9.9.4\nset protocols mpls interface fe-1/2/0.1\nset protocols mpls interface fe-1/2/2.8\nset protocols mpls interface fe-1/2/1.4\nset protocols bgp group internal type internal\nset protocols bgp group internal local-address 10.9.9.2\nset protocols bgp group internal family inet labeled-unicast aigp\nset protocols bgp group internal neighbor 10.9.9.1\nset protocols bgp group internal neighbor 10.9.9.3\nset protocols bgp group internal neighbor 10.9.9.4\nset protocols ospf area 0.0.0.1 interface fe-1/2/0.1 metric 1\nset protocols ospf area 0.0.0.1 interface fe-1/2/1.4 metric 1\nset protocols ospf area 0.0.0.0 interface fe-1/2/2.8 metric 1\nset protocols ospf area 0.0.0.0 interface 10.9.9.2 passive\nset protocols ospf area 0.0.0.0 interface 10.9.9.2 metric 1\nset protocols ospf area 0.0.0.0 interface 10.100.1.2 passive\nset protocols ospf area 0.0.0.0 interface 10.100.1.2 metric 1\nset routing-options router-id 10.9.9.2\nset routing-options autonomous-system 13979",
            "设备 P2": "set interfaces fe-1/2/0 unit 3 description P2-to-PE1\nset interfaces fe-1/2/0 unit 3 family inet address 10.0.0.6/30\nset interfaces fe-1/2/0 unit 3 family mpls\nset interfaces fe-1/2/1 unit 5 description P2-to-P1\nset interfaces fe-1/2/1 unit 5 family inet address 10.0.0.30/30\nset interfaces fe-1/2/1 unit 5 family mpls\nset interfaces fe-1/2/2 unit 6 description P2-to-PE4\nset interfaces fe-1/2/2 unit 6 family inet address 10.0.0.13/30\nset interfaces fe-1/2/2 unit 6 family mpls\nset interfaces lo0 unit 5 family inet address 10.9.9.3/32\nset interfaces lo0 unit 5 family inet address 10.100.1.3/32\nset protocols rsvp interface fe-1/2/1.5\nset protocols rsvp interface fe-1/2/2.6\nset protocols rsvp interface fe-1/2/0.3\nset protocols mpls label-switched-path P2-to-PE1 to 10.9.9.1\nset protocols mpls label-switched-path P2-to-P1 to 10.9.9.2\nset protocols mpls label-switched-path P2-to-PE4 to 10.9.9.4\nset protocols mpls interface fe-1/2/1.5\nset protocols mpls interface fe-1/2/2.6\nset protocols mpls interface fe-1/2/0.3\nset protocols bgp group internal type internal\nset protocols bgp group internal local-address 10.9.9.3\nset protocols bgp group internal family inet labeled-unicast aigp\nset protocols bgp group internal neighbor 10.9.9.1\nset protocols bgp group internal neighbor 10.9.9.2\nset protocols bgp group internal neighbor 10.9.9.4\nset protocols ospf area 0.0.0.0 interface fe-1/2/2.6 metric 1\nset protocols ospf area 0.0.0.0 interface 10.9.9.3 passive\nset protocols ospf area 0.0.0.0 interface 10.9.9.3 metric 1\nset protocols ospf area 0.0.0.0 interface 10.100.1.3 passive\nset protocols ospf area 0.0.0.0 interface 10.100.1.3 metric 1\nset routing-options router-id 10.9.9.3\nset routing-options autonomous-system 13979",
            "设备 PE4": "set interfaces fe-1/2/0 unit 7 description PE4-to-P2\nset interfaces fe-1/2/0 unit 7 family inet address 10.0.0.14/30\nset interfaces fe-1/2/0 unit 7 family mpls\nset interfaces fe-1/2/1 unit 9 description PE4-to-P1\nset interfaces fe-1/2/1 unit 9 family inet address 10.0.0.18/30\nset interfaces fe-1/2/1 unit 9 family mpls\nset interfaces fe-1/2/2 unit 10 description PE4-to-PE2\nset interfaces fe-1/2/2 unit 10 family inet address 10.0.0.21/30\nset interfaces fe-1/2/2 unit 10 family mpls\nset interfaces fe-1/0/2 unit 12 description PE4-to-PE3\nset interfaces fe-1/0/2 unit 12 family inet address 10.0.0.25/30\nset interfaces fe-1/0/2 unit 12 family mpls\nset interfaces lo0 unit 7 family inet address 10.9.9.4/32\nset interfaces lo0 unit 7 family inet address 10.100.1.4/32\nset protocols rsvp interface fe-1/2/0.7\nset protocols rsvp interface fe-1/2/1.9\nset protocols rsvp interface fe-1/2/2.10\nset protocols rsvp interface fe-1/0/2.12\nset protocols mpls label-switched-path PE4-to-PE2 to 10.9.9.5\nset protocols mpls label-switched-path PE4-to-PE3 to 10.9.9.6\nset protocols mpls label-switched-path PE4-to-P1 to 10.9.9.2\nset protocols mpls label-switched-path PE4-to-P2 to 10.9.9.3\nset protocols mpls interface fe-1/2/0.7\nset protocols mpls interface fe-1/2/1.9\nset protocols mpls interface fe-1/2/2.10\nset protocols mpls interface fe-1/0/2.12\nset protocols bgp export next-hop\nset protocols bgp export aigp\nset protocols bgp group internal type internal\nset protocols bgp group internal local-address 10.9.9.4\nset protocols bgp group internal family inet labeled-unicast aigp\nset protocols bgp group internal neighbor 10.9.9.1\nset protocols bgp group internal neighbor 10.9.9.3\nset protocols bgp group internal neighbor 10.9.9.2\nset protocols bgp group external type external\nset protocols bgp group external multihop ttl 2\nset protocols bgp group external local-address 10.9.9.4\nset protocols bgp group external family inet labeled-unicast aigp\nset protocols bgp group external peer-as 7018\nset protocols bgp group external neighbor 10.9.9.5\nset protocols bgp group external neighbor 10.9.9.6\nset protocols ospf area 0.0.0.0 interface fe-1/2/1.9 metric 1\nset protocols ospf area 0.0.0.0 interface fe-1/2/0.7 metric 1\nset protocols ospf area 0.0.0.0 interface 10.9.9.4 passive\nset protocols ospf area 0.0.0.0 interface 10.9.9.4 metric 1\nset protocols ospf area 0.0.0.0 interface 10.100.1.4 passive\nset protocols ospf area 0.0.0.0 interface 10.100.1.4 metric 1\nset protocols ospf area 0.0.0.2 interface fe-1/2/2.10 metric 1\nset protocols ospf area 0.0.0.3 interface fe-1/0/2.12 metric 1\nset policy-options policy-statement aigp term 10 from protocol static\nset policy-options policy-statement aigp term 10 from route-filter 44.0.0.0/24 exact\nset policy-options policy-statement aigp term 10 then aigp-originate distance 200\nset policy-options policy-statement aigp term 10 then next-hop 10.100.1.4\nset policy-options policy-statement aigp term 10 then accept\nset policy-options policy-statement next-hop term 10 from protocol bgp\nset policy-options policy-statement next-hop term 10 then next-hop 10.100.1.4\nset policy-options policy-statement next-hop term 10 then accept\nset policy-options policy-statement next-hop term 20 from protocol direct\nset policy-options policy-statement next-hop term 20 from route-filter 10.9.9.4/32 exact\nset policy-options policy-statement next-hop term 20 from route-filter 10.100.1.4/32 exact\nset policy-options policy-statement next-hop term 20 then next-hop 10.100.1.4\nset policy-options policy-statement next-hop term 20 then accept\nset routing-options static route 44.0.0.0/24 discard\nset routing-options router-id 10.9.9.4\nset routing-options autonomous-system 13979",
            "设备 PE1": "set interfaces fe-1/2/0 unit 0 description PE1-to-P1\nset interfaces fe-1/2/0 unit 0 family inet address 10.0.0.1/30\nset interfaces fe-1/2/0 unit 0 family mpls\nset interfaces fe-1/2/1 unit 2 description PE1-to-P2\nset interfaces fe-1/2/1 unit 2 family inet address 10.0.0.5/30\nset interfaces fe-1/2/1 unit 2 family mpls\nset interfaces fe-1/2/2 unit 14 description PE1-to-PE7\nset interfaces fe-1/2/2 unit 14 family inet address 10.0.0.9/30\nset interfaces lo0 unit 1 family inet address 10.9.9.1/32\nset interfaces lo0 unit 1 family inet address 10.100.1.1/32\nset protocols rsvp interface fe-1/2/0.0\nset protocols rsvp interface fe-1/2/1.2\nset protocols rsvp interface fe-1/2/2.14\nset protocols mpls label-switched-path PE1-to-P1 to 10.9.9.2\nset protocols mpls label-switched-path PE1-to-P2 to 10.9.9.3\nset protocols mpls interface fe-1/2/0.0\nset protocols mpls interface fe-1/2/1.2\nset protocols mpls interface fe-1/2/2.14\nset protocols bgp group internal type internal\nset protocols bgp group internal local-address 10.9.9.1\nset protocols bgp group internal family inet labeled-unicast aigp\nset protocols bgp group internal export SET_EXPORT_ROUTES\nset protocols bgp group internal vpn-apply-export\nset protocols bgp group internal neighbor 10.9.9.4\nset protocols bgp group internal neighbor 10.9.9.2\nset protocols bgp group internal neighbor 10.9.9.3\nset protocols bgp group external type external\nset protocols bgp group external family inet labeled-unicast aigp\nset protocols bgp group external export SET_EXPORT_ROUTES\nset protocols bgp group external peer-as 7019\nset protocols bgp group external neighbor 10.0.0.10\nset protocols ospf area 0.0.0.1 interface fe-1/2/0.0 metric 1\nset protocols ospf area 0.0.0.1 interface fe-1/2/1.2 metric 1\nset protocols ospf area 0.0.0.1 interface 10.9.9.1 passive\nset protocols ospf area 0.0.0.1 interface 10.9.9.1 metric 1\nset protocols ospf area 0.0.0.1 interface 10.100.1.1 passive\nset protocols ospf area 0.0.0.1 interface 10.100.1.1 metric 1\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.1\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept\nset routing-options router-id 10.9.9.1\nset routing-options autonomous-system 13979",
            "设备 PE2": "set interfaces fe-1/2/0 unit 11 description PE2-to-PE4\nset interfaces fe-1/2/0 unit 11 family inet address 10.0.0.22/30\nset interfaces fe-1/2/0 unit 11 family mpls\nset interfaces lo0 unit 9 family inet address 10.9.9.5/32 primary\nset interfaces lo0 unit 9 family inet address 10.100.1.5/32\nset protocols rsvp interface fe-1/2/0.11\nset protocols mpls label-switched-path PE2-to-PE4 to 10.9.9.4\nset protocols mpls interface fe-1/2/0.11\nset protocols bgp group external type external\nset protocols bgp group external multihop ttl 2\nset protocols bgp group external local-address 10.9.9.5\nset protocols bgp group external family inet labeled-unicast aigp\nset protocols bgp group external export next-hop\nset protocols bgp group external export aigp\nset protocols bgp group external export SET_EXPORT_ROUTES\nset protocols bgp group external vpn-apply-export\nset protocols bgp group external peer-as 13979\nset protocols bgp group external neighbor 10.9.9.4\nset protocols ospf area 0.0.0.2 interface 10.9.9.5 passive\nset protocols ospf area 0.0.0.2 interface 10.9.9.5 metric 1\nset protocols ospf area 0.0.0.2 interface 10.100.1.5 passive\nset protocols ospf area 0.0.0.2 interface 10.100.1.5 metric 1\nset protocols ospf area 0.0.0.2 interface fe-1/2/0.11 metric 1\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol static\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.5\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept\nset policy-options policy-statement aigp term 10 from route-filter 55.0.0.0/24 exact\nset policy-options policy-statement aigp term 10 then aigp-originate distance 20\nset policy-options policy-statement aigp term 10 then next-hop 10.100.1.5\nset policy-options policy-statement aigp term 10 then accept\nset policy-options policy-statement aigp term 20 from route-filter 99.0.0.0/24 exact\nset policy-options policy-statement aigp term 20 then aigp-originate distance 30\nset policy-options policy-statement aigp term 20 then next-hop 10.100.1.5\nset policy-options policy-statement aigp term 20 then accept\nset policy-options policy-statement next-hop term 10 from protocol bgp\nset policy-options policy-statement next-hop term 10 then next-hop 10.100.1.5\nset policy-options policy-statement next-hop term 10 then accept\nset policy-options policy-statement next-hop term 20 from protocol direct\nset policy-options policy-statement next-hop term 20 from route-filter 10.9.9.5/32 exact\nset policy-options policy-statement next-hop term 20 from route-filter 10.100.1.5/32 exact\nset policy-options policy-statement next-hop term 20 then next-hop 10.100.1.5\nset policy-options policy-statement next-hop term 20 then accept\nset routing-options static route 99.0.0.0/24 discard\nset routing-options static route 55.0.0.0/24 discard\nset routing-options router-id 10.9.9.5\nset routing-options autonomous-system 7018",
            "设备 PE3": "set interfaces fe-1/2/0 unit 13 description PE3-to-PE4\nset interfaces fe-1/2/0 unit 13 family inet address 10.0.0.26/30\nset interfaces fe-1/2/0 unit 13 family mpls\nset interfaces lo0 unit 11 family inet address 10.9.9.6/32\nset interfaces lo0 unit 11 family inet address 10.100.1.6/32\nset protocols rsvp interface fe-1/2/0.13\nset protocols mpls label-switched-path PE3-to-PE4 to 10.9.9.4\nset protocols mpls interface fe-1/2/0.13\nset protocols bgp group external type external\nset protocols bgp group external multihop ttl 2\nset protocols bgp group external local-address 10.9.9.6\nset protocols bgp group external family inet labeled-unicast aigp\nset protocols bgp group external export next-hop\nset protocols bgp group external export SET_EXPORT_ROUTES\nset protocols bgp group external vpn-apply-export\nset protocols bgp group external peer-as 13979\nset protocols bgp group external neighbor 10.9.9.4\nset protocols ospf area 0.0.0.3 interface 10.9.9.6 passive\nset protocols ospf area 0.0.0.3 interface 10.9.9.6 metric 1\nset protocols ospf area 0.0.0.3 interface 10.100.1.6 passive\nset protocols ospf area 0.0.0.3 interface 10.100.1.6 metric 1\nset protocols ospf area 0.0.0.3 interface fe-1/2/0.13 metric 1\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol static\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.6\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept\nset policy-options policy-statement next-hop term 10 from protocol bgp\nset policy-options policy-statement next-hop term 10 then next-hop 10.100.1.6\nset policy-options policy-statement next-hop term 10 then accept\nset policy-options policy-statement next-hop term 20 from protocol direct\nset policy-options policy-statement next-hop term 20 from route-filter 10.9.9.6/32 exact\nset policy-options policy-statement next-hop term 20 from route-filter 10.100.1.6/32 exact\nset policy-options policy-statement next-hop term 20 then next-hop 10.100.1.6\nset policy-options policy-statement next-hop term 20 then accept\nset routing-options router-id 10.9.9.6\nset routing-options autonomous-system 7018",
            "设备 PE7": "set interfaces fe-1/2/0 unit 15 description PE7-to-PE1\nset interfaces fe-1/2/0 unit 15 family inet address 10.0.0.10/30\nset interfaces lo0 unit 13 family inet address 10.9.9.7/32\nset interfaces lo0 unit 13 family inet address 10.100.1.7/32\nset protocols bgp group external type external\nset protocols bgp group external family inet labeled-unicast aigp\nset protocols bgp group external export SET_EXPORT_ROUTES\nset protocols bgp group external peer-as 13979\nset protocols bgp group external neighbor 10.0.0.9\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol direct\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.7\nset policy-options policy-statement SET_EXPORT_ROUTES term 10 then accept\nset routing-options router-id 10.9.9.7\nset routing-options autonomous-system 7019"
          }
        },
        {
          "title": "配置设备 P1",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 P1： 配置接口。 [edit interfaces] user@P1# set fe-1/2/0 unit 1 description P1-to-PE1 user@P1# set fe-1/2/0 unit 1 family inet address 10.0.0.2/30 user@P1# set fe-1/2/0 unit 1 family mpls user@P1# set fe-1/2/1 unit 4 description P1-to-P2 user@P1# set fe-1/2/1 unit 4 family inet address 10.0.0.29/30 user@P1# set fe-1/2/1 unit 4 family mpls user@P1# set fe-1/2/2 unit 8 description P1-to-PE4 user@P1# set fe-1/2/2 unit 8 family inet address 10.0.0.17/30 user@P1# set fe-1/2/2 unit 8 family mpls user@P1# set lo0 unit 3 family inet address 10.9.9.2/32 user@P1# set lo0 unit 3 family inet address 10.100.1.2/32 配置 MPLS 和信令协议，例如 RSVP 或 LDP。 [edit protocols] user@P1# set rsvp interface fe-1/2/0.1 user@P1# set rsvp interface fe-1/2/2.8 user@P1# set rsvp interface fe-1/2/1.4 user@P1# set mpls label-switched-path P1-to-P2 to 10.9.9.3 user@P1# set mpls label-switched-path P1-to-PE1 to 10.9.9.1 user@P1# set mpls label-switched-path P1-to-PE4 to 10.9.9.4 user@P1# set mpls interface fe-1/2/0.1 user@P1# set mpls interface fe-1/2/2.8 user@P1# set mpls interface fe-1/2/1.4 配置 BGP。 [edit protocols bgp group internal] user@P1# set type internal user@P1# set local-address 10.9.9.2 user@P1# set neighbor 10.9.9.1 user@P1# set neighbor 10.9.9.3 user@P1# set neighbor 10.9.9.4 启用 AIGP。 [edit protocols bgp group internal] user@P1# set family inet labeled-unicast aigp 配置 IGP，例如 OSPF、RIP 或 IS-IS。 [edit protocols ospf] user@P1# set area 0.0.0.1 interface fe-1/2/0.1 metric 1 user@P1# set area 0.0.0.1 interface fe-1/2/1.4 metric 1 user@P1# set area 0.0.0.0 interface fe-1/2/2.8 metric 1 user@P1# set area 0.0.0.0 interface 10.9.9.2 passive user@P1# set area 0.0.0.0 interface 10.9.9.2 metric 1 user@P1# set area 0.0.0.0 interface 10.100.1.2 passive user@P1# set area 0.0.0.0 interface 10.100.1.2 metric 1 配置路由器 ID 和自治系统编号。 [edit routing-options] user@P1# set router-id 10.9.9.2 user@P1# set autonomous-system 13979 如果完成设备配置，请提交配置。 user@P1# commit 在配置模式下，输入 show interfaces 、 show protocols 和 show routing-options 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@P1# show interfaces fe-1/2/0 { unit 1 { description P1-to-PE1; family inet { address 10.0.0.2/30; } family mpls; } } fe-1/2/1 { unit 4 { description P1-to-P2; family inet { address 10.0.0.29/30; } family mpls; } } fe-1/2/2 { unit 8 { description P1-to-PE4; family inet { address 10.0.0.17/30; } family mpls; } } lo0 { unit 3 { family inet { address 10.9.9.2/32; address 10.100.1.2/32; } } } user@P1# show protocols rsvp { interface fe-1/2/0.1; interface fe-1/2/2.8; interface fe-1/2/1.4; } mpls { label-switched-path P1-to-P2 { to 10.9.9.3; } label-switched-path P1-to-PE1 { to 10.9.9.1; } label-switched-path P1-to-PE4 { to 10.9.9.4; } interface fe-1/2/0.1; interface fe-1/2/2.8; interface fe-1/2/1.4; } bgp { group internal { type internal; local-address 10.9.9.2; family inet { labeled-unicast { aigp; } } neighbor 10.9.9.1; neighbor 10.9.9.3; neighbor 10.9.9.4; } } ospf { area 0.0.0.1 { interface fe-1/2/0.1 { metric 1; } interface fe-1/2/1.4 { metric 1; } } area 0.0.0.0 { interface fe-1/2/2.8 { metric 1; } interface 10.9.9.2 { passive; metric 1; } interface 10.100.1.2 { passive; metric 1; } } } user@P1# show routing-options router-id 10.9.9.2; autonomous-system 13979;",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@P1# set fe-1/2/0 unit 1 description P1-to-PE1",
                    "user@P1# set fe-1/2/0 unit 1 family inet address 10.0.0.2/30",
                    "user@P1# set fe-1/2/0 unit 1 family mpls",
                    "user@P1# set fe-1/2/1 unit 4 description P1-to-P2",
                    "user@P1# set fe-1/2/1 unit 4 family inet address 10.0.0.29/30",
                    "user@P1# set fe-1/2/1 unit 4 family mpls",
                    "user@P1# set fe-1/2/2 unit 8 description P1-to-PE4",
                    "user@P1# set fe-1/2/2 unit 8 family inet address 10.0.0.17/30",
                    "user@P1# set fe-1/2/2 unit 8 family mpls",
                    "user@P1# set lo0 unit 3 family inet address 10.9.9.2/32",
                    "user@P1# set lo0 unit 3 family inet address 10.100.1.2/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 MPLS 和信令协议，例如 RSVP 或 LDP。",
                  "code": [
                    "[edit protocols]",
                    "user@P1# set rsvp interface fe-1/2/0.1",
                    "user@P1# set rsvp interface fe-1/2/2.8",
                    "user@P1# set rsvp interface fe-1/2/1.4",
                    "user@P1# set mpls label-switched-path P1-to-P2 to 10.9.9.3",
                    "user@P1# set mpls label-switched-path P1-to-PE1 to 10.9.9.1",
                    "user@P1# set mpls label-switched-path P1-to-PE4 to 10.9.9.4",
                    "user@P1# set mpls interface fe-1/2/0.1",
                    "user@P1# set mpls interface fe-1/2/2.8",
                    "user@P1# set mpls interface fe-1/2/1.4"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group internal]",
                    "user@P1# set type internal",
                    "user@P1# set local-address 10.9.9.2",
                    "user@P1# set neighbor 10.9.9.1",
                    "user@P1# set neighbor 10.9.9.3",
                    "user@P1# set neighbor 10.9.9.4"
                  ]
                },
                {
                  "step": 4,
                  "description": "启用 AIGP。",
                  "code": [
                    "[edit protocols bgp group internal]",
                    "user@P1# set family inet labeled-unicast aigp"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置 IGP，例如 OSPF、RIP 或 IS-IS。",
                  "code": [
                    "[edit protocols ospf]",
                    "user@P1# set area 0.0.0.1 interface fe-1/2/0.1 metric 1",
                    "user@P1# set area 0.0.0.1 interface fe-1/2/1.4 metric 1",
                    "user@P1# set area 0.0.0.0 interface fe-1/2/2.8 metric 1",
                    "user@P1# set area 0.0.0.0 interface 10.9.9.2 passive",
                    "user@P1# set area 0.0.0.0 interface 10.9.9.2 metric 1",
                    "user@P1# set area 0.0.0.0 interface 10.100.1.2 passive",
                    "user@P1# set area 0.0.0.0 interface 10.100.1.2 metric 1"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置路由器 ID 和自治系统编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@P1# set router-id 10.9.9.2",
                    "user@P1# set autonomous-system 13979"
                  ]
                },
                {
                  "step": 7,
                  "description": "如果完成设备配置，请提交配置。",
                  "code": [
                    "user@P1# commit"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show protocols 和 show routing-options 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "user@P1#show interfacesfe-1/2/0 {\n    unit 1 {\n        description P1-to-PE1;\n        family inet {\n            address 10.0.0.2/30;\n        }\n        family mpls;\n    }\n}\nfe-1/2/1 {\n    unit 4 {\n        description P1-to-P2;\n        family inet {\n            address 10.0.0.29/30;\n        }\n        family mpls;\n    }\n}\nfe-1/2/2 {\n    unit 8 {\n        description P1-to-PE4;\n        family inet {\n            address 10.0.0.17/30;\n        }\n        family mpls;\n    }\n}\nlo0 {\n    unit 3 {\n        family inet {\n            address 10.9.9.2/32;\n            address 10.100.1.2/32;\n        }\n    }\n}",
                "user@P1#show protocolsrsvp {\n    interface fe-1/2/0.1;\n    interface fe-1/2/2.8;\n    interface fe-1/2/1.4;\n}\nmpls {\n    label-switched-path P1-to-P2 {\n        to 10.9.9.3;\n    }\n    label-switched-path P1-to-PE1 {\n        to 10.9.9.1;\n    }\n    label-switched-path P1-to-PE4 {\n        to 10.9.9.4;\n    }\n    interface fe-1/2/0.1;\n    interface fe-1/2/2.8;\n    interface fe-1/2/1.4;\n}\nbgp {\n    group internal {\n        type internal;\n        local-address 10.9.9.2;\n        family inet {\n            labeled-unicast {\n                aigp;\n            }\n        }\n        neighbor 10.9.9.1;\n        neighbor 10.9.9.3;\n        neighbor 10.9.9.4;\n    }\n}\nospf {\n    area 0.0.0.1 {\n        interface fe-1/2/0.1 {\n            metric 1;\n        }\n        interface fe-1/2/1.4 {\n            metric 1;\n        }\n    }\n    area 0.0.0.0 {\n        interface fe-1/2/2.8 {\n            metric 1;\n        }\n        interface 10.9.9.2 {\n            passive;\n            metric 1;\n        }\n        interface 10.100.1.2 {\n            passive;\n            metric 1;\n        }\n    }\n}",
                "user@P1#show routing-optionsrouter-id 10.9.9.2;\nautonomous-system 13979;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 P2",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 P2： 配置接口。 [edit interfaces] user@P2# set fe-1/2/0 unit 3 description P2-to-PE1 user@P2# set fe-1/2/0 unit 3 family inet address 10.0.0.6/30 user@P2# set fe-1/2/0 unit 3 family mpls user@P2# set fe-1/2/1 unit 5 description P2-to-P1 user@P2# set fe-1/2/1 unit 5 family inet address 10.0.0.30/30 user@P2# set fe-1/2/1 unit 5 family mpls user@P2# set fe-1/2/2 unit 6 description P2-to-PE4 user@P2# set fe-1/2/2 unit 6 family inet address 10.0.0.13/30 user@P2# set fe-1/2/2 unit 6 family mpls user@P2# set lo0 unit 5 family inet address 10.9.9.3/32 user@P2# set lo0 unit 5 family inet address 10.100.1.3/32 配置 MPLS 和信令协议，例如 RSVP 或 LDP。 [edit protocols] user@P2# set rsvp interface fe-1/2/1.5 user@P2# set rsvp interface fe-1/2/2.6 user@P2# set rsvp interface fe-1/2/0.3 user@P2# set mpls label-switched-path P2-to-PE1 to 10.9.9.1 user@P2# set mpls label-switched-path P2-to-P1 to 10.9.9.2 user@P2# set mpls label-switched-path P2-to-PE4 to 10.9.9.4 user@P2# set mpls interface fe-1/2/1.5 user@P2# set mpls interface fe-1/2/2.6 user@P2# set mpls interface fe-1/2/0.3 配置 BGP。 [edit protocols bgp group internal] user@P2# set type internal user@P2# set local-address 10.9.9.3 user@P2# set neighbor 10.9.9.1 user@P2# set neighbor 10.9.9.2 user@P2# set neighbor 10.9.9.4 启用 AIGP。 [edit protocols bgp group internal] user@P2# set family inet labeled-unicast aigp 配置 IGP，例如 OSPF、RIP 或 IS-IS。 [edit protocols ospf] user@P2# set area 0.0.0.0 interface fe-1/2/2.6 metric 1 user@P2# set area 0.0.0.0 interface 10.9.9.3 passive user@P2# set area 0.0.0.0 interface 10.9.9.3 metric 1 user@P2# set area 0.0.0.0 interface 10.100.1.3 passive user@P2# set area 0.0.0.0 interface 10.100.1.3 metric 1 配置路由器 ID 和自治系统编号。 [edit routing-options] user@P2# set router-id 10.9.9.3 user@P2# set autonomous-system 13979 如果完成设备配置，请提交配置。 user@P2# commit 在配置模式下，输入 show interfaces 、 show protocols 和 show routing-options 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@P2# show interfaces fe-1/2/0 { unit 3 { description P2-to-PE1; family inet { address 10.0.0.6/30; } family mpls; } } fe-1/2/1 { unit 5 { description P2-to-P1; family inet { address 10.0.0.30/30; } family mpls; } } fe-1/2/2 { unit 6 { description P2-to-PE4; family inet { address 10.0.0.13/30; } family mpls; } } lo0 { unit 5 { family inet { address 10.9.9.3/32; address 10.100.1.3/32; } } } user@P2# show protocols rsvp { interface fe-1/2/1.5; interface fe-1/2/2.6; interface fe-1/2/0.3; } mpls { label-switched-path P2-to-PE1 { to 10.9.9.1; } label-switched-path P2-to-P1 { to 10.9.9.2; } label-switched-path P2-to-PE4 { to 10.9.9.4; } interface fe-1/2/1.5; interface fe-1/2/2.6; interface fe-1/2/0.3; } bgp { group internal { type internal; local-address 10.9.9.3; family inet { labeled-unicast { aigp; } } neighbor 10.9.9.1; neighbor 10.9.9.2; neighbor 10.9.9.4; } } ospf { area 0.0.0.0 { interface fe-1/2/2.6 { metric 1; } interface 10.9.9.3 { passive; metric 1; } interface 10.100.1.3 { passive; metric 1; } } } user@P2# show routing-options router-id 10.9.9.3; autonomous-system 13979;",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@P2# set fe-1/2/0 unit 3 description P2-to-PE1",
                    "user@P2# set fe-1/2/0 unit 3 family inet address 10.0.0.6/30",
                    "user@P2# set fe-1/2/0 unit 3 family mpls",
                    "user@P2# set fe-1/2/1 unit 5 description P2-to-P1",
                    "user@P2# set fe-1/2/1 unit 5 family inet address 10.0.0.30/30",
                    "user@P2# set fe-1/2/1 unit 5 family mpls",
                    "user@P2# set fe-1/2/2 unit 6 description P2-to-PE4",
                    "user@P2# set fe-1/2/2 unit 6 family inet address 10.0.0.13/30",
                    "user@P2# set fe-1/2/2 unit 6 family mpls",
                    "user@P2# set lo0 unit 5 family inet address 10.9.9.3/32",
                    "user@P2# set lo0 unit 5 family inet address 10.100.1.3/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 MPLS 和信令协议，例如 RSVP 或 LDP。",
                  "code": [
                    "[edit protocols]",
                    "user@P2# set rsvp interface fe-1/2/1.5",
                    "user@P2# set rsvp interface fe-1/2/2.6",
                    "user@P2# set rsvp interface fe-1/2/0.3",
                    "user@P2# set mpls label-switched-path P2-to-PE1 to 10.9.9.1",
                    "user@P2# set mpls label-switched-path P2-to-P1 to 10.9.9.2",
                    "user@P2# set mpls label-switched-path P2-to-PE4 to 10.9.9.4",
                    "user@P2# set mpls interface fe-1/2/1.5",
                    "user@P2# set mpls interface fe-1/2/2.6",
                    "user@P2# set mpls interface fe-1/2/0.3"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group internal]",
                    "user@P2# set type internal",
                    "user@P2# set local-address 10.9.9.3",
                    "user@P2# set neighbor 10.9.9.1",
                    "user@P2# set neighbor 10.9.9.2",
                    "user@P2# set neighbor 10.9.9.4"
                  ]
                },
                {
                  "step": 4,
                  "description": "启用 AIGP。",
                  "code": [
                    "[edit protocols bgp group internal]",
                    "user@P2# set family inet labeled-unicast aigp"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置 IGP，例如 OSPF、RIP 或 IS-IS。",
                  "code": [
                    "[edit protocols ospf]",
                    "user@P2# set area 0.0.0.0 interface fe-1/2/2.6 metric 1",
                    "user@P2# set area 0.0.0.0 interface 10.9.9.3 passive",
                    "user@P2# set area 0.0.0.0 interface 10.9.9.3 metric 1",
                    "user@P2# set area 0.0.0.0 interface 10.100.1.3 passive",
                    "user@P2# set area 0.0.0.0 interface 10.100.1.3 metric 1"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置路由器 ID 和自治系统编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@P2# set router-id 10.9.9.3",
                    "user@P2# set autonomous-system 13979"
                  ]
                },
                {
                  "step": 7,
                  "description": "如果完成设备配置，请提交配置。",
                  "code": [
                    "user@P2# commit"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show protocols 和 show routing-options 命令确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "user@P2#show interfacesfe-1/2/0 {\n    unit 3 {\n        description P2-to-PE1;\n        family inet {\n            address 10.0.0.6/30;\n        }\n        family mpls;\n    }\n}\nfe-1/2/1 {\n    unit 5 {\n        description P2-to-P1;\n        family inet {\n            address 10.0.0.30/30;\n        }\n        family mpls;\n    }\n}\nfe-1/2/2 {\n    unit 6 {\n        description P2-to-PE4;\n        family inet {\n            address 10.0.0.13/30;\n        }\n        family mpls;\n    }\n}\nlo0 {\n    unit 5 {\n        family inet {\n            address 10.9.9.3/32;\n            address 10.100.1.3/32;\n        }\n    }\n}",
                "user@P2#show protocolsrsvp {\n    interface fe-1/2/1.5;\n    interface fe-1/2/2.6;\n    interface fe-1/2/0.3;\n}\nmpls {\n    label-switched-path P2-to-PE1 {\n        to 10.9.9.1;\n    }\n    label-switched-path P2-to-P1 {\n        to 10.9.9.2;\n    }\n    label-switched-path P2-to-PE4 {\n        to 10.9.9.4;\n    }\n    interface fe-1/2/1.5;\n    interface fe-1/2/2.6;\n    interface fe-1/2/0.3;\n}\nbgp {\n    group internal {\n        type internal;\n        local-address 10.9.9.3;\n        family inet {\n            labeled-unicast {\n                aigp;\n            }\n        }\n        neighbor 10.9.9.1;\n        neighbor 10.9.9.2;\n        neighbor 10.9.9.4;\n    }\n}\nospf {\n    area 0.0.0.0 {\n        interface fe-1/2/2.6 {\n            metric 1;\n        }\n        interface 10.9.9.3 {\n            passive;\n            metric 1;\n        }\n        interface 10.100.1.3 {\n            passive;\n            metric 1;\n        }\n    }\n}",
                "user@P2#show routing-optionsrouter-id 10.9.9.3;\nautonomous-system 13979;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 PE4",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 PE4： 配置接口。 [edit interfaces] user@PE4# set fe-1/2/0 unit 7 description PE4-to-P2 user@PE4# set fe-1/2/0 unit 7 family inet address 10.0.0.14/30 user@PE4# set fe-1/2/0 unit 7 family mpls user@PE4# set fe-1/2/1 unit 9 description PE4-to-P1 user@PE4# set fe-1/2/1 unit 9 family inet address 10.0.0.18/30 user@PE4# set fe-1/2/1 unit 9 family mpls user@PE4# set fe-1/2/2 unit 10 description PE4-to-PE2 user@PE4# set fe-1/2/2 unit 10 family inet address 10.0.0.21/30 user@PE4# set fe-1/2/2 unit 10 family mpls user@PE4# set fe-1/0/2 unit 12 description PE4-to-PE3 user@PE4# set fe-1/0/2 unit 12 family inet address 10.0.0.25/30 user@PE4# set fe-1/0/2 unit 12 family mpls user@PE4# set lo0 unit 7 family inet address 10.9.9.4/32 user@PE4# set lo0 unit 7 family inet address 10.100.1.4/32 配置 MPLS 和信令协议，例如 RSVP 或 LDP。 [edit protocols] user@PE4# set rsvp interface fe-1/2/0.7 user@PE4# set rsvp interface fe-1/2/1.9 user@PE4# set rsvp interface fe-1/2/2.10 user@PE4# set rsvp interface fe-1/0/2.12 user@PE4# set mpls label-switched-path PE4-to-PE2 to 10.9.9.5 user@PE4# set mpls label-switched-path PE4-to-PE3 to 10.9.9.6 user@PE4# set mpls label-switched-path PE4-to-P1 to 10.9.9.2 user@PE4# set mpls label-switched-path PE4-to-P2 to 10.9.9.3 user@PE4# set mpls interface fe-1/2/0.7 user@PE4# set mpls interface fe-1/2/1.9 user@PE4# set mpls interface fe-1/2/2.10 user@PE4# set mpls interface fe-1/0/2.12 配置 BGP。 [edit protocols bgp] user@PE4# set export next-hop user@PE4# set export aigp user@PE4# set group internal type internal user@PE4# set group internal local-address 10.9.9.4 user@PE4# set group internal neighbor 10.9.9.1 user@PE4# set group internal neighbor 10.9.9.3 user@PE4# set group internal neighbor 10.9.9.2 user@PE4# set group external type external user@PE4# set group external multihop ttl 2 user@PE4# set group external local-address 10.9.9.4 user@PE4# set group external peer-as 7018 user@PE4# set group external neighbor 10.9.9.5 user@PE4# set group external neighbor 10.9.9.6 启用 AIGP。 [edit protocols bgp] user@PE4# set group external family inet labeled-unicast aigp user@PE4# set group internal family inet labeled-unicast aigp 发起前缀，并配置 AIGP 距离。 默认情况下，前缀是使用当前 IGP 距离发起的。或者，您可以使用选项 distance 为 AIGP 属性配置距离，如下所示。 [edit policy-options policy-statement aigp term 10] user@PE4# set from protocol static user@PE4# set from route-filter 44.0.0.0/24 exact user@PE4# set then aigp-originate distance 200 user@PE4# set then next-hop 10.100.1.4 user@PE4# set then accept 启用策略。 [edit policy-options policy-statement next-hop] user@PE4# set term 10 from protocol bgp user@PE4# set term 10 then next-hop 10.100.1.4 user@PE4# set term 10 then accept user@PE4# set term 20 from protocol direct user@PE4# set term 20 from route-filter 10.9.9.4/32 exact user@PE4# set term 20 from route-filter 10.100.1.4/32 exact user@PE4# set term 20 then next-hop 10.100.1.4 user@PE4# set term 20 then accept 配置静态路由。 [edit routing-options] user@PE4# set static route 44.0.0.0/24 discard 配置 IGP，例如 OSPF、RIP 或 IS-IS。 [edit protocols ospf] user@PE4# set area 0.0.0.0 interface fe-1/2/1.9 metric 1 user@PE4# set area 0.0.0.0 interface fe-1/2/0.7 metric 1 user@PE4# set area 0.0.0.0 interface 10.9.9.4 passive user@PE4# set area 0.0.0.0 interface 10.9.9.4 metric 1 user@PE4# set area 0.0.0.0 interface 10.100.1.4 passive user@PE4# set area 0.0.0.0 interface 10.100.1.4 metric 1 user@PE4# set area 0.0.0.2 interface fe-1/2/2.10 metric 1 user@PE4# set area 0.0.0.3 interface fe-1/0/2.12 metric 1 配置路由器 ID 和自治系统编号。 [edit routing-options] user@PE4# set router-id 10.9.9.4 user@PE4# set autonomous-system 13979 如果完成设备配置，请提交配置。 user@PE4# commit 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@PE4# show interfaces fe-1/0/2 { unit 12 { description PE4-to-PE3; family inet { address 10.0.0.25/30; } family mpls; } } fe-1/2/0 { unit 7 { description PE4-to-P2; family inet { address 10.0.0.14/30; } family mpls; } } fe-1/2/1 { unit 9 { description PE4-to-P1; family inet { address 10.0.0.18/30; } family mpls; } } fe-1/2/2 { unit 10 { description PE4-to-PE2; family inet { address 10.0.0.21/30; } family mpls; } } lo0 { unit 7 { family inet { address 10.9.9.4/32; address 10.100.1.4/32; } } } user@PE4# show policy-options policy-statement aigp { term 10 { from { protocol static; route-filter 44.0.0.0/24 exact; } then { aigp-originate distance 200; next-hop 10.100.1.4; accept; } } } policy-statement next-hop { term 10 { from protocol bgp; then { next-hop 10.100.1.4; accept; } } term 20 { from { protocol direct; route-filter 10.9.9.4/32 exact; route-filter 10.100.1.4/32 exact; } then { next-hop 10.100.1.4; accept; } } } user@PE4# show protocols rsvp { interface fe-1/2/0.7; interface fe-1/2/1.9; interface fe-1/2/2.10; interface fe-1/0/2.12; } mpls { label-switched-path PE4-to-PE2 { to 10.9.9.5; } label-switched-path PE4-to-PE3 { to 10.9.9.6; } label-switched-path PE4-to-P1 { to 10.9.9.2; } label-switched-path PE4-to-P2 { to 10.9.9.3; } interface fe-1/2/0.7; interface fe-1/2/1.9; interface fe-1/2/2.10; interface fe-1/0/2.12; } bgp { export [ next-hop aigp ]; group internal { type internal; local-address 10.9.9.4; family inet { labeled-unicast { aigp; } } neighbor 10.9.9.1; neighbor 10.9.9.3; neighbor 10.9.9.2; } group external { type external; multihop { ttl 2; } local-address 10.9.9.4; family inet { labeled-unicast { aigp; } } peer-as 7018; neighbor 10.9.9.5; neighbor 10.9.9.6; } } ospf { area 0.0.0.0 { interface fe-1/2/1.9 { metric 1; } interface fe-1/2/0.7 { metric 1; } interface 10.9.9.4 { passive; metric 1; } interface 10.100.1.4 { passive; metric 1; } } area 0.0.0.2 { interface fe-1/2/2.10 { metric 1; } } area 0.0.0.3 { interface fe-1/0/2.12 { metric 1; } } } user@PE4# show routing-options static { route 44.0.0.0/24 discard; } router-id 10.9.9.4; autonomous-system 13979;",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE4# set fe-1/2/0 unit 7 description PE4-to-P2",
                    "user@PE4# set fe-1/2/0 unit 7 family inet address 10.0.0.14/30",
                    "user@PE4# set fe-1/2/0 unit 7 family mpls",
                    "user@PE4# set fe-1/2/1 unit 9 description PE4-to-P1",
                    "user@PE4# set fe-1/2/1 unit 9 family inet address 10.0.0.18/30",
                    "user@PE4# set fe-1/2/1 unit 9 family mpls",
                    "user@PE4# set fe-1/2/2 unit 10 description PE4-to-PE2",
                    "user@PE4# set fe-1/2/2 unit 10 family inet address 10.0.0.21/30",
                    "user@PE4# set fe-1/2/2 unit 10 family mpls",
                    "user@PE4# set fe-1/0/2 unit 12 description PE4-to-PE3",
                    "user@PE4# set fe-1/0/2 unit 12 family inet address 10.0.0.25/30",
                    "user@PE4# set fe-1/0/2 unit 12 family mpls",
                    "user@PE4# set lo0 unit 7 family inet address 10.9.9.4/32",
                    "user@PE4# set lo0 unit 7 family inet address 10.100.1.4/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 MPLS 和信令协议，例如 RSVP 或 LDP。",
                  "code": [
                    "[edit protocols]",
                    "user@PE4# set rsvp interface fe-1/2/0.7",
                    "user@PE4# set rsvp interface fe-1/2/1.9",
                    "user@PE4# set rsvp interface fe-1/2/2.10",
                    "user@PE4# set rsvp interface fe-1/0/2.12",
                    "user@PE4# set mpls label-switched-path PE4-to-PE2 to 10.9.9.5",
                    "user@PE4# set mpls label-switched-path PE4-to-PE3 to 10.9.9.6",
                    "user@PE4# set mpls label-switched-path PE4-to-P1 to 10.9.9.2",
                    "user@PE4# set mpls label-switched-path PE4-to-P2 to 10.9.9.3",
                    "user@PE4# set mpls interface fe-1/2/0.7",
                    "user@PE4# set mpls interface fe-1/2/1.9",
                    "user@PE4# set mpls interface fe-1/2/2.10",
                    "user@PE4# set mpls interface fe-1/0/2.12"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp]",
                    "user@PE4# set export next-hop",
                    "user@PE4# set export aigp",
                    "user@PE4# set group internal type internal",
                    "user@PE4# set group internal local-address 10.9.9.4",
                    "user@PE4# set group internal neighbor 10.9.9.1",
                    "user@PE4# set group internal neighbor 10.9.9.3",
                    "user@PE4# set group internal neighbor 10.9.9.2",
                    "user@PE4# set group external type external",
                    "user@PE4# set group external multihop ttl 2",
                    "user@PE4# set group external local-address 10.9.9.4",
                    "user@PE4# set group external peer-as 7018",
                    "user@PE4# set group external neighbor 10.9.9.5",
                    "user@PE4# set group external neighbor 10.9.9.6"
                  ]
                },
                {
                  "step": 4,
                  "description": "启用 AIGP。",
                  "code": [
                    "[edit protocols bgp]",
                    "user@PE4# set group external family inet labeled-unicast aigp",
                    "user@PE4# set group internal family inet labeled-unicast aigp"
                  ]
                },
                {
                  "step": 5,
                  "description": "发起前缀，并配置 AIGP 距离。",
                  "code": [
                    "[edit policy-options policy-statement aigp term 10]",
                    "user@PE4# set from protocol static",
                    "user@PE4# set from route-filter 44.0.0.0/24 exact",
                    "user@PE4# set then aigp-originate distance 200",
                    "user@PE4# set then next-hop 10.100.1.4",
                    "user@PE4# set then accept"
                  ]
                },
                {
                  "step": 6,
                  "description": "启用策略。",
                  "code": [
                    "[edit policy-options policy-statement next-hop]",
                    "user@PE4# set term 10 from protocol bgp",
                    "user@PE4# set term 10 then next-hop 10.100.1.4",
                    "user@PE4# set term 10 then accept",
                    "user@PE4# set term 20 from protocol direct",
                    "user@PE4# set term 20 from route-filter 10.9.9.4/32 exact",
                    "user@PE4# set term 20 from route-filter 10.100.1.4/32 exact",
                    "user@PE4# set term 20 then next-hop 10.100.1.4",
                    "user@PE4# set term 20 then accept"
                  ]
                },
                {
                  "step": 7,
                  "description": "配置静态路由。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE4# set static route 44.0.0.0/24 discard"
                  ]
                },
                {
                  "step": 8,
                  "description": "配置 IGP，例如 OSPF、RIP 或 IS-IS。",
                  "code": [
                    "[edit protocols ospf]",
                    "user@PE4# set area 0.0.0.0 interface fe-1/2/1.9 metric 1",
                    "user@PE4# set area 0.0.0.0 interface fe-1/2/0.7 metric 1",
                    "user@PE4# set area 0.0.0.0 interface 10.9.9.4 passive",
                    "user@PE4# set area 0.0.0.0 interface 10.9.9.4 metric 1",
                    "user@PE4# set area 0.0.0.0 interface 10.100.1.4 passive",
                    "user@PE4# set area 0.0.0.0 interface 10.100.1.4 metric 1",
                    "user@PE4# set area 0.0.0.2 interface fe-1/2/2.10 metric 1",
                    "user@PE4# set area 0.0.0.3 interface fe-1/0/2.12 metric 1"
                  ]
                },
                {
                  "step": 9,
                  "description": "配置路由器 ID 和自治系统编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE4# set router-id 10.9.9.4",
                    "user@PE4# set autonomous-system 13979"
                  ]
                },
                {
                  "step": 10,
                  "description": "如果完成设备配置，请提交配置。",
                  "code": [
                    "user@PE4# commit"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "user@PE4#show interfacesfe-1/0/2 {\n    unit 12 {\n        description PE4-to-PE3;\n        family inet {\n            address 10.0.0.25/30;\n        }\n        family mpls;\n    }\n}\nfe-1/2/0 {\n    unit 7 {\n        description PE4-to-P2;\n        family inet {\n            address 10.0.0.14/30;\n        }\n        family mpls;\n    }\n}\nfe-1/2/1 {\n    unit 9 {\n        description PE4-to-P1;\n        family inet {\n            address 10.0.0.18/30;\n        }\n        family mpls;\n    }\n}\nfe-1/2/2 {\n    unit 10 {\n        description PE4-to-PE2;\n        family inet {\n            address 10.0.0.21/30;\n        }\n        family mpls;\n    }\n}\nlo0 {\n    unit 7 {\n        family inet {\n            address 10.9.9.4/32;\n            address 10.100.1.4/32;\n        }\n    }\n}",
                "user@PE4#show policy-optionspolicy-statement aigp {\n    term 10 {\n        from {\n            protocol static;\n            route-filter 44.0.0.0/24 exact;\n        }\n        then {\n            aigp-originate distance 200;\n            next-hop 10.100.1.4;\n            accept;\n        }\n    }\n}\npolicy-statement next-hop {\n    term 10 {\n        from protocol bgp;\n        then {\n            next-hop 10.100.1.4;\n            accept;\n        }\n    }\n    term 20 {\n        from {\n            protocol direct;\n            route-filter 10.9.9.4/32 exact;\n            route-filter 10.100.1.4/32 exact;\n        }\n        then {\n            next-hop 10.100.1.4;\n            accept;\n        }\n    }\n}",
                "user@PE4#show protocolsrsvp {\n    interface fe-1/2/0.7;\n    interface fe-1/2/1.9;\n    interface fe-1/2/2.10;\n    interface fe-1/0/2.12;\n}\nmpls {\n    label-switched-path PE4-to-PE2 {\n        to 10.9.9.5;\n    }\n    label-switched-path PE4-to-PE3 {\n        to 10.9.9.6;\n    }\n    label-switched-path PE4-to-P1 {\n        to 10.9.9.2;\n    }\n    label-switched-path PE4-to-P2 {\n        to 10.9.9.3;\n    }\n    interface fe-1/2/0.7;\n    interface fe-1/2/1.9;\n    interface fe-1/2/2.10;\n    interface fe-1/0/2.12;\n}\nbgp {\n    export [ next-hop aigp ];\n    group internal {\n        type internal;\n        local-address 10.9.9.4;\n        family inet {\n            labeled-unicast {\n                aigp;\n            }\n        }\n        neighbor 10.9.9.1;\n        neighbor 10.9.9.3;\n        neighbor 10.9.9.2;\n    }\n    group external {\n        type external;\n        multihop {\n            ttl 2;\n        }\n        local-address 10.9.9.4;\n        family inet {\n            labeled-unicast {\n                aigp;\n            }\n        }\n        peer-as 7018;\n        neighbor 10.9.9.5;\n        neighbor 10.9.9.6;\n    }\n}\nospf {\n    area 0.0.0.0 {\n        interface fe-1/2/1.9 {\n            metric 1;\n        }\n        interface fe-1/2/0.7 {\n            metric 1;\n        }\n        interface 10.9.9.4 {\n            passive;\n            metric 1;\n        }\n        interface 10.100.1.4 {\n            passive;\n            metric 1;\n        }\n    }\n    area 0.0.0.2 {\n        interface fe-1/2/2.10 {\n            metric 1;\n        }\n    }\n    area 0.0.0.3 {\n        interface fe-1/0/2.12 {\n            metric 1;\n        }\n    }\n}",
                "user@PE4#show routing-optionsstatic {\n    route 44.0.0.0/24 discard;\n}\nrouter-id 10.9.9.4;\nautonomous-system 13979;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 PE1",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 PE1： 配置接口。 [edit interfaces] user@PE1# set fe-1/2/0 unit 0 description PE1-to-P1 user@PE1# set fe-1/2/0 unit 0 family inet address 10.0.0.1/30 user@PE1# set fe-1/2/0 unit 0 family mpls user@PE1# set fe-1/2/1 unit 2 description PE1-to-P2 user@PE1# set fe-1/2/1 unit 2 family inet address 10.0.0.5/30 user@PE1# set fe-1/2/1 unit 2 family mpls user@PE1# set fe-1/2/2 unit 14 description PE1-to-PE7 user@PE1# set fe-1/2/2 unit 14 family inet address 10.0.0.9/30 user@PE1# set lo0 unit 1 family inet address 10.9.9.1/32 user@PE1# set lo0 unit 1 family inet address 10.100.1.1/32 配置 MPLS 和信令协议，例如 RSVP 或 LDP。 [edit protocols] user@PE1# set rsvp interface fe-1/2/0.0 user@PE1# set rsvp interface fe-1/2/1.2 user@PE1# set rsvp interface fe-1/2/2.14 user@PE1# set mpls label-switched-path PE1-to-P1 to 10.9.9.2 user@PE1# set mpls label-switched-path PE1-to-P2 to 10.9.9.3 user@PE1# set mpls interface fe-1/2/0.0 user@PE1# set mpls interface fe-1/2/1.2 user@PE1# set mpls interface fe-1/2/2.14 配置 BGP。 [edit protocols bgp] user@PE1# set group internal type internal user@PE1# set group internal local-address 10.9.9.1 user@PE1# set group internal export SET_EXPORT_ROUTES user@PE1# set group internal vpn-apply-export user@PE1# set group internal neighbor 10.9.9.4 user@PE1# set group internal neighbor 10.9.9.2 user@PE1# set group internal neighbor 10.9.9.3 user@PE1# set group external type external user@PE1# set group external export SET_EXPORT_ROUTES user@PE1# set group external peer-as 7019 user@PE1# set group external neighbor 10.0.0.10 启用 AIGP。 [edit protocols bgp] user@PE1# set group internal family inet labeled-unicast aigp user@PE1# set group external family inet labeled-unicast aigp 启用策略。 [edit policy-options policy-statement SET_EXPORT_ROUTES term 10] user@PE1# set from protocol direct user@PE1# set from protocol bgp user@PE1# set then next-hop 10.100.1.1 user@PE1# set then accept 配置 IGP，例如 OSPF、RIP 或 IS-IS。 [edit protocols ospf area 0.0.0.1] user@PE1# set interface fe-1/2/0.0 metric 1 user@PE1# set interface fe-1/2/1.2 metric 1 user@PE1# set interface 10.9.9.1 passive user@PE1# set interface 10.9.9.1 metric 1 user@PE1# set interface 10.100.1.1 passive user@PE1# set interface 10.100.1.1 metric 1 配置路由器 ID 和自治系统编号。 [edit routing-options] user@PE1# set router-id 10.9.9.1 user@PE1# set autonomous-system 13979 如果完成设备配置，请提交配置。 user@PE1# commit 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@PE1# show interfaces fe-1/2/0 { unit 0 { description PE1-to-P1; family inet { address 10.0.0.1/30; } family mpls; } } fe-1/2/1 { unit 2 { description PE1-to-P2; family inet { address 10.0.0.5/30; } family mpls; } } fe-1/2/2 { unit 14 { description PE1-to-PE7; family inet { address 10.0.0.9/30; } } } lo0 { unit 1 { family inet { address 10.9.9.1/32; address 10.100.1.1/32; } } } user@PE1# show policy-options policy-statement SET_EXPORT_ROUTES { term 10 { from protocol [ direct bgp ]; then { next-hop 10.100.1.1; accept; } } } user@PE1# show protocols rsvp { interface fe-1/2/0.0; interface fe-1/2/1.2; interface fe-1/2/2.14; } mpls { label-switched-path PE1-to-P1 { to 10.9.9.2; } label-switched-path PE1-to-P2 { to 10.9.9.3; } interface fe-1/2/0.0; interface fe-1/2/1.2; interface fe-1/2/2.14; } bgp { group internal { type internal; local-address 10.9.9.1; family inet { labeled-unicast { aigp; } } export SET_EXPORT_ROUTES; vpn-apply-export; neighbor 10.9.9.4; neighbor 10.9.9.2; neighbor 10.9.9.3; } group external { type external; family inet { labeled-unicast { aigp; } } export SET_EXPORT_ROUTES; peer-as 7019; neighbor 10.0.0.10; } } ospf { area 0.0.0.1 { interface fe-1/2/0.0 { metric 1; } interface fe-1/2/1.2 { metric 1; } interface 10.9.9.1 { passive; metric 1; } interface 10.100.1.1 { passive; metric 1; } } } user@PE1# show routing-options router-id 10.9.9.1; autonomous-system 13979;",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE1# set fe-1/2/0 unit 0 description PE1-to-P1",
                    "user@PE1# set fe-1/2/0 unit 0 family inet address 10.0.0.1/30",
                    "user@PE1# set fe-1/2/0 unit 0 family mpls",
                    "user@PE1# set fe-1/2/1 unit 2 description PE1-to-P2",
                    "user@PE1# set fe-1/2/1 unit 2 family inet address 10.0.0.5/30",
                    "user@PE1# set fe-1/2/1 unit 2 family mpls",
                    "user@PE1# set fe-1/2/2 unit 14 description PE1-to-PE7",
                    "user@PE1# set fe-1/2/2 unit 14 family inet address 10.0.0.9/30",
                    "user@PE1# set lo0 unit 1 family inet address 10.9.9.1/32",
                    "user@PE1# set lo0 unit 1 family inet address 10.100.1.1/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 MPLS 和信令协议，例如 RSVP 或 LDP。",
                  "code": [
                    "[edit protocols]",
                    "user@PE1# set rsvp interface fe-1/2/0.0",
                    "user@PE1# set rsvp interface fe-1/2/1.2",
                    "user@PE1# set rsvp interface fe-1/2/2.14",
                    "user@PE1# set mpls label-switched-path PE1-to-P1 to 10.9.9.2",
                    "user@PE1# set mpls label-switched-path PE1-to-P2 to 10.9.9.3",
                    "user@PE1# set mpls interface fe-1/2/0.0",
                    "user@PE1# set mpls interface fe-1/2/1.2",
                    "user@PE1# set mpls interface fe-1/2/2.14"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp]",
                    "user@PE1# set group internal type internal",
                    "user@PE1# set group internal local-address 10.9.9.1",
                    "user@PE1# set group internal export SET_EXPORT_ROUTES",
                    "user@PE1# set group internal vpn-apply-export",
                    "user@PE1# set group internal neighbor 10.9.9.4",
                    "user@PE1# set group internal neighbor 10.9.9.2",
                    "user@PE1# set group internal neighbor 10.9.9.3",
                    "user@PE1# set group external type external",
                    "user@PE1# set group external export SET_EXPORT_ROUTES",
                    "user@PE1# set group external peer-as 7019",
                    "user@PE1# set group external neighbor 10.0.0.10"
                  ]
                },
                {
                  "step": 4,
                  "description": "启用 AIGP。",
                  "code": [
                    "[edit protocols bgp]",
                    "user@PE1# set group internal family inet labeled-unicast aigp",
                    "user@PE1# set group external family inet labeled-unicast aigp"
                  ]
                },
                {
                  "step": 5,
                  "description": "启用策略。",
                  "code": [
                    "[edit policy-options policy-statement SET_EXPORT_ROUTES term 10]",
                    "user@PE1# set from protocol direct",
                    "user@PE1# set from protocol bgp",
                    "user@PE1# set then next-hop 10.100.1.1",
                    "user@PE1# set then accept"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置 IGP，例如 OSPF、RIP 或 IS-IS。",
                  "code": [
                    "[edit protocols ospf area 0.0.0.1]",
                    "user@PE1# set interface fe-1/2/0.0 metric 1",
                    "user@PE1# set interface fe-1/2/1.2 metric 1",
                    "user@PE1# set interface 10.9.9.1 passive",
                    "user@PE1# set interface 10.9.9.1 metric 1",
                    "user@PE1# set interface 10.100.1.1 passive",
                    "user@PE1# set interface 10.100.1.1 metric 1"
                  ]
                },
                {
                  "step": 7,
                  "description": "配置路由器 ID 和自治系统编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE1# set router-id 10.9.9.1",
                    "user@PE1# set autonomous-system 13979"
                  ]
                },
                {
                  "step": 8,
                  "description": "如果完成设备配置，请提交配置。",
                  "code": [
                    "user@PE1# commit"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "user@PE1#show interfacesfe-1/2/0 {\n    unit 0 {\n        description PE1-to-P1;\n        family inet {\n            address 10.0.0.1/30;\n        }\n        family mpls;\n    }\n}\nfe-1/2/1 {\n    unit 2 {\n        description PE1-to-P2;\n        family inet {\n            address 10.0.0.5/30;\n        }\n        family mpls;\n    }\n}\nfe-1/2/2 {\n    unit 14 {\n        description PE1-to-PE7;\n        family inet {\n            address 10.0.0.9/30;\n        }\n    }\n}\nlo0 {\n    unit 1 {\n        family inet {\n            address 10.9.9.1/32;\n            address 10.100.1.1/32;\n        }\n    }\n}",
                "user@PE1#show policy-optionspolicy-statement SET_EXPORT_ROUTES {\n    term 10 {\n        from protocol [ direct bgp ];\n        then {\n            next-hop 10.100.1.1;\n            accept;\n        }\n    }\n}",
                "user@PE1#show protocolsrsvp {\n    interface fe-1/2/0.0;\n    interface fe-1/2/1.2;\n    interface fe-1/2/2.14;\n}\nmpls {\n    label-switched-path PE1-to-P1 {\n        to 10.9.9.2;\n    }\n    label-switched-path PE1-to-P2 {\n        to 10.9.9.3;\n    }\n    interface fe-1/2/0.0;\n    interface fe-1/2/1.2;\n    interface fe-1/2/2.14;\n}\nbgp {\n    group internal {\n        type internal;\n        local-address 10.9.9.1;\n        family inet {\n            labeled-unicast {\n                aigp;\n            }\n        }\n        export SET_EXPORT_ROUTES;\n        vpn-apply-export;\n        neighbor 10.9.9.4;\n        neighbor 10.9.9.2;\n        neighbor 10.9.9.3;\n    }\n    group external {\n        type external;\n        family inet {\n            labeled-unicast {\n                aigp;\n            }\n        }\n        export SET_EXPORT_ROUTES;\n        peer-as 7019;\n        neighbor 10.0.0.10;\n    }\n}\nospf {\n    area 0.0.0.1 {\n        interface fe-1/2/0.0 {\n            metric 1;\n        }\n        interface fe-1/2/1.2 {\n            metric 1;\n        }\n        interface 10.9.9.1 {\n            passive;\n            metric 1;\n        }\n        interface 10.100.1.1 {\n            passive;\n            metric 1;\n        }\n    }\n}",
                "user@PE1#show routing-optionsrouter-id 10.9.9.1;\nautonomous-system 13979;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 PE2",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 PE2： 配置接口。 [edit interfaces] user@PE2# set fe-1/2/0 unit 11 description PE2-to-PE4 user@PE2# set fe-1/2/0 unit 11 family inet address 10.0.0.22/30 user@PE2# set fe-1/2/0 unit 11 family mpls user@PE2# set lo0 unit 9 family inet address 10.9.9.5/32 primary user@PE2# set lo0 unit 9 family inet address 10.100.1.5/32 配置 MPLS 和信令协议，例如 RSVP 或 LDP。 [edit protocols] user@PE2# set rsvp interface fe-1/2/0.11 user@PE2# set mpls label-switched-path PE2-to-PE4 to 10.9.9.4 user@PE2# set mpls interface fe-1/2/0.11 配置 BGP。 [edit protocols bgp] user@PE2# set group external type external user@PE2# set group external multihop ttl 2 user@PE2# set group external local-address 10.9.9.5 user@PE2# set group external export next-hop user@PE2# set group external export aigp user@PE2# set group external export SET_EXPORT_ROUTES user@PE2# set group external vpn-apply-export user@PE2# set group external peer-as 13979 user@PE2# set group external neighbor 10.9.9.4 启用 AIGP。 [edit protocols bgp] user@PE2# set group external family inet labeled-unicast aigp 发起前缀，并配置 AIGP 距离。 默认情况下，前缀是使用当前 IGP 距离发起的。或者，您可以使用选项 distance 为 AIGP 属性配置距离，如下所示。 [edit policy-options policy-statement aigp] user@PE2# set term 10 from route-filter 55.0.0.0/24 exact user@PE2# set term 10 then aigp-originate distance 20 user@PE2# set term 10 then next-hop 10.100.1.5 user@PE2# set term 10 then accept user@PE2# set term 20 from route-filter 99.0.0.0/24 exact user@PE2# set term 20 then aigp-originate distance 30 user@PE2# set term 20 then next-hop 10.100.1.5 user@PE2# set term 20 then accept 启用策略。 [edit policy-options] user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 from protocol direct user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 from protocol static user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.5 user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 then accept user@PE2# set policy-statement next-hop term 10 from protocol bgp user@PE2# set policy-statement next-hop term 10 then next-hop 10.100.1.5 user@PE2# set policy-statement next-hop term 10 then accept user@PE2# set policy-statement next-hop term 20 from protocol direct user@PE2# set policy-statement next-hop term 20 from route-filter 10.9.9.5/32 exact user@PE2# set policy-statement next-hop term 20 from route-filter 10.100.1.5/32 exact user@PE2# set policy-statement next-hop term 20 then next-hop 10.100.1.5 user@PE2# set policy-statement next-hop term 20 then accept 启用一些静态路由。 [edit routing-options] user@PE2# set static route 99.0.0.0/24 discard user@PE2# set static route 55.0.0.0/24 discard 配置 IGP，例如 OSPF、RIP 或 IS-IS。 [edit protocols ospf area 0.0.0.2] user@PE2# set interface 10.9.9.5 passive user@PE2# set interface 10.9.9.5 metric 1 user@PE2# set interface 10.100.1.5 passive user@PE2# set interface 10.100.1.5 metric 1 user@PE2# set interface fe-1/2/0.11 metric 1 配置路由器 ID 和自治系统编号。 [edit routing-options] user@PE2# set router-id 10.9.9.5 user@PE2# set autonomous-system 7018 如果完成设备配置，请提交配置。 user@PE2# commit 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@PE2# show interfaces fe-1/2/0 { unit 11 { description PE2-to-PE4; family inet { address 10.0.0.22/30; } family mpls; } } lo0 { unit 9 { family inet { address 10.9.9.5/32 { primary; } address 10.100.1.5/32; } } } user@PE2# show policy-options policy-statement SET_EXPORT_ROUTES { term 10 { from protocol [ direct static bgp ]; then { next-hop 10.100.1.5; accept; } } } policy-statement aigp { term 10 { from { route-filter 55.0.0.0/24 exact; } then { aigp-originate distance 20; next-hop 10.100.1.5; accept; } } term 20 { from { route-filter 99.0.0.0/24 exact; } then { aigp-originate distance 30; next-hop 10.100.1.5; accept; } } } policy-statement next-hop { term 10 { from protocol bgp; then { next-hop 10.100.1.5; accept; } } term 20 { from { protocol direct; route-filter 10.9.9.5/32 exact; route-filter 10.100.1.5/32 exact; } then { next-hop 10.100.1.5; accept; } } } user@PE2# show protocols rsvp { interface fe-1/2/0.11; } mpls { label-switched-path PE2-to-PE4 { to 10.9.9.4; } interface fe-1/2/0.11; } bgp { group external { type external; multihop { ttl 2; } local-address 10.9.9.5; family inet { labeled-unicast { aigp; } } export [ next-hop aigp SET_EXPORT_ROUTES ]; vpn-apply-export; peer-as 13979; neighbor 10.9.9.4; } } ospf { area 0.0.0.2 { interface 10.9.9.5 { passive; metric 1; } interface 10.100.1.5 { passive; metric 1; } interface fe-1/2/0.11 { metric 1; } } } user@PE2# show routing-options static { route 99.0.0.0/24 discard; route 55.0.0.0/24 discard; } router-id 10.9.9.5; autonomous-system 7018;",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE2# set fe-1/2/0 unit 11 description PE2-to-PE4",
                    "user@PE2# set fe-1/2/0 unit 11 family inet address 10.0.0.22/30",
                    "user@PE2# set fe-1/2/0 unit 11 family mpls",
                    "user@PE2# set lo0 unit 9 family inet address 10.9.9.5/32 primary",
                    "user@PE2# set lo0 unit 9 family inet address 10.100.1.5/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 MPLS 和信令协议，例如 RSVP 或 LDP。",
                  "code": [
                    "[edit protocols]",
                    "user@PE2# set rsvp interface fe-1/2/0.11",
                    "user@PE2# set mpls label-switched-path PE2-to-PE4 to 10.9.9.4",
                    "user@PE2# set mpls interface fe-1/2/0.11"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp]",
                    "user@PE2# set group external type external",
                    "user@PE2# set group external multihop ttl 2",
                    "user@PE2# set group external local-address 10.9.9.5",
                    "user@PE2# set group external export next-hop",
                    "user@PE2# set group external export aigp",
                    "user@PE2# set group external export SET_EXPORT_ROUTES",
                    "user@PE2# set group external vpn-apply-export",
                    "user@PE2# set group external peer-as 13979",
                    "user@PE2# set group external neighbor 10.9.9.4"
                  ]
                },
                {
                  "step": 4,
                  "description": "启用 AIGP。",
                  "code": [
                    "[edit protocols bgp]",
                    "user@PE2# set group external family inet labeled-unicast aigp"
                  ]
                },
                {
                  "step": 5,
                  "description": "发起前缀，并配置 AIGP 距离。",
                  "code": [
                    "[edit policy-options policy-statement aigp]",
                    "user@PE2# set term 10 from route-filter 55.0.0.0/24 exact",
                    "user@PE2# set term 10 then aigp-originate distance 20",
                    "user@PE2# set term 10 then next-hop 10.100.1.5",
                    "user@PE2# set term 10 then accept",
                    "user@PE2# set term 20 from route-filter 99.0.0.0/24 exact",
                    "user@PE2# set term 20 then aigp-originate distance 30",
                    "user@PE2# set term 20 then next-hop 10.100.1.5",
                    "user@PE2# set term 20 then accept"
                  ]
                },
                {
                  "step": 6,
                  "description": "启用策略。",
                  "code": [
                    "[edit policy-options]",
                    "user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 from protocol direct",
                    "user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 from protocol static",
                    "user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp",
                    "user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.5",
                    "user@PE2# set policy-statement SET_EXPORT_ROUTES term 10 then accept",
                    "user@PE2# set policy-statement next-hop term 10 from protocol bgp",
                    "user@PE2# set policy-statement next-hop term 10 then next-hop 10.100.1.5",
                    "user@PE2# set policy-statement next-hop term 10 then accept",
                    "user@PE2# set policy-statement next-hop term 20 from protocol direct",
                    "user@PE2# set policy-statement next-hop term 20 from route-filter 10.9.9.5/32 exact",
                    "user@PE2# set policy-statement next-hop term 20 from route-filter 10.100.1.5/32 exact",
                    "user@PE2# set policy-statement next-hop term 20 then next-hop 10.100.1.5",
                    "user@PE2# set policy-statement next-hop term 20 then accept"
                  ]
                },
                {
                  "step": 7,
                  "description": "启用一些静态路由。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE2# set static route 99.0.0.0/24 discard",
                    "user@PE2# set static route 55.0.0.0/24 discard"
                  ]
                },
                {
                  "step": 8,
                  "description": "配置 IGP，例如 OSPF、RIP 或 IS-IS。",
                  "code": [
                    "[edit protocols ospf area 0.0.0.2]",
                    "user@PE2# set interface 10.9.9.5 passive",
                    "user@PE2# set interface 10.9.9.5 metric 1",
                    "user@PE2# set interface 10.100.1.5 passive",
                    "user@PE2# set interface 10.100.1.5 metric 1",
                    "user@PE2# set interface fe-1/2/0.11 metric 1"
                  ]
                },
                {
                  "step": 9,
                  "description": "配置路由器 ID 和自治系统编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE2# set router-id 10.9.9.5",
                    "user@PE2# set autonomous-system 7018"
                  ]
                },
                {
                  "step": 10,
                  "description": "如果完成设备配置，请提交配置。",
                  "code": [
                    "user@PE2# commit"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "user@PE2#show interfacesfe-1/2/0 {\n    unit 11 {\n        description PE2-to-PE4;\n        family inet {\n            address 10.0.0.22/30;\n        }\n        family mpls;\n    }\n}\nlo0 {\n    unit 9 {\n        family inet {\n            address 10.9.9.5/32 {\n                primary;\n            }\n            address 10.100.1.5/32;\n        }\n    }\n}",
                "user@PE2#show policy-optionspolicy-statement SET_EXPORT_ROUTES {\n    term 10 {\n        from protocol [ direct static bgp ];\n        then {\n            next-hop 10.100.1.5;\n            accept;\n        }\n    }\n}\npolicy-statement aigp {\n    term 10 {\n        from {\n            route-filter 55.0.0.0/24 exact;\n        }\n        then {\n            aigp-originate distance 20;\n            next-hop 10.100.1.5;\n            accept;\n        }\n    }\n    term 20 {\n        from {\n            route-filter 99.0.0.0/24 exact;\n        }\n        then {\n            aigp-originate distance 30;\n            next-hop 10.100.1.5;\n            accept;\n        }\n    }\n}\npolicy-statement next-hop {\n    term 10 {\n        from protocol bgp;\n        then {\n            next-hop 10.100.1.5;\n            accept;\n        }\n    }\n    term 20 {\n        from {\n            protocol direct;\n            route-filter 10.9.9.5/32 exact;\n            route-filter 10.100.1.5/32 exact;\n        }\n        then {\n            next-hop 10.100.1.5;\n            accept;\n        }\n    }\n}",
                "user@PE2#show protocolsrsvp {\n    interface fe-1/2/0.11;\n}\nmpls {\n    label-switched-path PE2-to-PE4 {\n        to 10.9.9.4;\n    }\n    interface fe-1/2/0.11;\n}\nbgp {\n    group external {\n        type external;\n        multihop {\n            ttl 2;\n        }\n        local-address 10.9.9.5;\n        family inet {\n            labeled-unicast {\n                aigp;\n            }\n        }\n        export [ next-hop aigp SET_EXPORT_ROUTES ];\n        vpn-apply-export;\n        peer-as 13979;\n        neighbor 10.9.9.4;\n    }\n}\nospf {\n    area 0.0.0.2 {\n        interface 10.9.9.5 {\n            passive;\n            metric 1;\n        }\n        interface 10.100.1.5 {\n            passive;\n            metric 1;\n        }\n        interface fe-1/2/0.11 {\n            metric 1;\n        }\n    }\n}",
                "user@PE2#show routing-optionsstatic {\n    route 99.0.0.0/24 discard;\n    route 55.0.0.0/24 discard;\n}\nrouter-id 10.9.9.5;\nautonomous-system 7018;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 PE3",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 PE3： 配置接口。 [edit interfaces] user@PE3# set fe-1/2/0 unit 13 description PE3-to-PE4 user@PE3# set fe-1/2/0 unit 13 family inet address 10.0.0.26/30 user@PE3# set fe-1/2/0 unit 13 family mpls user@PE3# set lo0 unit 11 family inet address 10.9.9.6/32 user@PE3# set lo0 unit 11 family inet address 10.100.1.6/32 配置 MPLS 和信令协议，例如 RSVP 或 LDP。 [edit protocols] user@PE3# set rsvp interface fe-1/2/0.13 user@PE3# set mpls label-switched-path PE3-to-PE4 to 10.9.9.4 user@PE3# set mpls interface fe-1/2/0.13 配置 BGP。 [edit protocols bgp group external] user@PE3# set type external user@PE3# set multihop ttl 2 user@PE3# set local-address 10.9.9.6 user@PE3# set export next-hop user@PE3# set export SET_EXPORT_ROUTES user@PE3# set vpn-apply-export user@PE3# set peer-as 13979 user@PE3# set neighbor 10.9.9.4 启用 AIGP。 [edit protocols bgp group external] user@PE3# set family inet labeled-unicast aigp 启用策略。 [edit policy-options] user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 from protocol direct user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 from protocol static user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.6 user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 then accept user@PE3# set policy-statement next-hop term 10 from protocol bgp user@PE3# set policy-statement next-hop term 10 then next-hop 10.100.1.6 user@PE3# set policy-statement next-hop term 10 then accept user@PE3# set policy-statement next-hop term 20 from protocol direct user@PE3# set policy-statement next-hop term 20 from route-filter 10.9.9.6/32 exact user@PE3# set policy-statement next-hop term 20 from route-filter 10.100.1.6/32 exact user@PE3# set policy-statement next-hop term 20 then next-hop 10.100.1.6 user@PE3# set policy-statement next-hop term 20 then accept 配置 IGP，例如 OSPF、RIP 或 IS-IS。 [edit protocols ospf area 0.0.0.3] user@PE3# set interface 10.9.9.6 passive user@PE3# set interface 10.9.9.6 metric 1 user@PE3# set interface 10.100.1.6 passive user@PE3# set interface 10.100.1.6 metric 1 user@PE3# set interface fe-1/2/0.13 metric 1 配置路由器 ID 和自治系统编号。 [edit routing-options] user@PE3# set router-id 10.9.9.6 user@PE3# set autonomous-system 7018 如果完成设备配置，请提交配置。 user@PE3# commit 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@PE3# show interfaces fe-1/2/0 { unit 13 { description PE3-to-PE4; family inet { address 10.0.0.26/30; } family mpls; } } lo0 { unit 11 { family inet { address 10.9.9.6/32; address 10.100.1.6/32; } } } user@PE3# show policy-options policy-statement SET_EXPORT_ROUTES { term 10 { from protocol [ direct static bgp ]; then { next-hop 10.100.1.6; accept; } } } policy-statement next-hop { term 10 { from protocol bgp; then { next-hop 10.100.1.6; accept; } } term 20 { from { protocol direct; route-filter 10.9.9.6/32 exact; route-filter 10.100.1.6/32 exact; } then { next-hop 10.100.1.6; accept; } } } user@PE3# show protocols rsvp { interface fe-1/2/0.13; } mpls { label-switched-path PE3-to-PE4 { to 10.9.9.4; } interface fe-1/2/0.13; } bgp { group external { type external; multihop { ttl 2; } local-address 10.9.9.6; family inet { labeled-unicast { aigp; } } export [ next-hop SET_EXPORT_ROUTES ]; vpn-apply-export; peer-as 13979; neighbor 10.9.9.4; } } ospf { area 0.0.0.3 { interface 10.9.9.6 { passive; metric 1; } interface 10.100.1.6 { passive; metric 1; } interface fe-1/2/0.13 { metric 1; } } } user@PE3# show routing-options router-id 10.9.9.6; autonomous-system 7018;",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE3# set fe-1/2/0 unit 13 description PE3-to-PE4",
                    "user@PE3# set fe-1/2/0 unit 13 family inet address 10.0.0.26/30",
                    "user@PE3# set fe-1/2/0 unit 13 family mpls",
                    "user@PE3# set lo0 unit 11 family inet address 10.9.9.6/32",
                    "user@PE3# set lo0 unit 11 family inet address 10.100.1.6/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 MPLS 和信令协议，例如 RSVP 或 LDP。",
                  "code": [
                    "[edit protocols]",
                    "user@PE3# set rsvp interface fe-1/2/0.13",
                    "user@PE3# set mpls label-switched-path PE3-to-PE4 to 10.9.9.4",
                    "user@PE3# set mpls interface fe-1/2/0.13"
                  ]
                },
                {
                  "step": 3,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group external]",
                    "user@PE3# set type external",
                    "user@PE3# set multihop ttl 2",
                    "user@PE3# set local-address 10.9.9.6",
                    "user@PE3# set export next-hop",
                    "user@PE3# set export SET_EXPORT_ROUTES",
                    "user@PE3# set vpn-apply-export",
                    "user@PE3# set peer-as 13979",
                    "user@PE3# set neighbor 10.9.9.4"
                  ]
                },
                {
                  "step": 4,
                  "description": "启用 AIGP。",
                  "code": [
                    "[edit protocols bgp group external]",
                    "user@PE3# set family inet labeled-unicast aigp"
                  ]
                },
                {
                  "step": 5,
                  "description": "启用策略。",
                  "code": [
                    "[edit policy-options]",
                    "user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 from protocol direct",
                    "user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 from protocol static",
                    "user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 from protocol bgp",
                    "user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 then next-hop 10.100.1.6",
                    "user@PE3# set policy-statement SET_EXPORT_ROUTES term 10 then accept",
                    "user@PE3# set policy-statement next-hop term 10 from protocol bgp",
                    "user@PE3# set policy-statement next-hop term 10 then next-hop 10.100.1.6",
                    "user@PE3# set policy-statement next-hop term 10 then accept",
                    "user@PE3# set policy-statement next-hop term 20 from protocol direct",
                    "user@PE3# set policy-statement next-hop term 20 from route-filter 10.9.9.6/32 exact",
                    "user@PE3# set policy-statement next-hop term 20 from route-filter 10.100.1.6/32 exact",
                    "user@PE3# set policy-statement next-hop term 20 then next-hop 10.100.1.6",
                    "user@PE3# set policy-statement next-hop term 20 then accept"
                  ]
                },
                {
                  "step": 6,
                  "description": "配置 IGP，例如 OSPF、RIP 或 IS-IS。",
                  "code": [
                    "[edit protocols ospf area 0.0.0.3]",
                    "user@PE3# set interface 10.9.9.6 passive",
                    "user@PE3# set interface 10.9.9.6 metric 1",
                    "user@PE3# set interface 10.100.1.6 passive",
                    "user@PE3# set interface 10.100.1.6 metric 1",
                    "user@PE3# set interface fe-1/2/0.13 metric 1"
                  ]
                },
                {
                  "step": 7,
                  "description": "配置路由器 ID 和自治系统编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE3# set router-id 10.9.9.6",
                    "user@PE3# set autonomous-system 7018"
                  ]
                },
                {
                  "step": 8,
                  "description": "如果完成设备配置，请提交配置。",
                  "code": [
                    "user@PE3# commit"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "user@PE3#show interfacesfe-1/2/0 {\n    unit 13 {\n        description PE3-to-PE4;\n        family inet {\n            address 10.0.0.26/30;\n        }\n        family mpls;\n    }\n}\nlo0 {\n    unit 11 {\n        family inet {\n            address 10.9.9.6/32;\n            address 10.100.1.6/32;\n        }\n    }\n}",
                "user@PE3#show policy-optionspolicy-statement SET_EXPORT_ROUTES {\n    term 10 {\n        from protocol [ direct static bgp ];\n        then {\n            next-hop 10.100.1.6;\n            accept;\n        }\n    }\n}\npolicy-statement next-hop {\n    term 10 {\n        from protocol bgp;\n        then {\n            next-hop 10.100.1.6;\n            accept;\n        }\n    }\n    term 20 {\n        from {\n            protocol direct;\n            route-filter 10.9.9.6/32 exact;\n            route-filter 10.100.1.6/32 exact;\n        }\n        then {\n            next-hop 10.100.1.6;\n            accept;\n        }\n    }\n}",
                "user@PE3#show protocolsrsvp {\n    interface fe-1/2/0.13;\n}\nmpls {\n    label-switched-path PE3-to-PE4 {\n        to 10.9.9.4;\n    }\n    interface fe-1/2/0.13;\n}\nbgp {\n    group external {\n        type external;\n        multihop {\n            ttl 2;\n        }\n        local-address 10.9.9.6;\n        family inet {\n            labeled-unicast {\n                aigp;\n            }\n        }\n        export [ next-hop SET_EXPORT_ROUTES ];\n        vpn-apply-export;\n        peer-as 13979;\n        neighbor 10.9.9.4;\n    }\n}\nospf {\n    area 0.0.0.3 {\n        interface 10.9.9.6 {\n            passive;\n            metric 1;\n        }\n        interface 10.100.1.6 {\n            passive;\n            metric 1;\n        }\n        interface fe-1/2/0.13 {\n            metric 1;\n        }\n    }\n}",
                "user@PE3#show routing-optionsrouter-id 10.9.9.6;\nautonomous-system 7018;"
              ]
            }
          ]
        },
        {
          "title": "配置设备 PE7",
          "level": 4,
          "content": "下面的示例要求您在各个配置层级中进行导航。有关导航 CLI 的信息，请参阅《Junos OS CLI 用户指南》中的在配置模式下使用 CLI 编辑器。 要配置设备 PE7： 配置接口。 [edit interfaces] user@PE7# set fe-1/2/0 unit 15 description PE7-to-PE1 user@PE7# set fe-1/2/0 unit 15 family inet address 10.0.0.10/30 user@PE7# set lo0 unit 13 family inet address 10.9.9.7/32 user@PE7# set lo0 unit 13 family inet address 10.100.1.7/32 配置 BGP。 [edit protocols bgp group external] user@PE7# set type external user@PE7# set export SET_EXPORT_ROUTES user@PE7# set peer-as 13979 user@PE7# set neighbor 10.0.0.9 启用 AIGP。 [edit protocols bgp group external] user@PE7# set family inet labeled-unicast aigp 配置路由策略。 [edit policy-options policy-statement SET_EXPORT_ROUTES term 10] user@PE7# set from protocol direct user@PE7# set from protocol bgp user@PE7# set then next-hop 10.100.1.7 user@PE7# set then accept 配置路由器 ID 和自治系统编号。 [edit routing-options] user@PE7# set router-id 10.9.9.7 user@PE7# set autonomous-system 7019 如果完成设备配置，请提交配置。 user@PE7# commit 在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。 user@PE7# show interfaces interfaces { fe-1/2/0 { unit 15 { description PE7-to-PE1; family inet { address 10.0.0.10/30; } } } lo0 { unit 13 { family inet { address 10.9.9.7/32; address 10.100.1.7/32; } } } } user@PE7# show policy-options policy-statement SET_EXPORT_ROUTES { term 10 { from protocol [ direct bgp ]; then { next-hop 10.100.1.7; accept; } } } user@PE7# show protocols bgp { group external { type external; family inet { labeled-unicast { aigp; } } export SET_EXPORT_ROUTES; peer-as 13979; neighbor 10.0.0.9; } } user@PE7# show routing-options router-id 10.9.9.7; autonomous-system 7019;",
          "sections": [
            {
              "title": "分步过程",
              "level": 5,
              "step_by_step": [
                {
                  "step": 1,
                  "description": "配置接口。",
                  "code": [
                    "[edit interfaces]",
                    "user@PE7# set fe-1/2/0 unit 15 description PE7-to-PE1",
                    "user@PE7# set fe-1/2/0 unit 15 family inet address 10.0.0.10/30",
                    "user@PE7# set lo0 unit 13 family inet address 10.9.9.7/32",
                    "user@PE7# set lo0 unit 13 family inet address 10.100.1.7/32"
                  ]
                },
                {
                  "step": 2,
                  "description": "配置 BGP。",
                  "code": [
                    "[edit protocols bgp group external]",
                    "user@PE7# set type external",
                    "user@PE7# set export SET_EXPORT_ROUTES",
                    "user@PE7# set peer-as 13979",
                    "user@PE7# set neighbor 10.0.0.9"
                  ]
                },
                {
                  "step": 3,
                  "description": "启用 AIGP。",
                  "code": [
                    "[edit protocols bgp group external]",
                    "user@PE7# set family inet labeled-unicast aigp"
                  ]
                },
                {
                  "step": 4,
                  "description": "配置路由策略。",
                  "code": [
                    "[edit policy-options policy-statement SET_EXPORT_ROUTES term 10]",
                    "user@PE7# set from protocol direct",
                    "user@PE7# set from protocol bgp",
                    "user@PE7# set then next-hop 10.100.1.7",
                    "user@PE7# set then accept"
                  ]
                },
                {
                  "step": 5,
                  "description": "配置路由器 ID 和自治系统编号。",
                  "code": [
                    "[edit routing-options]",
                    "user@PE7# set router-id 10.9.9.7",
                    "user@PE7# set autonomous-system 7019"
                  ]
                },
                {
                  "step": 6,
                  "description": "如果完成设备配置，请提交配置。",
                  "code": [
                    "user@PE7# commit"
                  ]
                }
              ]
            },
            {
              "title": "结果",
              "level": 5,
              "content": "在配置模式下，输入 show interfaces 、 show policy-options 、 show protocols 和 show routing-options 命令，以确认您的配置。如果输出未显示预期的配置，请重复此示例中的说明，以便进行更正。",
              "code": [
                "user@PE7#show interfacesinterfaces {\n    fe-1/2/0 {\n        unit 15 {\n            description PE7-to-PE1;\n            family inet {\n                address 10.0.0.10/30;\n            }\n        }\n    }\n    lo0 {\n        unit 13 {\n            family inet {\n                address 10.9.9.7/32;\n                address 10.100.1.7/32;\n            }\n        }\n    }\n}",
                "user@PE7#show policy-optionspolicy-statement SET_EXPORT_ROUTES {\n    term 10 {\n        from protocol [ direct bgp ];\n        then {\n            next-hop 10.100.1.7;\n            accept;\n        }\n    }\n}",
                "user@PE7#show protocolsbgp {\n    group external {\n        type external;\n        family inet {\n            labeled-unicast {\n                aigp;\n            }\n        }\n        export SET_EXPORT_ROUTES;\n        peer-as 13979;\n        neighbor 10.0.0.9;\n    }\n}",
                "user@PE7#show routing-optionsrouter-id 10.9.9.7;\nautonomous-system 7019;"
              ]
            }
          ]
        }
      ]
    }
  ],
  "content": "此示例说明如何为 BGP 配置累积 IGP （AIGP） 指标属性。 要求 此示例使用以下硬件和软件组件： 七个 BGP 接口设备。 Junos OS 12.1 或更高版本。 概述 AIGP 属性支持单个管理部门可以运行多个连续的 BGP 自治系统 （AS） 的部署。此类部署允许 BGP 根据 IGP 指标做出路由决策。启用 AIGP 后，BGP 可以根据 IGP 指标选择路径。这使 BGP 能够选择两个节点之间的最短路径，即使这些节点可能位于不同的 AS 中。AIGP 属性在使用隧道将数据包传送到其 BGP 下一跃点的网络中特别有用。此示例显示了配置了 MPLS 标签交换路径的 AIGP。 要启用 AIGP，您需要在 aigp 协议家族的 BGP 配置中包含该语句。在特定家族上配置 AIGP 可以在该家族上发送和接收 AIGP 属性。默认情况下，AIGP 处于禁用状态。禁用 AIGP 的邻居不会发送 AIGP 属性，而是以静默方式丢弃收到的 AIGP 属性。 Junos OS 支持 AIGP 和 family inet labeled-unicast family inet6 labeled-unicast 。可以在全局 BGP、组或邻居级别为给定系列配置语句 aigp 。 默认情况下，本地前缀的 AIGP 属性值为零。启用了 AIGP 的邻居可以使用策略 aigp-originate 操作，通过导出策略为给定前缀发起 AIGP 属性。AIGP 属性的值反映到前缀的 IGP 距离。或者，您可以使用策略操作指定 aigp-originate distance distance 一个值。可配置范围为 0 到 4,294,967,295。只需一个节点即可发起 AIGP 属性。如果使用 BGP 配置中的语句启用了 aigp 邻接方 AIGP，则会保留并重新通告 AIGP 属性。 发起 AIGP 属性的策略操作具有以下要求： 邻居必须启用 AIGP。 策略必须作为导出策略应用。 前缀必须没有当前 AIGP 属性。 前缀必须使用下一跃点自导出。 前缀必须位于 AIGP 域中。通常，环路 IP 地址是要发起的前缀。 如果不满足这些要求，则忽略该策略。 拓扑图 图 4 显示了此示例中使用的拓扑。OSPF 用作内部网关协议 （IGP）。在设备 PE1 和设备 PE4 之间配置内部 BGP。外部 BGP （EBGP） 在设备 PE7 和设备 PE1 之间、设备 PE4 和设备 PE3 之间以及设备 PE4 和设备 PE2 之间配置。设备 PE4、PE2 和 PE3 配置为多跳。设备 PE4 根据 AIGP 值选择路径，然后根据 AIGP 和策略配置重新播发 AIGP 值。设备 PE1 将 AIGP 值重新播发到另一个管理域中的设备 PE7。每个设备都有两个环路接口地址：10.9.9.x 用于 BGP 对等互连和路由器 ID，10.100.1.x 用于 BGP 下一跃点。 设备 PE1 和 PE3 之间的网络具有 IBGP 对等和多个 OSPF 区域。指向设备 PE7 的外部链接配置为显示 AIGP 属性已重新播发到管理域之外的邻接方（如果该邻接方已启用 AIGP）。 图 4： BGP 中多路径通告 对于 AIGP 属性的发起，BGP 下一跃点必须是自身。如果 BGP 下一跃点保持不变，则收到的 AIGP 属性将按原样重新播发到另一个 AIGP 邻接方。如果下一跃点发生变化，则收到的 AIGP 属性将以增加的值重新播发到另一个 AIGP 邻接方。值的增加反映了到上一个 BGP 下一跃点的 IGP 距离。为了进行演示，此示例将环路接口地址用于设备 PE4 与设备 PE2 和设备 PE3 的 EBGP 对等会话。在这些会话上启用多跳，以便执行递归查找以确定点对点接口。由于下一跃点会更改，因此 IGP 距离将添加到 AIGP 距离中"
}