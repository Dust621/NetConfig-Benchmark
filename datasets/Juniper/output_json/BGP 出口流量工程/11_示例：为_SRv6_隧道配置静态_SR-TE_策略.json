{
  "title": "示例：为 SRv6 隧道配置静态 SR-TE 策略",
  "sections": [
    {
      "title": "概述",
      "level": 3,
      "content": "此示例说明如何为 SRv6 隧道配置静态 SR-TE 策略。此 SRv6 TE 策略对于网络主要为 IPv6 且尚未部署 MPLS 的服务提供商非常有用。此类网络仅依靠 IPv6 报头和报头扩展来传输数据。SRv6 网络编程提供了利用分段路由的灵活性，无需部署 MPLS。 下图描述了一种 SRv6 TE 拓扑，其中设备 R1 和设备 R6 是支持 IPv4 或 IPv6 设备 CE1 和 CE2 的入口和出口路由器。设备 R2、R3、R4 和 R5 构成了仅支持 IPv6 的提供商核心网络。所有设备都属于同一个自治系统。IS-IS 是 IPv6 核心中的内部网关协议，配置为支持 SRv6。在此示例中，出口设备 R6 将 L3VPN SID 播发至入口设备 R1，后者接受并更新 VRF 表。设备 R6 配置为 2001：db8：0：a6：:d 06 作为端 sid，L3VPN 服务导出到 CE7 到 R1，下一跃点为 2001：db8：0：a6：:d 06。有两个区段列表：<R4、R5、R6> 和 <R2、R3、R6>。",
      "sections": [
        {
          "title": "拓扑学",
          "level": 4,
          "content": "下图描述了一种 SRv6 TE 拓扑，其中设备 R1 和设备 R6 是支持 IPv4 或 IPv6 设备 CE1 和 CE2 的入口和出口路由器。设备 R2、R3、R4 和 R5 构成了仅支持 IPv6 的提供商核心网络。所有设备都属于同一个自治系统。IS-IS 是 IPv6 核心中的内部网关协议，配置为支持 SRv6。在此示例中，出口设备 R6 将 L3VPN SID 播发至入口设备 R1，后者接受并更新 VRF 表。设备 R6 配置为 2001：db8：0：a6：:d 06 作为端 sid，L3VPN 服务导出到 CE7 到 R1，下一跃点为 2001：db8：0：a6：:d 06。有两个区段列表：<R4、R5、R6> 和 <R2、R3、R6>。",
          "images": [
            "BGP 出口流量工程\\images\\11_示例：为_SRv6_隧道配置静态_SR-_1.png"
          ]
        }
      ]
    },
    {
      "title": "要求",
      "level": 3,
      "content": "此示例使用以下硬件和软件组件： 六个 MX 系列路由器。 Junos OS 21.3R1 或更高版本。 此示例使用以下硬件和软件组件： 六个 MX 系列路由器。 Junos OS 21.3R1 或更高版本。"
    },
    {
      "title": "配置",
      "level": 3,
      "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改任何必要的详细信息以匹配您的网络配置，然后将命令复制并粘贴到 [edit] 层次结构级别的 CLI 中，然后从配置模式进入提交。 设备 R1 set interfaces ge-0/0/0 unit 0 description R1_to_CE0 set interfaces ge-0/0/0 unit 0 family inet address 192.168.10.2/24 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:10::2/64 set interfaces ge-0/0/3 unit 0 description R1_to_R2 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family inet6 address 2001:db8:12::1/64 set interfaces ge-0/0/3 unit 0 description R1_to_R4 set interfaces ge-0/0/5 unit 0 family iso set interfaces ge-0/0/5 unit 0 family inet6 address 2001:db8:14::1/64 set interfaces lo0 unit 0 family iso address 49.0001.0001.0101.0100 set interfaces lo0 unit 0 family inet6 address 2001:db8:1:255::1/128 set policy-options policy-statement to_CE0_community_export term 0 then community add to_CE0_community set policy-options policy-statement to_CE0_community_export term 0 then next-hop 2001:db8:0:a1::d01 set policy-options policy-statement to_CE0_community_export term 0 then accept set policy-options policy-statement to_CE0_community_import term 0 from community to_CE0_community set policy-options policy-statement to_CE0_community_import term 0 then accept set policy-options policy-statement v4vpn1_res_map1 term 1 from protocol bgp set policy-options policy-statement v4vpn1_res_map1 term 1 then accept set policy-options policy-statement v4vpn1_res_map1 term 1 then resolution-map map1 set policy-options policy-statement v6vpn1_res_map1 term 1 from family inet6-vpn set policy-options policy-statement v6vpn1_res_map1 term 1 from protocol bgp set policy-options policy-statement v6vpn1_res_map1 term 1 then accept set policy-options policy-statement v6vpn1_res_map1 term 1 then resolution-map map1 set policy-options policy-statement LBPP term 1 then load-balance per-packet set policy-options policy-statement mpath-resolve then multipath-resolve set policy-options resolution-map map1 mode ip-color set policy-options community to_CE0_community members target:65500:1 set routing-instances to_CE0 instance-type vrf set routing-instances to_CE0 protocols bgp group to_CE0_v6 type external set routing-instances to_CE0 protocols bgp group to_CE0_v6 peer-as 65000 set routing-instances to_CE0 protocols bgp group to_CE0_v6 neighbor 2001:db8:10::1 set routing-instances to_CE0 protocols bgp group to_CE0_v4 type external set routing-instances to_CE0 protocols bgp group to_CE0_v4 peer-as 65000 set routing-instances to_CE0 protocols bgp group to_CE0_v4 neighbor 192.168.10.1 set routing-instances to_CE0 protocols bgp source-packet-routing srv6 locator loc1 end-dt4-sid 2001:db8:0:a1::d410 set routing-instances to_CE0 protocols bgp source-packet-routing srv6 locator loc1 end-dt6-sid 2001:db8:0:a1::d610 set routing-instances to_CE0 interface ge-0/0/0.0 set routing-instances to_CE0 route-distinguisher 192.168.255.11:1 set routing-instances to_CE0 vrf-import to_CE0_community_import set routing-instances to_CE0 vrf-export to_CE0_community_export set routing-options source-packet-routing srv6 locator loc1 2001:db8:0:a1::/64 set routing-options resolution preserve-nexthop-hierarchy set routing-options resolution rib bgp.l3vpn-inet6.0 resolution-ribs inet6.3 set routing-options resolution rib bgp.l3vpn-inet6.0 inet6-resolution-ribs inet6.3 set routing-options resolution rib bgp.l3vpn-inet6.0 import mpath-resolve set routing-options resolution rib bgp.l3vpn-inet6.0 inet6-import mpath-resolve set routing-options resolution rib bgp.l3vpn-inet6.0 inet6color-import mpath-resolve set routing-options resolution rib bgp.l3vpn.0 import mpath-resolve set routing-options resolution rib bgp.l3vpn.0 inet6-import mpath-resolve set routing-options resolution rib inet6.0 import mpath-resolve set routing-options resolution rib inet.0 import mpath-resolve set routing-options router-id 192.168.255.11 set routing-options autonomous-system 65500 set routing-options forwarding-table srv6-chain-merge set routing-options forwarding-table export LBPP set protocols bgp group to_R6_ibgpv6 type internal set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast accept-srv6-service set protocols bgp group to_R6_ibgpv6 family inet6 unicast extended-nexthop-color set protocols bgp group to_R6_ibgpv6 family inet6-vpn unicast advertise-srv6-service set protocols bgp group to_R6_ibgpv6 family inet6-vpn unicast accept-srv6-service set protocols bgp group to_R6_ibgpv6 local-address 2001:db8:1:255::1 set protocols bgp group to_R6_ibgpv6 import v4vpn1_res_map1 set protocols bgp group to_R6_ibgpv6 import v6vpn1_res_map1 set protocols bgp group to_R6_ibgpv6 family inet unicast extended-nexthop set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast extended-nexthop set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast advertise-srv6-service set protocols bgp group to_R6_ibgpv6 neighbor 2001:db8:6:255::6 set protocols bgp multipath set protocols isis interface ge-0/0/3.0 level 2 disable set protocols isis interface ge-0/0/3.0 level 1 srv6-adjacency-segment unprotected locator loc1 end-x-sid 2001:db8:0:a1::1a12 flavor psp set protocols isis interface ge-0/0/3.0 level 1 srv6-adjacency-segment unprotected locator loc1 end-x-sid 2001:db8:0:a1::1a12 flavor usd set protocols isis interface ge-0/0/3.0 point-to-point set protocols isis interface ge-0/0/5.0 level 2 disable set protocols isis interface ge-0/0/5.0 level 1 post-convergence-lfa set protocols isis interface ge-0/0/5.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 set protocols isis source-packet-routing node-segment ipv6-index 101 set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor psp set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor usp set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor usd set protocols isis backup-spf-options use-post-convergence-lfa set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols source-packet-routing segment-list end-sids-segment srv6 set protocols source-packet-routing segment-list end-sids-segment hop1 srv6-sid 2001:db8:0:a4::d04 set protocols source-packet-routing segment-list end-sids-segment hop2 srv6-sid 2001:db8:0:a5::d05 set protocols source-packet-routing segment-list end-sids-segment hop3 srv6-sid 2001:db8:0:a6::d06 set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid srv6 set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop1 srv6-sid 2001:db8:0:a2::1a23 set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop2 srv6-sid 2001:db8:0:a3::1a34 set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop3 srv6-sid 2001:db8:0:a6::d06 set protocols source-packet-routing srv6 set protocols source-packet-routing source-routing-path nc_path_R1R6 srv6 set protocols source-packet-routing source-routing-path nc_path_R1R6 to 2001:db8:0:a6::d06 set protocols source-packet-routing source-routing-path nc_path_R1R6 from 2001:db8:1:255::1 set protocols source-packet-routing source-routing-path nc_path_R1R6 primary end-sids-segment weight 40 set protocols source-packet-routing source-routing-path nc_path_R1R6 primary end-x-sids-segment-last-sid-end-sid weight 30 set protocols source-packet-routing source-routing-path c_path_R1R6 srv6 set protocols source-packet-routing source-routing-path c_path_R1R6 to 2001:db8:0:a6::d06 set protocols source-packet-routing source-routing-path c_path_R1R6 from 2001:db8:1:255::1 set protocols source-packet-routing source-routing-path c_path_R1R6 color 6 set protocols source-packet-routing source-routing-path c_path_R1R6 primary end-sids-segment weight 40 set protocols source-packet-routing source-routing-path c_path_R1R6 primary end-x-sids-segment-last-sid-end-sid weight 30 设备 R2 set interfaces ge-0/0/0 unit 0 description R2_To_R1 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:12::2/64 set interfaces ge-0/0/2 unit 0 description R2_To_R3 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:23::1/64 set interfaces lo0 unit 0 family iso address 49.0001.0002.0202.0200 set interfaces lo0 unit 0 family inet6 address 2001:db8:2:255::2/128 set routing-options source-packet-routing srv6 locator loc2 2001:db8:0:a2::/64 set routing-options router-id 192.168.255.22 set protocols isis interface ge-0/0/0.0 level 2 disable set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a12 flavor psp set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a12 flavor usd set protocols isis interface ge-0/0/0.0 point-to-point set protocols isis interface ge-0/0/2.0 level 2 disable set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a23 flavor psp set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a23 flavor usd set protocols isis interface ge-0/0/2.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 passive set protocols isis source-packet-routing node-segment ipv6-index 110 set protocols isis source-packet-routing srv6 locator loc2 end-sid 2001:db8:0:a2::d02 flavor psp set protocols isis source-packet-routing srv6 locator loc2 end-sid 2001:db8:0:a2::d02 flavor usp set protocols isis source-packet-routing srv6 locator loc2 end-sid 2001:db8:0:a2::d02 flavor usd set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable 设备 R3 set interfaces ge-0/0/0 unit 0 description R3_To_R2 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:23::2/64 set interfaces ge-0/0/2 unit 0 description R3_To_R4 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:34::1/64 set interfaces ge-0/0/4 unit 0 description R3_To_R5 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family inet6 address 2001:db8:35::1/64 set interfaces lo0 unit 0 family iso address 49.0001.0003.0303.0300 set interfaces lo0 unit 0 family inet6 address 2001:db8:3:255::3/128 set routing-options source-packet-routing srv6 locator loc3 2001:db8:0:a3::/64 set routing-options router-id 192.168.255.33 set protocols isis interface ge-0/0/0.0 level 2 disable set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a23 flavor psp set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a23 flavor usd set protocols isis interface ge-0/0/0.0 point-to-point set protocols isis interface ge-0/0/2.0 level 2 disable set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a34 flavor psp set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a34 flavor usd set protocols isis interface ge-0/0/2.0 point-to-point set protocols isis interface ge-0/0/4.0 level 2 disable set protocols isis interface ge-0/0/4.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a35 flavor psp set protocols isis interface ge-0/0/4.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a35 flavor usd set protocols isis interface ge-0/0/4.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 set protocols isis source-packet-routing node-segment ipv6-index 120 set protocols isis source-packet-routing srv6 locator loc3 end-sid 2001:db8:0:a3::d03 flavor usp set protocols isis source-packet-routing srv6 locator loc3 end-sid 2001:db8:0:a3::d03 flavor usd set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable 设备 R4 set interfaces ge-0/0/0 unit 0 description R4_To_R1 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:14::2/64 set interfaces ge-0/0/2 unit 0 description R4_To_R3 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:34::2/64 set interfaces ge-0/0/6 unit 0 description R4_To_R5 set interfaces ge-0/0/6 unit 0 family iso set interfaces ge-0/0/6 unit 0 family inet6 address 2001:db8:45::1/64 set interfaces lo0 unit 0 family iso address 49.0001.0004.0404.0400 set interfaces lo0 unit 0 family inet6 address 2001:db8:4:255::4/128 set routing-options source-packet-routing srv6 locator loc4 2001:db8:0:a4::/64 set routing-options router-id 192.168.255.44 set protocols isis interface ge-0/0/0.0 level 2 disable set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a41 flavor psp set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a41 flavor usd set protocols isis interface ge-0/0/0.0 point-to-point set protocols isis interface ge-0/0/2.0 level 2 disable set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a34 flavor psp set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a34 flavor usd set protocols isis interface ge-0/0/2.0 point-to-point set protocols isis interface ge-0/0/6.0 level 2 disable set protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a45 flavor psp set protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a45 flavor usd set protocols isis interface ge-0/0/6.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 set protocols isis source-packet-routing node-segment ipv6-index 130 set protocols isis source-packet-routing srv6 locator loc4 end-sid 2001:db8:0:a4::d04 flavor psp set protocols isis source-packet-routing srv6 locator loc4 end-sid 2001:db8:0:a4::d04 flavor usp set protocols isis source-packet-routing srv6 locator loc4 end-sid 2001:db8:0:a4::d04 flavor usd set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable 设备 R5 set interfaces ge-0/0/0 unit 0 description R5_To_R3 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:35::2/64 set interfaces ge-0/0/2 unit 0 description R5_To_R4 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:45::2/64 set interfaces ge-0/0/6 unit 0 description R5_To_R6 set interfaces ge-0/0/6 unit 0 family iso set interfaces ge-0/0/6 unit 0 family inet6 address 2001:db8:56::1/64 set interfaces lo0 unit 0 family iso address 49.0001.0005.0505.0500 set interfaces lo0 unit 0 family inet6 address 2001:db8:5:255::5/128 set routing-options source-packet-routing srv6 locator loc5 2001:db8:0:a5::/64 set routing-options router-id 192.168.255.55 set protocols isis interface ge-0/0/0.0 level 2 disable set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a35 flavor psp set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a35 flavor usd set protocols isis interface ge-0/0/0.0 point-to-point set protocols isis interface ge-0/0/2.0 level 2 disable set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a45 flavor psp set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a45 flavor usd set protocols isis interface ge-0/0/2.0 point-to-point set protocols isis interface ge-0/0/6.0 level 2 disable set protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a56 flavor psp set protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a56 flavor usd set protocols isis interface ge-0/0/6.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 set protocols isis source-packet-routing node-segment ipv6-index 150 set protocols isis source-packet-routing srv6 locator loc5 end-sid 2001:db8:0:a5::d05 flavor psp set protocols isis source-packet-routing srv6 locator loc5 end-sid 2001:db8:0:a5::d05 flavor usp set protocols isis source-packet-routing srv6 locator loc5 end-sid 2001:db8:0:a5::d05 flavor usd set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable 设备 R6 set interfaces ge-0/0/0 unit 0 description R6_To_CE7 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:67::2/64 set interfaces ge-0/0/2 unit 0 description R6_To_R5 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:67::2/64 set interfaces ge-0/0/2 unit 0 description R6_To_R5 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:56::2/64 set interfaces lo0 unit 0 family iso address 49.0001.0006.0606.0600 set interfaces lo0 unit 0 family inet6 address 2001:db8:6:255::6/128 set policy-options policy-statement LBPP term 1 then load-balance per-packet set policy-options policy-statement mpath-resolve then multipath-resolve set policy-options policy-statement to_CE7_community_export term 0 then community add to_CE7_community set policy-options policy-statement to_CE7_community_export term 0 then community add to_ce7_color_com set policy-options policy-statement to_CE7_community_export term 0 then next-hop 2001:db8:0:a6::d06 set policy-options policy-statement to_CE7_community_export term 0 then accept set policy-options policy-statement to_CE7_community_import term 0 from community to_CE7_community set policy-options policy-statement to_CE7_community_import term 0 then accept set policy-options community to_CE7_community members target:65500:1 set policy-options community to_ce7_color_com members color:1:6 set routing-instances to_CE7 instance-type vrf set routing-instances to_CE7 protocols bgp group to_CE7_v6 type external set routing-instances to_CE7 protocols bgp group to_CE7_v6 peer-as 65000 set routing-instances to_CE7 protocols bgp group to_CE7_v6 neighbor 2001:db8:67::1 set routing-instances to_CE7 protocols bgp group to_CE7_v4 type external set routing-instances to_CE7 protocols bgp group to_CE7_v4 peer-as 65000 set routing-instances to_CE7 protocols bgp group to_CE7_v4 neighbor 192.168.67.1 set routing-instances to_CE7 protocols bgp source-packet-routing srv6 locator loc8 end-dt4-sid 2001:db8:0:a6::d467 set routing-instances to_CE7 protocols bgp source-packet-routing srv6 locator loc8 end-dt6-sid 2001:db8:0:a6::d667 set routing-instances to_CE7 interface ge-0/0/0.0 set routing-instances to_CE7 route-distinguisher 192.168.255.66:6 set routing-instances to_CE7 vrf-import to_CE7_community_import set routing-instances to_CE7 vrf-export to_CE7_community_export set routing-options source-packet-routing srv6 locator loc8 2001:db8:0:a6::/64 set routing-options resolution preserve-nexthop-hierarchy set routing-options resolution rib bgp.l3vpn-inet6.0 resolution-ribs inet6.3 set routing-options resolution rib bgp.l3vpn-inet6.0 inet6-resolution-ribs inet6.3 set routing-options resolution rib bgp.l3vpn-inet6.0 import mpath-resolve set routing-options resolution rib bgp.l3vpn.0 inet6-resolution-ribs inet6.3 set routing-options resolution rib bgp.l3vpn.0 import mpath-resolve set routing-options resolution rib inet6.0 import mpath-resolve set routing-options resolution rib inet.0 import mpath-resolve set routing-options router-id 192.168.255.66 set routing-options autonomous-system 65500 set routing-options forwarding-table srv6-chain-merge set routing-options forwarding-table export LBPP set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 2001:db8:6:255::6 set protocols bgp group ibgp family inet unicast extended-nexthop set protocols bgp group ibgp family inet-vpn unicast extended-nexthop set protocols bgp group ibgp family inet-vpn unicast advertise-srv6-service set protocols bgp group ibgp family inet-vpn unicast accept-srv6-service set protocols bgp group ibgp family inet6 unicast extended-nexthop-color set protocols bgp group ibgp family inet6-vpn unicast advertise-srv6-service set protocols bgp group ibgp family inet6-vpn unicast accept-srv6-service set protocols bgp group ibgp neighbor 2001:db8:1:255::1 set protocols bgp multipath set protocols isis interface ge-0/0/2.0 level 2 disable set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc8 end-x-sid 2001:db8:0:a6::1a56 flavor psp set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc8 end-x-sid 2001:db8:0:a6::1a56 flavor usd set protocols isis interface ge-0/0/2.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 set protocols isis source-packet-routing srgb start-label 400000 set protocols isis source-packet-routing srgb index-range 5000 set protocols isis source-packet-routing node-segment ipv6-index 170 set protocols isis source-packet-routing srv6 locator loc8 end-sid 2001:db8:0:a6::d06 flavor psp set protocols isis source-packet-routing srv6 locator loc8 end-sid 2001:db8:0:a6::d06 flavor usp set protocols isis source-packet-routing srv6 locator loc8 end-sid 2001:db8:0:a6::d06 flavor usd set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable 设备 CE0 set interfaces ge-0/0/0 unit 0 description CE0_To_R1 set interfaces ge-0/0/0 unit 0 family inet address 192.168.10.1/24 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:10::1/64 set interfaces lo0 unit 0 family inet address 10.100.10.1/32 set interfaces lo0 unit 0 family iso address 49.0001.000a.0a0a.0a00 set interfaces lo0 unit 0 family inet6 address 2001:db8:10:255::10/128 set policy-options policy-statement BGP_export term 0 from protocol direct set policy-options policy-statement BGP_export term 0 from interface lo0.0 set policy-options policy-statement BGP_export term 0 then accept set routing-options rib inet6.0 static route 0::0/0 next-hop 2001:db8:10::2 set routing-options rib inet.0 static route 0.0.0.0/0 next-hop 192.168.10.2 set routing-options router-id 10.100.10.1 set routing-options autonomous-system 65000 set protocols bgp group eBGPv6 type external set protocols bgp group eBGPv6 export BGP_export set protocols bgp group eBGPv6 peer-as 65500 set protocols bgp group eBGPv6 neighbor 2001:db8:10::2 set protocols bgp group eBGPv4 type external set protocols bgp group eBGPv4 export BGP_export set protocols bgp group eBGPv4 peer-as 65500 set protocols bgp group eBGPv4 neighbor 192.168.10.2 set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable 设备 CE7 set system host-name CE7 set system services netconf ssh set system ports console log-out-on-disconnect set interfaces ge-0/0/0 unit 0 description CE7_To_R6 set interfaces ge-0/0/0 unit 0 family inet address 192.168.67.1/24 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:67::1/64 set interfaces lo0 unit 0 family inet address 10.100.10.7/32 set interfaces lo0 unit 0 family iso address 49.0001.0007.0707.0700 set interfaces lo0 unit 0 family inet6 address 2001:db8:7:255::7/128 set policy-options policy-statement BGP_export term 0 from protocol direct set policy-options policy-statement BGP_export term 0 from interface lo0.0 set policy-options policy-statement BGP_export term 0 then accept set routing-options rib inet6.0 static route 0::0/0 next-hop 2001:db8:67::2 set routing-options rib inet.0 static route 0.0.0.0/0 next-hop 192.168.67.2 set routing-options router-id 10.100.10.7 set routing-options autonomous-system 65000 set protocols bgp group eBGPv6 type external set protocols bgp group eBGPv6 export BGP_export set protocols bgp group eBGPv6 peer-as 65500 set protocols bgp group eBGPv6 neighbor 2001:db8:67::2 set protocols bgp group eBGPv4 type external set protocols bgp group eBGPv4 export BGP_export set protocols bgp group eBGPv4 peer-as 65500 set protocols bgp group eBGPv4 neighbor 192.168.67.2 set protocols isis interface all level 2 disable 分步过程 要为 IS-IS SRv6 核心上的 SRV6 隧道配置静态 SR-TE 策略，请在 R1 设备上执行以下步骤： 配置设备接口以启用 IP 传输。 [edit] user@R1# set interfaces ge-0/0/0 unit 0 description R1_To_CE0 user@R1# set interfaces ge-0/0/0 unit 0 family inet address 192.168.10.2/24 user@R1# set interfaces ge-0/0/0 unit 0 family iso user@R1# set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:10::2/64 user@R1# set interfaces ge-0/0/3 unit 0 description R1_To_R2 user@R1# set interfaces ge-0/0/3 unit 0 family iso user@R1# set interfaces ge-0/0/3 unit 0 family inet6 address 2001:db8:12::1/64 user@R1# set interfaces ge-0/0/5 unit 0 description R1_To_R4 user@R1# set interfaces ge-0/0/5 unit 0 family iso user@R1# set interfaces ge-0/0/5 unit 0 family inet6 address 2001:db8:14::1/64 使用 IPv4 和 IPv6 地址配置环路接口，该地址用作 BGP 会话的路由器 ID。 [edit] user@R1# set interfaces lo0 unit 0 family iso address 49.0001.0001.0101.0100 user@R1# set interfaces lo0 unit 0 family inet6 address 2001:db8:1:255::1/128 配置路由器 ID 和自治系统 （AS） 编号，以便在属于同一 AS 的一组路由设备中传播路由信息。 [edit] user@R1# set routing-options router-id 192.168.255.11 user@R1# set routing-options autonomous-system 65500 [edit] user@R1# set protocols bgp group to_R6_ibgpv6 type internal user@R1# set protocols bgp group to_R6_ibgpv6 local-address 2001:db8:1:255::1 user@R1# set protocols bgp group to_R6_ibgpv6 import v4vpn1_res_map1 user@R1# set protocols bgp group to_R6_ibgpv6 import v6vpn1_res_map1 user@R1# set protocols bgp group to_R6_ibgpv6 family inet unicast extended-nexthop user@R1# set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast extended-nexthop user@R1# set protocols bgp group to_R6_ibgpv6 neighbor 2001:db8:6:255::6 为 IPv4 和 IPv6 流量配置外部路由实例to_CE0。为 to_CE0 配置 BGP 协议，以便在提供商边缘设备之间启用对等互连和流量传输。 [edit] user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v6 type external user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v6 peer-as 65000 user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v6 neighbor 2001:db8:10::1 user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v4 type external user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v4 peer-as 65000 user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v4 neighbor 192.168.10.1 使用 ip 颜色模式配置分辨率映射映射 map1。将 BGP 协议配置为使用多个路径，并定义包含多路径解析操作的策略 mpath-solve，然后导入策略以解析 IBGP 多路径路由的所有可用路径。 [edit] user@R1# set protocols bgp multipath user@R1# set policy-options resolution-map map1 mode ip-color user@R1# set policy-options policy-statement mpath-resolve then multipath-resolve user@R1# set routing-options resolution rib bgp.l3vpn-inet6.0 resolution-ribs inet6.3 user@R1# set routing-options resolution rib bgp.l3vpn-inet6.0 inet6-resolution-ribs inet6.3 user@R1# set routing-options resolution rib bgp.l3vpn-inet6.0 import mpath-resolve user@R1# set routing-options resolution rib bgp.l3vpn-inet6.0 inet6-import mpath-resolve user@R1# set routing-options resolution rib bgp.l3vpn-inet6.0 inet6color-import mpath-resolve user@R1# set routing-options resolution rib bgp.l3vpn.0 import mpath-resolve user@R1# set routing-options resolution rib bgp.l3vpn.0 inet6-import mpath-resolve user@R1# set routing-options resolution rib bgp.l3vpn.0 inet6color-import mpath-resolve user@R1# set routing-options resolution rib inet6.0 import mpath-resolve user@R1# set routing-options resolution rib inet.0 import mpath-resolve [edit] user@R1# set policy-options policy-statement to_CE0_community_import term 0 from community to_CE0_community user@R1# set policy-options policy-statement to_CE0_community_import term 0 then accept user@R1# set policy-options policy-statement to_CE0_community_export term 0 then community add to_CE0_community user@R1# set policy-options policy-statement to_CE0_community_export term 0 then next-hop 2001:db8:0:a1::d01 user@R1# set policy-options policy-statement to_CE0_community_export term 0 then accept user@R1# set routing-instances to_CE0 vrf-import to_CE0_community_import user@R1# set routing-instances to_CE0 vrf-export to_CE0_community_export 为参与路由实例的每个 PE 路由器配置 VPN 类型和唯一路由识别符。 [edit] user@R1# set routing-instances to_CE0 instance-type vrf user@R1# set routing-instances to_CE0 interface ge-0/0/0.0 user@R1# set routing-instances to_CE0 route-distinguisher 192.168.255.11:1 [edit] user@R1# set policy-options policy-statement LBPP term 1 then load-balance per-packet user@R1# set policy-options community to_CE0_community members target:65500:1 user@R1# set routing-options forwarding-table export LBPP [edit] user@R1# set policy-options policy-statement v4vpn1_res_map1 term 1 from protocol bgp user@R1# set policy-options policy-statement v4vpn1_res_map1 term 1 then accept user@R1# set policy-options policy-statement v4vpn1_res_map1 term 1 then resolution-map map1 user@R1# set policy-options policy-statement v6vpn1_res_map1 term 1 from family inet6-vpn user@R1# set policy-options policy-statement v6vpn1_res_map1 term 1 then accept user@R1# set policy-options policy-statement v6vpn1_res_map1 term 1 then resolution-map map1 [edit] user@R1# set protocols isis interface all level 2 disable user@R1# set protocols isis interface fxp0.0 disable user@R1# set protocols isis interface lo0.0 [edit] user@R1# set protocols isis backup-spf-options use-post-convergence-lfa user@R1# set protocols isis backup-spf-options use-source-packet-routing [edit] user@R1# set protocols isis source-packet-routing node-segment ipv6-index 101 全局启用 SRv6 和定位器地址以指示路由器的 SRv6 功能。SRv6 SID 是由定位器和函数组成的 IPv6 地址。路由协议播发定位器地址。 [edit] user@R1# set protocols source-packet-routing srv6 user@R1# set routing-options source-packet-routing srv6 locator loc1 2001:db8:0:a1::/64 为 SR-TE 路由风格启用保留下一跃点层次结构，为 SRv6 链下一跃点启用平台合并。 [edit] user@R1# set routing-options resolution preserve-nexthop-hierarchy user@R1# set routing-options forwarding-table srv6-chain-merge 配置结束 dt4 和结束 dt6 SID 值以启用第 3 层 VPN 服务。 [edit] user@R1# set routing-instances to_CE0 protocols bgp source-packet-routing srv6 locator loc1 end-dt4-sid 2001:db8:0:a1::d410 user@R1# set routing-instances to_CE0 protocols bgp source-packet-routing srv6 locator loc1 end-dt6-sid 2001:db8:0:a1::d610 使设备能够向 BGP 对等方播发 SRv6 服务，并接受出口设备通告的路由。 [edit] user@R1# set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast advertise-srv6-service user@R1# set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast accept-srv6-service user@R1# set protocols bgp group to_R6_ibgpv6 family inet6 unicast extended-nexthop-color user@R1# set protocols bgp group to_R6_ibgpv6 family inet6-vpn unicast advertise-srv6-service user@R1# set protocols bgp group to_R6_ibgpv6 family inet6-vpn unicast accept-srv6-service 为前缀段配置 End-Sid 功能。指定特定实例，即根据您的网络要求执行 End-SID 函数的行为。倒数第二段流行 （PSP）、终极分段流行 （USP） 和终极分段解封装 （USP） 是 SRv6 功能的三种可用类型。 注： 确保定位器和 End-SID 位于同一子网中，以避免提交错误。 确保定位器和 End-SID 位于同一子网中，以避免提交错误。 [edit] user@R1# set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor psp user@R1# set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor usp user@R1# set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor usd 在点对点 （P2P） 接口上为邻接分段配置 End-X-SID 功能。为 End-X-SID 指定一个或多个特定实例。 注： 确保定位器和 End-X-SID 位于同一子网中，以避免提交错误。在将定位器映射到接口之前，您必须启用 SRv6 并在 上 [edit routing-options] 配置定位器。 确保定位器和 End-X-SID 位于同一子网中，以避免提交错误。在将定位器映射到接口之前，您必须启用 SRv6 并在 上 [edit routing-options] 配置定位器。 [edit] user@R1# set protocols isis interface ge-0/0/3.0 level 2 disable user@R1# set protocols isis interface ge-0/0/3.0 level 1 srv6-adjacency-segment unprotected locator loc1 end-x-sid 2001:db8:0:a1::1a12 flavor psp user@R1# set protocols isis interface ge-0/0/3.0 level 1 srv6-adjacency-segment unprotected locator loc1 end-x-sid 2001:db8:0:a1::1a12 flavor usd user@R1# set protocols isis interface ge-0/0/3.0 point-to-point user@R1# set protocols isis interface ge-0/0/5.0 level 2 disable user@R1# set protocols isis interface ge-0/0/5.0 level 1 post-convergence-lfa user@R1# set protocols isis interface ge-0/0/5.0 point-to-point 配置 SRv6 分段列表 <R4、R5、R6> 和 <R2、R3、R6> 之间的 end-sids-segment 和 end-x-sids-segment-last-sid-end-sid。 [edit] user@R1# set protocols source-packet-routing segment-list end-sids-segment srv6 user@R1# set protocols source-packet-routing segment-list end-sids-segment hop1 srv6-sid 2001:db8:0:a4::d04 user@R1# set protocols source-packet-routing segment-list end-sids-segment hop2 srv6-sid 2001:db8:0:a5::d05 user@R1# set protocols source-packet-routing segment-list end-sids-segment hop3 srv6-sid 2001:db8:0:a6::d06 user@R1# set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid srv6 user@R1# set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop1 srv6-sid 2001:db8:0:a2::1a23 user@R1# set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop2 srv6-sid 2001:db8:0:a3::1a34 user@R1# set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop3 srv6-sid 2001:db8:0:a6::d06 将 R1 和 R6 之间的 SRv6-TE 隧道配置为端边段权重为 40，为无色路径 （nc_path_R1R6） 和彩色路径 （c_path_R1R6） 配置端 x-sid-段-最后-sid-端-sid 权重 30。 [edit] user@R1# set protocols source-packet-routing source-routing-path nc_path_R1R6 srv6 user@R1# set protocols source-packet-routing source-routing-path nc_path_R1R6 to 2001:db8:0:a6::d06 user@R1# set protocols source-packet-routing source-routing-path nc_path_R1R6 from 2001:db8:1:255::1 user@R1# set protocols source-packet-routing source-routing-path nc_path_R1R6 primary end-sids-segment weight 40 user@R1# set protocols source-packet-routing source-routing-path nc_path_R1R6 primary end-x-sids-segment-last-sid-end-sid weight 30 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 srv6 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 to 2001:db8:0:a6::d06 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 from 2001:db8:1:255::1 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 color 6 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 primary end-sids-segment weight 40 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 primary end-x-sids-segment-last-sid-end-sid weight 30 检查配置结果： interfaces { ge-0/0/0 { unit 0 { description R1_To_CE0; family inet { address 192.168.10.1/24; address 192.168.10.2/24; } family iso; family inet6 { address 2001:db8:10::2/64; } } } ge-0/0/3 { unit 0 { description R1_To_R2; family iso; family inet6 { address 2001:db8:12::1/64; } } } ge-0/0/5 { unit 0 { description R1_To_R4; family iso; family inet6 { address 2001:db8:14::1/64; } } } lo0 { unit 0 { family inet { address 192.168.100.2/32; } family iso { address 49.0002.0192.0168.0002.00; address 49.0001.0001.0101.0100; } family inet6 { address 2001:db8:1:255::1/128; } } } } policy-options { policy-statement LBPP { term 1 { then { load-balance per-packet; } } } policy-statement mpath-resolve { then multipath-resolve; } policy-statement to_CE0_community_export { term 0 { then { community add to_CE0_community; next-hop 2001:db8:0:a1::d01; accept; } } } policy-statement to_CE0_community_import { term 0 { from community to_CE0_community; then accept; } } policy-statement v4vpn1_res_map1 { term 1 { from protocol bgp; then { accept; resolution-map map1; } } } policy-statement v6vpn1_res_map1 { term 1 { from { family inet6-vpn; protocol bgp; } then { accept; resolution-map map1; } } } community to_CE0_community members target:65500:1; resolution-map map1 { mode ip-color; } } routing-instances { to_CE0 { instance-type vrf; protocols { bgp { group to_CE0_v6 { type external; peer-as 65000; neighbor 2001:db8:10::1; } group to_CE0_v4 { type external; peer-as 65000; neighbor 192.168.10.1; } source-packet-routing { srv6 { locator loc1 { end-dt4-sid 2001:db8:0:a1::d410; end-dt6-sid 2001:db8:0:a1::d610; } } } } } interface ge-0/0/0.0; route-distinguisher 192.168.255.11:1; vrf-import to_CE0_community_import; vrf-export to_CE0_community_export; } } routing-options { source-packet-routing { srv6 { locator loc1 2001:db8:0:a1::/64; } } resolution { preserve-nexthop-hierarchy; rib bgp.l3vpn-inet6.0 { resolution-ribs inet6.3; inet6-resolution-ribs inet6.3; import mpath-resolve; inet6-import mpath-resolve; inet6color-import mpath-resolve; } rib bgp.l3vpn.0 { import mpath-resolve; inet6-import mpath-resolve; inet6color-import mpath-resolve; } rib inet6.0 { import mpath-resolve; } rib inet.0 { import mpath-resolve; } } router-id 192.168.255.11; autonomous-system 65500; forwarding-table { srv6-chain-merge; export LBPP; } } protocols { bgp { group to_R6_ibgpv6 { type internal; local-address 2001:db8:1:255::1; import [ v4vpn1_res_map1 v6vpn1_res_map1 ]; family inet { unicast { extended-nexthop; } } family inet-vpn { unicast { extended-nexthop; advertise-srv6-service; accept-srv6-service; } } family inet6 { unicast { extended-nexthop-color; } } family inet6-vpn { unicast { advertise-srv6-service; accept-srv6-service; } } neighbor 2001:db8:6:255::6; } multipath; } isis { interface ge-0/0/3.0 { level 2 disable; level 1 { srv6-adjacency-segment { unprotected { locator loc1 { end-x-sid 2001:db8:0:a1::1a12 { flavor { psp; usd; } } } } } } point-to-point; } interface ge-0/0/5.0 { level 2 disable; level 1 { post-convergence-lfa; } point-to-point; } interface all { level 2 disable; } interface fxp0.0 { disable; } interface lo0.0; source-packet-routing { node-segment ipv6-index 101; srv6 { locator loc1 { end-sid 2001:db8:0:a1::d01 { flavor { psp; usp; usd; } } } } } backup-spf-options { use-post-convergence-lfa; use-source-packet-routing; } } mpls { interface all; interface fxp0.0 { disable; } } source-packet-routing { segment-list end-sids-segment { srv6; hop1 srv6-sid 2001:db8:0:a4::d04; hop2 srv6-sid 2001:db8:0:a5::d05; hop3 srv6-sid 2001:db8:0:a6::d06; } segment-list end-x-sids-segment-last-sid-end-sid { srv6; hop1 srv6-sid 2001:db8:0:a2::1a23; hop2 srv6-sid 2001:db8:0:a3::1a34; hop3 srv6-sid 2001:db8:0:a6::d06; } srv6; source-routing-path nc_path_R1R6 { srv6; to 2001:db8:0:a6::d06; from 2001:db8:1:255::1; primary { end-sids-segment weight 40; end-x-sids-segment-last-sid-end-sid weight 30; } } source-routing-path c_path_R1R6 { srv6; to 2001:db8:0:a6::d06; from 2001:db8:1:255::1; color 6; primary { end-sids-segment weight 40; end-x-sids-segment-last-sid-end-sid weight 30; } } } } 完成设备配置后，从配置模式输入 commit 。",
      "sections": [
        {
          "title": "CLI 快速配置",
          "level": 4,
          "content": "要快速配置此示例，请复制以下命令，将其粘贴到文本文件中，删除所有换行符，更改任何必要的详细信息以匹配您的网络配置，然后将命令复制并粘贴到 [edit] 层次结构级别的 CLI 中，然后从配置模式进入提交。 设备 R1 set interfaces ge-0/0/0 unit 0 description R1_to_CE0 set interfaces ge-0/0/0 unit 0 family inet address 192.168.10.2/24 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:10::2/64 set interfaces ge-0/0/3 unit 0 description R1_to_R2 set interfaces ge-0/0/3 unit 0 family iso set interfaces ge-0/0/3 unit 0 family inet6 address 2001:db8:12::1/64 set interfaces ge-0/0/3 unit 0 description R1_to_R4 set interfaces ge-0/0/5 unit 0 family iso set interfaces ge-0/0/5 unit 0 family inet6 address 2001:db8:14::1/64 set interfaces lo0 unit 0 family iso address 49.0001.0001.0101.0100 set interfaces lo0 unit 0 family inet6 address 2001:db8:1:255::1/128 set policy-options policy-statement to_CE0_community_export term 0 then community add to_CE0_community set policy-options policy-statement to_CE0_community_export term 0 then next-hop 2001:db8:0:a1::d01 set policy-options policy-statement to_CE0_community_export term 0 then accept set policy-options policy-statement to_CE0_community_import term 0 from community to_CE0_community set policy-options policy-statement to_CE0_community_import term 0 then accept set policy-options policy-statement v4vpn1_res_map1 term 1 from protocol bgp set policy-options policy-statement v4vpn1_res_map1 term 1 then accept set policy-options policy-statement v4vpn1_res_map1 term 1 then resolution-map map1 set policy-options policy-statement v6vpn1_res_map1 term 1 from family inet6-vpn set policy-options policy-statement v6vpn1_res_map1 term 1 from protocol bgp set policy-options policy-statement v6vpn1_res_map1 term 1 then accept set policy-options policy-statement v6vpn1_res_map1 term 1 then resolution-map map1 set policy-options policy-statement LBPP term 1 then load-balance per-packet set policy-options policy-statement mpath-resolve then multipath-resolve set policy-options resolution-map map1 mode ip-color set policy-options community to_CE0_community members target:65500:1 set routing-instances to_CE0 instance-type vrf set routing-instances to_CE0 protocols bgp group to_CE0_v6 type external set routing-instances to_CE0 protocols bgp group to_CE0_v6 peer-as 65000 set routing-instances to_CE0 protocols bgp group to_CE0_v6 neighbor 2001:db8:10::1 set routing-instances to_CE0 protocols bgp group to_CE0_v4 type external set routing-instances to_CE0 protocols bgp group to_CE0_v4 peer-as 65000 set routing-instances to_CE0 protocols bgp group to_CE0_v4 neighbor 192.168.10.1 set routing-instances to_CE0 protocols bgp source-packet-routing srv6 locator loc1 end-dt4-sid 2001:db8:0:a1::d410 set routing-instances to_CE0 protocols bgp source-packet-routing srv6 locator loc1 end-dt6-sid 2001:db8:0:a1::d610 set routing-instances to_CE0 interface ge-0/0/0.0 set routing-instances to_CE0 route-distinguisher 192.168.255.11:1 set routing-instances to_CE0 vrf-import to_CE0_community_import set routing-instances to_CE0 vrf-export to_CE0_community_export set routing-options source-packet-routing srv6 locator loc1 2001:db8:0:a1::/64 set routing-options resolution preserve-nexthop-hierarchy set routing-options resolution rib bgp.l3vpn-inet6.0 resolution-ribs inet6.3 set routing-options resolution rib bgp.l3vpn-inet6.0 inet6-resolution-ribs inet6.3 set routing-options resolution rib bgp.l3vpn-inet6.0 import mpath-resolve set routing-options resolution rib bgp.l3vpn-inet6.0 inet6-import mpath-resolve set routing-options resolution rib bgp.l3vpn-inet6.0 inet6color-import mpath-resolve set routing-options resolution rib bgp.l3vpn.0 import mpath-resolve set routing-options resolution rib bgp.l3vpn.0 inet6-import mpath-resolve set routing-options resolution rib inet6.0 import mpath-resolve set routing-options resolution rib inet.0 import mpath-resolve set routing-options router-id 192.168.255.11 set routing-options autonomous-system 65500 set routing-options forwarding-table srv6-chain-merge set routing-options forwarding-table export LBPP set protocols bgp group to_R6_ibgpv6 type internal set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast accept-srv6-service set protocols bgp group to_R6_ibgpv6 family inet6 unicast extended-nexthop-color set protocols bgp group to_R6_ibgpv6 family inet6-vpn unicast advertise-srv6-service set protocols bgp group to_R6_ibgpv6 family inet6-vpn unicast accept-srv6-service set protocols bgp group to_R6_ibgpv6 local-address 2001:db8:1:255::1 set protocols bgp group to_R6_ibgpv6 import v4vpn1_res_map1 set protocols bgp group to_R6_ibgpv6 import v6vpn1_res_map1 set protocols bgp group to_R6_ibgpv6 family inet unicast extended-nexthop set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast extended-nexthop set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast advertise-srv6-service set protocols bgp group to_R6_ibgpv6 neighbor 2001:db8:6:255::6 set protocols bgp multipath set protocols isis interface ge-0/0/3.0 level 2 disable set protocols isis interface ge-0/0/3.0 level 1 srv6-adjacency-segment unprotected locator loc1 end-x-sid 2001:db8:0:a1::1a12 flavor psp set protocols isis interface ge-0/0/3.0 level 1 srv6-adjacency-segment unprotected locator loc1 end-x-sid 2001:db8:0:a1::1a12 flavor usd set protocols isis interface ge-0/0/3.0 point-to-point set protocols isis interface ge-0/0/5.0 level 2 disable set protocols isis interface ge-0/0/5.0 level 1 post-convergence-lfa set protocols isis interface ge-0/0/5.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 set protocols isis source-packet-routing node-segment ipv6-index 101 set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor psp set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor usp set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor usd set protocols isis backup-spf-options use-post-convergence-lfa set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable set protocols source-packet-routing segment-list end-sids-segment srv6 set protocols source-packet-routing segment-list end-sids-segment hop1 srv6-sid 2001:db8:0:a4::d04 set protocols source-packet-routing segment-list end-sids-segment hop2 srv6-sid 2001:db8:0:a5::d05 set protocols source-packet-routing segment-list end-sids-segment hop3 srv6-sid 2001:db8:0:a6::d06 set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid srv6 set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop1 srv6-sid 2001:db8:0:a2::1a23 set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop2 srv6-sid 2001:db8:0:a3::1a34 set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop3 srv6-sid 2001:db8:0:a6::d06 set protocols source-packet-routing srv6 set protocols source-packet-routing source-routing-path nc_path_R1R6 srv6 set protocols source-packet-routing source-routing-path nc_path_R1R6 to 2001:db8:0:a6::d06 set protocols source-packet-routing source-routing-path nc_path_R1R6 from 2001:db8:1:255::1 set protocols source-packet-routing source-routing-path nc_path_R1R6 primary end-sids-segment weight 40 set protocols source-packet-routing source-routing-path nc_path_R1R6 primary end-x-sids-segment-last-sid-end-sid weight 30 set protocols source-packet-routing source-routing-path c_path_R1R6 srv6 set protocols source-packet-routing source-routing-path c_path_R1R6 to 2001:db8:0:a6::d06 set protocols source-packet-routing source-routing-path c_path_R1R6 from 2001:db8:1:255::1 set protocols source-packet-routing source-routing-path c_path_R1R6 color 6 set protocols source-packet-routing source-routing-path c_path_R1R6 primary end-sids-segment weight 40 set protocols source-packet-routing source-routing-path c_path_R1R6 primary end-x-sids-segment-last-sid-end-sid weight 30 设备 R2 set interfaces ge-0/0/0 unit 0 description R2_To_R1 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:12::2/64 set interfaces ge-0/0/2 unit 0 description R2_To_R3 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:23::1/64 set interfaces lo0 unit 0 family iso address 49.0001.0002.0202.0200 set interfaces lo0 unit 0 family inet6 address 2001:db8:2:255::2/128 set routing-options source-packet-routing srv6 locator loc2 2001:db8:0:a2::/64 set routing-options router-id 192.168.255.22 set protocols isis interface ge-0/0/0.0 level 2 disable set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a12 flavor psp set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a12 flavor usd set protocols isis interface ge-0/0/0.0 point-to-point set protocols isis interface ge-0/0/2.0 level 2 disable set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a23 flavor psp set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a23 flavor usd set protocols isis interface ge-0/0/2.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 passive set protocols isis source-packet-routing node-segment ipv6-index 110 set protocols isis source-packet-routing srv6 locator loc2 end-sid 2001:db8:0:a2::d02 flavor psp set protocols isis source-packet-routing srv6 locator loc2 end-sid 2001:db8:0:a2::d02 flavor usp set protocols isis source-packet-routing srv6 locator loc2 end-sid 2001:db8:0:a2::d02 flavor usd set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable 设备 R3 set interfaces ge-0/0/0 unit 0 description R3_To_R2 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:23::2/64 set interfaces ge-0/0/2 unit 0 description R3_To_R4 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:34::1/64 set interfaces ge-0/0/4 unit 0 description R3_To_R5 set interfaces ge-0/0/4 unit 0 family iso set interfaces ge-0/0/4 unit 0 family inet6 address 2001:db8:35::1/64 set interfaces lo0 unit 0 family iso address 49.0001.0003.0303.0300 set interfaces lo0 unit 0 family inet6 address 2001:db8:3:255::3/128 set routing-options source-packet-routing srv6 locator loc3 2001:db8:0:a3::/64 set routing-options router-id 192.168.255.33 set protocols isis interface ge-0/0/0.0 level 2 disable set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a23 flavor psp set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a23 flavor usd set protocols isis interface ge-0/0/0.0 point-to-point set protocols isis interface ge-0/0/2.0 level 2 disable set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a34 flavor psp set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a34 flavor usd set protocols isis interface ge-0/0/2.0 point-to-point set protocols isis interface ge-0/0/4.0 level 2 disable set protocols isis interface ge-0/0/4.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a35 flavor psp set protocols isis interface ge-0/0/4.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a35 flavor usd set protocols isis interface ge-0/0/4.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 set protocols isis source-packet-routing node-segment ipv6-index 120 set protocols isis source-packet-routing srv6 locator loc3 end-sid 2001:db8:0:a3::d03 flavor usp set protocols isis source-packet-routing srv6 locator loc3 end-sid 2001:db8:0:a3::d03 flavor usd set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable 设备 R4 set interfaces ge-0/0/0 unit 0 description R4_To_R1 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:14::2/64 set interfaces ge-0/0/2 unit 0 description R4_To_R3 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:34::2/64 set interfaces ge-0/0/6 unit 0 description R4_To_R5 set interfaces ge-0/0/6 unit 0 family iso set interfaces ge-0/0/6 unit 0 family inet6 address 2001:db8:45::1/64 set interfaces lo0 unit 0 family iso address 49.0001.0004.0404.0400 set interfaces lo0 unit 0 family inet6 address 2001:db8:4:255::4/128 set routing-options source-packet-routing srv6 locator loc4 2001:db8:0:a4::/64 set routing-options router-id 192.168.255.44 set protocols isis interface ge-0/0/0.0 level 2 disable set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a41 flavor psp set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a41 flavor usd set protocols isis interface ge-0/0/0.0 point-to-point set protocols isis interface ge-0/0/2.0 level 2 disable set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a34 flavor psp set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a34 flavor usd set protocols isis interface ge-0/0/2.0 point-to-point set protocols isis interface ge-0/0/6.0 level 2 disable set protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a45 flavor psp set protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a45 flavor usd set protocols isis interface ge-0/0/6.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 set protocols isis source-packet-routing node-segment ipv6-index 130 set protocols isis source-packet-routing srv6 locator loc4 end-sid 2001:db8:0:a4::d04 flavor psp set protocols isis source-packet-routing srv6 locator loc4 end-sid 2001:db8:0:a4::d04 flavor usp set protocols isis source-packet-routing srv6 locator loc4 end-sid 2001:db8:0:a4::d04 flavor usd set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable 设备 R5 set interfaces ge-0/0/0 unit 0 description R5_To_R3 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:35::2/64 set interfaces ge-0/0/2 unit 0 description R5_To_R4 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:45::2/64 set interfaces ge-0/0/6 unit 0 description R5_To_R6 set interfaces ge-0/0/6 unit 0 family iso set interfaces ge-0/0/6 unit 0 family inet6 address 2001:db8:56::1/64 set interfaces lo0 unit 0 family iso address 49.0001.0005.0505.0500 set interfaces lo0 unit 0 family inet6 address 2001:db8:5:255::5/128 set routing-options source-packet-routing srv6 locator loc5 2001:db8:0:a5::/64 set routing-options router-id 192.168.255.55 set protocols isis interface ge-0/0/0.0 level 2 disable set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a35 flavor psp set protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a35 flavor usd set protocols isis interface ge-0/0/0.0 point-to-point set protocols isis interface ge-0/0/2.0 level 2 disable set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a45 flavor psp set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a45 flavor usd set protocols isis interface ge-0/0/2.0 point-to-point set protocols isis interface ge-0/0/6.0 level 2 disable set protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a56 flavor psp set protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a56 flavor usd set protocols isis interface ge-0/0/6.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 set protocols isis source-packet-routing node-segment ipv6-index 150 set protocols isis source-packet-routing srv6 locator loc5 end-sid 2001:db8:0:a5::d05 flavor psp set protocols isis source-packet-routing srv6 locator loc5 end-sid 2001:db8:0:a5::d05 flavor usp set protocols isis source-packet-routing srv6 locator loc5 end-sid 2001:db8:0:a5::d05 flavor usd set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable 设备 R6 set interfaces ge-0/0/0 unit 0 description R6_To_CE7 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:67::2/64 set interfaces ge-0/0/2 unit 0 description R6_To_R5 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:67::2/64 set interfaces ge-0/0/2 unit 0 description R6_To_R5 set interfaces ge-0/0/2 unit 0 family iso set interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:56::2/64 set interfaces lo0 unit 0 family iso address 49.0001.0006.0606.0600 set interfaces lo0 unit 0 family inet6 address 2001:db8:6:255::6/128 set policy-options policy-statement LBPP term 1 then load-balance per-packet set policy-options policy-statement mpath-resolve then multipath-resolve set policy-options policy-statement to_CE7_community_export term 0 then community add to_CE7_community set policy-options policy-statement to_CE7_community_export term 0 then community add to_ce7_color_com set policy-options policy-statement to_CE7_community_export term 0 then next-hop 2001:db8:0:a6::d06 set policy-options policy-statement to_CE7_community_export term 0 then accept set policy-options policy-statement to_CE7_community_import term 0 from community to_CE7_community set policy-options policy-statement to_CE7_community_import term 0 then accept set policy-options community to_CE7_community members target:65500:1 set policy-options community to_ce7_color_com members color:1:6 set routing-instances to_CE7 instance-type vrf set routing-instances to_CE7 protocols bgp group to_CE7_v6 type external set routing-instances to_CE7 protocols bgp group to_CE7_v6 peer-as 65000 set routing-instances to_CE7 protocols bgp group to_CE7_v6 neighbor 2001:db8:67::1 set routing-instances to_CE7 protocols bgp group to_CE7_v4 type external set routing-instances to_CE7 protocols bgp group to_CE7_v4 peer-as 65000 set routing-instances to_CE7 protocols bgp group to_CE7_v4 neighbor 192.168.67.1 set routing-instances to_CE7 protocols bgp source-packet-routing srv6 locator loc8 end-dt4-sid 2001:db8:0:a6::d467 set routing-instances to_CE7 protocols bgp source-packet-routing srv6 locator loc8 end-dt6-sid 2001:db8:0:a6::d667 set routing-instances to_CE7 interface ge-0/0/0.0 set routing-instances to_CE7 route-distinguisher 192.168.255.66:6 set routing-instances to_CE7 vrf-import to_CE7_community_import set routing-instances to_CE7 vrf-export to_CE7_community_export set routing-options source-packet-routing srv6 locator loc8 2001:db8:0:a6::/64 set routing-options resolution preserve-nexthop-hierarchy set routing-options resolution rib bgp.l3vpn-inet6.0 resolution-ribs inet6.3 set routing-options resolution rib bgp.l3vpn-inet6.0 inet6-resolution-ribs inet6.3 set routing-options resolution rib bgp.l3vpn-inet6.0 import mpath-resolve set routing-options resolution rib bgp.l3vpn.0 inet6-resolution-ribs inet6.3 set routing-options resolution rib bgp.l3vpn.0 import mpath-resolve set routing-options resolution rib inet6.0 import mpath-resolve set routing-options resolution rib inet.0 import mpath-resolve set routing-options router-id 192.168.255.66 set routing-options autonomous-system 65500 set routing-options forwarding-table srv6-chain-merge set routing-options forwarding-table export LBPP set protocols bgp group ibgp type internal set protocols bgp group ibgp local-address 2001:db8:6:255::6 set protocols bgp group ibgp family inet unicast extended-nexthop set protocols bgp group ibgp family inet-vpn unicast extended-nexthop set protocols bgp group ibgp family inet-vpn unicast advertise-srv6-service set protocols bgp group ibgp family inet-vpn unicast accept-srv6-service set protocols bgp group ibgp family inet6 unicast extended-nexthop-color set protocols bgp group ibgp family inet6-vpn unicast advertise-srv6-service set protocols bgp group ibgp family inet6-vpn unicast accept-srv6-service set protocols bgp group ibgp neighbor 2001:db8:1:255::1 set protocols bgp multipath set protocols isis interface ge-0/0/2.0 level 2 disable set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc8 end-x-sid 2001:db8:0:a6::1a56 flavor psp set protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc8 end-x-sid 2001:db8:0:a6::1a56 flavor usd set protocols isis interface ge-0/0/2.0 point-to-point set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable set protocols isis interface lo0.0 set protocols isis source-packet-routing srgb start-label 400000 set protocols isis source-packet-routing srgb index-range 5000 set protocols isis source-packet-routing node-segment ipv6-index 170 set protocols isis source-packet-routing srv6 locator loc8 end-sid 2001:db8:0:a6::d06 flavor psp set protocols isis source-packet-routing srv6 locator loc8 end-sid 2001:db8:0:a6::d06 flavor usp set protocols isis source-packet-routing srv6 locator loc8 end-sid 2001:db8:0:a6::d06 flavor usd set protocols isis backup-spf-options use-source-packet-routing set protocols mpls interface all set protocols mpls interface fxp0.0 disable 设备 CE0 set interfaces ge-0/0/0 unit 0 description CE0_To_R1 set interfaces ge-0/0/0 unit 0 family inet address 192.168.10.1/24 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:10::1/64 set interfaces lo0 unit 0 family inet address 10.100.10.1/32 set interfaces lo0 unit 0 family iso address 49.0001.000a.0a0a.0a00 set interfaces lo0 unit 0 family inet6 address 2001:db8:10:255::10/128 set policy-options policy-statement BGP_export term 0 from protocol direct set policy-options policy-statement BGP_export term 0 from interface lo0.0 set policy-options policy-statement BGP_export term 0 then accept set routing-options rib inet6.0 static route 0::0/0 next-hop 2001:db8:10::2 set routing-options rib inet.0 static route 0.0.0.0/0 next-hop 192.168.10.2 set routing-options router-id 10.100.10.1 set routing-options autonomous-system 65000 set protocols bgp group eBGPv6 type external set protocols bgp group eBGPv6 export BGP_export set protocols bgp group eBGPv6 peer-as 65500 set protocols bgp group eBGPv6 neighbor 2001:db8:10::2 set protocols bgp group eBGPv4 type external set protocols bgp group eBGPv4 export BGP_export set protocols bgp group eBGPv4 peer-as 65500 set protocols bgp group eBGPv4 neighbor 192.168.10.2 set protocols isis interface all level 2 disable set protocols isis interface fxp0.0 disable 设备 CE7 set system host-name CE7 set system services netconf ssh set system ports console log-out-on-disconnect set interfaces ge-0/0/0 unit 0 description CE7_To_R6 set interfaces ge-0/0/0 unit 0 family inet address 192.168.67.1/24 set interfaces ge-0/0/0 unit 0 family iso set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:67::1/64 set interfaces lo0 unit 0 family inet address 10.100.10.7/32 set interfaces lo0 unit 0 family iso address 49.0001.0007.0707.0700 set interfaces lo0 unit 0 family inet6 address 2001:db8:7:255::7/128 set policy-options policy-statement BGP_export term 0 from protocol direct set policy-options policy-statement BGP_export term 0 from interface lo0.0 set policy-options policy-statement BGP_export term 0 then accept set routing-options rib inet6.0 static route 0::0/0 next-hop 2001:db8:67::2 set routing-options rib inet.0 static route 0.0.0.0/0 next-hop 192.168.67.2 set routing-options router-id 10.100.10.7 set routing-options autonomous-system 65000 set protocols bgp group eBGPv6 type external set protocols bgp group eBGPv6 export BGP_export set protocols bgp group eBGPv6 peer-as 65500 set protocols bgp group eBGPv6 neighbor 2001:db8:67::2 set protocols bgp group eBGPv4 type external set protocols bgp group eBGPv4 export BGP_export set protocols bgp group eBGPv4 peer-as 65500 set protocols bgp group eBGPv4 neighbor 192.168.67.2 set protocols isis interface all level 2 disable",
          "commands_by_device": {
            "设备 R1": "set interfaces ge-0/0/0 unit 0 description R1_to_CE0\nset interfaces ge-0/0/0 unit 0 family inet address 192.168.10.2/24\nset interfaces ge-0/0/0 unit 0 family iso\nset interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:10::2/64\nset interfaces ge-0/0/3 unit 0 description R1_to_R2\nset interfaces ge-0/0/3 unit 0 family iso\nset interfaces ge-0/0/3 unit 0 family inet6 address 2001:db8:12::1/64\nset interfaces ge-0/0/3 unit 0 description R1_to_R4\nset interfaces ge-0/0/5 unit 0 family iso\nset interfaces ge-0/0/5 unit 0 family inet6 address 2001:db8:14::1/64\nset interfaces lo0 unit 0 family iso address 49.0001.0001.0101.0100\nset interfaces lo0 unit 0 family inet6 address 2001:db8:1:255::1/128\nset policy-options policy-statement to_CE0_community_export term 0 then community add to_CE0_community\nset policy-options policy-statement to_CE0_community_export term 0 then next-hop 2001:db8:0:a1::d01\nset policy-options policy-statement to_CE0_community_export term 0 then accept\nset policy-options policy-statement to_CE0_community_import term 0 from community to_CE0_community\nset policy-options policy-statement to_CE0_community_import term 0 then accept\nset policy-options policy-statement v4vpn1_res_map1 term 1 from protocol bgp\nset policy-options policy-statement v4vpn1_res_map1 term 1 then accept\nset policy-options policy-statement v4vpn1_res_map1 term 1 then resolution-map map1\nset policy-options policy-statement v6vpn1_res_map1 term 1 from family inet6-vpn\nset policy-options policy-statement v6vpn1_res_map1 term 1 from protocol bgp\nset policy-options policy-statement v6vpn1_res_map1 term 1 then accept\nset policy-options policy-statement v6vpn1_res_map1 term 1 then resolution-map map1\nset policy-options policy-statement LBPP term 1 then load-balance per-packet\nset policy-options policy-statement mpath-resolve then multipath-resolve\nset policy-options resolution-map map1 mode ip-color\nset policy-options community to_CE0_community members target:65500:1\nset routing-instances to_CE0 instance-type vrf\nset routing-instances to_CE0 protocols bgp group to_CE0_v6 type external\nset routing-instances to_CE0 protocols bgp group to_CE0_v6 peer-as 65000\nset routing-instances to_CE0 protocols bgp group to_CE0_v6 neighbor 2001:db8:10::1\nset routing-instances to_CE0 protocols bgp group to_CE0_v4 type external\nset routing-instances to_CE0 protocols bgp group to_CE0_v4 peer-as 65000\nset routing-instances to_CE0 protocols bgp group to_CE0_v4 neighbor 192.168.10.1\nset routing-instances to_CE0 protocols bgp source-packet-routing srv6 locator loc1 end-dt4-sid 2001:db8:0:a1::d410\nset routing-instances to_CE0 protocols bgp source-packet-routing srv6 locator loc1 end-dt6-sid 2001:db8:0:a1::d610\nset routing-instances to_CE0 interface ge-0/0/0.0\nset routing-instances to_CE0 route-distinguisher 192.168.255.11:1\nset routing-instances to_CE0 vrf-import to_CE0_community_import\nset routing-instances to_CE0 vrf-export to_CE0_community_export\nset routing-options source-packet-routing srv6 locator loc1 2001:db8:0:a1::/64\nset routing-options resolution preserve-nexthop-hierarchy\nset routing-options resolution rib bgp.l3vpn-inet6.0 resolution-ribs inet6.3\nset routing-options resolution rib bgp.l3vpn-inet6.0 inet6-resolution-ribs inet6.3\nset routing-options resolution rib bgp.l3vpn-inet6.0 import mpath-resolve\nset routing-options resolution rib bgp.l3vpn-inet6.0 inet6-import mpath-resolve\nset routing-options resolution rib bgp.l3vpn-inet6.0 inet6color-import mpath-resolve\nset routing-options resolution rib bgp.l3vpn.0 import mpath-resolve\nset routing-options resolution rib bgp.l3vpn.0 inet6-import mpath-resolve\nset routing-options resolution rib inet6.0 import mpath-resolve\nset routing-options resolution rib inet.0 import mpath-resolve\nset routing-options router-id 192.168.255.11\nset routing-options autonomous-system 65500\nset routing-options forwarding-table srv6-chain-merge\nset routing-options forwarding-table export LBPP\nset protocols bgp group to_R6_ibgpv6 type internal\nset protocols bgp group to_R6_ibgpv6 family inet-vpn unicast accept-srv6-service\nset protocols bgp group to_R6_ibgpv6 family inet6 unicast extended-nexthop-color\nset protocols bgp group to_R6_ibgpv6 family inet6-vpn unicast advertise-srv6-service\nset protocols bgp group to_R6_ibgpv6 family inet6-vpn unicast accept-srv6-service\nset protocols bgp group to_R6_ibgpv6 local-address 2001:db8:1:255::1\nset protocols bgp group to_R6_ibgpv6 import v4vpn1_res_map1\nset protocols bgp group to_R6_ibgpv6 import v6vpn1_res_map1\nset protocols bgp group to_R6_ibgpv6 family inet unicast extended-nexthop\nset protocols bgp group to_R6_ibgpv6 family inet-vpn unicast extended-nexthop\nset protocols bgp group to_R6_ibgpv6 family inet-vpn unicast advertise-srv6-service\nset protocols bgp group to_R6_ibgpv6 neighbor 2001:db8:6:255::6\nset protocols bgp multipath\nset protocols isis interface ge-0/0/3.0 level 2 disable\nset protocols isis interface ge-0/0/3.0 level 1 srv6-adjacency-segment unprotected locator loc1 end-x-sid 2001:db8:0:a1::1a12 flavor psp\nset protocols isis interface ge-0/0/3.0 level 1 srv6-adjacency-segment unprotected locator loc1 end-x-sid 2001:db8:0:a1::1a12 flavor usd\nset protocols isis interface ge-0/0/3.0 point-to-point\nset protocols isis interface ge-0/0/5.0 level 2 disable\nset protocols isis interface ge-0/0/5.0 level 1 post-convergence-lfa\nset protocols isis interface ge-0/0/5.0 point-to-point\nset protocols isis interface all level 2 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0\nset protocols isis source-packet-routing node-segment ipv6-index 101\nset protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor psp\nset protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor usp\nset protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor usd\nset protocols isis backup-spf-options use-post-convergence-lfa\nset protocols isis backup-spf-options use-source-packet-routing\nset protocols mpls interface all\nset protocols mpls interface fxp0.0 disable\nset protocols source-packet-routing segment-list end-sids-segment srv6\nset protocols source-packet-routing segment-list end-sids-segment hop1 srv6-sid 2001:db8:0:a4::d04\nset protocols source-packet-routing segment-list end-sids-segment hop2 srv6-sid 2001:db8:0:a5::d05\nset protocols source-packet-routing segment-list end-sids-segment hop3 srv6-sid 2001:db8:0:a6::d06\nset protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid srv6\nset protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop1 srv6-sid 2001:db8:0:a2::1a23\nset protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop2 srv6-sid 2001:db8:0:a3::1a34\nset protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop3 srv6-sid 2001:db8:0:a6::d06\nset protocols source-packet-routing srv6\nset protocols source-packet-routing source-routing-path nc_path_R1R6 srv6\nset protocols source-packet-routing source-routing-path nc_path_R1R6 to 2001:db8:0:a6::d06\nset protocols source-packet-routing source-routing-path nc_path_R1R6 from 2001:db8:1:255::1\nset protocols source-packet-routing source-routing-path nc_path_R1R6 primary end-sids-segment weight 40\nset protocols source-packet-routing source-routing-path nc_path_R1R6 primary end-x-sids-segment-last-sid-end-sid weight 30\nset protocols source-packet-routing source-routing-path c_path_R1R6 srv6\nset protocols source-packet-routing source-routing-path c_path_R1R6 to 2001:db8:0:a6::d06\nset protocols source-packet-routing source-routing-path c_path_R1R6 from 2001:db8:1:255::1\nset protocols source-packet-routing source-routing-path c_path_R1R6 color 6\nset protocols source-packet-routing source-routing-path c_path_R1R6 primary end-sids-segment weight 40\nset protocols source-packet-routing source-routing-path c_path_R1R6 primary end-x-sids-segment-last-sid-end-sid weight 30",
            "设备 R2": "set interfaces ge-0/0/0 unit 0 description R2_To_R1\nset interfaces ge-0/0/0 unit 0 family iso\nset interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:12::2/64\nset interfaces ge-0/0/2 unit 0 description R2_To_R3\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:23::1/64\nset interfaces lo0 unit 0 family iso address 49.0001.0002.0202.0200\nset interfaces lo0 unit 0 family inet6 address 2001:db8:2:255::2/128\nset routing-options source-packet-routing srv6 locator loc2 2001:db8:0:a2::/64\nset routing-options router-id 192.168.255.22\nset protocols isis interface ge-0/0/0.0 level 2 disable\nset protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a12 flavor psp\nset protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a12 flavor usd\nset protocols isis interface ge-0/0/0.0 point-to-point\nset protocols isis interface ge-0/0/2.0 level 2 disable\nset protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a23 flavor psp\nset protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc2 end-x-sid 2001:db8:0:a2::1a23 flavor usd\nset protocols isis interface ge-0/0/2.0 point-to-point\nset protocols isis interface all level 2 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0 passive\nset protocols isis source-packet-routing node-segment ipv6-index 110\nset protocols isis source-packet-routing srv6 locator loc2 end-sid 2001:db8:0:a2::d02 flavor psp\nset protocols isis source-packet-routing srv6 locator loc2 end-sid 2001:db8:0:a2::d02 flavor usp\nset protocols isis source-packet-routing srv6 locator loc2 end-sid 2001:db8:0:a2::d02 flavor usd\nset protocols isis backup-spf-options use-source-packet-routing\nset protocols mpls interface all\nset protocols mpls interface fxp0.0 disable",
            "设备 R3": "set interfaces ge-0/0/0 unit 0 description R3_To_R2\nset interfaces ge-0/0/0 unit 0 family iso\nset interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:23::2/64\nset interfaces ge-0/0/2 unit 0 description R3_To_R4\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:34::1/64\nset interfaces ge-0/0/4 unit 0 description R3_To_R5\nset interfaces ge-0/0/4 unit 0 family iso\nset interfaces ge-0/0/4 unit 0 family inet6 address 2001:db8:35::1/64\nset interfaces lo0 unit 0 family iso address 49.0001.0003.0303.0300\nset interfaces lo0 unit 0 family inet6 address 2001:db8:3:255::3/128\nset routing-options source-packet-routing srv6 locator loc3 2001:db8:0:a3::/64\nset routing-options router-id 192.168.255.33\nset protocols isis interface ge-0/0/0.0 level 2 disable\nset protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a23 flavor psp\nset protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a23 flavor usd\nset protocols isis interface ge-0/0/0.0 point-to-point\nset protocols isis interface ge-0/0/2.0 level 2 disable\nset protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a34 flavor psp\nset protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a34 flavor usd\nset protocols isis interface ge-0/0/2.0 point-to-point\nset protocols isis interface ge-0/0/4.0 level 2 disable\nset protocols isis interface ge-0/0/4.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a35 flavor psp\nset protocols isis interface ge-0/0/4.0 level 1 srv6-adjacency-segment unprotected locator loc3 end-x-sid 2001:db8:0:a3::1a35 flavor usd\nset protocols isis interface ge-0/0/4.0 point-to-point\nset protocols isis interface all level 2 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0\nset protocols isis source-packet-routing node-segment ipv6-index 120\nset protocols isis source-packet-routing srv6 locator loc3 end-sid 2001:db8:0:a3::d03 flavor usp\nset protocols isis source-packet-routing srv6 locator loc3 end-sid 2001:db8:0:a3::d03 flavor usd\nset protocols isis backup-spf-options use-source-packet-routing\nset protocols mpls interface all\nset protocols mpls interface fxp0.0 disable",
            "设备 R4": "set interfaces ge-0/0/0 unit 0 description R4_To_R1\nset interfaces ge-0/0/0 unit 0 family iso\nset interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:14::2/64\nset interfaces ge-0/0/2 unit 0 description R4_To_R3\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:34::2/64\nset interfaces ge-0/0/6 unit 0 description R4_To_R5\nset interfaces ge-0/0/6 unit 0 family iso\nset interfaces ge-0/0/6 unit 0 family inet6 address 2001:db8:45::1/64\nset interfaces lo0 unit 0 family iso address 49.0001.0004.0404.0400\nset interfaces lo0 unit 0 family inet6 address 2001:db8:4:255::4/128\nset routing-options source-packet-routing srv6 locator loc4 2001:db8:0:a4::/64\nset routing-options router-id 192.168.255.44\nset protocols isis interface ge-0/0/0.0 level 2 disable\nset protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a41 flavor psp\nset protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a41 flavor usd\nset protocols isis interface ge-0/0/0.0 point-to-point\nset protocols isis interface ge-0/0/2.0 level 2 disable\nset protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a34 flavor psp\nset protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a34 flavor usd\nset protocols isis interface ge-0/0/2.0 point-to-point\nset protocols isis interface ge-0/0/6.0 level 2 disable\nset protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a45 flavor psp\nset protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc4 end-x-sid 2001:db8:0:a4::1a45 flavor usd\nset protocols isis interface ge-0/0/6.0 point-to-point\nset protocols isis interface all level 2 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0\nset protocols isis source-packet-routing node-segment ipv6-index 130\nset protocols isis source-packet-routing srv6 locator loc4 end-sid 2001:db8:0:a4::d04 flavor psp\nset protocols isis source-packet-routing srv6 locator loc4 end-sid 2001:db8:0:a4::d04 flavor usp\nset protocols isis source-packet-routing srv6 locator loc4 end-sid 2001:db8:0:a4::d04 flavor usd\nset protocols isis backup-spf-options use-source-packet-routing\nset protocols mpls interface all\nset protocols mpls interface fxp0.0 disable",
            "设备 R5": "set interfaces ge-0/0/0 unit 0 description R5_To_R3\nset interfaces ge-0/0/0 unit 0 family iso\nset interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:35::2/64\nset interfaces ge-0/0/2 unit 0 description R5_To_R4\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:45::2/64\nset interfaces ge-0/0/6 unit 0 description R5_To_R6\nset interfaces ge-0/0/6 unit 0 family iso\nset interfaces ge-0/0/6 unit 0 family inet6 address 2001:db8:56::1/64\nset interfaces lo0 unit 0 family iso address 49.0001.0005.0505.0500\nset interfaces lo0 unit 0 family inet6 address 2001:db8:5:255::5/128\nset routing-options source-packet-routing srv6 locator loc5 2001:db8:0:a5::/64\nset routing-options router-id 192.168.255.55\nset protocols isis interface ge-0/0/0.0 level 2 disable\nset protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a35 flavor psp\nset protocols isis interface ge-0/0/0.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a35 flavor usd\nset protocols isis interface ge-0/0/0.0 point-to-point\nset protocols isis interface ge-0/0/2.0 level 2 disable\nset protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a45 flavor psp\nset protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a45 flavor usd\nset protocols isis interface ge-0/0/2.0 point-to-point\nset protocols isis interface ge-0/0/6.0 level 2 disable\nset protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a56 flavor psp\nset protocols isis interface ge-0/0/6.0 level 1 srv6-adjacency-segment unprotected locator loc5 end-x-sid 2001:db8:0:a5::1a56 flavor usd\nset protocols isis interface ge-0/0/6.0 point-to-point\nset protocols isis interface all level 2 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0\nset protocols isis source-packet-routing node-segment ipv6-index 150\nset protocols isis source-packet-routing srv6 locator loc5 end-sid 2001:db8:0:a5::d05 flavor psp\nset protocols isis source-packet-routing srv6 locator loc5 end-sid 2001:db8:0:a5::d05 flavor usp\nset protocols isis source-packet-routing srv6 locator loc5 end-sid 2001:db8:0:a5::d05 flavor usd\nset protocols isis backup-spf-options use-source-packet-routing\nset protocols mpls interface all\nset protocols mpls interface fxp0.0 disable",
            "设备 R6": "set interfaces ge-0/0/0 unit 0 description R6_To_CE7\nset interfaces ge-0/0/0 unit 0 family iso\nset interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:67::2/64\nset interfaces ge-0/0/2 unit 0 description R6_To_R5\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:67::2/64\nset interfaces ge-0/0/2 unit 0 description R6_To_R5\nset interfaces ge-0/0/2 unit 0 family iso\nset interfaces ge-0/0/2 unit 0 family inet6 address 2001:db8:56::2/64\nset interfaces lo0 unit 0 family iso address 49.0001.0006.0606.0600\nset interfaces lo0 unit 0 family inet6 address 2001:db8:6:255::6/128\nset policy-options policy-statement LBPP term 1 then load-balance per-packet\nset policy-options policy-statement mpath-resolve then multipath-resolve\nset policy-options policy-statement to_CE7_community_export term 0 then community add to_CE7_community\nset policy-options policy-statement to_CE7_community_export term 0 then community add to_ce7_color_com\nset policy-options policy-statement to_CE7_community_export term 0 then next-hop 2001:db8:0:a6::d06\nset policy-options policy-statement to_CE7_community_export term 0 then accept\nset policy-options policy-statement to_CE7_community_import term 0 from community to_CE7_community\nset policy-options policy-statement to_CE7_community_import term 0 then accept\nset policy-options community to_CE7_community members target:65500:1\nset policy-options community to_ce7_color_com members color:1:6\nset routing-instances to_CE7 instance-type vrf\nset routing-instances to_CE7 protocols bgp group to_CE7_v6 type external\nset routing-instances to_CE7 protocols bgp group to_CE7_v6 peer-as 65000\nset routing-instances to_CE7 protocols bgp group to_CE7_v6 neighbor 2001:db8:67::1\nset routing-instances to_CE7 protocols bgp group to_CE7_v4 type external\nset routing-instances to_CE7 protocols bgp group to_CE7_v4 peer-as 65000\nset routing-instances to_CE7 protocols bgp group to_CE7_v4 neighbor 192.168.67.1\nset routing-instances to_CE7 protocols bgp source-packet-routing srv6 locator loc8 end-dt4-sid 2001:db8:0:a6::d467\nset routing-instances to_CE7 protocols bgp source-packet-routing srv6 locator loc8 end-dt6-sid 2001:db8:0:a6::d667\nset routing-instances to_CE7 interface ge-0/0/0.0\nset routing-instances to_CE7 route-distinguisher 192.168.255.66:6\nset routing-instances to_CE7 vrf-import to_CE7_community_import\nset routing-instances to_CE7 vrf-export to_CE7_community_export\nset routing-options source-packet-routing srv6 locator loc8 2001:db8:0:a6::/64\nset routing-options resolution preserve-nexthop-hierarchy\nset routing-options resolution rib bgp.l3vpn-inet6.0 resolution-ribs inet6.3\nset routing-options resolution rib bgp.l3vpn-inet6.0 inet6-resolution-ribs inet6.3\nset routing-options resolution rib bgp.l3vpn-inet6.0 import mpath-resolve\nset routing-options resolution rib bgp.l3vpn.0 inet6-resolution-ribs inet6.3\nset routing-options resolution rib bgp.l3vpn.0 import mpath-resolve\nset routing-options resolution rib inet6.0 import mpath-resolve\nset routing-options resolution rib inet.0 import mpath-resolve\nset routing-options router-id 192.168.255.66\nset routing-options autonomous-system 65500\nset routing-options forwarding-table srv6-chain-merge\nset routing-options forwarding-table export LBPP\nset protocols bgp group ibgp type internal\nset protocols bgp group ibgp local-address 2001:db8:6:255::6\nset protocols bgp group ibgp family inet unicast extended-nexthop\nset protocols bgp group ibgp family inet-vpn unicast extended-nexthop\nset protocols bgp group ibgp family inet-vpn unicast advertise-srv6-service\nset protocols bgp group ibgp family inet-vpn unicast accept-srv6-service\nset protocols bgp group ibgp family inet6 unicast extended-nexthop-color\nset protocols bgp group ibgp family inet6-vpn unicast advertise-srv6-service\nset protocols bgp group ibgp family inet6-vpn unicast accept-srv6-service\nset protocols bgp group ibgp neighbor 2001:db8:1:255::1\nset protocols bgp multipath\nset protocols isis interface ge-0/0/2.0 level 2 disable\nset protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc8 end-x-sid 2001:db8:0:a6::1a56 flavor psp\nset protocols isis interface ge-0/0/2.0 level 1 srv6-adjacency-segment unprotected locator loc8 end-x-sid 2001:db8:0:a6::1a56 flavor usd\nset protocols isis interface ge-0/0/2.0 point-to-point\nset protocols isis interface all level 2 disable\nset protocols isis interface fxp0.0 disable\nset protocols isis interface lo0.0\nset protocols isis source-packet-routing srgb start-label 400000\nset protocols isis source-packet-routing srgb index-range 5000\nset protocols isis source-packet-routing node-segment ipv6-index 170\nset protocols isis source-packet-routing srv6 locator loc8 end-sid 2001:db8:0:a6::d06 flavor psp\nset protocols isis source-packet-routing srv6 locator loc8 end-sid 2001:db8:0:a6::d06 flavor usp\nset protocols isis source-packet-routing srv6 locator loc8 end-sid 2001:db8:0:a6::d06 flavor usd\nset protocols isis backup-spf-options use-source-packet-routing\nset protocols mpls interface all\nset protocols mpls interface fxp0.0 disable",
            "设备 CE0": "set interfaces ge-0/0/0 unit 0 description CE0_To_R1\nset interfaces ge-0/0/0 unit 0 family inet address 192.168.10.1/24\nset interfaces ge-0/0/0 unit 0 family iso\nset interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:10::1/64\nset interfaces lo0 unit 0 family inet address 10.100.10.1/32\nset interfaces lo0 unit 0 family iso address 49.0001.000a.0a0a.0a00\nset interfaces lo0 unit 0 family inet6 address 2001:db8:10:255::10/128\nset policy-options policy-statement BGP_export term 0 from protocol direct\nset policy-options policy-statement BGP_export term 0 from interface lo0.0\nset policy-options policy-statement BGP_export term 0 then accept\nset routing-options rib inet6.0 static route 0::0/0 next-hop 2001:db8:10::2\nset routing-options rib inet.0 static route 0.0.0.0/0 next-hop 192.168.10.2\nset routing-options router-id 10.100.10.1\nset routing-options autonomous-system 65000\nset protocols bgp group eBGPv6 type external\nset protocols bgp group eBGPv6 export BGP_export\nset protocols bgp group eBGPv6 peer-as 65500\nset protocols bgp group eBGPv6 neighbor 2001:db8:10::2\nset protocols bgp group eBGPv4 type external\nset protocols bgp group eBGPv4 export BGP_export\nset protocols bgp group eBGPv4 peer-as 65500\nset protocols bgp group eBGPv4 neighbor 192.168.10.2\nset protocols isis interface all level 2 disable\nset protocols isis interface fxp0.0 disable",
            "设备 CE7": "set system host-name CE7\nset system services netconf ssh\nset system ports console log-out-on-disconnect\nset interfaces ge-0/0/0 unit 0 description CE7_To_R6\nset interfaces ge-0/0/0 unit 0 family inet address 192.168.67.1/24\nset interfaces ge-0/0/0 unit 0 family iso\nset interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:67::1/64\nset interfaces lo0 unit 0 family inet address 10.100.10.7/32\nset interfaces lo0 unit 0 family iso address 49.0001.0007.0707.0700\nset interfaces lo0 unit 0 family inet6 address 2001:db8:7:255::7/128\nset policy-options policy-statement BGP_export term 0 from protocol direct\nset policy-options policy-statement BGP_export term 0 from interface lo0.0\nset policy-options policy-statement BGP_export term 0 then accept\nset routing-options rib inet6.0 static route 0::0/0 next-hop 2001:db8:67::2\nset routing-options rib inet.0 static route 0.0.0.0/0 next-hop 192.168.67.2\nset routing-options router-id 10.100.10.7\nset routing-options autonomous-system 65000\nset protocols bgp group eBGPv6 type external\nset protocols bgp group eBGPv6 export BGP_export\nset protocols bgp group eBGPv6 peer-as 65500\nset protocols bgp group eBGPv6 neighbor 2001:db8:67::2\nset protocols bgp group eBGPv4 type external\nset protocols bgp group eBGPv4 export BGP_export\nset protocols bgp group eBGPv4 peer-as 65500\nset protocols bgp group eBGPv4 neighbor 192.168.67.2\nset protocols isis interface all level 2 disable"
          }
        },
        {
          "title": "配置设备 R1",
          "level": 4,
          "content": "分步过程 要为 IS-IS SRv6 核心上的 SRV6 隧道配置静态 SR-TE 策略，请在 R1 设备上执行以下步骤： 配置设备接口以启用 IP 传输。 [edit] user@R1# set interfaces ge-0/0/0 unit 0 description R1_To_CE0 user@R1# set interfaces ge-0/0/0 unit 0 family inet address 192.168.10.2/24 user@R1# set interfaces ge-0/0/0 unit 0 family iso user@R1# set interfaces ge-0/0/0 unit 0 family inet6 address 2001:db8:10::2/64 user@R1# set interfaces ge-0/0/3 unit 0 description R1_To_R2 user@R1# set interfaces ge-0/0/3 unit 0 family iso user@R1# set interfaces ge-0/0/3 unit 0 family inet6 address 2001:db8:12::1/64 user@R1# set interfaces ge-0/0/5 unit 0 description R1_To_R4 user@R1# set interfaces ge-0/0/5 unit 0 family iso user@R1# set interfaces ge-0/0/5 unit 0 family inet6 address 2001:db8:14::1/64 使用 IPv4 和 IPv6 地址配置环路接口，该地址用作 BGP 会话的路由器 ID。 [edit] user@R1# set interfaces lo0 unit 0 family iso address 49.0001.0001.0101.0100 user@R1# set interfaces lo0 unit 0 family inet6 address 2001:db8:1:255::1/128 配置路由器 ID 和自治系统 （AS） 编号，以便在属于同一 AS 的一组路由设备中传播路由信息。 [edit] user@R1# set routing-options router-id 192.168.255.11 user@R1# set routing-options autonomous-system 65500 [edit] user@R1# set protocols bgp group to_R6_ibgpv6 type internal user@R1# set protocols bgp group to_R6_ibgpv6 local-address 2001:db8:1:255::1 user@R1# set protocols bgp group to_R6_ibgpv6 import v4vpn1_res_map1 user@R1# set protocols bgp group to_R6_ibgpv6 import v6vpn1_res_map1 user@R1# set protocols bgp group to_R6_ibgpv6 family inet unicast extended-nexthop user@R1# set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast extended-nexthop user@R1# set protocols bgp group to_R6_ibgpv6 neighbor 2001:db8:6:255::6 为 IPv4 和 IPv6 流量配置外部路由实例to_CE0。为 to_CE0 配置 BGP 协议，以便在提供商边缘设备之间启用对等互连和流量传输。 [edit] user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v6 type external user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v6 peer-as 65000 user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v6 neighbor 2001:db8:10::1 user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v4 type external user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v4 peer-as 65000 user@R1# set routing-instances to_CE0 protocols bgp group to_CE0_v4 neighbor 192.168.10.1 使用 ip 颜色模式配置分辨率映射映射 map1。将 BGP 协议配置为使用多个路径，并定义包含多路径解析操作的策略 mpath-solve，然后导入策略以解析 IBGP 多路径路由的所有可用路径。 [edit] user@R1# set protocols bgp multipath user@R1# set policy-options resolution-map map1 mode ip-color user@R1# set policy-options policy-statement mpath-resolve then multipath-resolve user@R1# set routing-options resolution rib bgp.l3vpn-inet6.0 resolution-ribs inet6.3 user@R1# set routing-options resolution rib bgp.l3vpn-inet6.0 inet6-resolution-ribs inet6.3 user@R1# set routing-options resolution rib bgp.l3vpn-inet6.0 import mpath-resolve user@R1# set routing-options resolution rib bgp.l3vpn-inet6.0 inet6-import mpath-resolve user@R1# set routing-options resolution rib bgp.l3vpn-inet6.0 inet6color-import mpath-resolve user@R1# set routing-options resolution rib bgp.l3vpn.0 import mpath-resolve user@R1# set routing-options resolution rib bgp.l3vpn.0 inet6-import mpath-resolve user@R1# set routing-options resolution rib bgp.l3vpn.0 inet6color-import mpath-resolve user@R1# set routing-options resolution rib inet6.0 import mpath-resolve user@R1# set routing-options resolution rib inet.0 import mpath-resolve [edit] user@R1# set policy-options policy-statement to_CE0_community_import term 0 from community to_CE0_community user@R1# set policy-options policy-statement to_CE0_community_import term 0 then accept user@R1# set policy-options policy-statement to_CE0_community_export term 0 then community add to_CE0_community user@R1# set policy-options policy-statement to_CE0_community_export term 0 then next-hop 2001:db8:0:a1::d01 user@R1# set policy-options policy-statement to_CE0_community_export term 0 then accept user@R1# set routing-instances to_CE0 vrf-import to_CE0_community_import user@R1# set routing-instances to_CE0 vrf-export to_CE0_community_export 为参与路由实例的每个 PE 路由器配置 VPN 类型和唯一路由识别符。 [edit] user@R1# set routing-instances to_CE0 instance-type vrf user@R1# set routing-instances to_CE0 interface ge-0/0/0.0 user@R1# set routing-instances to_CE0 route-distinguisher 192.168.255.11:1 [edit] user@R1# set policy-options policy-statement LBPP term 1 then load-balance per-packet user@R1# set policy-options community to_CE0_community members target:65500:1 user@R1# set routing-options forwarding-table export LBPP [edit] user@R1# set policy-options policy-statement v4vpn1_res_map1 term 1 from protocol bgp user@R1# set policy-options policy-statement v4vpn1_res_map1 term 1 then accept user@R1# set policy-options policy-statement v4vpn1_res_map1 term 1 then resolution-map map1 user@R1# set policy-options policy-statement v6vpn1_res_map1 term 1 from family inet6-vpn user@R1# set policy-options policy-statement v6vpn1_res_map1 term 1 then accept user@R1# set policy-options policy-statement v6vpn1_res_map1 term 1 then resolution-map map1 [edit] user@R1# set protocols isis interface all level 2 disable user@R1# set protocols isis interface fxp0.0 disable user@R1# set protocols isis interface lo0.0 [edit] user@R1# set protocols isis backup-spf-options use-post-convergence-lfa user@R1# set protocols isis backup-spf-options use-source-packet-routing [edit] user@R1# set protocols isis source-packet-routing node-segment ipv6-index 101 全局启用 SRv6 和定位器地址以指示路由器的 SRv6 功能。SRv6 SID 是由定位器和函数组成的 IPv6 地址。路由协议播发定位器地址。 [edit] user@R1# set protocols source-packet-routing srv6 user@R1# set routing-options source-packet-routing srv6 locator loc1 2001:db8:0:a1::/64 为 SR-TE 路由风格启用保留下一跃点层次结构，为 SRv6 链下一跃点启用平台合并。 [edit] user@R1# set routing-options resolution preserve-nexthop-hierarchy user@R1# set routing-options forwarding-table srv6-chain-merge 配置结束 dt4 和结束 dt6 SID 值以启用第 3 层 VPN 服务。 [edit] user@R1# set routing-instances to_CE0 protocols bgp source-packet-routing srv6 locator loc1 end-dt4-sid 2001:db8:0:a1::d410 user@R1# set routing-instances to_CE0 protocols bgp source-packet-routing srv6 locator loc1 end-dt6-sid 2001:db8:0:a1::d610 使设备能够向 BGP 对等方播发 SRv6 服务，并接受出口设备通告的路由。 [edit] user@R1# set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast advertise-srv6-service user@R1# set protocols bgp group to_R6_ibgpv6 family inet-vpn unicast accept-srv6-service user@R1# set protocols bgp group to_R6_ibgpv6 family inet6 unicast extended-nexthop-color user@R1# set protocols bgp group to_R6_ibgpv6 family inet6-vpn unicast advertise-srv6-service user@R1# set protocols bgp group to_R6_ibgpv6 family inet6-vpn unicast accept-srv6-service 为前缀段配置 End-Sid 功能。指定特定实例，即根据您的网络要求执行 End-SID 函数的行为。倒数第二段流行 （PSP）、终极分段流行 （USP） 和终极分段解封装 （USP） 是 SRv6 功能的三种可用类型。 注： 确保定位器和 End-SID 位于同一子网中，以避免提交错误。 确保定位器和 End-SID 位于同一子网中，以避免提交错误。 [edit] user@R1# set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor psp user@R1# set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor usp user@R1# set protocols isis source-packet-routing srv6 locator loc1 end-sid 2001:db8:0:a1::d01 flavor usd 在点对点 （P2P） 接口上为邻接分段配置 End-X-SID 功能。为 End-X-SID 指定一个或多个特定实例。 注： 确保定位器和 End-X-SID 位于同一子网中，以避免提交错误。在将定位器映射到接口之前，您必须启用 SRv6 并在 上 [edit routing-options] 配置定位器。 确保定位器和 End-X-SID 位于同一子网中，以避免提交错误。在将定位器映射到接口之前，您必须启用 SRv6 并在 上 [edit routing-options] 配置定位器。 [edit] user@R1# set protocols isis interface ge-0/0/3.0 level 2 disable user@R1# set protocols isis interface ge-0/0/3.0 level 1 srv6-adjacency-segment unprotected locator loc1 end-x-sid 2001:db8:0:a1::1a12 flavor psp user@R1# set protocols isis interface ge-0/0/3.0 level 1 srv6-adjacency-segment unprotected locator loc1 end-x-sid 2001:db8:0:a1::1a12 flavor usd user@R1# set protocols isis interface ge-0/0/3.0 point-to-point user@R1# set protocols isis interface ge-0/0/5.0 level 2 disable user@R1# set protocols isis interface ge-0/0/5.0 level 1 post-convergence-lfa user@R1# set protocols isis interface ge-0/0/5.0 point-to-point 配置 SRv6 分段列表 <R4、R5、R6> 和 <R2、R3、R6> 之间的 end-sids-segment 和 end-x-sids-segment-last-sid-end-sid。 [edit] user@R1# set protocols source-packet-routing segment-list end-sids-segment srv6 user@R1# set protocols source-packet-routing segment-list end-sids-segment hop1 srv6-sid 2001:db8:0:a4::d04 user@R1# set protocols source-packet-routing segment-list end-sids-segment hop2 srv6-sid 2001:db8:0:a5::d05 user@R1# set protocols source-packet-routing segment-list end-sids-segment hop3 srv6-sid 2001:db8:0:a6::d06 user@R1# set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid srv6 user@R1# set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop1 srv6-sid 2001:db8:0:a2::1a23 user@R1# set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop2 srv6-sid 2001:db8:0:a3::1a34 user@R1# set protocols source-packet-routing segment-list end-x-sids-segment-last-sid-end-sid hop3 srv6-sid 2001:db8:0:a6::d06 将 R1 和 R6 之间的 SRv6-TE 隧道配置为端边段权重为 40，为无色路径 （nc_path_R1R6） 和彩色路径 （c_path_R1R6） 配置端 x-sid-段-最后-sid-端-sid 权重 30。 [edit] user@R1# set protocols source-packet-routing source-routing-path nc_path_R1R6 srv6 user@R1# set protocols source-packet-routing source-routing-path nc_path_R1R6 to 2001:db8:0:a6::d06 user@R1# set protocols source-packet-routing source-routing-path nc_path_R1R6 from 2001:db8:1:255::1 user@R1# set protocols source-packet-routing source-routing-path nc_path_R1R6 primary end-sids-segment weight 40 user@R1# set protocols source-packet-routing source-routing-path nc_path_R1R6 primary end-x-sids-segment-last-sid-end-sid weight 30 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 srv6 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 to 2001:db8:0:a6::d06 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 from 2001:db8:1:255::1 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 color 6 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 primary end-sids-segment weight 40 user@R1# set protocols source-packet-routing source-routing-path c_path_R1R6 primary end-x-sids-segment-last-sid-end-sid weight 30",
          "sections": [
            {
              "title": "分步过程",
              "level": 5
            }
          ]
        },
        {
          "title": "结果",
          "level": 4,
          "content": "检查配置结果： 完成设备配置后，从配置模式输入 commit 。",
          "code": [
            "interfaces {                            \n    ge-0/0/0 {                          \n        unit 0 {                        \n            description R1_To_CE0; \n            family inet {               \n                address 192.168.10.1/24;\n                address 192.168.10.2/24;\n            }                           \n            family iso;                 \n            family inet6 {              \n                address 2001:db8:10::2/64;\n            }                           \n        }                               \n    }                                                        \n    ge-0/0/3 {                          \n        unit 0 {                        \n            description R1_To_R2;  \n            family iso;                 \n            family inet6 {              \n                address 2001:db8:12::1/64;\n            }                           \n        }                               \n    }                                   \n    ge-0/0/5 {                          \n        unit 0 {                        \n            description R1_To_R4;  \n            family iso;                 \n            family inet6 {              \n                address 2001:db8:14::1/64;\n            }                           \n        }                               \n    }                                   \n    lo0 {                               \n        unit 0 {                        \n            family inet {               \n                address 192.168.100.2/32;\n            }                           \n            family iso {                \n                address 49.0002.0192.0168.0002.00;\n                address 49.0001.0001.0101.0100;\n            }                           \n            family inet6 {              \n                address 2001:db8:1:255::1/128;\n            }                           \n        }                               \n    }                                   \n}                                       \npolicy-options {                        \n    policy-statement LBPP {             \n        term 1 {                        \n            then {                      \n                load-balance per-packet;\n            }                           \n        }                               \n    }                                   \n    policy-statement mpath-resolve {    \n        then multipath-resolve;         \n    }                                   \n    policy-statement to_CE0_community_export {\n        term 0 {                        \n            then {                      \n                community add to_CE0_community;\n                next-hop 2001:db8:0:a1::d01;\n                accept;                 \n            }                           \n        }                               \n    }                                   \n    policy-statement to_CE0_community_import {\n        term 0 {                        \n            from community to_CE0_community;\n            then accept;                \n        }                               \n    }                                   \n    policy-statement v4vpn1_res_map1 {  \n        term 1 {                        \n            from protocol bgp;          \n            then {                      \n                accept;                 \n                resolution-map map1;    \n            }                           \n        }                               \n    }                                   \n    policy-statement v6vpn1_res_map1 {  \n        term 1 {                        \n            from {                      \n                family inet6-vpn;       \n                protocol bgp;           \n            }                           \n            then {                      \n                accept;                 \n                resolution-map map1;    \n            }                           \n        }                               \n    }                                   \n    community to_CE0_community members target:65500:1;\n    resolution-map map1 {               \n        mode ip-color;                  \n    }                                   \n}                                       \nrouting-instances {                     \n    to_CE0 {                            \n        instance-type vrf;              \n        protocols {                     \n            bgp {                       \n                group to_CE0_v6 {       \n                    type external;      \n                    peer-as 65000;      \n                    neighbor 2001:db8:10::1;\n                }                       \n                group to_CE0_v4 {       \n                    type external;      \n                    peer-as 65000;      \n                    neighbor 192.168.10.1;\n                }                       \n                source-packet-routing { \n                    srv6 {              \n                        locator loc1 {  \n                            end-dt4-sid 2001:db8:0:a1::d410;\n                            end-dt6-sid 2001:db8:0:a1::d610;\n                        }               \n                    }                   \n                }                       \n            }                           \n        }                               \n        interface ge-0/0/0.0;           \n        route-distinguisher 192.168.255.11:1;  \n        vrf-import to_CE0_community_import;\n        vrf-export to_CE0_community_export;\n    }                                   \n}                                       \nrouting-options {                       \n    source-packet-routing {             \n        srv6 {                          \n            locator loc1 2001:db8:0:a1::/64;\n        }                               \n    }                                   \n    resolution {                        \n        preserve-nexthop-hierarchy;     \n        rib bgp.l3vpn-inet6.0 {         \n            resolution-ribs inet6.3;    \n            inet6-resolution-ribs inet6.3;\n            import mpath-resolve;       \n            inet6-import mpath-resolve; \n            inet6color-import mpath-resolve;\n        }                               \n        rib bgp.l3vpn.0 {               \n            import mpath-resolve;       \n            inet6-import mpath-resolve; \n            inet6color-import mpath-resolve;\n        }                               \n        rib inet6.0 {                   \n            import mpath-resolve;       \n        }                               \n        rib inet.0 {                    \n            import mpath-resolve;       \n        }                               \n    }                                   \n    router-id 192.168.255.11;                  \n    autonomous-system 65500;            \n    forwarding-table {                  \n        srv6-chain-merge;               \n        export LBPP;                    \n    }                                   \n}                                       \nprotocols {                             \n    bgp {                               \n        group to_R6_ibgpv6 {            \n            type internal;              \n            local-address 2001:db8:1:255::1;\n            import [ v4vpn1_res_map1 v6vpn1_res_map1 ];\n            family inet {               \n                unicast {               \n                    extended-nexthop;   \n                }                       \n            }                           \n            family inet-vpn {           \n                unicast {               \n                    extended-nexthop;   \n                    advertise-srv6-service;\n                    accept-srv6-service;\n                }                       \n            }                           \n            family inet6 {              \n                unicast {               \n                    extended-nexthop-color;\n                }                       \n            }                           \n            family inet6-vpn {          \n                unicast {               \n                    advertise-srv6-service;\n                    accept-srv6-service;\n                }                       \n            }                           \n            neighbor 2001:db8:6:255::6; \n        }                               \n        multipath;                      \n    }                                   \n    isis {                              \n        interface ge-0/0/3.0 {          \n            level 2 disable;            \n            level 1 {                   \n                srv6-adjacency-segment {\n                    unprotected {       \n                        locator loc1 {  \n                            end-x-sid 2001:db8:0:a1::1a12 {\n                                flavor {\n                                    psp;\n                                    usd;\n                                }       \n                            }           \n                        }               \n                    }                   \n                }                       \n            }                           \n            point-to-point;             \n        }                               \n        interface ge-0/0/5.0 {          \n            level 2 disable;            \n            level 1 {                                         \n                post-convergence-lfa;   \n            }                           \n            point-to-point;             \n        }                               \n        interface all {                 \n            level 2 disable;            \n        }                               \n        interface fxp0.0 {              \n            disable;                    \n        }                               \n        interface lo0.0;                \n        source-packet-routing {         \n            \n            node-segment ipv6-index 101;\n            srv6 {                      \n                locator loc1 {          \n                    end-sid 2001:db8:0:a1::d01 {\n                        flavor {        \n                            psp;        \n                            usp;        \n                            usd;        \n                        }               \n                    }                   \n                }                       \n            }                           \n        }                               \n        backup-spf-options {            \n            use-post-convergence-lfa;   \n            use-source-packet-routing;  \n        }                               \n    }                                   \n    mpls {                              \n        interface all;                  \n        interface fxp0.0 {              \n            disable;                    \n        }                               \n    }                                   \n    source-packet-routing {             \n        segment-list end-sids-segment { \n            srv6;                       \n            hop1 srv6-sid 2001:db8:0:a4::d04;\n            hop2 srv6-sid 2001:db8:0:a5::d05;\n            hop3 srv6-sid 2001:db8:0:a6::d06;\n        }                               \n        segment-list end-x-sids-segment-last-sid-end-sid {\n            srv6;                       \n            hop1 srv6-sid 2001:db8:0:a2::1a23;\n            hop2 srv6-sid 2001:db8:0:a3::1a34;\n            hop3 srv6-sid 2001:db8:0:a6::d06;\n        }                               \n        srv6;                           \n        source-routing-path nc_path_R1R6 {\n            srv6;                       \n            to 2001:db8:0:a6::d06;      \n            from 2001:db8:1:255::1;     \n            primary {                   \n                end-sids-segment weight 40;\n                end-x-sids-segment-last-sid-end-sid weight 30;\n            }                           \n        }                               \n        source-routing-path c_path_R1R6 {\n            srv6;                       \n            to 2001:db8:0:a6::d06;      \n            from 2001:db8:1:255::1;     \n            color 6;                    \n            primary {                   \n                end-sids-segment weight 40;\n                end-x-sids-segment-last-sid-end-sid weight 30;\n            }                           \n        }                               \n    }                                   \n}"
          ]
        }
      ]
    }
  ],
  "content": "要求 此示例使用以下硬件和软件组件： 六个 MX 系列路由器。 Junos OS 21.3R1 或更高版本"
}