{
  "title": "BGP 入口对等方的分段路由流量工程概述",
  "sections": [
    {
      "title": "静态配置的分段路由策略",
      "level": 3,
      "content": "可以在入口路由器上配置静态策略，以便在与控制器的链路出现故障时允许流量路由。在 [edit protocols source-packet-routing] 层次结构级别进行配置 sr-preference ，以选择静态配置的分段路由流量工程策略转发条目，而不是 BGP 信号分段路由流量工程转发条目。分段标识符标签堆栈的顶部标签与内部网关协议 （IGP） 顶部标签交换以进行解析。 静态分段路由流量工程策略可以包含多个带或不带加权 ECMP 的路径。如果 IGP 配置配置了加权 ECMP，则转发路径将提供分层加权等价多路径 （ECMP）。但是，如果未配置加权 ECMP，则会对所有分段路由流量工程路径应用相等的平衡。"
    }
  ],
  "content": "此功能使 BGP 能够支持入口路由器流量工程的分段路由策略。控制器可以指定由多个路径组成的分段路由策略，以引导标记或 IP 流量。分段路由策略会将有序的分段列表添加到数据包的标头，以便进行流量引导。BGP 将分段路由策略的候选路由安装到路由表 bgp.inetcolor.0 或 bgp.inet6color.0 中。BGP 从特定分段路由流量工程策略的候选路由中选择一个路由，并将其安装在新的路由表 inetcolor.0 或 inet6color.0 中。此功能支持入口路由器转发表中静态配置和 BGP 安装的分段路由流量工程策略。 了解分段路由策略 BGP 在从分段路由策略选择路由中的作用 静态配置的分段路由策略 支持和不支持的功能 了解分段路由策略 在分段路由中，控制器允许核心网络中的入口节点通过显式路径引导流量，同时消除中间节点中显式路径的状态。与分段路由策略关联的分段的有序列表将添加到数据包的标头中。这些分段列表或分段标识符 （SID） 列表表示网络中的路径，它们是从各种源获知的多个候选路径中选择的最佳候选路径。段的有序列表被编码为标签堆栈。此功能允许根据网络或客户要求将数据包引导至特定路径。可以将流量标记为 IP 流量，并通过标签交换或基于目标的查找将其引导至这些分段路由流量工程路径。您可以在入口路由器上配置静态策略，以便在与控制器的链路出现故障时引导流量。静态分段路由策略有助于确保在控制器关闭或无法访问时进行流量引导。 BGP 在从分段路由策略选择路由中的作用 当 BGP 从控制器收到分段路由流量工程后续地址族标识符 （SAFI） 的更新时，BGP 会对这些更新执行一些基本检查和验证。不是 MPLS 标签的分段被视为无效。如果更新有效，则 BGP 会在路由表 bgp.inetcolor.0 和 bgp.inet6color.0 中安装分段路由流量工程策略，这些策略随后将安装在路由表 inetcolor.0 或 inet6color.0 中。这些路由表使用 、 endpoint address 和 color 等属性 distinguisher 作为键。 从 Junos OS 20.2R1 版开始，Junos OS 支持基于控制器的 BGP-SRTE 路由作为分段路由流量工程 （SPRING-TE） 路由进行安装。BGP 在路由表 bgp.inetcolor.0 和 bgp.inet6color.0 中安装分段路由流量工程策略，随后由 SPRING-TE 将这些策略安装在路由表 inetcolor.0 或 inet6color.0 中。 策略操作 color: color-mode : color-value 在层次结构级别进行 [edit policy-options community name members] 配置，以便在从 inet-单播和 inet6-单播地址族导出前缀时附加颜色社区。 要为地址族启用 BGP IPv4 分段路由流量工程功能，请在层次结构级别包含该 segment-routing-te 语句 [edit protocols bgp family inet] 。 要启用 BGP，请为地址族提供分段路由流量工程功能，请在层次结构级别包含 segment-routing-te 语句 [edit protocols bgp family inet6] 。 注： 从版本 18.3R1 开始，Junos OS 支持在配置了分段路由流量工程策略的网络中收集入口 IP 和中转 MPLS 流量的流量统计信息。要启用流量统计信息的收集，请在层次结构级别包括 telemetry [edit protocols source-packet-routing] 语句。 静态配置的分段路由策略 可以在入口路由器上配置静态策略，以便在与控制器的链路出现故障时允许流量路由。在 [edit protocols source-packet-routing] 层次结构级别进行配置 sr-preference ，以选择静态配置的分段路由流量工程策略转发条目，而不是 BGP 信号分段路由流量工程转发条目。分段标识符标签堆栈的顶部标签与内部网关协议 （IGP） 顶部标签交换以进行解析。 静态分段路由流量工程策略可以包含多个带或不带加权 ECMP 的路径。如果 IGP 配置配置了加权 ECMP，则转发路径将提供分层加权等价多路径 （ECMP）。但是，如果未配置加权 ECMP，则会对所有分段路由流量工程路径应用相等的平衡。 支持和不支持的功能 Junos OS 通过 BGP 分段路由流量工程支持以下功能： 对于 PTX 系列，具有增强机箱模式的 FPC-PTX-P1-A 支持此功能。 加权 ECMP 和分层加权 ECMP。 分段路由流量工程策略中的路径支持 MPLS 快速重新路由 （FRR）。当可用于分段路由流量工程策略路径时，与顶部标签对应的 IGP 备份路径将安装到路由表中。 以下限制适用于 BGP 分段路由流量工程： 仅主实例支持 BGP 和静态分段路由流量工程策略。 使用静态策略显式配置或通过 BGP 获知的分段路由流量工程路径仅限于仅代表绝对 MPLS 标签的分段标识符列表。 静态分段路由流量工程策略最多支持 128 个分段列表。 路由实例中的对等方不支持 BGP 分段路由流量工程 SAFI。 BGP 分段路由流量工程网络层可达性信息 （NLRI） 不能使用路由信息库 （RIB） 组（RIB 也称为路由表）导入到其他路由表。 通过分段路由策略的流量不支持流量统计信息。 不支持处理生存时间 （TTL） MPLS 标签分段标识符。 不支持不间断活动路由。 服务等级 （CoS） 策略在顶部标签上工作。 仅支持非 VPN CoS 重写 CLI 命令;例如，支持顶部标签的 EXP 重写。 对于入口数据包，最多可以解析 8 个标签，并且在负载平衡哈希计算中使用第 2 层或第 3 层 MPLS 有效负载字段。如果入口数据包中的标签深度超过 8 个标签，则不会解析 MPLS 有效负载，并且不会在负载平衡哈希计算中使用第 2 层和第 3 层 MPLS 有效负载字段。 最大标签堆栈深度支持为 5。您必须进行配置 maximum-labels 以限制分段路由流量工程策略的标签深度。如果未配置，则 maximum-labels 应用有意义的默认值，将最大标签深度限制为 5。 必须在分段路由流量工程 LSP 配置中指定颜色属性。因此，入口路由将下载到 inetcolor{6}.0 表中。 当存在多个具有相同 Endpoint, color 优先级但存在不同绑定分段标识符的静态分段路由流量工程策略时，表中将安装 mpls.0 与较小绑定分段标识符对应的路由。 不支持混合分段标识符：分段路由流量工程分段列表中的分段标识符必须是 IPv4 或 IPv6。 您必须在一个接口上显式配置 MPLS 最大标签，以容纳五个以上的标签;否则，超过五个标签可能会导致丢包"
}