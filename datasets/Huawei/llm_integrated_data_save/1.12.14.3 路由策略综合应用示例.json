{
  "topology": "组网需求图1-187为承载多媒体、信令、计费等多种L3VPN业务的MPLS网络简化图。该图以两个站点为例，每个站点有两台PE接入核心层。核心层可分为两个平面，同一平面的P节点全连接。不同平面的节点相连提供备份路径。使用MP-BGP在PE之间发布内层标签和VPNv4路由信息。每台PE都和RR建立MP-IBGP对等体。",
  "requirement": "通过部署路由策略，可灵活控制复杂网络中的流量。所有的路由器都运行BGP，并将整个自治系统划分为多个区域。其中，PE和RR作为核心节点来转发区域之间的路由。配置完成后，每台路由器都应学到自治系统内的所有网段的路由。",
  "steps": [
    "为位于同一站点的两个PE分配不同的RD，保证每个PE都能从远端站点的不同BGP下一跳收到两条路由。",
    "为平面A的PE发布的路由和平面B的PE发布的路由分配不同的团体属性。",
    "基于不同的团体属性设置不同的本地优先级。使平面A的PE总是选择从平面A的远端PE发布的路由，使平面B的PE总是选择从平面B的远端PE发布的路由。"
  ],
  "configs": {
    "PE1": "#\nsysname PE1\n#\nrouter id 0.7.7.9\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 0.1.16.1 255.255.255.0\n#\nbgp 65000\n peer 10.11.11.9 as-number 65000\n peer 10.11.11.9 connect-interface LoopBack0\n ipv4-family unicast\n  undo peer 10.11.11.9 enable\n ipv4-family vpnv4\n  peer 10.11.11.9 enable\n  peer 10.11.11.9 route-policy comm export\n  peer 10.11.11.9 advertise-community\n  peer 10.11.11.9 route-policy local_pre import\n#\nroute-policy comm permit node 10\n apply community 65000:100\n#\nroute-policy local_pre permit node 10\n if-match community-filter 1\n apply local-preference 200\n#\nip community-filter 1 permit 65000:100\n#\nreturn",
    "PE2": "#\nsysname PE2\n#\nrouter id 0.8.8.9\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 0.1.17.1 255.255.255.0\n#\nbgp 65000\n peer 10.11.11.9 as-number 65000\n peer 10.11.11.9 connect-interface LoopBack0\n ipv4-family unicast\n  undo peer 10.11.11.9 enable\n ipv4-family vpnv4\n  peer 10.11.11.9 enable\n  peer 10.11.11.9 route-policy comm export\n  peer 10.11.11.9 advertise-community\n  peer 10.11.11.9 route-policy local_pre import\n#\nroute-policy comm permit node 10\n apply community 65000:200\n#\nroute-policy local_pre permit node 10\n if-match community-filter 1\n apply local-preference 200\n#\nip community-filter 1 permit 65000:200\n#\nreturn",
    "RR": "#\nsysname RR\n#\nrouter id 0.11.11.9\n#\nbgp 65000\n group client internal\n peer client connect-interface LoopBack0\n ipv4-family unicast\n  undo peer client enable\n ipv4-family vpnv4\n  undo policy vpn-target\n  peer client enable\n  peer 10.7.7.9 group client\n  peer 10.8.8.9 group client\n  peer 10.9.9.9 group client\n  peer 10.10.10.9 group client\n  peer client reflect-client\n  peer client advertise-community\n#\nreturn"
  },
  "related_images": [
    "图1-187 配置 BGP 路由策略综合应用组网图.png"
  ]
}