{
  "topology": "在AS65010内，采用路由反射器(Route Reflector)架构解决IBGP全连接问题，整个网络分为两个集群：\n\n**Cluster1架构：**\n- DeviceB作为路由反射器(RR)，通过interface4连接DeviceA，通过interface1和interface3分别连接客户机DeviceD和DeviceE\n- DeviceD和DeviceE作为RR客户机，分别通过interface1和interface3与DeviceB建立IBGP邻居关系\n- DeviceD通过interface2与DeviceE直连，形成客户机间的备份连接\n\n**Cluster2架构：**\n- DeviceC作为路由反射器，通过interface1连接DeviceA，通过interface2、interface3和interface4分别连接客户机DeviceF、DeviceG和DeviceH\n- DeviceF、DeviceG、DeviceH作为RR客户机，与DeviceC建立IBGP邻居关系\n- DeviceH通过interface2与DeviceG直连，提供客户机间的冗余路径\n\n**集群间连接：**\n- DeviceA作为核心设备，通过interface1和interface2分别与两个集群的RR（DeviceB和DeviceC）建立IBGP非客户机关系\n- DeviceB和DeviceC通过各自的interface2建立IBGP非客户机邻居关系，实现集群间路由交换\n\n**接口分配详情：**\n- DeviceA：interface1↔DeviceB-interface4，interface2↔DeviceC-interface1，interface3连接外部AS\n- DeviceB：interface1↔DeviceD，interface2↔DeviceC，interface3↔DeviceE，interface4↔DeviceA\n- DeviceC：interface1↔DeviceA，interface2↔DeviceF，interface3↔DeviceG，interface4↔DeviceH，interface5↔DeviceB\n- 客户机设备通过指定接口与各自的RR建立连接，部分客户机间存在直连备份链路\n\n此架构有效减少了IBGP邻居数量，避免了全连接拓扑的复杂性和资源开销。",
  "requirement": "在大型网络中，一个AS内存在多台运行BGP协议的路由器，这些路由器之间需要使用BGP相互传递路由。为了简化网络配置并减少路由器的开销，用户希望避免在所有路由器之间建立逻辑全连接（Full-mesh）关系。",
  "steps": [
    "配置客户机与路由反射器之间，非客户机与路由反射器之间建立IBGP连接。",
    "在DeviceB和DeviceC上配置路由反射器功能，指定客户机，并查看路由信息。"
  ],
  "configs": {
    "DeviceA": "#\nsysname DeviceA\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.1.1.2 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.1.3.2 255.255.255.0\n#\ninterface GigabitEthernet3/0/0\n undo shutdown\n ip address 172.16.1.1 255.255.255.0\n#\nbgp 65010\n router-id 1.1.1.1\n peer 10.1.1.1 as-number 65010\n peer 10.1.3.1 as-number 65010\n #\n ipv4-family unicast\n  undo synchronization\n  network 172.16.1.0 255.255.255.0\n  peer 10.1.1.1 enable\n  peer 10.1.3.1 enable\n#\nreturn",
    "DeviceB": "#\nsysname DeviceB\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.1.1.1 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.1.4.1 255.255.255.0\n#\ninterface GigabitEthernet3/0/0\n undo shutdown\n ip address 10.1.5.1 255.255.255.0\n#\ninterface GigabitEthernet1/0/1\n undo shutdown\n ip address 10.1.2.1 255.255.255.0\n#\nbgp 65010\n router-id 2.2.2.2\n peer 10.1.1.2 as-number 65010\n peer 10.1.2.2 as-number 65010\n group in_rr internal\n peer 10.1.4.2 as-number 65010\n peer 10.1.4.2 group in_rr\n peer 10.1.5.2 as-number 65010\n peer 10.1.5.2 group in_rr\n #\n ipv4-family unicast\n  undo synchronization\n  undo reflect between-clients\n  reflector cluster-id 1\n  peer 10.1.1.2 enable\n  peer 10.1.2.2 enable\n  peer in_rr enable\n  peer in_rr reflect-client\n  peer 10.1.4.2 enable\n  peer 10.1.4.2 group in_rr\n  peer 10.1.5.2 enable\n  peer 10.1.5.2 group in_rr\n#\nreturn",
    "DeviceC": "#\nsysname DeviceC\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.1.2.2 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.1.3.1 255.255.255.0\n#\ninterface GigabitEthernet3/0/0\n undo shutdown\n ip address 10.1.7.1 255.255.255.0\n#\ninterface GigabitEthernet1/0/1\n undo shutdown\n ip address 10.1.8.1 255.255.255.0\n#\ninterface GigabitEthernet1/0/2\n undo shutdown\n ip address 10.1.9.1 255.255.255.0\n#\nbgp 65010\n router-id 3.3.3.3\n peer 10.1.2.1 as-number 65010\n peer 10.1.3.2 as-number 65010\n group in_rr internal\n peer 10.1.7.2 as-number 65010\n peer 10.1.7.2 group in_rr\n peer 10.1.8.2 as-number 65010\n peer 10.1.8.2 group in_rr\n peer 10.1.9.2 as-number 65010\n peer 10.1.9.2 group in_rr\n #\n ipv4-family unicast\n  undo synchronization\n  reflector cluster-id 2\n  peer 10.1.2.1 enable\n  peer 10.1.3.2 enable\n  peer in_rr enable\n  peer in_rr reflect-client\n  peer 10.1.7.2 enable\n  peer 10.1.7.2 group in_rr\n  peer 10.1.8.2 enable\n  peer 10.1.8.2 group in_rr\n  peer 10.1.9.2 enable\n  peer 10.1.9.2 group in_rr\n#\nreturn",
    "DeviceD": "#\nsysname DeviceD\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.1.4.2 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.1.6.1 255.255.255.0\n#\nbgp 65010\n router-id 4.4.4.4\n peer 10.1.4.1 as-number 65010\n #\n ipv4-family unicast\n  undo synchronization\n  peer 10.1.4.1 enable\n#\nreturn"
  },
  "related_images": [
    "图1-147 配置BGP 路由反射器组网图.png"
  ],
  "topology_original": "在AS65010内，分为两个Cluster：Cluster1（DeviceB为路由反射器，DeviceD和DeviceE为其客户机）和Cluster2（DeviceC为路由反射器，DeviceF、DeviceG和DeviceH为其客户机）。DeviceA为DeviceB和DeviceC的非客户机，DeviceB和DeviceC互为非客户机。"
}