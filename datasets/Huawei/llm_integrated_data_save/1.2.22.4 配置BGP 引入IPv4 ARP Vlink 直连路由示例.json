{
  "topology": "基于网络拓扑图的详细分析，增强后的网络拓扑描述如下：\n\n**网络拓扑结构：**\n\n本网络包含4台设备：DeviceA、DeviceB、DeviceC、DeviceD，其中DeviceC为核心交换机，其余为边缘设备。\n\n**物理连接关系：**\n- DeviceA通过Interface1(10.1.1.3/24)连接至SwitchA的Interface2\n- DeviceB通过Interface3连接至SwitchA的Interface1  \n- SwitchA通过Interface2连接至DeviceC的Interface1(10.1.1.1/24)\n- DeviceC通过Interface2(10.2.1.1/24)与DeviceD的Interface1(10.2.1.2/24)直连\n\n**VLAN配置：**\n- DeviceC配置VLANIF10接口(10.1.1.1/24)，承载VLAN10流量\n- DeviceC配置VLANIF10接口(10.1.1.1/24)，提供VLAN间路由功能\n\n**协议配置：**\n- DeviceC与DeviceD之间运行BGP协议，位于AS100自治系统内\n- DeviceC作为BGP Speaker，负责路由信息的发布和接收\n\n**IP地址规划：**\n- VLAN10网段：10.1.1.0/24（DeviceA、DeviceC互联）\n- 互联网段：10.2.1.0/24（DeviceC、DeviceD互联）\n- DeviceB使用10.1.1.4/24地址接入VLAN10\n\n**特殊需求实现：**\n- DeviceC通过BGP发布IPv4 ARP Vlink直连路由至外部网络\n- 配置路由策略过滤网段路由和到DeviceA的特定路由\n- DeviceD与DeviceB实现互访，同时隔离与DeviceA的通信\n- 针对不同VLAN用户实施差异化流量控制策略",
  "requirement": "VLAN外部用户需要知道VLAN内的IPv4 ARP Vlink直连路由，并且针对不同的VLAN用户采取不同的流量控制策略。在DeviceC上配置发布IPv4 ARP Vlink直连路由，并且利用路由策略过滤掉网段路由和到DeviceA的路由。",
  "steps": [
    "在SwitchA和DeviceC上创建VLANIF，并且配置IP地址，保证DeviceA、DeviceB、SwitchA和DeviceC之间的互通。",
    "在DeviceC和DeviceD之间配置BGP协议，保证DeviceC和DeviceD之间可以相互传递路由。",
    "在DeviceC上配置发布IPv4 ARP Vlink直连路由，使IPv4 ARP Vlink直连路由可发布。",
    "在DeviceC上配置路由策略，只允许来源于DeviceB的路由通过。",
    "在DeviceC上配置BGP引入直连路由，并且应用路由策略只引入来源于DeviceB的路由。",
    "在DeviceC上配置BGP使用路由出口过滤策略，过滤掉VLAN所在网段路由，使DeviceD无法看到网段路由，只能使用ARP Vlink直连路由与VLAN内的用户通信。"
  ],
  "configs": {
    "DeviceA": "#\nsysname DeviceA\n#\ninterface GigabitEthernet 1/0/0\n undo shutdown\n ip address 10.1.1.3 255.255.255.0\n#\ncommit",
    "DeviceB": "#\nsysname DeviceB\n#\ninterface GigabitEthernet 1/0/0\n undo shutdown\n ip address 10.1.1.4 255.255.255.0\n#\ncommit",
    "DeviceC": "#\nsysname DeviceC\n#\ninterface GigabitEthernet 2/0/0\n undo shutdown\n ip address 10.2.1.1 255.255.255.0\n#\nvlan 10\n#\ninterface GigabitEthernet 1/0/0\n portswitch\n undo shutdown\n port link-type access\n port default vlan 10\n#\ninterface Vlanif 10\n ip address 10.1.1.1 255.255.255.0\n#\nbgp 100\n router-id 3.3.3.3\n peer 10.2.1.2 as-number 100\n import-route direct\n#\nip ip-prefix prefix1 permit 10.1.1.4 32\nroute-policy policy1 permit node 10\n if-match ip-prefix prefix1\n#\narp vlink-direct-route advertise route-policy policy1\n#\nip ip-prefix prefix2 index 10 deny 10.1.1.0 24\nip ip-prefix prefix2 index 20 permit 0.0.0.0 0 less-equal 32\nroute-policy policy2 permit node 10\n if-match ip-prefix prefix2\n#\nbgp 100\n peer 10.2.1.2 route-policy policy2 export\n#\ncommit",
    "DeviceD": "#\nsysname DeviceD\n#\ninterface GigabitEthernet 1/0/0\n undo shutdown\n ip address 10.2.1.2 255.255.255.0\n#\nbgp 100\n router-id 4.4.4.4\n peer 10.2.1.1 as-number 100\n#\ncommit",
    "SwitchA": "#\nsysname SwitchA\n#\nvlan batch 10\n#\ninterface GigabitEthernet1/0/0\n portswitch\n undo shutdown\n port link-type access\n port default vlan 10\n#\ninterface GigabitEthernet2/0/0\n portswitch\n undo shutdown\n port link-type access\n port default vlan 10\n#\ninterface GigabitEthernet3/0/0\n portswitch\n undo shutdown\n port link-type access\n port default vlan 10\n#\ninterface Vlanif 10\n ip address 10.1.1.2 255.255.255.0\n#\ncommit"
  },
  "related_images": [
    "图1-16 配置BGP引入IPv4 ARP Vlink直连路由组网图.png"
  ],
  "topology_original": "DeviceC通过VLANIF接口连接了两个用户，DeviceD只需要与DeviceB互访，而与DeviceA没有互访需求。"
}