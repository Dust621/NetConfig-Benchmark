{
  "topology": "基于网络拓扑图分析，增强后的网络拓扑描述如下：\n\n**物理拓扑结构：**\n- 四台路由器设备：DeviceA、DeviceB、DeviceC、DeviceD\n- DeviceA通过interface1(10.12.1.1/24)连接DeviceB的interface1(10.12.1.2/24)\n- DeviceB通过interface2(10.23.1.2/24)连接DeviceC的interface2(10.23.1.3/24)  \n- DeviceB通过interface3(10.24.1.2/24)连接DeviceD的interface1(10.24.1.4/24)\n- DeviceC通过interface1(10.34.1.3/24)连接DeviceD的interface2(10.34.1.4/24)\n\n**协议配置：**\n- 所有设备属于AS 100自治系统\n- DeviceA、DeviceB、DeviceC、DeviceD之间建立IBGP邻居关系\n- DeviceC和DeviceD运行OSPF协议，形成OSPF区域\n- DeviceC配置OSPF路由引入BGP功能\n- DeviceD配置BGP路由引入OSPF功能，实现路由重分发\n\n**网络分段：**\n- 10.12.1.0/24网段：DeviceA-DeviceB直连链路\n- 10.23.1.0/24网段：DeviceB-DeviceC直连链路\n- 10.24.1.0/24网段：DeviceB-DeviceD直连链路  \n- 10.34.1.0/24网段：DeviceC-DeviceD直连链路\n\n**特殊配置：**\n- OSPF与BGP双向路由重分发配置\n- 需要在OSPF引入路由时配置环路检测功能防止路由环路",
  "requirement": "在现网应用中，OSPF路由可以通过路由引入的方式在BGP进程进行重发布。此类场景通常通过多台设备协同配置路由策略防环。如果引入路由的设备路由策略配置不当，可能导致路由环路。为了避免该问题，可以在OSPF引入路由时，配置环路检测功能。",
  "steps": [
    "配置各设备接口的IP地址。",
    "在设备上使能OSPF和BGP，配置OSPF和BGP基本功能。",
    "配置路由引入，构造环路。",
    "验证是否存在路由环路。",
    "使能路由环路检测功能，验证环路是否解除。"
  ],
  "configs": {
    "DeviceA": "#\nsysname DeviceA\n#\ninterface GigabitEthernet1/0/0\n ip address 10.12.1.1 255.255.255.0\n quit\n#\nip route-static 10.0.0.0 255.255.255.255 NULL0\n#\nbgp 100\n router-id 1.1.1.1\n peer 10.12.1.2 as-number 100\n ipv4-family unicast\n  peer 10.12.1.2 enable\n quit\n#\nroute loop-detect ospf enable\nroute loop-detect bgp enable\n#\ncommit",
    "DeviceB": "#\nsysname DeviceB\n#\nbgp 100\n router-id 2.2.2.2\n peer 10.12.1.1 as-number 100\n peer 10.23.1.3 as-number 100\n peer 10.24.1.4 as-number 100\n ipv4-family unicast\n  peer 10.12.1.1 enable\n  peer 10.23.1.3 enable\n  peer 10.24.1.4 enable\n  peer 10.23.1.3 reflect-client\n quit\n#\ncommit",
    "DeviceC": "#\nsysname DeviceC\n#\nbgp 100\n router-id 3.3.3.3\n peer 10.23.1.2 as-number 100\n ipv4-family unicast\n  peer 10.23.1.2 enable\n quit\n#\nospf 1 router-id 3.3.3.3\n area 0.0.0.0\n  network 10.34.1.0 0.0.0.255\n quit\n import-route bgp permit-ibgp\n quit\n#\ncommit",
    "DeviceD": "#\nsysname DeviceD\n#\nbgp 100\n router-id 4.4.4.4\n peer 10.24.1.2 as-number 100\n ipv4-family unicast\n  peer 10.24.1.2 enable\n import-route ospf\n quit\n#\ncommit"
  },
  "related_images": [
    "图1-53 OSPF 引入BGP 路由环路检测.png"
  ],
  "topology_original": "DeviceA、DeviceB、DeviceC及DeviceD配置IBGP邻居。DeviceC和DeviceD配置OSPF进程。DeviceC配置OSPF引入BGP。DeviceD配置BGP引入OSPF。"
}