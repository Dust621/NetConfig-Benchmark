{
  "topology": "基于网络拓扑图的详细分析，增强后的网络拓扑描述如下：\n\n**物理拓扑结构：**\n- CE1、PE1、P、PE2、CE2五台路由器构成线性拓扑\n- RT0作为中心路由器与PE1、PE2形成三角形结构\n\n**设备连接关系：**\n- CE1通过interface1(172.16.1.2/24)连接PE1的interface2(172.16.1.1/24)\n- PE1通过interface1(10.10.1.2/24)连接P的interface2(10.10.1.1/24)  \n- P通过interface1(10.20.1.1/24)连接PE2的interface2(10.20.1.2/24)\n- PE2通过interface1(172.16.2.1/24)连接CE2的interface2(172.16.2.2/24)\n- RT0通过interface1(10.1.1.2/24)连接PE1的interface2，通过interface2(10.2.1.2/24)连接PE2的interface1\n\n**环回接口配置：**\n- CE1: Loopback1(1.1.1.9/32)\n- PE1: Loopback1(2.2.2.9/32)\n- P: Loopback1(3.3.3.9/32)\n- PE2: Loopback1(8.8.8.8/32)\n- RT0: Loopback10(5.5.5.5/32), Loopback10(6.6.6.6/32)\n\n**协议配置：**\n- CE-PE链路运行OSPF协议\n- PE-P-PE骨干网段配置MPLS\n- RT0与PE设备间建立Intra-area OSPF链路\n- PE1-PE2间通过Sham link实现VPN路由优化\n\n**VPN配置：**\n- CE1和CE2同属VPN1\n- 通过MPLS L3VPN技术实现CE间互通\n- Sham link确保VPN流量通过MPLS骨干网转发而非OSPF区域内路由",
  "requirement": "CE与PE之间运行OSPF，CE1与CE2之间的VPN流量通过MPLS骨干网转发，不使用OSPF的区域内路由。",
  "steps": [
    "建立MP-IBGP对等体关系：PE之间建立MP-IBGP对等体关系，PE与CE运行OSPF协议来建立连接。",
    "创建VPN实例：在PE上创建VPN实例，并绑定与CE相连的接口。",
    "创建OSPF伪连接：在PE上创建OSPF伪连接。",
    "调整接口cost值：调整用户网络转发接口的cost值，使其比sham link的cost值大。"
  ],
  "configs": {
    "PE1": "#\nsysname PE1\n#\nip vpn-instance vpn1\n ipv4-family\n  route-distinguisher 100:1\n  apply-label per-instance\n  vpn-target 1:1 export-extcommunity\n  vpn-target 1:1 import-extcommunity\n#\nmpls lsr-id 1.1.1.9\n#\nmpls\n#\nmpls ldp\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip binding vpn-instance vpn1\n ip address 172.16.1.2 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.10.1.1 255.255.255.0\n mpls\n mpls ldp\n#\ninterface LoopBack1\n ip address 1.1.1.9 255.255.255.255\n#\ninterface LoopBack10\n ip binding vpn-instance vpn1\n ip address 5.5.5.5 255.255.255.255\n#\nbgp 100\n peer 3.3.3.9 as-number 100\n peer 3.3.3.9 connect-interface LoopBack1\n #\n ipv4-family unicast\n  undo synchronization\n  peer 3.3.3.9 enable\n #\n ipv4-family vpnv4\n  policy vpn-target\n  peer 3.3.3.9 enable\n #\n ipv4-family vpn-instance vpn1\n  import-route direct\n  import-route ospf 100\n#\nospf 1\n area 0.0.0.0\n  network 1.1.1.9 0.0.0.0\n  network 10.10.1.0 0.0.0.255\n#\nospf 100 router-id 11.11.11.11 vpn-instance vpn1\n import-route bgp\n domain-id 0.0.0.0\n area 0.0.0.0\n  network 172.16.1.0 0.0.0.255\n  sham-link 5.5.5.5 6.6.6.6 cost 1\n#\nreturn",
    "P": "#\nsysname P\n#\nmpls lsr-id 2.2.2.9\n#\nmpls\n#\nmpls ldp\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.10.1.2 255.255.255.0\n mpls\n mpls ldp\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.20.1.1 255.255.255.0\n mpls\n mpls ldp\n#\ninterface LoopBack1\n ip address 2.2.2.9 255.255.255.255\n#\nospf 1\n area 0.0.0.0\n  network 2.2.2.9 0.0.0.0\n  network 10.10.1.0 0.0.0.255\n  network 10.20.1.0 0.0.0.255\n#\nreturn",
    "PE2": "#\nsysname PE2\n#\nip vpn-instance vpn1\n ipv4-family\n  route-distinguisher 100:1\n  apply-label per-instance\n  vpn-target 1:1 export-extcommunity\n  vpn-target 1:1 import-extcommunity\n#\nmpls lsr-id 3.3.3.9\n#\nmpls\n#\nmpls ldp\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip binding vpn-instance vpn1\n ip address 172.16.2.2 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.20.1.2 255.255.255.0\n mpls\n mpls ldp\n#\ninterface LoopBack1\n ip address 3.3.3.9 255.255.255.255\n#\ninterface LoopBack10\n ip binding vpn-instance vpn1\n ip address 6.6.6.6 255.255.255.255\n#\nbgp 100\n peer 1.1.1.9 as-number 100\n peer 1.1.1.9 connect-interface LoopBack1\n #\n ipv4-family unicast\n  undo synchronization\n  peer 1.1.1.9 enable\n #\n ipv4-family vpnv4\n  policy vpn-target\n  peer 1.1.1.9 enable\n #\n ipv4-family vpn-instance vpn1\n  import-route direct\n  import-route ospf 100\n#\nospf 1\n area 0.0.0.0\n  network 3.3.3.9 0.0.0.0\n  network 10.20.1.0 0.0.0.255\n#\nospf 100 router-id 22.22.22.22 vpn-instance vpn1\n import-route bgp\n domain-id 0.0.0.0\n area 0.0.0.0\n  network 172.16.2.0 0.0.0.255\n  sham-link 6.6.6.6 5.5.5.5 cost 1\n#\nreturn",
    "CE1": "#\nsysname CE1\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 172.16.1.1 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.1.1.1 255.255.255.0\n ospf cost 10\n#\nospf 1\n area 0.0.0.0\n  network 172.16.1.0 0.0.0.255\n  network 10.1.1.0 0.0.0.255\n#\nreturn",
    "CE2": "#\nsysname CE2\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 172.16.2.1 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.2.1.2 255.255.255.0\n ospf cost 10\n#\ninterface LoopBack1\n ip address 8.8.8.8 255.255.255.255\n ospf enable 1 area 0.0.0.0\n#\nospf 1\n area 0.0.0.0\n  network 10.2.1.0 0.0.0.255\n  network 172.16.2.0 0.0.0.255\n#\nreturn",
    "RT0": "#\nsysname RT0\n#\ninterface GigabitEthernet1/0/0\n undo shutdown\n ip address 10.1.1.2 255.255.255.0\n#\ninterface GigabitEthernet2/0/0\n undo shutdown\n ip address 10.2.1.1 255.255.255.0\n#\nospf 1\n area 0.0.0.0\n  network 10.1.1.0 0.0.0.255\n  network 10.2.1.0 0.0.0.255\n#\nreturn"
  },
  "related_images": [
    "图1-56 OSPF 伪连接配置组网图.png"
  ],
  "topology_original": "CE1和CE2在同一个OSPF区域中，都属于VPN1，分别接入PE1和PE2。CE1和CE2是客户边缘设备，PE1和PE2是提供商边缘设备，P是骨干网设备。所有链路的cost值都是1。"
}