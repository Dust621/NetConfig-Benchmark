{
  "topology": "网络拓扑描述：\n\n**AS100（左侧自治系统）：**\n- DeviceA：interface1(10.1.1.1/24)、interface2(10.1.2.1/24)、interface3(172.16.1.4/24)\n- DeviceB：interface1(172.16.1.5/24)、LoopBack0(1.1.1.1/24)、interface2(10.1.3.1/24)\n\n**AS200（右侧自治系统）：**\n- DeviceC：Interface1(10.1.1.2/24)、interface3(10.1.4.1/24)、interface2(10.1.3.2/24)、LoopBack0(2.2.2.2/24)\n- DeviceD：interface1(10.1.2.2/24)、interface2(10.1.5.2/24)、interface1(10.1.5.1/24)\n- DeviceE：interface3(10.1.4.2/24)、interface1(10.1.4.2/24)、interface2(10.1.5.2/24)\n\n**BGP邻居关系：**\n- EBGP连接：DeviceA-DeviceC(10.1.1.1-10.1.1.2)、DeviceA-DeviceD(10.1.2.1-10.1.2.2)、DeviceB-DeviceC(10.1.3.1-10.1.3.2)\n- IBGP连接：DeviceE-DeviceC(AS200内部)、DeviceE-DeviceD(AS200内部)\n\n**关键路由信息：**\n目的网段172.16.1.0/24位于AS100，DeviceE通过两条路径可达：\n- 路径1：DeviceE→DeviceC→DeviceA/DeviceB\n- 路径2：DeviceE→DeviceD→DeviceA\n\n**负载分担配置：**\nDeviceE配置BGP非等值负载分担，基于从DeviceC和DeviceD学习到的172.16.1.0/24路由携带的链路带宽扩展团体属性值进行流量动态分配，其中DeviceC路由携带聚合后的链路带宽扩展团体属性。",
  "requirement": "在DeviceE上存在两条到达相同目的地址172.16.1.0/24的BGP路由，如果有流量要到达172.16.1.0/24，则既可以通过DeviceC到达，也可以通过DeviceD到达。目的地址为172.16.1.0/24的BGP路由携带链路带宽扩展团体属性，其中DeviceE从DeviceC收到的路由携带的是聚合后的链路带宽扩展团体属性。通过配置BGP非等值负载分担可以根据每条路由的带宽值动态分配流量，减少网络拥塞，充分利用网络资源。",
  "steps": [
    "在DeviceA和DeviceC、DeviceD之间配置EBGP连接。在DeviceB和DeviceC之间配置EBGP连接。在DeviceE和DeviceC、DeviceD之间配置IBGP连接。",
    "在DeviceA与DeviceC、DeviceD配置将扩展团体属性发布给对等体和将BGP路由中携带的带宽扩展团体属性转换成可选过渡属性。在DeviceB与DeviceC配置将扩展团体属性发布给对等体和将BGP路由中携带的带宽扩展团体属性转换成可选过渡属性。",
    "在DeviceA、DeviceB与DeviceC配置允许修改向对等体发布的扩展团体属性。",
    "在DeviceC配置获取DeviceA和DeviceB邻居链路带宽值，并生成扩展团体属性，DeviceC上使能BGP路由基于指定对等体的非等值负载分担的能力。在DeviceD配置获取DeviceA邻居链路带宽值，并生成扩展团体属性，DeviceD上使能BGP路由基于指定对等体的非等值负载分担的能力。",
    "在DeviceC和DeviceD配置将扩展团体属性发布给DeviceE、将BGP路由中携带的链路带宽扩展团体属性转换成可选过渡属性，在DeviceC聚合收到的相同目的地址的多条路由的链路带宽扩展团体属性的功能。",
    "在DeviceC上配置非等值负载分担的功能。在DeviceE上配置非等值负载分担的功能，并设置形成非等值负载分担路由的最大条数。"
  ],
  "configs": {
    "DeviceA": "#\nsysname DeviceA\n#\ninterface GE1/0/0\n undo shutdown\n ip address 10.1.1.1 255.255.255.0\n#\ninterface GE2/0/0\n undo shutdown\n ip address 10.1.2.1 255.255.255.0\n#\ninterface GE3/0/0\n undo shutdown\n ip address 172.16.1.4 255.255.255.0\n#\nbgp router-id 1.0.0.1\n private-4-byte-as enable\n peer 10.1.1.2 as-number 200\n peer 10.1.2.2 as-number 200\n#\n ipv4-family unicast\n undo synchronization\n network 172.16.1.0 255.255.255.0\n ext-community-change enable\n peer 10.1.1.2 enable\n peer 10.1.1.2 advertise link-bandwidth transitive\n peer 10.1.1.2 advertise-ext-community\n peer 10.1.2.2 enable\n peer 10.1.2.2 advertise link-bandwidth transitive\n peer 10.1.2.2 advertise-ext-community\n#\nreturn",
    "DeviceB": "#\nsysname DeviceB\n#\ninterface GE1/0/0\n undo shutdown\n ip address 172.16.1.5 255.255.255.0\n#\ninterface GE2/0/0\n undo shutdown\n ip address 10.1.3.1 255.255.255.0\n#\ninterface LoopBack0\n ip address 1.1.1.1 255.255.255.255\n#\nbgp router-id 2.0.0.2\n private-4-byte-as enable\n peer 2.2.2.2 as-number 200\n peer 2.2.2.2 ebgp-max-hop 255\n peer 2.2.2.2 connect-interface LoopBack0\n#\n ipv4-family unicast\n undo synchronization\n network 172.16.1.0 255.255.255.0\n ext-community-change enable\n peer 2.2.2.2 enable\n peer 2.2.2.2 advertise link-bandwidth transitive\n peer 2.2.2.2 advertise-ext-community\n#\nip route-static 2.2.2.0 255.255.255.0 10.1.3.2\n#\nreturn",
    "DeviceC": "#\nsysname DeviceC\n#\ninterface GE1/0/0\n undo shutdown\n ip address 10.1.1.2 255.255.255.0\n#\ninterface GE2/0/0\n undo shutdown\n ip address 10.1.3.2 255.255.255.0\n#\ninterface GE3/0/0\n undo shutdown\n ip address 10.1.4.1 255.255.255.0\n#\ninterface LoopBack0\n ip address 2.2.2.2 255.255.255.255\n#\nbgp router-id 3.0.0.3\n private-4-byte-as enable\n peer 1.1.1.1 as-number 100\n peer 1.1.1.1 ebgp-max-hop 255\n peer 1.1.1.1 connect-interface LoopBack0\n peer 10.1.1.1 as-number 100\n peer 10.1.4.2 as-number 200\n#\n ipv4-family unicast\n undo synchronization\n load-balancing ucmp\n ext-community-change enable\n peer 1.1.1.1 enable\n peer 1.1.1.1 generate-link-bandwidth all\n peer 1.1.1.1 load-balancing\n peer 10.1.1.1 enable\n peer 10.1.1.1 generate-link-bandwidth\n peer 10.1.1.1 load-balancing\n peer 10.1.4.2 enable\n peer 10.1.4.2 advertise link-bandwidth transitive\n peer 10.1.4.2 aggregate-link-bandwidth\n peer 10.1.4.2 advertise-ext-community\n#\nip route-static 1.1.1.0 255.255.255.0 10.1.3.1\n#\nreturn",
    "DeviceD": "#\nsysname DeviceD\n#\ninterface GE1/0/0\n undo shutdown\n ip address 10.1.2.2 255.255.255.0\n#\ninterface GE2/0/0\n undo shutdown\n ip address 10.1.5.1 255.255.255.0\n#\nbgp router-id 4.0.0.4\n private-4-byte-as enable\n peer 10.1.2.1 as-number 100\n peer 10.1.5.2 as-number 200\n#\n ipv4-family unicast\n undo synchronization\n peer 10.1.2.1 enable\n peer 10.1.2.1 generate-link-bandwidth\n peer 10.1.5.2 enable\n peer 10.1.5.2 advertise link-bandwidth transitive\n peer 10.1.5.2 advertise-ext-community\n#\nreturn",
    "DeviceE": "#\nsysname DeviceE\n#\ninterface GE1/0/0\n undo shutdown\n ip address 10.1.4.2 255.255.255.0\n#\ninterface GE2/0/0\n undo shutdown\n ip address 10.1.5.2 255.255.255.0\n#\nbgp router-id 5.0.0.5\n private-4-byte-as enable\n peer 10.1.4.1 as-number 200\n peer 10.1.5.1 as-number 200\n#\n ipv4-family unicast\n undo synchronization\n maximum load-balancing 2\n load-balancing ucmp\n peer 10.1.4.1 enable\n peer 10.1.5.1 enable\n#\nreturn"
  },
  "related_images": [
    "图1-154 配置BGP 非等值负载分担组网图.png"
  ],
  "topology_original": "组网需求如图1-154所示，所有路由器都配置BGP，DeviceA和DeviceB在AS100中，DeviceC、DeviceD和DeviceE在AS200中。DeviceA与DeviceC、DeviceD之间运行EBGP，DeviceB与DeviceC之间运行EBGP，DeviceE与DeviceC、DeviceD之间运行IBGP。"
}