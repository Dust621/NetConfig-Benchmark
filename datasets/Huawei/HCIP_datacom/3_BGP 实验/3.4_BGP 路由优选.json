{
  "topology": "设备互联方式、互联接口地址如图所示，所有设备均创建Loopback0 接口，IP 地址为10.0.x.x/32，其中x 为设备编号，所有设备都使用Loopback0 地址作为BGP Router ID。R1 在AS100，R5 在AS200，R2、R3、R4 在AS64512。AS64512 内运行OSPF，在互联接口（不包括连接外部AS 的接口）、Loopback0 接口上激活OSPF。EBGP 对等体关系基于直连接口建立，IBGP 对等体关系基于Loopback0 接口建立。R1、R5 上存在相同的网段172.16.1.0/24、172.16.2.0/24、172.16.3.0/24、172.16.4.0/24，在R1、R5 上将其发布到BGP，以用于BGP 路由优选。",
  "requirement": "你是公司的网络管理员。公司的网络采用了BGP 协议接入了两个服务运营商。公司自己采用了私有的AS 号64512，ISP1 的AS 号为100，ISP2 的AS 号为200。通过AS100、AS200 都可以到达相同的网络，你通过改变BGP 的各种属性达到了调整路由走向的目的。",
  "steps": [
    "设备IP 地址配置。",
    "配置AS64512 内的OSPF，在互联接口（不包含连接外部AS 的接口）、Loopback0 接口上激活OSPF。",
    "按照规划配置BGP 对等体，在R1、R5 上将路由发布到BGP 中。",
    "在R1 上通过路由策略修改BGP 路由172.16.1.0/24 的 AS_Path 属性值，使得R3 优选R5发布的BGP 路由172.16.1.0/24。",
    "在R4 上通过路由策略修改BGP 路由172.16.2.0/24 的Local_Preference 属性值，使得R3优选R4 通告的BGP 路由172.16.2.0/24。",
    "在R2 上通过路由策略修改BGP 路由172.16.3.0/24 的MED 属性值，使得R3 优选R5 发布的BGP 路由172.16.3.0/24。",
    "在R3 上通过路由策略修改BGP 路由172.16.4.0/24 的preferred-value 属性值，使得R3 优选R4 通告的BGP 路由172.16.4.0/24。"
  ],
  "configs": {
    "R1": "# \nsysname R1 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.12.1 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.1.1 255.255.255.255 \n# \ninterface LoopBack1 \n ip address 172.16.1.1 255.255.255.0 \n# \ninterface LoopBack2 \n ip address 172.16.2.1 255.255.255.0 \n# \ninterface LoopBack3 \n ip address 172.16.3.1 255.255.255.0 \n# \ninterface LoopBack4 \n ip address 172.16.4.1 255.255.255.0 \n# \ninterface LoopBack5 \n ip address 172.16.5.1 255.255.255.0 \n# \ninterface LoopBack6 \n ip address 172.16.6.1 255.255.255.0 \n# \nbgp 100 \n router-id 10.0.1.1 \n peer 10.0.12.2 as-number 64512 \n # \n ipv4-family unicast \n  undo synchronization \n  network 172.16.1.0 255.255.255.0 \n  network 172.16.2.0 255.255.255.0 \n  network 172.16.3.0 255.255.255.0 \n  network 172.16.4.0 255.255.255.0 \n  network 172.16.6.0 255.255.255.0 \n  import-route direct route-policy origin \n  peer 10.0.12.2 enable \n  peer 10.0.12.2 route-policy hcip export \n# \nroute-policy hcip permit node 10 \n if-match ip-prefix 1 \n apply as-path 300 400 additive \n# \nroute-policy hcip permit node 20 \n# \nroute-policy origin permit node 10 \n if-match ip-prefix 2 \n# \nip ip-prefix 1 index 10 permit 172.16.1.0 24 greater-equal 24 less-equal 24 \nip ip-prefix 2 index 10 permit 172.16.5.0 24 greater-equal 24 less-equal 24 \n# \nReturn",
    "R2": "# \nsysname R2 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.23.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.12.2 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.2.2 255.255.255.255 \n# \ninterface LoopBack1 \n ip address 10.2.2.2 255.255.255.255 \n# \ninterface LoopBack7 \n ip address 172.16.7.1 255.255.255.0 \n# \nbgp 64512 \n router-id 10.0.2.2 \n peer 10.0.3.3 as-number 64512 \n peer 10.0.3.3 connect-interface LoopBack0 \n peer 10.0.4.4 as-number 64512 \n peer 10.0.4.4 connect-interface LoopBack0 \n peer 10.0.12.1 as-number 100 \n # \n ipv4-family unicast \n  undo synchronization \n  network 10.2.2.2 255.255.255.255 \n  network 172.16.7.0 255.255.255.0 \n  peer 10.0.3.3 enable \n  peer 10.0.3.3 next-hop-local \n  peer 10.0.4.4 enable \n  peer 10.0.12.1 enable \n  peer 10.0.12.1 route-policy hcip import \n# \nospf 1 router-id 10.0.2.2 \n area 0.0.0.0 \n  network 10.0.2.2 0.0.0.0 \n  network 10.0.23.2 0.0.0.0 \n  network 10.2.2.2 0.0.0.0 \n# \nroute-policy hcip permit node 10 \n if-match ip-prefix 1 \n apply cost 200 \n# \nroute-policy hcip permit node 20 \n# \nip ip-prefix 1 index 10 permit 172.16.3.0 24 greater-equal 24 less-equal 24 \n# \nip route-static 10.0.1.1 255.255.255.255 10.0.12.1 \n# \nreturn",
    "R3": "# \nsysname R3 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.34.3 255.255.255.0 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.23.3 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.3.3 255.255.255.255 \n# \ninterface LoopBack6 \n ip address 172.16.6.1 255.255.255.0 \n# \ninterface LoopBack7 \n ip address 172.16.7.1 255.255.255.0 \n# \nbgp 64512 \n router-id 10.0.3.3 \n peer 10.0.2.2 as-number 64512 \n peer 10.0.2.2 connect-interface LoopBack0 \n peer 10.0.4.4 as-number 64512 \n peer 10.0.4.4 connect-interface LoopBack0 \n # \n ipv4-family unicast \n  undo synchronization \n  compare-different-as-med \n  network 10.2.2.2 255.255.255.255 \n  network 172.16.6.0 255.255.255.0 \n  network 172.16.7.0 255.255.255.0 \n  peer 10.0.2.2 enable \n  peer 10.0.2.2 route-policy as_path export \n  peer 10.0.4.4 enable \n  peer 10.0.4.4 route-policy hcip import \n# \nospf 1 router-id 10.0.3.3 \n area 0.0.0.0 \n  network 10.0.3.3 0.0.0.0 \n  network 10.0.23.3 0.0.0.0 \n  network 10.0.34.3 0.0.0.0 \n# \nroute-policy hcip permit node 10 \n if-match ip-prefix 1 \n apply preferred-value 300 \n# \nroute-policy hcip permit node 20 \n# \nroute-policy as_path permit node 10 \n if-match ip-prefix 2 \n apply as-path 300 additive \n# \nroute-policy as_path permit node 20 \n# \nip ip-prefix 1 index 10 permit 172.16.4.0 24 greater-equal 24 less-equal 24 \nip ip-prefix 2 index 10 permit 172.16.6.0 24 greater-equal 24 less-equal 24 \n# \nreturn",
    "R4": "# \nsysname R4 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.45.4 255.255.255.0 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.34.4 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.4.4 255.255.255.255 \n# \nbgp 64512 \n router-id 10.0.4.4 \n peer 10.0.2.2 as-number 64512 \n peer 10.0.2.2 connect-interface LoopBack0 \n peer 10.0.3.3 as-number 64512 \n peer 10.0.3.3 connect-interface LoopBack0 \n peer 10.0.45.5 as-number 200 \n # \n ipv4-family unicast \n  undo synchronization \n  peer 10.0.2.2 enable \n  peer 10.0.3.3 enable \n  peer 10.0.3.3 route-policy hcip export \n  peer 10.0.3.3 next-hop-local \n  peer 10.0.45.5 enable \n# \nospf 1 router-id 10.0.4.4 \n area 0.0.0.0 \n  network 10.0.4.4 0.0.0.0 \n  network 10.0.34.4 0.0.0.0 \n# \nroute-policy hcip permit node 10 \n if-match ip-prefix 1 \n apply local-preference 200 \n# \nroute-policy hcip permit node 20 \n# \nip ip-prefix 1 index 10 permit 172.16.2.0 24 greater-equal 24 less-equal 24 \n# \nip route-static 10.0.5.5 255.255.255.255 10.0.45.5 \n# \nreturn",
    "R5": "# \nsysname R5 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.45.5 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.5.5 255.255.255.255 \n# \ninterface LoopBack1 \n ip address 172.16.1.1 255.255.255.0 \n# \ninterface LoopBack2 \n ip address 172.16.2.1 255.255.255.0 \n# \ninterface LoopBack3 \n ip address 172.16.3.1 255.255.255.0 \n# \ninterface LoopBack4 \n ip address 172.16.4.1 255.255.255.0 \n# \ninterface LoopBack5 \n ip address 172.16.5.1 255.255.255.0 \n# \nbgp 200 \n router-id 10.0.5.5 \n peer 10.0.45.4 as-number 64512 \n # \n ipv4-family unicast \n  undo synchronization \n  network 172.16.1.0 255.255.255.0 \n  network 172.16.2.0 255.255.255.0 \n  network 172.16.3.0 255.255.255.0 \n  network 172.16.4.0 255.255.255.0 \n  network 172.16.5.0 255.255.255.0 \n  peer 10.0.45.4 enable \n# \nip route-static 10.0.4.4 255.255.255.255 10.0.45.4 \n# \nreturn"
  }
}