{
  "topology": "R1、R2、R3、R4 均属于 AS64511，各路由器之间的连接和接口地址如下：\n- R1 的 GE0/0/2 接口与 R2 的 GE0/0/3 接口相连，IP 地址分别为 10.0.12.1/24 和 10.0.12.2/24。\n- R2 的 GE0/0/2 接口与 R3 的 GE0/0/3 接口相连，IP 地址分别为 10.0.23.2/24 和 10.0.23.3/24。\n- R3 的 GE0/0/2 接口与 R4 的 GE0/0/3 接口相连，IP 地址分别为 10.0.34.3/24 和 10.0.34.4/24。\n- R4 的 GE0/0/1 接口与 R2 的 GE0/0/1 接口相连，IP 地址分别为 10.0.24.4/24 和 10.0.24.2/24。\n- 所有设备均配置了 Loopback0 接口作为 BGP Router ID，IP 地址分别为：\n  - R1：10.0.1.1/32\n  - R2：10.0.2.2/32\n  - R3：10.0.3.3/32\n  - R4：10.0.4.4/32\n- 另外，R1 和 R2 配置了 Loopback1 接口：\n  - R1：10.1.1.1/24（模拟用户网段）\n  - R2：10.2.2.2/24（模拟用户网段）。所有设备都使用Loopback0 地址作为BGP Router ID，R1 与R2、R2 与R3、R3 与R4、R4 与R2 之间基于直连接口建立IBGP 对等体关系，其中R1 为R2 的路由反射器客户端，R2 为R3的路由反射器客户端，R3 为R4 的路由反射器客户端。",
  "requirement": "某公司的总部网络采用了BGP 协议作为路由协议，总部的4 台路由器之间建立IBGP 对等体关系（非全互联），为了让4 台路由器学习到完整的BGP 路由，现需要在网络中部署BGP 路由反射器。",
  "steps": [
    "设备基础IP 地址配置。",
    "配置AS 内的OSPF，在互联接口、Loopback0 接口上激活OSPF。",
    "配置AS 内基于直连接口建立IBGP 对等体关系。",
    "配置路由反射器，将R1 配置为R2 的客户端、R2 配置为R3 的客户端、R3 配置为R4 的客户端。",
    "在R2 上将Loopback1 接口路由发布进BGP，观察Originator_ID 属性如何实现路由防环。",
    "在R1 上将Loopback1 接口路由发布进BGP，观察Cluster_List 属性如何实现路由防环。"
  ],
  "configs": {
    "R1": "# \nsysname R1 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.12.1 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.1.1 255.255.255.255 \n# \ninterface LoopBack1 \n ip address 10.1.1.1 255.255.255.0 \n# \nbgp 64511 \n router-id 10.0.1.1 \n peer 10.0.12.2 as-number 64511 \n # \n ipv4-family unicast \n  undo synchronization \n  summary automatic \n  network 10.1.1.0 255.255.255.0 \n  peer 10.0.12.2 enable \n# \nospf 1 router-id 10.0.1.1 \n area 0.0.0.0 \n  network 10.0.1.1 0.0.0.0 \n  network 10.0.12.1 0.0.0.0 \n# \n# \nreturn",
    "R2": "# \nsysname R2 \n# \nacl number 2000 \n rule 5 permit \n# \ninterface GigabitEthernet0/0/1 \n ip address 10.0.24.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.23.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.12.2 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.2.2 255.255.255.255 \n# \ninterface LoopBack1 \n ip address 10.2.2.2 255.255.255.0 \n# \nbgp 64511 \n router-id 10.0.2.2 \n peer 10.0.12.1 as-number 64511 \n peer 10.0.23.3 as-number 64511 \n peer 10.0.24.4 as-number 64511 \n # \n ipv4-family unicast \n  undo synchronization \n  peer 10.0.12.1 enable \n  peer 10.0.12.1 reflect-client \n  peer 10.0.23.3 enable \n  peer 10.0.24.4 enable \n  peer 10.0.24.4 route-policy bgp export \n# \nospf 1 router-id 10.0.2.2 \n area 0.0.0.0 \n  network 10.0.2.2 0.0.0.0 \n  network 10.0.12.2 0.0.0.0 \n  network 10.0.23.2 0.0.0.0 \n  network 10.0.24.2 0.0.0.0 \n# \nroute-policy bgp deny node 10 \n if-match acl 2000 \n# \nreturn",
    "R3": "# \nsysname R3 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.34.3 255.255.255.0 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.23.3 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.3.3 255.255.255.255 \n# \nbgp 64511 \n router-id 10.0.3.3 \n peer 10.0.23.2 as-number 64511 \n peer 10.0.34.4 as-number 64511 \n # \n ipv4-family unicast \n  undo synchronization \n  peer 10.0.23.2 enable \n  peer 10.0.23.2 reflect-client \n  peer 10.0.34.4 enable \n# \nospf 1 router-id 10.0.3.3 \n area 0.0.0.0 \n  network 10.0.3.3 0.0.0.0 \n  network 10.0.23.3 0.0.0.0 \n  network 10.0.34.3 0.0.0.0 \n# \nreturn",
    "R4": "# \nsysname R4 \n# \ninterface GigabitEthernet0/0/1 \n ip address 10.0.24.4 255.255.255.0 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.34.4 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.4.4 255.255.255.255 \n# \nbgp 64511 \n router-id 10.0.4.4 \n peer 10.0.24.2 as-number 64511 \n peer 10.0.34.3 as-number 64511 \n # \n ipv4-family unicast \n  undo synchronization \n  peer 10.0.24.2 enable \n  peer 10.0.34.3 enable \n  peer 10.0.34.3 reflect-client \n# \nospf 1 router-id 10.0.4.4 \n area 0.0.0.0 \n  network 10.0.4.4 0.0.0.0 \n  network 10.0.24.4 0.0.0.0 \n  network 10.0.34.4 0.0.0.0 \n# \nreturn"
  }
}