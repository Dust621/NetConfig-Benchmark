{
  "topology": "## 网络拓扑架构分析\n\n### 1. 物理拓扑连接架构\n\n**设备清单**: 6台路由器(AR1-AR6)，部署华为AR系列路由器平台\n\n**物理连接矩阵**:\n```\nAS1边界区域:\n- AR1 GE0/0/0 ↔ AR2 GE0/0/0 (12.1.1.0/24网段)\n- AR1 GE0/0/1 ↔ AR3 GE0/0/0 (13.1.1.0/24网段)\n\nAS2核心骨干网:\n- AR2 GE0/0/2 ↔ AR3 GE0/0/2 (23.1.1.0/24网段)\n- AR2 GE0/0/1 ↔ AR4 GE0/0/0 (24.1.1.0/24网段)\n- AR3 GE0/0/1 ↔ AR5 GE0/0/0 (35.1.1.0/24网段)\n- AR4 GE0/0/1 ↔ AR5 GE0/0/1 (45.1.1.0/24网段)\n- AR4 GE0/0/2 ↔ AR6 GE0/0/0 (46.1.1.0/24网段)\n- AR5 GE0/0/2 ↔ AR6 GE0/0/1 (56.1.1.0/24网段)\n```\n\n### 2. 逻辑网络分层架构\n\n**自治系统划分**:\n- **AS1**: 边界接入域，包含AR1单台设备\n- **AS2**: 核心传输域，包含AR2/AR3/AR4/AR5/AR6五台设备\n\n**OSPF域架构**:\n- AS2全网部署单区域OSPF(Area 0)\n- 宣告范围：所有物理接口网段 + 设备环回接口\n- DR/BDR选举：基于接口优先级和Router-ID自动选举\n\n### 3. BGP路由架构设计\n\n**EBGP对等体配置**:\n```\n跨AS连接:\n- AR1(AS1) ↔ AR2(AS2): 通过12.1.1.0/24网段建立邻居\n- AR1(AS1) ↔ AR3(AS2): 通过13.1.1.0/24网段建立邻居\n```\n\n**IBGP全网状架构**:\n```\nAS2内部BGP邻居关系(基于Loopback接口):\n- AR2(2.2.2.2) ↔ AR3/AR4/AR5/AR6\n- AR3(3.3.3.3) ↔ AR2/AR4/AR5/AR6\n- AR4(4.4.4.4) ↔ AR2/AR3/AR5/AR6\n- AR5(5.5.5.5) ↔ AR2/AR3/AR4/AR6\n- AR6(6.6.6.6) ↔ AR2/AR3/AR4/AR5\n```\n\n**路由反射器层次架构**:\n- **RR服务器**: AR5(5.5.5.5)\n- **RR客户端**: AR3/AR4/AR6\n- **非RR成员**: AR2(与RR服务器建立常规IBGP邻居)\n\n### 4. 地址规划方案\n\n**环回地址分配**(/24掩码):\n```\nAS1: AR1(1.1.1.1/24, 1.1.2.1/24)\nAS2: AR2(2.2.2.2/24), AR3(3.3.3.3/24), AR4(4.4.4.4/24)\n     AR5(5.5.5.5/24), AR6(6.6.6.6/24)\n```\n\n**P2P链路地址**(/24掩码):\n- 采用连续地址空间，便于路由汇总和管理\n- 每个网段预留充足地址空间用于后续扩展\n\n### 5. 路由策略与流量工程\n\n**BGP路由发布策略**:\n```\nAS1发布路由:\n- Network: 1.1.1.0/24 (精确匹配)\n- Network: 1.1.2.0/24 (精确匹配)\n\nAS2发布路由:\n- 各设备发布自身环回网段至BGP表\n- 禁用自动汇总，确保路由精确性\n```\n\n**负载均衡与冗余设计**:\n```\n多路径场景:\n1. AR1到AS2访问路径:\n   - 主路径: AR1→AR2(via 12.1.1.0/24)\n   - 备份路径: AR1→AR3(via 13.1.1.0/24)\n\n2. AS2到AR1环回路径:\n   - AR4首选: AR4→AR2→AR1, 备份: AR4→AR5→AR3→AR1\n   - AR5首选: AR5→AR3→AR1, 备份: AR5→AR4→AR2→AR1  \n   - AR6首选: AR6→AR4→AR2→AR1, 备份: AR6→AR5→AR3→AR1\n```\n\n### 6. 协议特性与约束条件\n\n**OSPF配置要求**:\n- 单区域部署，简化LSA扩散和SPF计算\n- Router-ID基于环回接口自动生成\n- 接口代价采用默认值，基于带宽自动计算\n\n**BGP配置限制**:\n- 严格禁止路由汇总配置\n- 要求实现等价多路径负载分担\n- 必须保证路径冗余性和快速收敛\n\n**流量工程目标**:\n- R1到AS2: 实现最优路径选择与备份保障\n- R4/R5/R6到R1双环回: 实现负载分担与故障转移",
  "requirement": "根据拓扑，该实验不得使用汇总配置；R1到AS2全部最佳选路，且存在备份路径；R4/5/6到R1的两个环回实现负载分担，且存在备份。",
  "steps": [
    "1. 配置IP地址",
    "2. 配置OSPF路由协议",
    "3. 配置BGP路由协议"
  ],
  "configs": {
    "R1": "# \nsysname R1 \n# \ninterface LoopBack0 \n ip address 1.1.1.1 255.255.255.0 \n# \ninterface LoopBack1 \n ip address 1.1.2.1 255.255.255.0 \n# \ninterface GigabitEthernet0/0/0 \n ip address 12.1.1.1 255.255.255.0 \n# \ninterface GigabitEthernet0/0/1 \n ip address 13.1.1.1 255.255.255.0 \n# \nospf 1 router-id 1.1.1.1 \n area 0.0.0.0 \n network 1.1.1.1 0.0.0.0 \n network 1.1.2.1 0.0.0.0 \n network 12.1.1.1 0.0.0.0 \n network 13.1.1.1 0.0.0.0 \n# \nbgp 1 \nrouter-id 1.1.1.1 \npeer 12.1.1.2 as-number 2 \npeer 13.1.1.2 as-number 2 \nnetwork 1.1.1.0 24 \nnetwork 1.1.2.0 24 \n# \nreturn",
    "R2": "# \nsysname R2 \n# \ninterface LoopBack0 \n ip address 2.2.2.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/0 \n ip address 12.1.1.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/1 \n ip address 24.1.1.1 255.255.255.0 \n# \ninterface GigabitEthernet0/0/2 \n ip address 23.1.1.1 255.255.255.0 \n# \nospf 1 router-id 2.2.2.2 \n area 0.0.0.0 \n network 2.2.2.2 0.0.0.0 \n network 24.1.1.0 0.0.0.255 \n network 23.1.1.0 0.0.0.255 \n network 12.1.1.0 0.0.0.255 \n# \nbgp 2 \nrouter-id 2.2.2.2 \npeer 12.1.1.1 as-number 1 \npeer 3.3.3.3 as-number 2 \npeer 4.4.4.4 as-number 2 \npeer 5.5.5.5 as-number 2 \nnetwork 2.2.2.0 24 \n# \nreturn",
    "R3": "# \nsysname R3 \n# \ninterface LoopBack0 \n ip address 3.3.3.3 255.255.255.0 \n# \ninterface GigabitEthernet0/0/0 \n ip address 13.1.1.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/1 \n ip address 35.1.1.1 255.255.255.0 \n# \ninterface GigabitEthernet0/0/2 \n ip address 23.1.1.2 255.255.255.0 \n# \nospf 1 router-id 3.3.3.3 \n area 0.0.0.0 \n network 3.3.3.3 0.0.0.0 \n network 35.1.1.0 0.0.0.255 \n network 23.1.1.0 0.0.0.255 \n network 13.1.1.0 0.0.0.255 \n# \nbgp 2 \nrouter-id 3.3.3.3 \npeer 13.1.1.1 as-number 1 \npeer 2.2.2.2 as-number 2 \npeer 5.5.5.5 as-number 2 \npeer 4.4.4.4 as-number 2 \nnetwork 3.3.3.0 24 \nip ip-prefix p permit 1.1.1.0 24 \nroute-policy p permit node 10 \nroute-policy p permit node 20 \n# \nbgp 2 \npeer 6.6.6.6 route-policy p import \n# \nreturn",
    "R4": "# \nsysname R4 \n# \ninterface LoopBack0 \n ip address 4.4.4.4 255.255.255.0 \n# \ninterface GigabitEthernet0/0/0 \n ip address 24.1.1.1 255.255.255.0 \n# \ninterface GigabitEthernet0/0/1 \n ip address 45.1.1.1 255.255.255.0 \n# \ninterface GigabitEthernet0/0/2 \n ip address 46.1.1.1 255.255.255.0 \n# \nospf 1 router-id 4.4.4.4 \n area 0.0.0.0 \n network 4.4.4.4 0.0.0.0 \n network 46.1.1.0 0.0.0.255 \n network 45.1.1.0 0.0.0.255 \n network 24.1.1.0 0.0.0.255 \n# \nbgp 2 \nrouter-id 4.4.4.4 \npeer 5.5.5.5 as-number 2 \npeer 6.6.6.6 as-number 2 \npeer 2.2.2.2 as-number 2 \npeer 3.3.3.3 as-number 2 \nnetwork 4.4.4.0 24 \nip ip-prefix p permit 1.1.1.0 24 \nroute-policy p permit node 10 \nroute-policy p permit node 20 \nbgp 2 \npeer 6.6.6.6 route-policy p import \n# \nreturn",
    "R5": "# \nsysname R5 \n# \ninterface LoopBack0 \n ip address 5.5.5.5 255.255.255.0 \n# \ninterface GigabitEthernet0/0/0 \n ip address 35.1.1.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/1 \n ip address 45.1.1.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/2 \n ip address 56.1.1.1 255.255.255.0 \n# \nospf 1 router-id 5.5.5.5 \n area 0.0.0.0 \n network 5.5.5.5 0.0.0.0 \n network 35.1.1.0 0.0.0.255 \n network 45.1.1.0 0.0.0.255 \n network 56.1.1.0 0.0.0.255 \n# \nbgp 2 \nrouter-id 5.5.5.5 \npeer 6.6.6.6 as-number 2 \npeer 4.4.4.4 as-number 2 \npeer 3.3.3.3 as-number 2 \npeer 2.2.2.2 as-number 2 \npeer 3.3.3.3 reflect-client \nnetwork 5.5.5.0 24 \n# \nreturn",
    "R6": "# \nsysname R6 \n# \ninterface LoopBack0 \n ip address 6.6.6.6 255.255.255.0 \n# \ninterface GigabitEthernet0/0/0 \n ip address 46.1.1.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/1 \n ip address 56.1.1.2 255.255.255.0 \n# \nospf 1 router-id 6.6.6.6 \n area 0.0.0.0 \n network 6.6.6.6 0.0.0.0 \n network 46.1.1.0 0.0.0.255 \n network 56.1.1.0 0.0.0.255 \n# \nbgp 2 \nrouter-id 6.6.6.6 \npeer 4.4.4.4 as-number 2 \npeer 5.5.5.5 as-number 2 \nnetwork 6.6.6.0 24 \n# \nreturn"
  },
  "topology_original": "网络包含6台路由器（AR1-AR6）和2个自治系统（AS1、AS2），拓扑架构如下：\n\n1. 物理连接拓扑：\n   - AS1（边界路由器）：\n     • AR1(GE0/0/0) ↔ AR2(GE0/0/0)：12.1.1.0/24\n     • AR1(GE0/0/1) ↔ AR3(GE0/0/0)：13.1.1.0/24\n   \n   - AS2（核心网络）：\n     • AR2(GE0/0/2) ↔ AR3(GE0/0/2)：23.1.1.0/24\n     • AR2(GE0/0/1) ↔ AR4(GE0/0/0)：24.1.1.0/24\n     • AR3(GE0/0/1) ↔ AR5(GE0/0/0)：35.1.1.0/24\n     • AR4(GE0/0/1) ↔ AR5(GE0/0/1)：45.1.1.0/24\n     • AR4(GE0/0/2) ↔ AR6(GE0/0/0)：46.1.1.0/24\n     • AR5(GE0/0/2) ↔ AR6(GE0/0/1)：56.1.1.0/24\n\n2. 逻辑网络划分：\n   - AS2内部：\n     • 全OSPF域（Area 0），宣告所有物理接口及环回地址\n     • IBGP全互联架构：AR2/3/4/5/6通过环回地址建立邻居（2.2.2.2-6.6.6.6）\n     • 路由反射器：AR5作为RR服务AR3/4/6\n   \n   - 跨AS连接：\n     • EBGP邻居：AR1(AS1)-AR2/AR3(AS2)\n\n3. 关键地址规划：\n   - 环回地址（/24）：\n     • AS1：AR1(1.1.1.1、1.1.2.1)\n     • AS2：AR2(2.2.2.2)、AR3(3.3.3.3)、AR4(4.4.4.4)、AR5(5.5.5.5)、AR6(6.6.6.6)\n   \n   - BGP路由发布：\n     • AS1：精确发布1.1.1.0/24、1.1.2.0/24\n     • AS2：各设备发布自身环回网段\n\n4. 特殊路径要求：\n   - R1到AS2双出口：通过AR2(12.1.1.0/24)和AR3(13.1.1.0/24)形成主备路径\n   - R4/5/6到R1环回：\n     • 主路径：R4→R2→R1、R5→R3→R1、R6→R4→R2→R1\n     • 备份路径：R4→R5→R3→R1、R6→R5→R3→R1"
}