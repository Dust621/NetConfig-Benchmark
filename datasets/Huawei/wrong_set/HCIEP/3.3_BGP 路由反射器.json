{
  "topology": "**网络拓扑详细描述**\n\n**1. 物理拓扑结构**\n- 网络由4台路由器组成：R1、R2、R3、R4，形成链型拓扑结构\n- 物理连接关系：R1-R2-R3-R4线性串联，同时R4与R2之间有直连链路形成部分环形\n- 所有互联均为以太网接口，连接速率为千兆级别\n- 具体物理接口连接：\n  * R1 GE0/0/2 ↔ R2 GE0/0/3\n  * R2 GE0/0/2 ↔ R3 GE0/0/3  \n  * R3 GE0/0/2 ↔ R4 GE0/0/3\n  * R4 GE0/0/1 ↔ R2 GE0/0/1\n\n**2. IP地址分配方案**\n- **点对点互联地址**：\n  * R1-R2链路：10.0.12.1/24 ↔ 10.0.12.2/24\n  * R2-R3链路：10.0.23.2/24 ↔ 10.0.23.3/24\n  * R3-R4链路：10.0.34.3/24 ↔ 10.0.34.4/24\n  * R4-R2链路：10.0.24.4/24 ↔ 10.0.24.2/24\n\n- **设备管理地址（Loopback0）**：\n  * R1：10.0.1.1/32\n  * R2：10.0.2.2/32\n  * R3：10.0.3.3/32\n  * R4：10.0.4.4/32\n\n- **用户网段模拟（Loopback1）**：\n  * R1：10.1.1.1/24\n  * R2：10.2.2.2/24\n\n**3. 路由协议架构**\n- **AS归属**：所有设备均属于AS 64511（私有AS号段）\n- **IGP协议**：OSPF作为内部网关协议，覆盖所有互联接口和Loopback0接口\n- **BGP配置**：\n  * 协议类型：IBGP（内部BGP）\n  * Router ID：统一使用各设备Loopback0地址作为BGP Router ID\n  * 对等体建立方式：基于直连接口地址建立邻接关系\n\n**4. BGP路由反射器层次架构**\n- **反射器层次结构**：采用串联式路由反射器部署\n  * R2作为R1的路由反射器（RR），R1为R2的客户端（Client）\n  * R3作为R2的路由反射器（RR），R2为R3的客户端（Client）\n  * R4作为R3的路由反射器（RR），R3为R4的客户端（Client）\n  * R2同时具备客户端和反射器双重角色\n\n- **IBGP对等体关系**：\n  * R1 ↔ R2（客户端-反射器关系）\n  * R2 ↔ R3（客户端-反射器关系）\n  * R3 ↔ R4（客户端-反射器关系）\n  * R4 ↔ R2（对等体关系，用于冗余路径）\n\n**5. BGP防环机制验证设计**\n- **Originator_ID验证**：通过R2发布Loopback1路由，验证反射器在路由反射过程中添加的Originator_ID属性防环功能\n- **Cluster_List验证**：通过R1发布Loopback1路由，验证多级反射器环境中Cluster_List属性的防环机制\n\n**6. 网络特殊配置要点**\n- 采用非全连通IBGP设计，通过路由反射器解决BGP路由传递完整性问题\n- 多路径冗余设计：R4-R2直连提供备用路径\n- 分层反射器架构确保路由信息在整个AS内正确传播\n- 防环属性测试验证BGP路由反射器的安全性和可靠性",
  "requirement": "某公司的总部网络采用了BGP 协议作为路由协议，总部的4 台路由器之间建立IBGP 对等体关系（非全互联），为了让4 台路由器学习到完整的BGP 路由，现需要在网络中部署BGP 路由反射器。",
  "steps": [
    "设备基础IP 地址配置。",
    "配置AS 内的OSPF，在互联接口、Loopback0 接口上激活OSPF。",
    "配置AS 内基于直连接口建立IBGP 对等体关系。",
    "配置路由反射器，将R1 配置为R2 的客户端、R2 配置为R3 的客户端、R3 配置为R4 的客户端。",
    "在R2 上将Loopback1 接口路由发布进BGP，观察Originator_ID 属性如何实现路由防环。",
    "在R1 上将Loopback1 接口路由发布进BGP，观察Cluster_List 属性如何实现路由防环。"
  ],
  "configs": {
    "R1": "# \nsysname R1 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.12.1 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.1.1 255.255.255.255 \n# \ninterface LoopBack1 \n ip address 10.1.1.1 255.255.255.0 \n# \nbgp 64511 \n router-id 10.0.1.1 \n peer 10.0.12.2 as-number 64511 \n # \n ipv4-family unicast \n  undo synchronization \n  summary automatic \n  network 10.1.1.0 255.255.255.0 \n  peer 10.0.12.2 enable \n# \nospf 1 router-id 10.0.1.1 \n area 0.0.0.0 \n  network 10.0.1.1 0.0.0.0 \n  network 10.0.12.1 0.0.0.0 \n# \n# \nreturn",
    "R2": "# \nsysname R2 \n# \nacl number 2000 \n rule 5 permit \n# \ninterface GigabitEthernet0/0/1 \n ip address 10.0.24.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.23.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.12.2 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.2.2 255.255.255.255 \n# \ninterface LoopBack1 \n ip address 10.2.2.2 255.255.255.0 \n# \nbgp 64511 \n router-id 10.0.2.2 \n peer 10.0.12.1 as-number 64511 \n peer 10.0.23.3 as-number 64511 \n peer 10.0.24.4 as-number 64511 \n # \n ipv4-family unicast \n  undo synchronization \n  peer 10.0.12.1 enable \n  peer 10.0.12.1 reflect-client \n  peer 10.0.23.3 enable \n  peer 10.0.24.4 enable \n  peer 10.0.24.4 route-policy bgp export \n# \nospf 1 router-id 10.0.2.2 \n area 0.0.0.0 \n  network 10.0.2.2 0.0.0.0 \n  network 10.0.12.2 0.0.0.0 \n  network 10.0.23.2 0.0.0.0 \n  network 10.0.24.2 0.0.0.0 \n# \nroute-policy bgp deny node 10 \n if-match acl 2000 \n# \nreturn",
    "R3": "# \nsysname R3 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.34.3 255.255.255.0 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.23.3 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.3.3 255.255.255.255 \n# \nbgp 64511 \n router-id 10.0.3.3 \n peer 10.0.23.2 as-number 64511 \n peer 10.0.34.4 as-number 64511 \n # \n ipv4-family unicast \n  undo synchronization \n  peer 10.0.23.2 enable \n  peer 10.0.23.2 reflect-client \n  peer 10.0.34.4 enable \n# \nospf 1 router-id 10.0.3.3 \n area 0.0.0.0 \n  network 10.0.3.3 0.0.0.0 \n  network 10.0.23.3 0.0.0.0 \n  network 10.0.34.3 0.0.0.0 \n# \nreturn",
    "R4": "# \nsysname R4 \n# \ninterface GigabitEthernet0/0/1 \n ip address 10.0.24.4 255.255.255.0 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.34.4 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.4.4 255.255.255.255 \n# \nbgp 64511 \n router-id 10.0.4.4 \n peer 10.0.24.2 as-number 64511 \n peer 10.0.34.3 as-number 64511 \n # \n ipv4-family unicast \n  undo synchronization \n  peer 10.0.24.2 enable \n  peer 10.0.34.3 enable \n  peer 10.0.34.3 reflect-client \n# \nospf 1 router-id 10.0.4.4 \n area 0.0.0.0 \n  network 10.0.4.4 0.0.0.0 \n  network 10.0.24.4 0.0.0.0 \n  network 10.0.34.4 0.0.0.0 \n# \nreturn"
  },
  "topology_original": "R1、R2、R3、R4 都属于AS64511，其连接方式、互联接口地址如图所示。每台设备均创建Loopback0 接口，IP 地址为10.0.x.x/32，其中x 为设备编号。R1、R2 上的Loopback1 地址分别为10.1.1.1/24、10.2.2.2/24，用于模拟用户网段。所有设备都使用Loopback0 地址作为BGP Router ID，R1 与R2、R2 与R3、R3 与R4、R4 与R2 之间基于直连接口建立IBGP 对等体关系，其中R1 为R2 的路由反射器客户端，R2 为R3的路由反射器客户端，R3 为R4 的路由反射器客户端。"
}