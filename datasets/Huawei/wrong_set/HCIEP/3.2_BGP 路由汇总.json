{
  "topology": "## 网络拓扑详细描述\n\n### 物理拓扑结构\n本实验环境采用三台路由器构成的线性拓扑结构，设备型号为R1、R2、R3，通过以太网接口实现互联：\n- R1（AS 64511）通过GE0/0/2接口连接R2的GE0/0/3接口\n- R2（AS 64512）作为中转节点，通过GE0/0/3接口连接R1，通过GE0/0/2接口连接R3\n- R3（AS 64513）通过GE0/0/3接口连接R2的GE0/0/2接口\n\n### 逻辑网络架构\n\n#### IP地址规划方案\n**互联网段地址分配：**\n- R1-R2链路：10.0.12.0/24网段\n  - R1 GE0/0/2：10.0.12.1/24\n  - R2 GE0/0/3：10.0.12.2/24\n- R2-R3链路：10.0.23.0/24网段\n  - R2 GE0/0/2：10.0.23.2/24\n  - R3 GE0/0/3：10.0.23.3/24\n\n**设备管理地址（Loopback0）：**\n- R1：10.0.1.1/32（BGP Router ID）\n- R2：10.0.2.2/32（BGP Router ID）\n- R3：10.0.3.3/32（BGP Router ID）\n\n**用户网段模拟（测试网段）：**\n- R1用户网段：\n  - Loopback1：172.16.1.0/24\n  - Loopback2：172.16.2.0/24\n- R3用户网段：\n  - Loopback1：172.17.1.0/24\n  - Loopback2：172.17.2.0/24\n\n#### BGP自治系统架构\n- **AS 64511（R1）**：边界自治系统，承载用户网段172.16.0.0/16超网\n- **AS 64512（R2）**：中转自治系统，提供路由汇总和转发服务\n- **AS 64513（R3）**：边界自治系统，承载用户网段172.17.0.0/16超网\n\n### 协议配置特征\n\n#### EBGP对等体关系\n- R1-R2：基于直连接口10.0.12.1与10.0.12.2建立EBGP邻接\n- R2-R3：基于直连接口10.0.23.2与10.0.23.3建立EBGP邻接\n- 所有BGP会话使用Loopback0地址作为Router ID确保会话稳定性\n\n#### 路由汇总策略\n**R1自动汇总配置：**\n- 启用BGP自动汇总功能（auto-summary）\n- 将172.16.1.0/24和172.16.2.0/24自动汇总为172.16.0.0/16\n- 通过network命令或redistribute方式发布Loopback接口路由\n\n**R2手动汇总配置：**\n- 对R3传入的172.17.x.x/24路由执行手动汇总\n- 使用aggregate-address命令生成172.17.0.0/16汇总路由\n- 测试as-set参数对AS_PATH属性的影响\n\n### 设备角色和功能\n\n#### 核心功能划分\n- **R1（边界路由器）**：\n  - 用户网段接入点\n  - BGP路由发起者\n  - 实施自动路由汇总\n  \n- **R2（中转路由器）**：\n  - 跨AS路由转发\n  - 路由汇总策略执行点\n  - BGP路由属性操作节点\n  \n- **R3（边界路由器）**：\n  - 用户网段接入点\n  - BGP路由发起者\n  - 接收汇总路由验证点\n\n#### BGP路由传播路径\n1. R1发布用户路由→R2（接收汇总后的172.16.0.0/16）\n2. R2执行路由汇总→向R3传播\n3. R3发布用户路由→R2（执行手动汇总处理）\n4. R2生成汇总路由→向R1传播验证\n\n### 实验验证要点\n- 验证BGP邻接关系建立状态\n- 观察自动汇总与手动汇总的路由表差异\n- 分析as-set参数对AS_PATH属性的保持效果\n- 检查汇总路由的下一跳和MED属性变化",
  "requirement": "你是公司的网络管理员。公司的网络采用了BGP 协议作为路由协议。公司的网络由多个自治系统组成，不同的分支机构使用了不同的AS 号。随着公司规模的扩大，路由器中已经有越来越多的路由，进行BGP 的路由汇总迫在眉睫。你测试了几种进行路由汇总的方法，最终选择了合适的方式实现了路由汇总。",
  "steps": [
    "设备IP 地址配置。",
    "按照规划配置R1、R2、R3 之间的EBGP 对等体关系。",
    "在R1 上将Loopback1、Loopback2 接口路由发布到BGP 中并进行自动汇总，在R2 上观察BGP 汇总路由的明细信息。",
    "在R3 上将Loopback1、Loopback2 接口路由发布到BGP 中，在R2 上执行手动汇总，观察R2、R3 上的BGP 汇总路由的明细信息。之后在R2 上执行手动汇总并增加关键字as-set，再次观察R2 上的BGP 汇总路由的明细信息。"
  ],
  "configs": {
    "R1": "# \nsysname R1 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.12.1 255.255.255.0 \n# \ninterface NULL0 \n# \ninterface LoopBack0 \n ip address 10.0.1.1 255.255.255.255 \n# \ninterface LoopBack1 \n ip address 172.16.1.1 255.255.255.0 \n# \ninterface LoopBack2 \n ip address 172.16.2.1 255.255.255.0 \n# \nbgp 64511 \n router-id 10.0.1.1 \n peer 10.0.12.2 as-number 64512 \n # \n ipv4-family unicast \n  undo synchronization \n  summary automatic \n  import-route direct route-policy hcip \n  peer 10.0.12.2 enable \n# \nroute-policy hcip permit node 10 \n if-match ip-prefix 1 \n# \nip ip-prefix 1 index 10 permit 172.16.0.0 16 greater-equal 24 less-equal 24 \n# \nreturn",
    "R2": "# \nsysname R2 \n# \ninterface GigabitEthernet0/0/2 \n ip address 10.0.23.2 255.255.255.0 \n# \ninterface GigabitEthernet0/0/3 \n ip address 10.0.12.2 255.255.255.0 \n# \ninterface LoopBack0 \n ip address 10.0.2.2 255.255.255.255 \n# \nbgp 64512 \n router-id 10.0.2.2 \n peer 10.0.12.1 as-number 64511 \n peer 10.0.23.3 as-number 64513 \n # \n ipv4-family unicast \n  undo synchronization \n  aggregate 172.17.0.0 255.255.252.0 as-set detail-suppressed \n  peer 10.0.12.1 enable \n  peer 10.0.23.3 enable \n# \nreturn",
    "R3": "# \nsysname R3 \n# \ninterface LoopBack0 \n ip address 10.0.3.3 255.255.255.255 \n# \ninterface LoopBack1 \n ip address 172.17.1.1 255.255.255.0 \n# \ninterface LoopBack2 \n ip address 172.17.2.1 255.255.255.0 \n# \nbgp 64513 \n router-id 10.0.3.3 \n peer 10.0.23.2 as-number 64512 \n # \n ipv4-family unicast \n  undo synchronization \n  import-route direct route-policy hcip \n  peer 10.0.23.2 enable \n# \nroute-policy hcip permit node 10 \n if-match ip-prefix 1 \n# \nip ip-prefix 1 index 10 permit 172.17.0.0 16 greater-equal 24 less-equal 24 \n# \nreturn"
  },
  "topology_original": "BGP AS 号、互联地址如图所示，所有设备均创建Loopback0 接口，IP 地址为10.0.x.x/32，其中x 为设备编号。 R1、R2、R3 使用Loopback0 地址作为BGP Router ID，基于直连接口建立EBGP 对等体关系。 R1、R3 上存在Loopback1、Loopback2 接口，用于模拟用户网段。"
}