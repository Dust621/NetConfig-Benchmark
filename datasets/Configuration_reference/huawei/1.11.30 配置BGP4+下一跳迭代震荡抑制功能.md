```markdown
# 1.11.30 配置 BGP4+ 下一跳迭代震荡抑制功能

当下一跳频繁震荡时，通过配置该功能可以降低迭代到该下一跳路由的处理速度，从而节省系统资源，降低 CPU 占用率。

## 应用环境

如果有大量路由迭代到相同的下一跳，并且该下一跳频繁震荡时，系统就会频繁地处理迭代到该下一跳的大量路由的变化，这样会占用大量资源，导致 CPU 占用率升高。

为了解决上述问题，可以使能下一跳迭代震荡抑制功能，这样就会降低路由处理的速度，从而节省系统资源，降低 CPU 占用率。

缺省情况下，下一跳迭代震荡抑制功能是使能的。使能下一跳迭代震荡抑制功能后，BGP4+ 会将下一跳两次震荡的时间间隔与配置的时间阈值进行比较，根据比较结果来增加、保持和清除抑制计数，当抑制计数达到一定值（大于 10 次）时，将对下一跳迭代震荡进行抑制处理。

假设抑制惩罚计数的时间阈值为 T1、保持惩罚计数的时间阈值为 T2、清除惩罚计数的时间阈值为 T3，具体处理如下：

- 下一跳两次震荡的时间间隔小于 T1，惩罚计数加 1。
- 下一跳两次震荡的时间间隔大于等于 T1 小于 T2，惩罚计数不变。
- 下一跳两次震荡的时间间隔大于等于 T2 小于 T3，惩罚计数减 1。
- 下一跳两次震荡的时间间隔大于等于 T3，惩罚计数清 0。

## 前置任务

在配置 BGP4+ 下一跳迭代震荡抑制功能之前，需完成以下任务：

- 配置 BGP4+ 的基本功能

## 操作步骤

1. 执行命令 `system-view`，进入系统视图。

2. 执行命令 `bgp as-number`，进入 BGP 视图。

3. 执行命令 `ipv6-family unicast`，进入 IPv6 单播地址族视图。

4. 执行命令 `undo nexthop recursive-lookup restrain disable`，使能下一跳迭代震荡抑制功能。

   当用户不想减慢迭代处理、也不关心迭代变化处理是否会造成 CPU 占用率升高时，可以使用 `nexthop recursive-lookup restrain disable` 命令去使能下一跳迭代震荡抑制特性。

5. 执行命令 `quit`，退回 BGP 视图。

6. 执行命令 `nexthop recursive-lookup restrain suppress-interval add-count-time hold-interval hold-count-time clear-interval clear-count-time`，配置下一跳迭代震荡抑制需要的抑制惩罚计数的时间阈值、保持惩罚计数的时间阈值和清除惩罚计数的时间阈值。

7. 执行命令 `commit`，提交配置。

## 检查配置结果

完成配置后，可以按以下指导来检查配置结果：

- 使用 `display bgp ipv6 routing-table` 命令查看 BGP4+ 的公网路由信息。
- 使用 `display bgp vpnv6 routing-table` 命令查看 BGP VPNv6 路由和 BGP 私网路由的信息。
```