```markdown
# 1.10.10 配置BGP对等体组

通过配置BGP对等体组，可以简化BGP网络配置，提高路由的发布效率。

## 应用环境

一个BGP对等体组是具有相同的更新策略和配置要求的一系列BGP邻居。在大型BGP网络中，对等体的数目众多，配置和维护极为不便。对于存在相同配置的BGP对等体，可以把它们创建为一个BGP对等体组。使用对等体组进行批量配置，可以简化管理的难度，还可以提高路由发布效率。

根据对等体所在的AS是否相同，对等体组可分为以下三类：

- **IBGP对等体组**：所包括的对等体属于同一个内部AS。
- **纯EBGP对等体组**：所包括的对等体属于同一个外部AS。
- **混合EBGP对等体组**：所包括的对等体属于不同的外部AS。

对单个对等体和对等体组同时进行配置了某个功能时，单个对等体的配置生效。创建对等体组之后，可以向对等体组内加入新的对等体，新加入的对等体如果没有单独的配置，那么将继承对等体组的配置。加入对等体组之后，如果某个BGP对等体有特殊的配置要求，还可以进行单独的配置，单个对等体的配置将覆盖从对等体组继承的配置。

## 前置任务

在配置BGP对等体组之前，需完成以下任务：

- 配置BGP的基本功能。

## 1.10.10.1 创建IBGP对等体组

BGP有多个IBGP对等体时，创建IBGP对等体组可以简化BGP网络的配置和管理。创建IBGP对等体组不需要指定自治系统号。

### 操作步骤

1. 执行命令 `system-view`，进入系统视图。
2. 执行命令 `bgp as-number`，进入BGP视图。
3. 执行命令 `group group-name internal`，创建IBGP对等体组。
4. 执行命令 `peer ipv4-address group group-name`，向对等体组中加入对等体。

### 说明

- 重复步骤4，可向组中加入多个对等体。如果该对等体还未创建，系统会自动在BGP视图下创建该对等体，并设置其AS编号为对等体组的AS编号。
- 在BGP私网实例下，配置向对等体组中加入对等体除了可以用上述命令外，还可以通过执行 `peer group enable` 命令实现：该命令需要在VPN实例视图下先创建BGP对等体和BGP对等体组，然后在对应的BGP私网实例地址族视图下，使能BGP对等体和BGP对等体组。

创建IBGP对等体组不需要指定自治系统号。对等体组建立以后，可以为对等体组批量配置BGP的功能。默认情况下，对等体组内的对等体将继承对等体组的配置。如果为对等体直接进行单独的配置，那么单独的配置将代替从对等体组继承的配置。

5. （可选）执行命令 `peer group-name description description-text`，配置对等体组的描述信息。通过配置描述信息可以方便网络管理。
6. 执行命令 `commit`，提交配置。

---

## 1.10.10.2 创建纯EBGP对等体组

BGP有属于同一AS的多个EBGP对等体时，创建EBGP对等体组可以简化BGP网络的配置和管理。一个纯EBGP对等体组的所有对等体的AS号必须相同。

### 操作步骤

1. 执行命令 `system-view`，进入系统视图。
2. 执行命令 `bgp as-number`，进入BGP视图。
3. 执行命令 `group group-name external`，创建EBGP对等体组。
4. 执行命令 `peer group-name as-number as-number`，设置该对等体组所属的AS编号。如果对等体组中已经存在对等体，则不能改变该对等体组的自治系统号。
5. 执行命令 `peer ipv4-address group group-name`，向对等体组中加入对等体。

### 说明

- 重复步骤5，可向组中加入多个对等体。如果该对等体还未创建，系统会自动在BGP视图下创建该对等体，并设置其AS编号为对等体组的AS编号。
- 在BGP私网实例下，配置向对等体组中加入对等体除了可以用上述命令外，还可以通过执行 `peer group enable` 命令实现：该命令需要在VPN实例视图下先创建BGP对等体和BGP对等体组，然后在对应的BGP私网实例地址族视图下，使能BGP对等体和BGP对等体组。

对等体组建立以后，可以为对等体组批量配置BGP的功能。默认情况下，对等体组内的对等体将继承对等体组的配置。如果为对等体直接进行单独的配置，那么单独的配置将代替从对等体组继承的配置。

6. （可选）执行命令 `peer group-name description description-text`，配置对等体组的描述信息。通过配置描述信息可以方便网络管理。
7. 执行命令 `commit`，提交配置。

---

## 1.10.10.3 创建混合EBGP对等体组

BGP有属于不同AS的多个EBGP对等体时，创建混合EBGP对等体组，可以简化BGP网络的配置和管理。创建混合EBGP对等体组时，需要单独指定各对等体的自治系统号。

### 操作步骤

1. 执行命令 `system-view`，进入系统视图。
2. 执行命令 `bgp as-number`，进入BGP视图。
3. 执行命令 `group group-name external`，创建EBGP对等体组。
4. 执行命令 `peer ipv4-address as-number as-number`，创建对等体，设置对等体的AS编号。
5. 执行命令 `peer ipv4-address group group-name`，向对等体组中加入对等体。

### 说明

- 重复步骤4和步骤5，可向组中加入多个对等体。
- 在BGP私网实例下，配置向对等体组中加入对等体除了可以用上述命令外，还可以通过执行 `peer group enable` 命令实现：该命令需要在VPN实例视图下先创建BGP对等体和BGP对等体组，然后在对应的BGP私网实例地址族视图下，使能BGP对等体和BGP对等体组。

在混合EBGP对等体组中，需要单独指定各对等体的自治系统号。对等体组建立以后，可以为对等体组批量配置BGP的功能。默认情况下，对等体组内的对等体将继承对等体组的配置。如果为对等体直接进行单独的配置，那么单独的配置将代替从对等体组继承的配置。

6. （可选）执行命令 `peer group-name description description-text`，配置对等体组的描述信息。通过配置描述信息可以方便网络管理。
7. 执行命令 `commit`，提交配置。

---

## 1.10.10.4 检查配置结果

BGP对等体组配置成功后，可以查看BGP对等体的详细信息和对等体组信息。

### 前提条件

已经完成BGP对等体组的所有配置。

### 操作步骤

- 使用 `display bgp peer [ ipv4-address ] verbose` 命令查看对等体详细信息。
- 使用 `display bgp group [ group-name ]` 命令查看对等体组信息。

### 说明

该命令只有在创建BGP对等体组的设备上执行才能查看该对等体组的信息。如果指定了对等体组则显示该对等体组的详细信息；如果没有指定对等体组，将显示所有BGP对等体组信息。

---
```