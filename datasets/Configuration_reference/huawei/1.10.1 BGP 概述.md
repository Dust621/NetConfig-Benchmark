```markdown
# 1.10.1 BGP 概述

BGP（Border Gateway Protocol）是一种用于自治系统（AS，Autonomous System）之间的动态路由协议。它的设计目的是在AS之间更高效地传递路由信息，并维护大量的路由。

## BGP 的定义与版本

BGP 是一种外部网关协议（EGP），与OSPF、RIP等内部网关协议（IGP）不同。BGP 的早期版本包括 BGP-1、BGP-2 和 BGP-3，这些版本主要用于交换 AS 之间的可达路由信息，构建 AS 域间的传播路径，防止路由环路的产生，并在 AS 级别应用一些路由策略。当前广泛使用的版本是 BGP-4。

BGP 作为事实上的 Internet 外部路由协议标准，被广泛应用于 ISP（Internet Service Provider）之间。

## BGP 的特点

- **外部网关协议（EGP）**：BGP 是一种外部网关协议，与 OSPF、RIP 等内部网关协议不同。BGP 的重点不在于发现和计算路由，而在于在 AS 之间选择最佳路由和控制路由的传播。
  
- **基于 TCP 的传输**：BGP 使用 TCP 作为其传输层协议，提高了协议的可靠性。BGP 进行域间的路由选择，对协议的稳定性要求非常高，因此使用 TCP 协议的高可靠性来保证 BGP 协议的稳定性。BGP 的对等体之间必须在逻辑上连通，并进行 TCP 连接，目的端口号为 179，本地端口号任意。

- **支持 CIDR**：BGP 支持无类别域间路由 CIDR（Classless Inter-Domain Routing）。

- **增量更新**：在路由更新时，BGP 只发送更新的路由，大大减少了 BGP 传播路由所占用的带宽，适用于在 Internet 上传播大量的路由信息。

- **距离矢量协议**：BGP 是一种距离矢量（Distance-Vector）路由协议。

- **环路避免**：BGP 从设计上避免了环路的发生。
  - **AS 之间**：BGP 通过携带 AS 路径信息来标记途经的 AS，带有本地 AS 号的路由将被丢弃，从而避免了域间产生环路。
  - **AS 内部**：BGP 在 AS 内学到的路由不再通告给 AS 内的 BGP 邻居，避免了 AS 内产生环路。

- **丰富的路由策略**：BGP 提供了丰富的路由策略，能够对路由实现灵活的过滤和选择。

- **防止路由震荡**：BGP 提供了防止路由震荡的机制，有效提高了 Internet 网络的稳定性。

- **易于扩展**：BGP 易于扩展，能够适应网络新的发展。

## BGP 的应用场景

BGP 用于在 AS 之间传递路由信息，但并不是所有情况都需要运行 BGP。

### 需要使用 BGP 的情况

- **多 ISP 连接**：如图 1-99，用户需要同时与两个或多个 ISP 相连，ISP 需要向用户提供部分或完全的 Internet 路由。这时可以通过 BGP 路由携带的各种属性来决定目的地，选择走哪一个 ISP 的 AS 更为经济。

- **传递 AS 路径信息**：不同组织下的用户之间需要传递 AS 路径信息。

- **三层 VPN 传播私网路由**：用户需要通过三层 VPN 传播私网路由，请参见《HUAWEI NetEngine40E 特性描述-VPN》。

- **传播组播路由**：用户需要传播组播路由构造组播拓扑，请参见《HUAWEI NetEngine40E 特性描述-IP组播》。

### 不需要使用 BGP 的情况

- **单 ISP 连接**：用户只与一个 ISP 相连。

- **不提供 Internet 路由**：ISP 不需要向用户提供 Internet 路由。

- **使用缺省路由**：AS 间使用了缺省路由进行连接。
```